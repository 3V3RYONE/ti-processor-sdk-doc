

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10.1. Target &mdash; Processor SDK RTOS Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="Processor SDK RTOS Documentation" href="../index.html"/>
        <link rel="up" title="10. How to Guides" href="How_to_Guides.html"/>
        <link rel="next" title="11. Frequently Asked Questions" href="FAQ.html"/>
        <link rel="prev" title="10. How to Guides" href="How_to_Guides.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Processor SDK RTOS
          

          
          </a>

          
            
            
              <div class="version">
                05_03_00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Release_Specific.html">2. Release Specific</a></li>
<li class="toctree-l1"><a class="reference internal" href="Board_EVM_Abstration.html">3. Board/EVM Abstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Foundational_Components.html">4. Foundational Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="DSP_Software.html">5. DSP Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="Device_Drivers.html">6. Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="PRU_ICSS.html">7. PRU-ICSS Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="Compilers.html">8. Compilers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Examples_and_Demonstrations.html">9. Examples and Demonstrations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="How_to_Guides.html">10. How to Guides</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">10.1. Target</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#run-ipc-examples-on-am572x">10.1.1. Run IPC Examples on AM572x</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dra7xx-am572xx-ipc-examples">10.1.1.1. DRA7xx/AM572xx IPC Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#run-ipc-examples-on-am65xx">10.1.2. Run IPC Examples on AM65XX</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#am65xx-ipc-examples">10.1.2.1. AM65xx IPC Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#taking-the-c66x-out-of-reset-with-linux-running-on-the-arm-a15">10.1.3. Taking the C66x Out Of Reset with Linux Running on the ARM A15</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-to-take-the-c66x-dsp-out-of-reset-with-linux-running-on-a15">10.1.3.1. How to take the C66x DSP out of reset with Linux running on A15</a></li>
<li class="toctree-l4"><a class="reference internal" href="#target-configuration">10.1.3.2. Target Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#rtos-customization-using-an-external-input-to-trigger-an-interrupt-on-am57x">10.1.4. RTOS Customization: using an external input to trigger an interrupt on AM57x</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#hardware">10.1.4.1. Hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#software">10.1.4.2. Software</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-software-development">10.1.4.3. Application software development</a></li>
<li class="toctree-l4"><a class="reference internal" href="#test">10.1.4.4. Test</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#host">10.2. Host</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup">10.2.1. Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setup-ccs-for-evm-and-processor-sdk-rtos">10.2.1.1. Setup CCS for EVM and Processor-SDK RTOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-environment-when-installing-to-a-custom-path">10.2.1.2. Update environment when installing to a custom path</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prevent-beaglebone-board-reset-on-jtag-connect">10.2.1.3. Prevent BeagleBone board reset on JTAG Connect</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rebuild-drivers-from-pdk-directory">10.2.1.4. Rebuild drivers from PDK directory</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#flashing-and-boot">10.2.2. Flashing and Boot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#flash-bootable-images-c66x-k2h-k2e-k2l-only">10.2.2.1. Flash bootable images (C66x, K2H/K2E/K2L only)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#porting">10.2.3. Porting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-custom-board-library-target-to-processor-sdk-rtos-makefiles">10.2.3.1. Adding Custom Board_Library Target to Processor SDK RTOS makefiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#processor-sdk-rtos-porting-guide-for-am571x-am570x-speed-grades">10.2.3.2. Processor SDK RTOS Porting Guide for AM571x/AM570x Speed Grades</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#system-integration">10.2.4. System Integration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-dsp-and-ipu-firmware-using-pdk-drivers-and-ipc-to-load-from-arm-linux-on-am57xx-devices">10.2.4.1. Create DSP and IPU firmware using PDK drivers and IPC to load from ARM Linux on AM57xx devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customizing-memory-map-for-creating-multicore-applications-on-am57xx-using-ipc">10.2.4.2. Customizing Memory map for creating Multicore Applications on AM57xx using IPC</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipc-debugging-tools-and-techniques-on-am57xx">10.2.4.3. IPC Debugging Tools and Techniques on AM57xx</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#evm-hardware-setup">10.3. EVM Hardware Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#am65x-evm">10.3.1. AM65x EVM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#evm-layout-and-key-components">10.3.1.1. EVM Layout and Key Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="#minimum-hardware-setup-required-to-connect-to-evm">10.3.1.2. Minimum Hardware Setup Required to Connect to EVM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#am65x-debug-software-setup">10.3.1.3. AM65x Debug Software Setup</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="How_to_Guides.html#taking-the-c66x-out-of-reset-with-linux-running-on-the-arm-a15">10.4. Taking the C66x Out Of Reset with Linux Running on the ARM A15</a></li>
<li class="toctree-l2"><a class="reference internal" href="How_to_Guides.html#setup">10.5. Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="How_to_Guides.html#flashing-and-boot">10.6. Flashing and Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="How_to_Guides.html#porting">10.7. Porting</a></li>
<li class="toctree-l2"><a class="reference internal" href="How_to_Guides.html#system-integration">10.8. System Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="How_to_Guides.html#am65x-evm">10.9. AM65x EVM</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">11. Frequently Asked Questions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Processor SDK RTOS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="How_to_Guides.html">10. How to Guides</a> &raquo;</li>
      
    <li>10.1. Target</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="target">
<h1>10.1. Target<a class="headerlink" href="#target" title="Permalink to this headline">¶</a></h1>
<div class="section" id="run-ipc-examples-on-am572x">
<h2>10.1.1. Run IPC Examples on AM572x<a class="headerlink" href="#run-ipc-examples-on-am572x" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dra7xx-am572xx-ipc-examples">
<h3>10.1.1.1. DRA7xx/AM572xx IPC Examples<a class="headerlink" href="#dra7xx-am572xx-ipc-examples" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="ipc-hello-example">IPC Hello Example:</p>
<p><strong>ex01_hello</strong></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The following examples demonstrate some of the rudimentary IPC
capabilities. They are mostly two processors examples. These examples
may be built for any two processors on your device, but only for two
at a time. An IPC Ping example using three processors is also
presented at the end.</p>
<p>Hello example uses the reader/writer design pattern. One processor will
be the reader and the other will be the writer. The reader creates a
message queue and waits on it for messages. The writer opens the
reader&#8217;s message queue and sends messages to it. The writer allocates
the message from a shared message pool and the reader returns the
message to the pool. Thus, messages are sent in only one direction.
Default settings of the Hello world example configures DSP1 as the
writer and DSP2 as the reader.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">if Windows 7 machine is used for building these examples,
<strong>GnuWin32</strong> make utility needs to be installed to run make which can be
downloaded from this link
<a class="reference external" href="http://gnuwin32.sourceforge.net/packages/make.htm">http://gnuwin32.sourceforge.net/packages/make.htm</a></p>
</div>
<p>Set <strong>GnuWin32\bin</strong> folder on file path and add a system variable
<strong>XDCTOOLS_JAVA_HOME</strong> to point to &#8220;<strong>c:\ti\ccsv6\eclipse\jre</strong>&#8220;</p>
<div class="highlight-cpp"><div class="highlight"><pre>set PATH=&lt;YOUR_PROCEEDING_PATH&gt;\GnuWin32\bin;%PATH%
set XDCTOOLS_JAVA_HOME=c:\ti\ccsv6\eclipse\jre
</pre></div>
</div>
<p>1. Change to the example folder by entering: cd
~/ti/ipc_nn_nn_nn_nn/examples/DRA7xx_bios_elf/<strong>ex01_hello</strong></p>
<p>2. Open readme.txt file and follow build instructions step-by-step. If
build this example on Ubuntu PC, make sure there is no spaces between
variable name and its value.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">DEPOT</span> <span class="p">(</span><span class="n">your</span> <span class="n">depository</span> <span class="n">folder</span> <span class="n">ex</span><span class="o">:</span> <span class="n">DEPOT</span><span class="o">=/</span><span class="n">Your_Ubuntu_home_folder</span><span class="o">/</span><span class="n">ti</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>BIOS_INSTALL_DIR=$(DEPOT)/bios_n_nn_nn_nn
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>IPC_INSTALL_DIR=$(DEPOT)/ipc_n_nn_nn_nn
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>XDC_INSTALL_DIR=$(DEPOT)/xdctools_n_nn_nn_nn
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>gnu.targets.arm.A15F=$(DEPOT)/ccsv6/tools/compiler/gcc-arm-none-eabi-4_8-2014q3
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>ti.targets.elf.C66=$(DEPOT)/ccsv6/tools/compiler/c6000_7.4.14
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>ti.targets.arm.elf.M4=$(DEPOT)/ccsv6/tools/compiler/arm_5.2.4
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>ti.targets.arp32.elf.ARP32_far=$(DEPOT)/ccsv6/tools/compiler/arm_5.2.4
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>See the following example, and ensure you are using the latest version
of folder names present in ~/ti folder:

DEPOT=/home/Your_Ubuntu_home_folder/ti

# Use the following environment assignment  (Note you must use 32 bit Java even in Ubuntu 14.04 64 bit OS environment)
export XDCTOOLS_JAVA_HOME=/home/Your_Ubuntu_home_folder/ti/ccsv6/eclipse/jre

#### BIOS-side dependencies ####
BIOS_INSTALL_DIR=$(DEPOT)/bios_6_41_04_54
IPC_INSTALL_DIR=$(DEPOT)/ipc_3_36_01_11
XDC_INSTALL_DIR=$(DEPOT)/xdctools_3_31_02_38

#### BIOS-side toolchains ####
gnu.targets.arm.A15F=$(DEPOT)/ccsv6/tools/compiler/gcc-arm-none-eabi-4_8-2014q3
ti.targets.elf.C66=$(DEPOT)/ti-cgt-c6000_8.0.3
ti.targets.arm.elf.M4=$(DEPOT)/ccsv6/tools/compiler/ti-cgt-arm_5.2.4
ti.targets.arp32.elf.ARP32_far=$(DEPOT)/ccsv6/tools/compiler/ti-cgt-arm_5.2.4
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Run make command in current folder to build DSP1 and DSP2 hello examples. Output files are created under debug sub folders.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>ex01_hello\dsp1\bin\debug</li>
<li>ex01_hello\dsp2\bin\debug</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Launch target configurations.</li>
<li>Right click CortexA15_0 and connect target.</li>
<li>On CCS &#8211;&gt; Scripts &#8211;&gt; AM572 Multicore Initialization &#8211;&gt; Run AM572x Multicore EnableAllCore</li>
<li>Initialize DDR configuration. On CCS &#8211;&gt; Scripts &#8211;&gt; DDR configurations &#8211;&gt; AM572_DDR3_532MHz_config</li>
<li>Load DSP1 Hello Example hello_dsp1.xe66 (writer)file on DSP1.</li>
<li>Load DSP2 Hello Example hello_dsp2.xe66 (reader) file on DSP2.</li>
<li>Run both DSP1 and DSP2.</li>
<li>On CCS &#8211;&gt; Tools &#8211;&gt; RTOS Object view (ROV).</li>
<li>Suspend (halt) DSP1 to view test messages on ROV Viewable Modules &#8211;&gt;LoggerBuf Refer below image of ROV log messages.</li>
</ol>
<img alt="../_images/Hello_dsp2.png" src="../_images/Hello_dsp2.png" />
<ol class="arabic simple" start="13">
<li>Suspend (halt) DSP2 and click on ROV icon to view log messages.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="ipc-message-queue-example">IPC Message Queue Example:</p>
<p><strong>ex02_messageq</strong></p>
<p>Message queue example sends round-trip message from client to server and
back. MessageQ example uses client/server pattern. It is a two
processors example: the HOST and DSP processors. Either DSP1 or DSP2 can
be built for testing.</p>
<p>The DSP processor is configured as server. It creates a named message
queue. The server does not open any queues because it extracts the
return address from the message header. The server returns all messages
to the sender. It does not access the message pool.</p>
<p>The HOST processor is configured as client application. The client
creates an anonymous message queue. The client also creates and manages
the message pool. The client&#8217;s return address is set in the message
header for each message before sending it to the server.</p>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Change to messageQ folder example by enter:</dt>
<dd><p class="first last">cd  ~/ti/ipc_nn_nn_nn_nn/examples/DRA7xx_bios_elf/<strong>ex02_messageQ</strong></p>
</dd>
</dl>
</li>
</ol>
<p>2. Open readme.txt file and follow build instructions step-by-step. Make
sure there is no spaces between variable name and its value. See Hello
World example environment varaible settings for reference.</p>
<ol class="arabic simple" start="3">
<li>Run make command in current folder to build DSP1 and HOST hello examples. Output files are created under debug sub folders</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>ex02_messageq\host\bin\debug : HOST A15 binary</li>
<li>ex02_messageq\dsp1\bin\debug : C66x binary</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Launch target configurations. Note that BH560USB_M is emulator is used to connect to AM572X EVM.</li>
<li>Right click CortexA15_0 and connect target.</li>
<li>On CCS &#8211;&gt; Scripts &#8211;&gt; AM572 Multicore Initialization &#8211;&gt; Run AM572x Multicore EnableAllCore</li>
<li>Initialize DDR configuration. On CCS &#8211;&gt; Scripts &#8211;&gt; DDR configurations &#8211;&gt; AM572_DDR3_532MHz_config</li>
<li><strong>Load DSP1</strong> messageQ Example out file(server_dsp1.xe66) onto DSP1.</li>
<li><strong>Load HOST</strong> messageQ Example out file(app_host.xa15fg) onto ARM CortexA15_0.</li>
<li>Run both DSP1 and HOST.</li>
<li>On CCS &#8211;&gt; Tools &#8211;&gt; RTOS Object view (ROV).</li>
<li>Suspend (halt) ARM Cortex_A15 to view test messages on ROV Viewable Modules &#8211;&gt;LoggerBuf Refer the following ROV message queue screenshot</li>
</ol>
<img alt="../_images/MesgQ_arm0.png" src="../_images/MesgQ_arm0.png" />
<ol class="arabic simple" start="13">
<li>Suspend (halt) DSP1 and click on ROV icon to view log messages.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="ipc-notify-peer-example">IPC Notify Peer Example:</p>
<p><strong>ex13_notifypeer</strong></p>
<p>Notify peer example only uses notify to communicate to a peer processor.
This is an example of IPC Scalability. It uses the client/server design
pattern. Initially, the example builds only for two processors: HOST and
DSP1. The client runs on HOST and the server runs on DSP1.</p>
<p>The client (HOST) creates an anonymous message queue. The client also
creates and manages its own message pool. And it opens the server
message queue using its name. The client initiates the data flow by
allocating a message from the pool, placing its return address in the
message header and sending the message to the server. It then waits for
the message to be returned. When it receives the return message, the
message is returned to the pool. The client repeats this in a loop.</p>
<p>The server (DSP1) creates a named message queue, then waits on it for
messages. When a message arrives, the server performs the requested
work. When the work is done, the server extracts the return address from
the message header and sends the message back to the client. The server
never opens any message queues and does not access the message pool.</p>
<p>Since DSP1 will need to wait on both the message queue and the notify
queue, we introduce events. The SYS/BIOS event object can be used to
wait on multiple input sources.</p>
<ol class="arabic simple">
<li>Change to notify_peer folder example by enter: cd ~/ti/ipc_nn_nn_nn_nn/examples/DRA7xx_bios_elf/<strong>ex13_notifypeer</strong></li>
<li>Open readme.txt file and follow build instructions step-by-step. Make sure there is no spaces between variable name and its value.</li>
<li>Run make command in current folder to build DSP1 and HOST notifypeer examples. Output files are created under debug subfolder.</li>
<li>Launch target configurations. Note that BH560USB_M is emulator is used to connect to AM572X EVM.</li>
<li>Right click CortexA15_0 and connect target.</li>
<li>On CCS &#8211;&gt; Scripts &#8211;&gt; AM572 Multicore Initialization &#8211;&gt; Run AM572x Multicore EnableAllCore</li>
<li>Initialize DDR configuration. On CCS &#8211;&gt; Scripts &#8211;&gt; DDR configurations &#8211;&gt; AM572_DDR3_532MHz_config</li>
<li><strong>Load DSP1</strong> notifypeer Example out file on DSP1.</li>
<li><strong>Load HOST</strong> notifypeer Example out file on ARM CortexA15_0.</li>
<li>Run both DSP1 and CortexA15_0.</li>
<li>On CCS &#8211;&gt; Tools &#8211;&gt; RTOS Object view (ROV).</li>
<li>Suspend (halt) ARM CortexA15_0 to view test messages on ROV Viewable Modules &#8211;&gt;LoggerBuf. Refer the following image of ROV log messages</li>
</ol>
<img alt="../_images/Notify_peer_arm0.png" src="../_images/Notify_peer_arm0.png" />
<ol class="arabic simple" start="13">
<li>Suspend (halt) DSP2 and click on ROV icon to view log messages.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="ipc-ping-example">IPC Ping Example:</p>
<p><strong>ex11_ping</strong></p>
<p>ping example sends a message between all cores in the system. This
example is used to exercise every communication path between all
processors in the system (including local delivery on the current
processor). Ping example is also organized in a suitable manner to
develop an application with different compute units on each processor.</p>
<p>Each executable will create two tasks: 1) the server task, and 2) the
application task. The server task creates a message queue and then waits
on that queue for incoming messages. When a message is received, the
server task simply sends it back to the original sender.</p>
<p>The application task creates its own message queue and then opens every
server message queue in the system (including the server queue on the
local processor). The task sends a message to a server and waits for the
message to be returned. This is repeated for each server in the system
(including the local server).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that presently EVE is not yet supported and therefore,
DSP1/DSP2/HOST are built for testing.</p>
</div>
<p>1. Change to ping folder example by enter: cd
~/ti/ipc_nn_nn_nn_nn/examples/DRA7xx_bios_elf/<strong>ex11_ping</strong></p>
<p>2. Open readme.txt file and follow build instructions step-by-step. Make
sure there is no space between variable name and its value.</p>
<ol class="arabic simple" start="3">
<li>Open makefile and remove EVE and IPU from PROC build list.</li>
<li>Run make command in current folder to build DSP1, DSP2 and HOST ping examples. Output files are created under debug subfolder.</li>
<li>Launch target configurations. Note that BH560USB_M is emulator is used to connect to AM572X EVM.</li>
<li>Right click CortexA15_0 and connect target.</li>
<li>On CCS &#8211;&gt; Scripts &#8211;&gt; AM572 Multicore Initialization &#8211;&gt; Run AM572x Multicore EnableAllCore</li>
<li>Initialize DDR configuration. On CCS &#8211;&gt; Scripts &#8211;&gt; DDR configurations &#8211;&gt; AM572_DDR3_532MHz_config</li>
<li><strong>Load DSP1</strong> Ping Example out file on DSP1.</li>
<li><strong>Load DSP2</strong> Ping Example out file on DSP2.</li>
<li><strong>Load HOST</strong> ping Example onto ARM CortexA15_0</li>
<li>Run DSP1, DSP2, and HOST images.</li>
<li>On CCS &#8211;&gt; Tools &#8211;&gt; RTOS Object view (ROV).</li>
<li>Halt DSP1 to view test messages on ROV Viewable Modules &#8211;&gt;LoggerBuf Refer below image of ROV log messages</li>
</ol>
<img alt="../_images/Ping_dsp1.png" src="../_images/Ping_dsp1.png" />
<ol class="arabic simple" start="15">
<li>Suspend (halt) DSP2 and click on ROV icon to view log messages.</li>
<li>Suspend (halt) ARM CortexA15_0 and click on ROV icon to view log messages.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="expanding-ipc-ping-example">Expanding IPC Ping Example:</p>
<p>To demonstrate the flexibility of IPC architecture, you may include
additional cores to the above example by modifying the make file. For
example, you may add IPU1 in the list of processor in the make file as:
DSP1, DSP2, <strong>IPU1,</strong> HOST. After a clean build, the appropriate
configuration and output executable files will be generated that allow
passing messages between DSP1, DSP2, IPU1 and Host. Procedures are the
same as described in the previous example with the exception of
additional steps to load the IPU1 core with the corresponding executable
and running it in conjunction with DSP1, DSP2 and HOST.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>During build process using IPU1, you may encounter a message
indicating <strong>rtsv7M4_T_le_eabi.lib</strong> library is missing. This is a know
issue and is being tracked by <strong>SDCOM00118417</strong> IR. However, you may
create this missing library by going to the compiler installation&#8217;s
<strong>lib</strong> directory and execute the following command to regenerate all
required libraries:</p>
<div class="last highlight-cpp"><div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">mklib</span> <span class="o">--</span><span class="n">all</span>
</pre></div>
</div>
</div>
<p>The following example depicts a typical host communications protocol
with other IPC apps (dsp1, dsp2, ipu1) <strong>Note that the following HOST
communications list has been rearranged to further clarify the type of
communications between various cores</strong>. Typically these messages arrive
at different intervals depending on each core processes execution time.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="mi">1</span>    <span class="n">xdc</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">Main</span>    <span class="o">--&gt;</span> <span class="n">main</span><span class="o">:</span>
<span class="mi">2</span>    <span class="n">xdc</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">Main</span>    <span class="n">main</span><span class="o">:</span> <span class="n">ipc</span> <span class="n">ready</span>
<span class="mi">3</span>    <span class="n">xdc</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">Main</span>    <span class="n">MainHost_svrTskFxn</span><span class="o">:</span>
<span class="mi">4</span>    <span class="n">SvrHost</span>    <span class="o">--&gt;</span> <span class="n">SvrHost_setup</span><span class="o">:</span>
<span class="mi">5</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_setup</span><span class="o">:</span> <span class="n">slave</span> <span class="n">is</span> <span class="n">ready</span>
<span class="mi">6</span>    <span class="n">SvrHost</span>    <span class="o">&lt;--</span> <span class="n">SvrHost_setup</span><span class="o">:</span>
<span class="mi">7</span>    <span class="n">SvrHost</span>    <span class="o">--&gt;</span> <span class="n">SvrHost_run</span><span class="o">:</span>
<span class="mi">8</span>    <span class="n">xdc</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">Main</span>    <span class="o">--&gt;</span> <span class="n">MainHost_appTskFxn</span><span class="o">:</span>
<span class="mi">9</span>    <span class="n">AppHost</span>    <span class="o">--&gt;</span> <span class="n">AppHost_setup</span><span class="o">:</span>

<span class="mi">10</span>    <span class="n">AppHost</span>    <span class="n">AppHost_setup</span><span class="o">:</span> <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>     <span class="n">opened</span> <span class="n">server</span> <span class="n">queue</span>
<span class="mi">11</span>    <span class="n">AppHost</span>    <span class="n">AppHost_setup</span><span class="o">:</span> <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>     <span class="n">opened</span> <span class="n">server</span> <span class="n">queue</span>
<span class="mi">12</span>    <span class="n">AppHost</span>    <span class="n">AppHost_setup</span><span class="o">:</span> <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>     <span class="n">opened</span> <span class="n">server</span> <span class="n">queue</span>
<span class="mi">28</span>    <span class="n">AppHost</span>    <span class="n">AppHost_setup</span><span class="o">:</span> <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>     <span class="n">opened</span> <span class="n">server</span> <span class="n">queue</span>

<span class="mi">32</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>
<span class="mi">34</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>
<span class="mi">36</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>
<span class="mi">38</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>
<span class="mi">40</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>

<span class="mi">33</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>
<span class="mi">35</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>
<span class="mi">37</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>
<span class="mi">39</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>
<span class="mi">41</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>

<span class="mi">13</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>
<span class="mi">14</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>
<span class="mi">15</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>
<span class="mi">16</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>
<span class="mi">17</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">0</span>

<span class="mi">42</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">44</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">46</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">48</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">50</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>

<span class="mi">43</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">45</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">47</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">49</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">51</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>

<span class="mi">18</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">19</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">20</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">21</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">22</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">1</span>

<span class="mi">52</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>
<span class="mi">55</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>
<span class="mi">58</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>
<span class="mi">61</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>
<span class="mi">64</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>

<span class="mi">54</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>
<span class="mi">57</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>
<span class="mi">60</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>
<span class="mi">63</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>
<span class="mi">66</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>

<span class="mi">53</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>
<span class="mi">56</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>
<span class="mi">59</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>
<span class="mi">62</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>
<span class="mi">65</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">2</span>

<span class="mi">67</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>
<span class="mi">69</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>
<span class="mi">71</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>
<span class="mi">73</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>
<span class="mi">75</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ping</span> <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>

<span class="mi">68</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>
<span class="mi">70</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>
<span class="mi">72</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>
<span class="mi">74</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>
<span class="mi">76</span>    <span class="n">AppHost</span>    <span class="n">AppHost_run</span><span class="o">:</span> <span class="n">ack</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>

<span class="mi">23</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>
<span class="mi">24</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>
<span class="mi">25</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>
<span class="mi">26</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>
<span class="mi">27</span>    <span class="n">SvrHost</span>    <span class="n">SvrHost_run</span><span class="o">:</span> <span class="n">message</span> <span class="n">received</span>     <span class="n">procId</span><span class="o">=</span><span class="mi">3</span>

<span class="mi">29</span>    <span class="n">AppHost</span>    <span class="n">AppHost_setup</span><span class="o">:</span> <span class="n">slave</span> <span class="n">is</span> <span class="n">ready</span>
<span class="mi">30</span>    <span class="n">AppHost</span>    <span class="o">&lt;--</span> <span class="n">AppHost_setup</span><span class="o">:</span>
<span class="mi">31</span>    <span class="n">AppHost</span>    <span class="o">--&gt;</span> <span class="n">AppHost_run</span><span class="o">:</span>
<span class="mi">77</span>    <span class="n">AppHost</span>    <span class="o">&lt;--</span> <span class="n">AppHost_run</span><span class="o">:</span> <span class="mi">0</span>
<span class="mi">78</span>    <span class="n">AppHost</span>    <span class="o">--&gt;</span> <span class="n">AppHost_destroy</span><span class="o">:</span>
<span class="mi">79</span>    <span class="n">AppHost</span>    <span class="o">&lt;--</span> <span class="n">AppHost_destroy</span><span class="o">:</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span>
<span class="mi">80</span>    <span class="n">xdc</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">Main</span>    <span class="o">&lt;--</span> <span class="n">MainHost_appTskFxn</span><span class="o">:</span> <span class="mi">0</span>
<span class="mi">81</span>    <span class="n">xdc</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">Main</span>    <span class="n">MainHost_done</span><span class="o">:</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="run-ipc-examples-on-am65xx">
<h2>10.1.2. Run IPC Examples on AM65XX<a class="headerlink" href="#run-ipc-examples-on-am65xx" title="Permalink to this headline">¶</a></h2>
<div class="section" id="am65xx-ipc-examples">
<h3>10.1.2.1. AM65xx IPC Examples<a class="headerlink" href="#am65xx-ipc-examples" title="Permalink to this headline">¶</a></h3>
<p>In the processor SDK release ipc examples can be built from the Processor SDK top level makefile.</p>
<p>See link for building IPC examples</p>
<p><a class="reference internal" href="index_Foundational_Components.html#ipc-rtos-examples"><em>IPC Examples</em></a></p>
<p>Once the examples are built, they can be run by loading and running the binaries using CCS through JTAG.
Please refer to the section &#8220;Advanced AM65x Debug Setup with DMSC Firmware Load&#8221; of the TMDX654 EVM Hardware Setup Guide for setting up the JTAG.</p>
<p><a class="reference internal" href="#advanced-am65x-debug-setup-with-dmsc-firmware-load">Advanced AM65x Debug Setup with DMSC Firmware Load</a></p>
<p class="rubric" id="id1">IPC Message Queue Example:</p>
<p><strong>ex02_messageq</strong></p>
<p>Message queue example sends round-trip message from client to server and
back. MessageQ example uses client/server pattern. It is a two
processors example: the HOST and R5F-0 processor.</p>
<p>The R5F-0 processor is configured as server. It creates a named message
queue. The server does not open any queues because it extracts the
return address from the message header. The server returns all messages
to the sender. It does not access the message pool.</p>
<p>The HOST processor is configured as client application. The client
creates an anonymous message queue. The client also creates and manages
the message pool. The client&#8217;s return address is set in the message
header for each message before sending it to the server.</p>
<p>Here are the steps to run the example.</p>
<ol class="arabic simple">
<li>Follow instructions above to build the IPC examples. The build will create the R5F-0 and HOST binaries under debug and release sub folders
For example</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>AM65XX_bios_elf\ex02_messageq\host\bin\debug\app_host.xa53fg : HOST A15 binary</li>
<li>AM65XX_bios_elfex02_messageq\r5f-0\bin\debug\server_r5f-0.xer5fg : R5 binary</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Follow procedure to initialize platform and launch target configuration through steps outlined
in the hardware setup guide referred above.</li>
<li>Right click R5 core 0 and connect target.</li>
<li><strong>Load R5F-0</strong> messageQ Example out file(server_r5f-0.xer5fg) onto R5F core 0.</li>
<li>Right click CortexA53_0 and connect target.</li>
<li><strong>Load HOST</strong> messageQ Example out file(app_host.xa53fg) onto ARM CortexA53_0.</li>
<li>Run both R5F-0 and HOST.</li>
<li>On CCS &#8211;&gt; Tools &#8211;&gt; RTOS Object view (ROV).</li>
<li>Suspend (halt) ARM Cortex_53 to view test messages on ROV Viewable Modules &#8211;&gt;LoggerBuf</li>
<li>Suspend (halt) R5F-0 and click on ROV icon to view log messages.</li>
</ol>
</div>
</div>
<div class="section" id="taking-the-c66x-out-of-reset-with-linux-running-on-the-arm-a15">
<h2>10.1.3. Taking the C66x Out Of Reset with Linux Running on the ARM A15<a class="headerlink" href="#taking-the-c66x-out-of-reset-with-linux-running-on-the-arm-a15" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-to-take-the-c66x-dsp-out-of-reset-with-linux-running-on-a15">
<h3>10.1.3.1. How to take the C66x DSP out of reset with Linux running on A15<a class="headerlink" href="#how-to-take-the-c66x-dsp-out-of-reset-with-linux-running-on-a15" title="Permalink to this headline">¶</a></h3>
<p>This document describes the procedure to bring the C66x core out of reset after
booting Linux, or at the u-boot prompt.These steps are necessary in to order to
load an application on the C66x core, without interfering with the operation of
Linux running on the A15.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to proceeding with the below instructions, please ensure that the latest <em class="xref std std-ref">Emulation Package</em>
is downloaded/installed through CCS. This will ensure the GEL files in your machine
has the reset routines described below.</p>
</div>
<ol class="arabic simple">
<li>Once Linux has booted, launch the target configuration.</li>
</ol>
<img alt="../_images/Outofreset_1_lali.JPG" src="../_images/Outofreset_1_lali.JPG" />
<ol class="arabic simple" start="2">
<li>With the target configuration launched, right click on K2x.ccxml and select
“Show all cores”</li>
</ol>
<img alt="../_images/Outofreset_2_lali.JPG" src="../_images/Outofreset_2_lali.JPG" />
<ol class="arabic simple" start="3">
<li>This will bring up the Non-Debuggable Devices section.
Right click and connect the CS_DAP_Debug_SS core.</li>
</ol>
<img alt="../_images/Outofreset_3_lali.JPG" src="../_images/Outofreset_3_lali.JPG" />
<ol class="arabic simple" start="4">
<li>Go to Tools&gt;GEL files and load the evmk2x.gel file by right clicking on the GEL file window.
The Gel file would typically be located in the CCS installation under
\ccsv6\ccs_base\emulation\boards\evmk2x\gel\</li>
</ol>
<img alt="../_images/Outofreset_4_lali.png" src="../_images/Outofreset_4_lali.png" />
<ol class="arabic simple" start="5">
<li>Once the GEL has been successfully loaded, go to Scripts&gt;default and select K2x_TakeDSPOutofReset.</li>
</ol>
<img alt="../_images/Outofreset_5_lali.png" src="../_images/Outofreset_5_lali.png" />
<ol class="arabic simple" start="6">
<li>At this point the console would indicate that the DSP is out of reset.</li>
</ol>
<img alt="../_images/Outofreset_6_lali.png" src="../_images/Outofreset_6_lali.png" />
<ol class="arabic simple" start="7">
<li>Now the DSP cores can be right-clicked and connected successfully.</li>
</ol>
<img alt="../_images/Outofreset_7_lali.png" src="../_images/Outofreset_7_lali.png" />
</div>
<div class="section" id="target-configuration">
<h3>10.1.3.2. Target Configuration<a class="headerlink" href="#target-configuration" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Once the DSP core is connected following the above out of reset routine, the DDR and PLL settings
done by u-boot would be overwritten by what&#8217;s in the GEL. In order to avoid this, please ensure that
the gel is NOT preloaded on the DSP core in the ccxml by leaving the initialization script blank.</p>
</div>
<img alt="../_images/Outofreset_8_lali.JPG" src="../_images/Outofreset_8_lali.JPG" />
</div>
</div>
<div class="section" id="rtos-customization-using-an-external-input-to-trigger-an-interrupt-on-am57x">
<h2>10.1.4. RTOS Customization: using an external input to trigger an interrupt on AM57x<a class="headerlink" href="#rtos-customization-using-an-external-input-to-trigger-an-interrupt-on-am57x" title="Permalink to this headline">¶</a></h2>
<p>This note explains how to develop an example using a General-Purpose Input/Output (GPIO) pin to capture an external input event and generate an interrupt by modifying an existing RTOS GPIO driver LED blinking example. The hardware setup, software development procedures and testing are done using TI AM572x IDK EVM. The same process can be extended to other TI Sitara devices, TI EVMs or custom platforms as well.</p>
<div class="section" id="hardware">
<h3>10.1.4.1. Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.ti.com/tool/TMDXIDK5728">The AM572x Industrial Development
Kit (IDK)</a> is used here for developing the example. The same expect to work with the <a class="reference external" href="http://www.ti.com/tool/TMDSIDK574">AM574x
IDK</a> as well.</p>
<p>From the <a class="reference external" href="http://www.ti.com/lit/ug/sprui64c/sprui64c.pdf">AM572x IDK EVM hardware
user guide</a>, the card has 3 push buttons: SW1, SW2 and SW3, but they all are used for different purposes. However, the card has a 60-pin female expansion connector J21, pins that are not used may be dedicated for GPIO input test purpose. Here J21 pin 4 is selected based on the following analysis:</p>
<ul class="simple">
<li>The Pin 4 signal is labeled as GPMC_CS0 and is connected to AM572x chip ball T1 as shown in the schematic:</li>
</ul>
<img alt="../_images/J21_gpio_input.png" src="../_images/J21_gpio_input.png" />
<img alt="../_images/gpmc_cs0_t1.png" src="../_images/gpmc_cs0_t1.png" />
<ul class="simple">
<li>From the AM5728 datasheet, T1 ball can be configured as GPMC_CS0 or GPIO2_19 based on different PINMUX modes.</li>
</ul>
</div>
<div class="section" id="software">
<h3>10.1.4.2. Software<a class="headerlink" href="#software" title="Permalink to this headline">¶</a></h3>
<p>The GPIO LED blink example is served as the reference example and the test is developed on the ARM A15 core, it should work for other cores. This section discusses several typical steps involved in the software development work:</p>
<ul class="simple">
<li>PinMux configuration</li>
<li>PRCM setup</li>
<li>Re-build board library</li>
<li>Application software development</li>
</ul>
<p><strong>PinMux configuration</strong></p>
<p>The default PinMux file has to be modified for GPIO2_19 pin usage:</p>
<ul class="simple">
<li>Use the PinMux Utility to open the default PinMux file pdk_am57xx_1_0_x\packages\ti\board\src\idkAM572x\idkAM572x_SR2.0.pinmux (for the latest Rev 1.3B EVM)</li>
<li>Select GPIO, then MyGPIO2:</li>
</ul>
<img alt="../_images/pinmux_gpio_1.png" src="../_images/pinmux_gpio_1.png" />
<ul class="simple">
<li>Then, scroll down, set gpio2_19 with ball #T1, pull up and Rx direction.</li>
<li>Finally, select Category filter as “SR2.0 – Platform Development Kit (PDK) and download the generated files.</li>
</ul>
<img alt="../_images/pinmux_gpio_2.png" src="../_images/pinmux_gpio_2.png" />
<ul class="simple">
<li>Four new files should be generated, with the only difference  being a new pin configuration added in boardPadDelayInit.c file:</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre> <span class="cm">/* GPIO2 - gpio2_19 on T1 - MyGPIO2 */</span>
<span class="p">{</span><span class="mh">0x14B4</span><span class="p">,</span> <span class="mh">0x6000E</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">}},</span>
</pre></div>
</div>
<ul class="simple">
<li>Replace the same files under pdk_am57xx_1_0_x\packages\ti\board\src\idkAM572x with the new ones.</li>
</ul>
<p><strong>PRCM setup</strong></p>
<p>Setup of the Power, Reset and Clock Management (PRCM) domain for newly added GPIO2 is required. The application code calls Board_init() API with a BOARD_INIT_MODULE_CLOCK flag to enable the clock domain. It is implemented in the Board_moduleClockInit() function inside pdk_am57xx_1_0_x\packages\ti\board\source\idkAM572x\idkAM572x_clock.c. It is found that GPIO2 is enabled already and no further code needed.</p>
<p><strong>Re-build board library</strong></p>
<p>The board library must be recompiled for the changes to take effect. This has several major steps:</p>
<ul class="simple">
<li>Setup the build environment by running setupenv script</li>
<li>Build the library with make command (e.g. “make board”) and the output will be under pdk_am57xx_1_0_x\packages\ti\board\lib\idkAM572x\a15\release</li>
</ul>
</div>
<div class="section" id="application-software-development">
<h3>10.1.4.3. Application software development<a class="headerlink" href="#application-software-development" title="Permalink to this headline">¶</a></h3>
<p>The GPIO LED blinking example (GPIO_LedBlink_idkAM572x_armTestProject) is used as the reference. The CCS project can be created by using pdkprojectcreate script, such as “pdkprojectcreate AM572x idkAM572x little gpio all arm”. Check <a class="reference external" href="http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_overview.html#rebuilding-components">PDK Example and Test Project Creation</a> for details.</p>
<p>This LED blink example uses 2 GPIO pins. The first pin is used to periodically generate an interrupt. The second pin is an output pin connected to an onboard LED, which toggles between low and high inside the interrupt ISR, thus driving the LED. Note the first pin doesn’t accept any external input, but using software to write a register (GPIO_IRQSTATUS_RAW_n) to generate interrupt.</p>
<p>Also note from GPIO_idkAM572x_board.c, the rising edge is configured to generate interrupt:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">GPIO_PinConfig</span> <span class="n">gpioPinConfigs_1p3</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="cm">/* Input pin with interrupt enabled */</span>
  <span class="n">GPIO_DEVICE_CONFIG</span><span class="p">(</span><span class="n">GPIO_GRN_LED_PORT_NUM_1P3</span><span class="p">,</span> <span class="n">GPIO_GRN_LED_PIN_NUM_1P3</span><span class="p">)</span> <span class="o">|</span>
  <span class="n">GPIO_CFG_IN_INT_RISING</span> <span class="o">|</span> <span class="n">GPIO_CFG_INPUT</span><span class="p">,</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>After understanding how the reference example works, the code can be modified to use the first pin to receive external input and trigger the interrupt, then the second pin works the same way to toggle the LED, visualizing the event input.</p>
<p>Code modifications:
•       GPIO_board.h: this file defines the GPIO pins for the test, the first pin needs to be updated</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#define GPIO_INTR_LED_BASE_ADDR_1P3      (CSL_MPU_GPIO2_REGS)</span>
<span class="cp">#define GPIO_LED_PIN_NUM_1P3             (0x13U)</span>
</pre></div>
</div>
<ul class="simple">
<li>GPIO_idkAM572x_board.c: this file also defines the GPIO pins for the test, the first pin needs to be updated</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* GPIO Definitions specific Rev1p3 Board */</span>
<span class="cm">/* GPIO pin number connected to the green LED */</span>
<span class="cp">#define GPIO_GRN_LED_PIN_NUM_1P3    (0x13)</span>

<span class="cm">/* GPIO port number connected to the green LED */</span>
<span class="cp">#define GPIO_GRN_LED_PORT_NUM_1P3   (0x02)</span>
</pre></div>
</div>
<ul class="simple">
<li>main_led_blink.c: this is the main test program. The change is high-lighted in black, while the original code is in grey.</li>
</ul>
<ol class="arabic simple">
<li>Inside void gpio_test(UArg arg0, UArg arg1) routine there is a while(1) loop that continuously triggers the interrupt by software write. Since the new example relies on the external input event to trigger it, one can simply add another while(1) in front of it to block the original loop:</li>
</ol>
<div class="highlight-cpp"><div class="highlight"><pre>while(1);  //New added loop
while(1)
    {
            if defined(SOC_AM574x) || defined(SOC_AM572x) || defined(SOC_AM571x)|| defined(SOC_AM335x) || defined(SOC_AM437x)
            #if defined (idkAM572x) || defined (idkAM574x)
              ….
}
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Also inside the same void gpio_test(UArg arg0, UArg arg1) routine, one may add a debounce control before the test loop:</li>
</ol>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* Write high to gpio pin to control LED1 */</span>
<span class="n">GPIO_write</span><span class="p">((</span><span class="n">USER_LED1</span><span class="p">),</span> <span class="n">GPIO_PIN_VAL_HIGH</span><span class="p">);</span>

<span class="cm">/* Add new debounce code here */</span>
<span class="n">GPIOAppUpdateConfig</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gpioBaseAddr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gpioPin</span><span class="p">);</span>
<span class="n">GPIODebounceFuncControl</span><span class="p">(</span><span class="n">gpioBaseAddr</span><span class="p">,</span> <span class="n">gpioPin</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">GPIODebounceTimeConfig</span><span class="p">(</span><span class="n">gpioBaseAddr</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>

<span class="n">AppDelay</span><span class="p">(</span><span class="n">DELAY_VALUE</span><span class="p">);</span>

<span class="n">GPIO_log</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> GPIO Led Blink Application </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>After all the code changes, rebuild the test application. A GPIO_LedBlink_idkAM572x_armTestProject.out should be generated.</p>
</div>
<div class="section" id="test">
<h3>10.1.4.4. Test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h3>
<p><strong>Test Setup</strong>
The test setup using AM572x IDK EVM is depicted below:</p>
<img alt="../_images/gpio_test.png" src="../_images/gpio_test.png" />
<ul class="simple">
<li>The EVM is powered with a +5V power supply</li>
<li>A micro USB cable is connected to the host PC for on-board XDS100v2 JTAG connection and UART console.</li>
<li>A wire is connected to J21 pin4 as the event input. Another wire is connected to J21 pin 60 as the digital ground. When the two wires touch each other, pin 4 goes low, creating a GPIO falling edge. On the other hand, when the two wires are not touching, pin 4 goes high, creating a GPIO rising edge.</li>
</ul>
<p><strong>Test Procedure</strong></p>
<ul class="simple">
<li>Connect to the A15_0 with a JTAG emulator and use the default GEL file to initialize the SOC.</li>
<li>Load the test application (GPIO_LedBlink_idkAM572x_armTestProject.out) and run.</li>
<li>Touch the two wires, then un-touch, the LED should flip the status and keep steady until next touch, un-touch cycle.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="host">
<h1>10.2. Host<a class="headerlink" href="#host" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup">
<h2>10.2.1. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<div class="section" id="setup-ccs-for-evm-and-processor-sdk-rtos">
<span id="processor-sdk-rtos-setup-ccs-label"></span><h3>10.2.1.1. Setup CCS for EVM and Processor-SDK RTOS<a class="headerlink" href="#setup-ccs-for-evm-and-processor-sdk-rtos" title="Permalink to this headline">¶</a></h3>
<div class="section" id="overview">
<h4>10.2.1.1.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h4>
<p>This page provides information on configuring CCS to work with both the
EVM and the Processor-SDK for RTOS.</p>
</div>
<div class="section" id="discovering-sdk-products">
<h4>10.2.1.1.2. Discovering SDK products<a class="headerlink" href="#discovering-sdk-products" title="Permalink to this headline">¶</a></h4>
<div class="section" id="ccs-and-sdk-installed-in-same-directory">
<h5>10.2.1.1.2.1. CCS and SDK installed in same directory<a class="headerlink" href="#ccs-and-sdk-installed-in-same-directory" title="Permalink to this headline">¶</a></h5>
<p>After installing the Processor-SDK RTOS, start CCS and it will
automatically detect the newly installed components (<em>products</em>):</p>
<img alt="../_images/CCS-discovered-products.png" src="../_images/CCS-discovered-products.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="ccs-and-sdk-installed-in-different-directories">
<h5>10.2.1.1.2.2. CCS and SDK installed in different directories<a class="headerlink" href="#ccs-and-sdk-installed-in-different-directories" title="Permalink to this headline">¶</a></h5>
<p>If you chose to install the SDK package in a different folder from where
CCS is installed (e.g. C:\TEMP\RTOS-SDK\am57x), then you will need to
add the path to the search path for CCS to locate the new packages. The
screenshots below demonstrate the process to setup the CCS environment;
the sequence for a Linux host is the same.</p>
<div class="section" id="go-to-product-preference">
<h6>10.2.1.1.2.2.1. Go to product preference<a class="headerlink" href="#go-to-product-preference" title="Permalink to this headline">¶</a></h6>
<p>From CCS, select &#8220;Window -&gt; Preferences&#8221;:</p>
<img alt="../_images/CCS-GP57x-EVM-Custom-Preferences.png" src="../_images/CCS-GP57x-EVM-Custom-Preferences.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="enter-path-to-sdk">
<h6>10.2.1.1.2.2.2. Enter path to SDK<a class="headerlink" href="#enter-path-to-sdk" title="Permalink to this headline">¶</a></h6>
<p>In the Preferences window, select &#8220;Code Composer Studio -&gt; RTSC -&gt;
Products&#8221; in the panel on the left. Then, press the &#8220;Add&#8221; button on the
panel on the right:</p>
<img alt="../_images/CCS-GP57x-EVM-Custom-Add.png" src="../_images/CCS-GP57x-EVM-Custom-Add.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="verify-components">
<h6>10.2.1.1.2.2.3. Verify components<a class="headerlink" href="#verify-components" title="Permalink to this headline">¶</a></h6>
<p>Next, verify the newly discovered products. If everything is correct,
press the &#8220;Finish&#8221; button on the bottom:</p>
<img alt="../_images/CCS-GP57x-EVM-Custom-Finish.png" src="../_images/CCS-GP57x-EVM-Custom-Finish.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="restart-ccs">
<h6>10.2.1.1.2.2.4. Restart CCS<a class="headerlink" href="#restart-ccs" title="Permalink to this headline">¶</a></h6>
<p>When prompted, restart CCS for changes to take effect. You will see
newly discovered products from the custom path.</p>
<img alt="../_images/CCS-GP57x-EVM-Custom-Confirm.png" src="../_images/CCS-GP57x-EVM-Custom-Confirm.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="install-latest-emulation-package-and-sitara-device-support-package">
<h5>10.2.1.1.2.3. Install Latest Emulation Package and Sitara Device Support Package<a class="headerlink" href="#install-latest-emulation-package-and-sitara-device-support-package" title="Permalink to this headline">¶</a></h5>
<p>1. In CCS, navigate to Help -&gt; Check for Updates and select &#8220;Sitara device support&#8221;
and &#8220;TI Emulators&#8221; and click Next.</p>
<blockquote>
<div><img alt="../_images/CCS_Check_for_Updates.PNG" src="../_images/CCS_Check_for_Updates.PNG" />
</div></blockquote>
<p>2. Click &#8220;Next&#8221; again, select &#8220;I accept the terms of the license agreements&#8221;
and click Finish to begin the installation.</p>
<blockquote>
<div><img alt="../_images/CCS_Updating_Software.png" src="../_images/CCS_Updating_Software.png" />
</div></blockquote>
<p>3. You may be prompted to restart CCS for the updates to take effect. Click &#8220;Restart Now&#8221; when
prompted to complete the installation.</p>
</div>
<div class="section" id="create-target-configuration-file-for-evm">
<h5>10.2.1.1.2.4. Create Target Configuration File for EVM<a class="headerlink" href="#create-target-configuration-file-for-evm" title="Permalink to this headline">¶</a></h5>
<p>In CCS, you need to create a <em>Target Configuration</em> for your EVM to be
able to connect to the target. This configuration defines your:</p>
<ul class="simple">
<li>Connection to the target (XDS, FET, etc.)</li>
<li>Target device (AM437x GP EVM, AM57x GP EVM, etc.)</li>
<li>GEL file for hardware initialization. A GEL file is basically a
“batch file” that sets up the CCS debug environment including memory
map, PLL, clock, etc.</li>
</ul>
<p>CCS comes with basic configuration that can be used to configure your
particular setup. In the example below, we provide details for a GP
AM437x EVM; configuration information for other supported EVMs are also
provided as needed.</p>
<p>For EVM specific instructions, refer to the <strong>Hardware User&#8217;s Guide</strong>
for your <a class="reference external" href="index_release_specific.html#supported-platforms-and-versions">EVM</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Note for K2G devices:</strong> If using CCS v6.1.2 and Keystone2 device
support v1.1.7, 66AK2G02 would not show up in the list of devices when
creating the target configuration. This is due to an incompatibility in
the XML parser in CCS v6.1.2 with the K2G device xml. In order to
work-around this issue, make the change in 66AK2G02.xml as illustrated
below in order to have 66AK2G02 display in the device list. This problem
does not exist in CCS v6.1.3 onwards as the XML parser has been updated.</p>
<div class="last highlight-cpp"><div class="highlight"><pre>C:\ti\ccsv6\ccs_base\common\targetdb\devices\66AK2G02.xml

Line #1

&lt;?xml version=&quot;1.1&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
to
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
</pre></div>
</div>
</div>
<div class="section" id="open-new-target-configuration-file">
<h6>10.2.1.1.2.4.1. Open new target configuration file<a class="headerlink" href="#open-new-target-configuration-file" title="Permalink to this headline">¶</a></h6>
<p>From CCS, select &#8220;File -&gt; New -&gt; Target Configuration File&#8221;:</p>
<img alt="../_images/CCS-GP437x-EVM-New-Target.png" src="../_images/CCS-GP437x-EVM-New-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="select-target-configuration-options">
<h6>10.2.1.1.2.4.2. Select target configuration options<a class="headerlink" href="#select-target-configuration-options" title="Permalink to this headline">¶</a></h6>
<p>The AM437x GP EVM supports embedded XDS100V2 USB Emulation through the
MicroUSB AB connector. Select</p>
<ul class="simple">
<li><strong>Connection</strong>: Texas Instruments XDS100v2 USB Debug Probe</li>
<li><strong>Board or Device</strong>: EVMAM437X</li>
</ul>
<img alt="../_images/CCS-GP437x-EVM-Configure-Target.png" src="../_images/CCS-GP437x-EVM-Configure-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Useful Tip</strong></p>
<p>If you enter the starting numbers of your device in the <strong>Board or
Device</strong> field, the list will show the relevant subset.</p>
<p>Here is a table showing configuration information for all supported
EVMs in the Processor-SDK RTOS:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EVM</th>
<th class="head">Connection</th>
<th class="head">Board</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AM65x EVM</td>
<td>Texas Instruments
XDS110 USB Debug
Probe</td>
<td>GPEVM_AM65x</td>
</tr>
<tr class="row-odd"><td>AM65x IDK</td>
<td>Texas Instruments
XDS110 USB Debug
Probe</td>
<td>IDK_AM65x</td>
</tr>
<tr class="row-even"><td>GP335x</td>
<td>External Emulator
Supplied by User. EVM
includes a TI 20 pin
JTAG connector.</td>
<td>EVMAM3358</td>
</tr>
<tr class="row-odd"><td>ICE335x</td>
<td>Texas Instruments
XDS100v2 USB Debug
Probe</td>
<td>ICE_AM3359</td>
</tr>
<tr class="row-even"><td>SK335x</td>
<td>Texas Instruments
XDS100v2 USB Debug
Probe</td>
<td>SK_AM3358</td>
</tr>
<tr class="row-odd"><td>BBB</td>
<td>External Emulator
Supplied by User. EVM
includes a TI 20 pin
JTAG connector.</td>
<td>BeagleBone_Black</td>
</tr>
<tr class="row-even"><td>GP437x</td>
<td>Texas Instruments
XDS100v2 USB Debug
Probe</td>
<td>EVMAM437X</td>
</tr>
<tr class="row-odd"><td>IDK437x</td>
<td>Texas Instruments
XDS100v2 USB Debug
Probe</td>
<td>IDK_AM437X</td>
</tr>
<tr class="row-even"><td>GP572x</td>
<td>External Emulator
Supplied by User. EVM
includes a TI 20 pin
JTAG connector.</td>
<td>GPEVM_AM572X</td>
</tr>
<tr class="row-odd"><td>X15</td>
<td>External Emulator
Supplied by User. EVM
includes a TI 20 pin
JTAG connector.</td>
<td>GPEVM_AM572X</td>
</tr>
<tr class="row-even"><td>IDK572x/IDK574x</td>
<td>Texas Instruments
XDS100V2 USB Debug
Probe
External Emulator
Supplied by User. EVM
includes a 60-pin
MIPI JTAG connector</td>
<td>IDK_AM572X/IDK_AM574X</td>
</tr>
<tr class="row-odd"><td>C665x EVM</td>
<td>Texas Instruments
XDS2xx USB Onboard
Debug Probe</td>
<td>TMS320C6657</td>
</tr>
<tr class="row-even"><td>C667x EVM</td>
<td>L w/ XDC100: Texas
Instruments XDS100v1
USB Emulator
LE/LXE with XDS560:
Blackhawk
XDS560v2-USB
Mezzanine Emulator</td>
<td>TMS320C6678</td>
</tr>
<tr class="row-odd"><td>K2E EVM</td>
<td>Texas Instruments
XDS2xx USB Onboard
Debug Probe</td>
<td>66AK2E05</td>
</tr>
<tr class="row-even"><td>K2H EVM</td>
<td>Texas Instruments
XDS2xx USB Onboard
Debug Probe</td>
<td>66AK2H12</td>
</tr>
<tr class="row-odd"><td>K2L EVM</td>
<td>Texas Instruments
XDS2xx USB Onboard
Debug Probe</td>
<td>TCI6630K2L</td>
</tr>
<tr class="row-even"><td>K2G GP EVM</td>
<td>Texas Instruments
XDS2xx USB Onboard
Debug Probe</td>
<td>66AK2G02</td>
</tr>
<tr class="row-odd"><td>OMAPL137 EVM</td>
<td>Spectrum Digital
XDS510USB Emulator</td>
<td>OMAPL137SK</td>
</tr>
<tr class="row-even"><td>OMAPL138 LCDK</td>
<td>External Emulator
Supplied by User. EVM
includes a TI 14 pin
JTAG connector.</td>
<td>OMAPL138LCDK</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="save-target-configuration">
<h6>10.2.1.1.2.4.3. Save target configuration<a class="headerlink" href="#save-target-configuration" title="Permalink to this headline">¶</a></h6>
<p>Next, save the target configuration by pressing the <strong>Save</strong> button:</p>
<img alt="../_images/CCS-GP437x-EVM-Save-Target.png" src="../_images/CCS-GP437x-EVM-Save-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="test-target-configuration">
<h6>10.2.1.1.2.4.4. Test target configuration<a class="headerlink" href="#test-target-configuration" title="Permalink to this headline">¶</a></h6>
<p>Next, test the target configuration by pressing the <strong>Test Connection</strong>
button. This will confirm that you have successfully created an emulator
connection with your board.</p>
<img alt="../_images/AM4-GP-test-connection.png" src="../_images/AM4-GP-test-connection.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-target-configurations">
<h6>10.2.1.1.2.4.5. View target configurations<a class="headerlink" href="#view-target-configurations" title="Permalink to this headline">¶</a></h6>
<p>From CCS, select &#8220;View -&gt; Target Configurations&#8221;:</p>
<img alt="../_images/CCS-GP437x-EVM-View-Target.png" src="../_images/CCS-GP437x-EVM-View-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="launch-target-configuration">
<h6>10.2.1.1.2.4.6. Launch target configuration<a class="headerlink" href="#launch-target-configuration" title="Permalink to this headline">¶</a></h6>
<p>Open &#8220;User Defined&#8221; list and right click on the target configuration
file that was just saved and select &#8220;Launch Selected Configuration&#8221;:</p>
<img alt="../_images/CCS-GP437x-EVM-Launch-Target.png" src="../_images/CCS-GP437x-EVM-Launch-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="connect-target">
<h6>10.2.1.1.2.4.7. Connect target<a class="headerlink" href="#connect-target" title="Permalink to this headline">¶</a></h6>
<p>After launch, you can connect to a core. For GP AM437x EVM, select
<strong>Cortex A9</strong> and select &#8220;Connect Target&#8221;:</p>
<img alt="../_images/CCS-GP437x-EVM-Connnect-Target.png" src="../_images/CCS-GP437x-EVM-Connnect-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="success">
<h6>10.2.1.1.2.4.8. Success!<a class="headerlink" href="#success" title="Permalink to this headline">¶</a></h6>
<p>After connecting to target, check the console for status. Typically, the
end of the configuration will indicate success or failure. For GP AM437x
EVM, you will see the message &#8220;AM437x GP EVM Initialization is Done&#8221;:</p>
<img alt="../_images/CCS-GP437x-EVM-Run-Target.png" src="../_images/CCS-GP437x-EVM-Run-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="additional-notes-for-am57x">
<h5>10.2.1.1.2.5. Additional Notes for AM57x<a class="headerlink" href="#additional-notes-for-am57x" title="Permalink to this headline">¶</a></h5>
<div class="section" id="connect-to-am57x-slave-cores">
<h6>10.2.1.1.2.5.1. Connect to AM57x Slave Cores<a class="headerlink" href="#connect-to-am57x-slave-cores" title="Permalink to this headline">¶</a></h6>
<p>After connecting to the boot master core &#8211; typically the ARM core &#8211;
you may need to connect to a slave core in order to run code. Depending
on your SOC, the slave core can be</p>
<ul class="simple">
<li>DSP C66x</li>
<li>ARM M4</li>
<li>PRUSS</li>
<li>IVAHD</li>
</ul>
<p>Typically the slave cores will wait in reset state until the master core
wakes up the slave core to run code. To connect to the slave core on
AM57x, go to <strong>Scripts</strong> menu in CCS Debug View and under <strong>AM572x
MULTICORE Initialization</strong> enable the corresponding sub system clock.
For example, enable <tt class="docutils literal"><span class="pre">DSP11SSClkEnable_API</span></tt> for the first DSP core.
After running the clock enable option, you can connect to the core.</p>
<img alt="../_images/Multicore-Enable.jpg" src="../_images/Multicore-Enable.jpg" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="timer-suspend-control-options-for-dsp">
<h6>10.2.1.1.2.5.2. Timer Suspend Control Options for DSP<a class="headerlink" href="#timer-suspend-control-options-for-dsp" title="Permalink to this headline">¶</a></h6>
<p>On AM57xx devices, all the timers on the chip have their suspend control
signal routed to the A15 core. Which means that if any of the slave
cores are using these timers, the timers will continue to run even when
the slave core has been paused. The timer will only pause when the A15
core is halted.</p>
<p>This is confusing while debugging code on slave cores if you are relying
on timer for logging, inserting delays or if the timer keeps firing
interrupts even when the core is halted. One such scenario occurs with
<em>GPtimer5</em> when DSP developers are using SYS/BIOS. The OS uses
<em>GPtimer5</em> on the DSP and forces a frequency check to confirm the timer
configuration, however the OS can&#8217;t gain access to the timer due to the
hook up of the suspend control signals.</p>
<p>Due to this issue the SYS/BIOS developers will need to configure an
additional CCS configuration check to connect the GPTimer suspend
control signal to the DSP as shown in the image below:</p>
<img alt="../_images/GPtimer5_DSPConnect.png" src="../_images/GPtimer5_DSPConnect.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="troubleshooting">
<h5>10.2.1.1.2.6. Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h5>
<p>If you face any problems, first check these basic items:</p>
<ul class="simple">
<li><strong>Power cycle your target.</strong></li>
<li><strong>Check the USB cable.</strong> One simple way to do this is to connect
another device to the USB and ensure the cable works.</li>
<li><strong>Check host driver.</strong> Even with CCS turned off, your host should
list the TI XDS as a USB device. If this does not work, try a
different USB port.</li>
<li><strong>Latest emulation package.</strong> Ensure that you have the latest
emulation files as specified in the <a class="reference external" href="index_overview.html#emulator-support">Getting Started Guide</a>.</li>
</ul>
<p>If this does not resolve your problem, see these additional resources:</p>
<ul class="simple">
<li><a class="reference external" href="http://processors.wiki.ti.com/index.php/Troubleshooting_CCSv6">Troubleshoot
CCS</a></li>
<li><a class="reference external" href="http://processors.wiki.ti.com/index.php/XDS100#Troubleshooting">Troubleshoot
XDS100</a></li>
<li><a class="reference external" href="http://processors.wiki.ti.com/index.php/XDS200#Troubleshooting">Troubleshoot
XDS200</a></li>
<li><a class="reference external" href="http://processors.wiki.ti.com/index.php/XDS560#Frequently_Asked_Questions">Troubleshoot
XDS560</a></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="update-environment-when-installing-to-a-custom-path">
<span id="processor-sdk-rtos-install-in-custom-path-label"></span><h3>10.2.1.2. Update environment when installing to a custom path<a class="headerlink" href="#update-environment-when-installing-to-a-custom-path" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id2">
<h4>10.2.1.2.1. Overview<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>This page will provide configuration information if the SDK is installed
in a custom path.</p>
<p><strong>Useful Tip</strong></p>
<p>To avoid changing environment variable for each new shell, modify
environment variable file directly. This file is the <em>setupenv</em> file
located in the SDK root directory.</p>
</div>
<div class="section" id="changes-to-ccs-configuration">
<h4>10.2.1.2.2. Changes to CCS Configuration<a class="headerlink" href="#changes-to-ccs-configuration" title="Permalink to this headline">¶</a></h4>
<p>Installing the SDK in a folder other than where CCS is installed will
require modifications to CCS to be able to discover the SDK. See the
<a class="reference external" href="/index.php/Processor_SDK_RTOS_Setup_CCS">Setup CCS</a> <strong>How To</strong> page
explaining how to update CCS configuration.</p>
</div>
<div class="section" id="rebuilding-the-sdk-rtos">
<h4>10.2.1.2.3. Rebuilding the SDK RTOS<a class="headerlink" href="#rebuilding-the-sdk-rtos" title="Permalink to this headline">¶</a></h4>
<p>Installing the SDK in a folder other than the default (<tt class="docutils literal"><span class="pre">C:\TI</span></tt> for
Windows, <tt class="docutils literal"><span class="pre">/home/[user]/ti</span></tt> for Linux) requires modifications to SDK
RTOS scripts in order for recompilation and example/test creation to
work properly.</p>
<p>In all the commands below, replace <em>[version]</em> with the appropriate
version of the software/tool.</p>
<div class="section" id="ccs-in-custom-path-and-sdk-rtos-in-default-path">
<h5>10.2.1.2.3.1. CCS in Custom Path and SDK RTOS in Default Path<a class="headerlink" href="#ccs-in-custom-path-and-sdk-rtos-in-default-path" title="Permalink to this headline">¶</a></h5>
<p>CCS installation and toolchain paths can be customized by setting the
TOOLS_INSTALL_PATH environment variable prior to running the SDK level
setupenv script. This feature is used if CCS and the toolchains are
installed somewhere other than the default C:\ti location.</p>
<p>For example, environment configuration assuming CCS is installed to
[os_base]\ti_temp and SDK RTOS has been installed to default path,
[os_base]\ti&nbsp;:</p>
<ul class="simple">
<li>Windows</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre>C:\&gt; set TOOLS_INSTALL_PATH=C:\ti_temp
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>C:\&gt; cd C:\ti\processor_sdk_rtos_[soc]_[version]
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>C:\ti\processor_sdk_rtos_[soc]_[version]&gt; setupenv.bat
</pre></div>
</div>
<p>Gives the output:</p>
<div class="highlight-cpp"><div class="highlight"><pre>Optional parameter not configured : CG_XML_BIN_INSTALL_PATH
REQUIRED for xdc release build
Example: set CG_XML_BIN_INSTALL_PATH=C:/ti/cg_xml/bin
Optional parameter not configured : DOXYGEN_INSTALL_PATH
REQUIRED for xdc release build
Example: set DOXYGEN_INSTALL_PATH=C:/ti/Doxygen/doxygen/1.5.1-p1/bin
**************************************************************************
Environment Configuration:
    PDK Directory             : /ti/PDK_AM~3/packages/
    CGTOOL INSTALL Directory  : C:/ti_temp/ccsv6/tools/compiler/ti-cgt-c6000_[version]
    TOOLCHAIN A15 Directory   : C:/ti_temp/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN A8 Directory    : C:/ti_temp/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN A9 Directory    : C:/ti_temp/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN M4 Directory    : C:/ti_temp/ccsv6/tools/compiler/ti-cgt-arm_[version]
    FPULIB_PATH               : C:/ti_temp/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]/lib/gcc/arm-none-eabi/[version]/fpu
    CROSS_TOOL_PRFX           : arm-none-eabi-
    XDC_INSTALL_PATH          : C:/ti/xdctools_[version]_core
    BIOS_INSTALL_PATH         : C:/ti/bios_[version]
    IPC_INSTALL_PATH          : C:/ti/ipc_[version]
    EDMA3LLD_BIOS6_INSTALLDIR : C:/ti/edma3_lld_[version]
    NDK_INSTALL_PATH          : C:/ti/ndk_[version]
    IMGLIB_INSTALL_PATH       : C:/ti/imglib_c66x_[version]
    UIA_INSTALL_PATH          : C:/ti/uia_[version]
    PROC_SDK_INSTALL_PATH     : C:/ti/processor_sdk_rtos_[soc]_[version]
**************************************************************************
Changing to short name to support directory names containing spaces
current directory: C:/ti/processor_sdk_rtos_[soc]_[version]
PROCESSOR SDK BUILD ENVIRONMENT CONFIGURED
**************************************************************************
</pre></div>
</div>
<ul class="simple">
<li>Linux</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre>$ export TOOLS_INSTALL_PATH=~/ti_temp
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>$ cd ~/ti/processor_sdk_rtos_[soc]_[version]/
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>~/ti/processor_sdk_rtos_[soc]_[version]$ source setupenv.sh
</pre></div>
</div>
<p>Gives the output:</p>
<div class="highlight-cpp"><div class="highlight"><pre>Optional parameter not configured : CG_XML_BIN_INSTALL_PATH
REQUIRED for xdc release build
Example: export CG_XML_BIN_INSTALL_PATH=&quot;~/ti/cg_xml/bin&quot;
Optional parameter not configured : DOXYGEN_INSTALL_PATH
REQUIRED for xdc release build
Example: export DOXYGEN_INSTALL_PATH=&quot;~/ti/Doxygen/doxygen/1.5.1-p1/bin&quot;
**************************************************************************
Environment Configuration:
    PDK Directory             : /home/[user]/ti/pdk_[soc]_[version]/packages
    CGTOOL INSTALL Directory  : /home/[user]/ti_temp/ccsv6/tools/compiler/ti-cgt-c6000_[version]
    TOOLCHAIN A15 Directory   : /home/[user]/ti_temp/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN A8 Directory    : /home/[user]/ti_temp/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN A9 Directory    : /home/[user]/ti_temp/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN M4 Directory    : /home/[user]/ti_temp/ccsv6/tools/compiler/ti-cgt-arm_[version]
    FPULIB_PATH               : /home/[user]/ti_temp/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]/lib/gcc/arm-none-eabi/[version]/fpu
    CROSS_TOOL_PRFX           : arm-none-eabi-
    XDC_INSTALL_PATH          : /home/[user]/ti/xdctools_[version]_core
    BIOS_INSTALL_PATH         : /home/[user]/ti/bios_[version]
    IPC_INSTALL_PATH          : /home/[user]/ti/ipc_[version]
    EDMA3LLD_BIOS6_INSTALLDIR : /home/[user]/ti/edma3_lld_[version]
    NDK_INSTALL_PATH          : /home/[user]/ti/ndk_[version]
    IMGLIB_INSTALL_PATH       : /home/[user]/ti/imglib_c66x_[version]
    UIA_INSTALL_PATH          : /home/[user]/ti/uia_[version]
    PROC_SDK_INSTALL_PATH     : /home/[user]/ti/processor_sdk_rtos_[soc]_[version]

PROCESSOR SDK BUILD ENVIRONMENT CONFIGURED
*******************************************************************************
</pre></div>
</div>
<p>The <a class="reference external" href="index_overview.html#top-level-makefile">RTOS SDK top level
Makefile</a>
can now be used to rebuild SDK RTOS components with CCS and toolchains
installed in a custom installation path.</p>
</div>
<div class="section" id="ccs-in-default-path-and-sdk-rtos-in-custom-path">
<h5>10.2.1.2.3.2. CCS in Default Path and SDK RTOS in Custom Path<a class="headerlink" href="#ccs-in-default-path-and-sdk-rtos-in-custom-path" title="Permalink to this headline">¶</a></h5>
<p>SDK RTOS component installation paths can be customized by setting the
SDK_INSTALL_PATH variable prior to running the SDK level setupenv
script. This feature is used if the SDK is installed somewhere other
than the default <tt class="docutils literal"><span class="pre">C:\ti</span></tt> location.</p>
<p>For example, environment configuration assuming CCS is installed to the
default path, <tt class="docutils literal"><span class="pre">[os_base]\ti</span></tt> and SDK RTOS has been installed to
<tt class="docutils literal"><span class="pre">[os_base]\ti_temp</span></tt>:</p>
<ul class="simple">
<li>Windows</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre>C:\&gt; set SDK_INSTALL_PATH=C:/ti_temp
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>C:\&gt; cd C:\ti_temp\processor_sdk_rtos_[soc]_[version]
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>C:\ti_temp\processor_sdk_rtos_[soc]_[version]&gt; setupenv.bat
</pre></div>
</div>
<p>Gives the output:</p>
<div class="highlight-cpp"><div class="highlight"><pre>Optional parameter not configured : CG_XML_BIN_INSTALL_PATH
REQUIRED for xdc release build
Example: set CG_XML_BIN_INSTALL_PATH=C:/ti/cg_xml/bin
Optional parameter not configured : DOXYGEN_INSTALL_PATH
REQUIRED for xdc release build
Example: set DOXYGEN_INSTALL_PATH=C:/ti/Doxygen/doxygen/1.5.1-p1/bin
**************************************************************************
Environment Configuration:
    PDK Directory             : /ti_temp/PDK_AM~3/packages/
    CGTOOL INSTALL Directory  : C:/ti/ccsv6/tools/compiler/ti-cgt-c6000_[version]
    TOOLCHAIN A15 Directory   : C:/ti/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN A8 Directory    : C:/ti/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN A9 Directory    : C:/ti/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN M4 Directory    : C:/ti/ccsv6/tools/compiler/ti-cgt-arm_[version]
    FPULIB_PATH               : C:/ti/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]/lib/gcc/arm-none-eabi/[version]/fpu
    CROSS_TOOL_PRFX           : arm-none-eabi-
    XDC_INSTALL_PATH          : C:/ti_temp/xdctools_[version]_core
    BIOS_INSTALL_PATH         : C:/ti_temp/bios_[version]
    IPC_INSTALL_PATH          : C:/ti_temp/ipc_[version]
    EDMA3LLD_BIOS6_INSTALLDIR : C:/ti_temp/edma3_lld_[version]
    NDK_INSTALL_PATH          : C:/ti_temp/ndk_[version]
    IMGLIB_INSTALL_PATH       : C:/ti_temp/imglib_c66x_[version]
    UIA_INSTALL_PATH          : C:/ti_temp/uia_[version]
    PROC_SDK_INSTALL_PATH     : C:/ti_temp/processor_sdk_rtos_[soc]_[version]
**************************************************************************
Changing to short name to support directory names containing spaces
current directory: C:/ti_temp/processor_sdk_rtos_[soc]_[version]
PROCESSOR SDK BUILD ENVIRONMENT CONFIGURED
**************************************************************************
</pre></div>
</div>
<ul class="simple">
<li>Linux</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre>$ export SDK_INSTALL_PATH=~/ti_temp
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>$ cd ~/ti_temp/processor_sdk_rtos_[soc]_[version]/
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>~/ti_temp/processor_sdk_rtos_[soc]_[version]$ source setupenv.sh
</pre></div>
</div>
<p>Gives the output:</p>
<div class="highlight-cpp"><div class="highlight"><pre>Optional parameter not configured : CG_XML_BIN_INSTALL_PATH
REQUIRED for xdc release build
Example: export CG_XML_BIN_INSTALL_PATH=&quot;~/ti/cg_xml/bin&quot;
Optional parameter not configured : DOXYGEN_INSTALL_PATH
REQUIRED for xdc release build
Example: export DOXYGEN_INSTALL_PATH=&quot;~/ti/Doxygen/doxygen/1.5.1-p1/bin&quot;
**************************************************************************
Environment Configuration:
    PDK Directory             : /home/[user]/ti_temp/pdk_[soc]_[version]/packages
    CGTOOL INSTALL Directory  : /home/[user]/ti/ccsv6/tools/compiler/ti-cgt-c6000_[version]
    TOOLCHAIN A15 Directory   : /home/[user]/ti/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN A8 Directory    : /home/[user]/ti/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN A9 Directory    : /home/[user]/ti/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN M4 Directory    : /home/[user]/ti/ccsv6/tools/compiler/ti-cgt-arm_[version]
    FPULIB_PATH               : /home/[user]/ti/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]/lib/gcc/arm-none-eabi/[version]/fpu
    CROSS_TOOL_PRFX           : arm-none-eabi-
    XDC_INSTALL_PATH          : /home/[user]/ti_temp/xdctools_[version]_core
    BIOS_INSTALL_PATH         : /home/[user]/ti_temp/bios_[version]
    IPC_INSTALL_PATH          : /home/[user]/ti_temp/ipc_[version]
    EDMA3LLD_BIOS6_INSTALLDIR : /home/[user]/ti_temp/edma3_lld_[version]
    NDK_INSTALL_PATH          : /home/[user]/ti_temp/ndk_[version]
    IMGLIB_INSTALL_PATH       : /home/[user]/ti_temp/imglib_c66x_[version]
    UIA_INSTALL_PATH          : /home/[user]/ti_temp/uia_[version]
    PROC_SDK_INSTALL_PATH     : /home/[user]/ti_temp/processor_sdk_rtos_[soc]_[version]

PROCESSOR SDK BUILD ENVIRONMENT CONFIGURED
*******************************************************************************
</pre></div>
</div>
<p>The <a class="reference external" href="index_overview.html#top-level-makefile">RTOS SDK top level
Makefile</a>
can now be used to rebuild SDK RTOS components installed in the custom
installation path.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The following known issue impacts this step:
<strong>PRSDK-1263</strong>: PDK AM437x: Make fails on Windows if CCS is installed in
custom path. <strong>Workaround:</strong> Edit the UTILS_INSTALL_DIR variable in
&lt;pdk_root_dir&gt;/packages/ti/starterware/Rules.make to point to the CCS
installation on your Windows PC.</p>
</div>
</div>
<div class="section" id="ccs-and-sdk-rtos-in-custom-path">
<h5>10.2.1.2.3.3. CCS and SDK RTOS in Custom Path<a class="headerlink" href="#ccs-and-sdk-rtos-in-custom-path" title="Permalink to this headline">¶</a></h5>
<p>When CCS and the SDK RTOS are both installed to custom paths the SDK can
be rebuilt by setting the SDK_INSTALL_PATH and TOOLS_INSTALL_PATH
variables prior to running the SDK RTOS top level environment setup
script. The Windows and Linux environment setup scripts can be found in
the following locations, respectively:</p>
<ul class="simple">
<li>Windows -
C:\custom\install\path\processor_sdk_rtos_[soc]_[version]\setupenv.bat</li>
<li>Linux -
/home/[user]/custom/install/path/processor_sdk_rtos_[soc]_[version]/setupenv.sh</li>
</ul>
<p>The SDK_INSTALL_PATH and TOOLS_INSTALL_PATH environment variables must
be set to the custom install path <strong>prior to running</strong> the environment
setup script.</p>
<p>For example, environment configuration assuming CCS and the SDK have
been installed to [os_base]\new_sdk_release\&nbsp;:</p>
<ul class="simple">
<li>Windows</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre>C:\&gt; set SDK_INSTALL_PATH=C:\new_sdk_release
C:\&gt; set TOOLS_INSTALL_PATH=C:\new_sdk_release
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>C:\&gt; cd C:\new_sdk_release\processor_sdk_rtos_[soc]_[version]
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>C:\new_sdk_release\processor_sdk_rtos_[soc]_[version]&gt; setupenv.bat
</pre></div>
</div>
<p>Gives the output:</p>
<div class="highlight-cpp"><div class="highlight"><pre>Optional parameter not configured : CG_XML_BIN_INSTALL_PATH
REQUIRED for xdc release build
Example: set CG_XML_BIN_INSTALL_PATH=C:/ti/cg_xml/bin
Optional parameter not configured : DOXYGEN_INSTALL_PATH
REQUIRED for xdc release build
Example: set DOXYGEN_INSTALL_PATH=C:/ti/Doxygen/doxygen/1.5.1-p1/bin
**************************************************************************
Environment Configuration:
    PDK Directory             : /NEW_SD~1/PDK_AM~1/packages/
    CGTOOL INSTALL Directory  : C:/new_sdk_release/ccsv6/tools/compiler/ti-cgt-c6000_[version]
    TOOLCHAIN A15 Directory   : C:/new_sdk_release/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN A8 Directory    : C:/new_sdk_release/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN A9 Directory    : C:/new_sdk_release/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN M4 Directory    : C:/new_sdk_release/ccsv6/tools/compiler/ti-cgt-arm_[version]
    FPULIB_PATH               : C:/new_sdk_release/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]/lib/gcc/arm-none-eabi/[version]/fpu
    CROSS_TOOL_PRFX           : arm-none-eabi-
    XDC_INSTALL_PATH          : C:/new_sdk_release/xdctools_[version]_core
    BIOS_INSTALL_PATH         : C:/new_sdk_release/bios_[version]
    IPC_INSTALL_PATH          : C:/new_sdk_release/ipc_[version]
    EDMA3LLD_BIOS6_INSTALLDIR : C:/new_sdk_release/edma3_lld_[version]
    NDK_INSTALL_PATH          : C:/new_sdk_release/ndk_[version]
    IMGLIB_INSTALL_PATH       : C:/new_sdk_release/imglib_c66x_[version]
    UIA_INSTALL_PATH          : C:/new_sdk_release/uia_[version]
    PROC_SDK_INSTALL_PATH     : C:/new_sdk_release/processor_sdk_rtos_[soc]_[version]
**************************************************************************
Changing to short name to support directory names containing spaces
current directory: C:/new_sdk_release/processor_sdk_rtos_[soc]_[version]
PROCESSOR SDK BUILD ENVIRONMENT CONFIGURED
**************************************************************************
</pre></div>
</div>
<ul class="simple">
<li>Linux</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre>$ export SDK_INSTALL_PATH=~/new_sdk_release
$ export TOOLS_INSTALL_PATH=~/new_sdk_release
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>$ cd ~/new_sdk_release/processor_sdk_rtos_[soc]_[version]/
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>~/new_sdk_release/processor_sdk_rtos_[soc]_[version]$ source setupenv.sh
</pre></div>
</div>
<p>Gives the output:</p>
<div class="highlight-cpp"><div class="highlight"><pre>Optional parameter not configured : CG_XML_BIN_INSTALL_PATH
REQUIRED for xdc release build
Example: export CG_XML_BIN_INSTALL_PATH=&quot;~/ti/cg_xml/bin&quot;
Optional parameter not configured : DOXYGEN_INSTALL_PATH
REQUIRED for xdc release build
Example: export DOXYGEN_INSTALL_PATH=&quot;~/ti/Doxygen/doxygen/1.5.1-p1/bin&quot;
**************************************************************************
Environment Configuration:
    PDK Directory             : /home/[user]/new_sdk_release/pdk_[soc]_[version]/packages
    CGTOOL INSTALL Directory  : /home/[user]/new_sdk_release/ccsv6/tools/compiler/ti-cgt-c6000_[version]
    TOOLCHAIN A15 Directory   : /home/[user]/new_sdk_release/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN A8 Directory    : /home/[user]/new_sdk_release/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN A9 Directory    : /home/[user]/new_sdk_release/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]
    TOOLCHAIN M4 Directory    : /home/[user]/new_sdk_release/ccsv6/tools/compiler/ti-cgt-arm_[version]
    FPULIB_PATH               : /home/[user]/new_sdk_release/ccsv6/tools/compiler/gcc-arm-none-eabi-[version]/lib/gcc/arm-none-eabi/[version]/fpu
    CROSS_TOOL_PRFX           : arm-none-eabi-
    XDC_INSTALL_PATH          : /home/[user]/new_sdk_release/xdctools_[version]_core
    BIOS_INSTALL_PATH         : /home/[user]/new_sdk_release/bios_[version]
    IPC_INSTALL_PATH          : /home/[user]/new_sdk_release/ipc_[version]
    EDMA3LLD_BIOS6_INSTALLDIR : /home/[user]/new_sdk_release/edma3_lld_[version]
    NDK_INSTALL_PATH          : /home/[user]/new_sdk_release/ndk_[version]
    IMGLIB_INSTALL_PATH       : /home/[user]/new_sdk_release/imglib_c66x_[version]
    UIA_INSTALL_PATH          : /home/[user]/new_sdk_release/uia_[version]
    PROC_SDK_INSTALL_PATH     : /home/[user]/new_sdk_release/processor_sdk_rtos_[soc]_[version]

PROCESSOR SDK BUILD ENVIRONMENT CONFIGURED
*******************************************************************************
</pre></div>
</div>
<p>The <a class="reference external" href="index_overview.html#top-level-makefile">RTOS SDK top level Makefile</a>
can now be used to rebuild SDK RTOS components installed in the custom
installation path using CCS and toolchains installed in a custom path as
well.</p>
</div>
</div>
<div class="section" id="rebuilding-the-pdk">
<h4>10.2.1.2.4. Rebuilding the PDK<a class="headerlink" href="#rebuilding-the-pdk" title="Permalink to this headline">¶</a></h4>
<p>Installing the PDK in a folder other than the default (C:TI for
Windows, /home/[user]/ti for Linux) requires modifications to PDK
scripts in order for recompilation and example/test creation to work
properly.</p>
<div class="section" id="ccs-in-custom-path-and-pdk-in-default-path">
<h5>10.2.1.2.4.1. CCS in Custom Path and PDK in Default Path<a class="headerlink" href="#ccs-in-custom-path-and-pdk-in-default-path" title="Permalink to this headline">¶</a></h5>
<p>The instructions provided in the <a class="reference external" href="/index.php/Processor_SDK_RTOS_Install_In_Custom_Path#CCS_in_Custom_Path_and_SDK_RTOS_in_Default_Path">CCS in Custom Path and SDK RTOS in
Default
Path</a>
section can be used to rebuild components at the PDK level. The only
difference is the PDK level setup script should be used instead of the
SDK RTOS level setup script. The PDK level setup scripts are found in
the following locations on Windows and Linux, respectively:</p>
<ul class="simple">
<li>Windows -
C:\custom\install\path\pdk_[soc]_[version]\packages\pdksetupenv.bat</li>
<li>Linux -
/home/[user]/custom/install/path/pdk_[soc]_[version]/packages/pdksetupenv.sh</li>
</ul>
</div>
<div class="section" id="ccs-in-default-path-and-pdk-in-custom-path">
<h5>10.2.1.2.4.2. CCS in Default Path and PDK in Custom Path<a class="headerlink" href="#ccs-in-default-path-and-pdk-in-custom-path" title="Permalink to this headline">¶</a></h5>
<p>The instructions provided in the <a class="reference external" href="/index.php/Processor_SDK_RTOS_Install_In_Custom_Path#CCS_in_Default_Path_and_SDK_RTOS_in_Custom_Path">CCS in Default Path and SDK RTOS in
Custom
Path</a>
section can be used to rebuild components at the PDK level. The only
difference is the PDK level setup script should be used instead of the
SDK RTOS level setup script. The PDK level setup scripts are found in
the following locations on Windows and Linux, respectively:</p>
<ul class="simple">
<li>Windows -
C:\custom\install\path\pdk_[soc]_[version]\packages\pdksetupenv.bat</li>
<li>Linux -
/home/[user]/custom/install/path/pdk_[soc]_[version]/packages/pdksetupenv.sh</li>
</ul>
</div>
<div class="section" id="ccs-and-pdk-in-custom-path">
<h5>10.2.1.2.4.3. CCS and PDK in Custom Path<a class="headerlink" href="#ccs-and-pdk-in-custom-path" title="Permalink to this headline">¶</a></h5>
<p>The instructions provided in the <a class="reference external" href="/index.php/Processor_SDK_RTOS_Install_In_Custom_Path#CCS_and_SDK_RTOS_in_Custom_Path">CCS and SDK RTOS in Custom
Path</a>
section can be used to rebuild components at the PDK level. The only
difference is the PDK level setup script should be used instead of the
SDK RTOS level setup script. The PDK level setup scripts are found in
the following locations on Windows and Linux, respectively:</p>
<ul class="simple">
<li>Windows -
C:\custom\install\path\pdk_[soc]_[version]\packages\pdksetupenv.bat</li>
<li>Linux -
/home/[user]/custom/install/path/pdk_[soc]_[version]/packages/pdksetupenv.sh</li>
</ul>
</div>
</div>
<div class="section" id="creating-pdk-example-test-projects-when-ccs-is-installed-to-custom-path">
<h4>10.2.1.2.5. Creating PDK Example/Test Projects When CCS is Installed to Custom Path<a class="headerlink" href="#creating-pdk-example-test-projects-when-ccs-is-installed-to-custom-path" title="Permalink to this headline">¶</a></h4>
<p>The pdkProjectCreate scripts must be modified in order to build PDK
example and test projects only if CCS has been installed to a custom
path. The modification is the same for both Windows and Linux. Inside
the pdkProjectCreate scripts is a CCS_INSTALL_PATH variable which points
to the Code Composer Studio root directory. This variable must be
redefined to the new location of the CCS root directory if CCS is
installed to a custom path.</p>
<ul class="simple">
<li>Windows</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">REM</span> <span class="n">Install</span> <span class="n">Location</span> <span class="k">for</span> <span class="n">CCS</span>
<span class="n">set</span> <span class="n">CCS_INSTALL_PATH</span><span class="o">=</span><span class="s">&quot;C:</span><span class="se">\t</span><span class="s">i\ccsv6&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li>Linux</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp"># Install Location for CCS</span>
<span class="k">export</span> <span class="n">CCS_INSTALL_PATH</span><span class="o">=~/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to invoking the pdkProjectCreate script, make sure to start CCS
and register the SDK RTOS components installed. Project creation will
fail if the RTOS SDK components installed to the custom path have not
been registered with CCS. Please see <a class="reference external" href="/index.php/Processor_SDK_RTOS_Setup_CCS#CCS_and_SDK_installed_in_different_directories">CCS and SDK installed in different
directories</a>
for instructions on how to register SDK RTOS components installed to a
custom path with CCS</p>
</div>
</div>
</div>
<div class="section" id="prevent-beaglebone-board-reset-on-jtag-connect">
<h3>10.2.1.3. Prevent BeagleBone board reset on JTAG Connect<a class="headerlink" href="#prevent-beaglebone-board-reset-on-jtag-connect" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://elinux.org/Beagleboard:BeagleBone#Board_Reset_on_JTAG_Connect.28A3.2CA4.2CA5.29">https://elinux.org/Beagleboard:BeagleBone#Board_Reset_on_JTAG_Connect.28A3.2CA4.2CA5.29</a></p>
</div>
<div class="section" id="rebuild-drivers-from-pdk-directory">
<h3>10.2.1.4. Rebuild drivers from PDK directory<a class="headerlink" href="#rebuild-drivers-from-pdk-directory" title="Permalink to this headline">¶</a></h3>
<p>Refer <a class="reference external" href="Overview.html#rebuild-pdk">Rebuilding the PDK</a> for details on rebuilding the PDK components.</p>
</div>
</div>
<div class="section" id="flashing-and-boot">
<h2>10.2.2. Flashing and Boot<a class="headerlink" href="#flashing-and-boot" title="Permalink to this headline">¶</a></h2>
<div class="section" id="flash-bootable-images-c66x-k2h-k2e-k2l-only">
<h3>10.2.2.1. Flash bootable images (C66x, K2H/K2E/K2L only)<a class="headerlink" href="#flash-bootable-images-c66x-k2h-k2e-k2l-only" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id3">
<h4>10.2.2.1.1. Overview<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>The Processor SDK RTOS for C6657, C6678, K2H, K2E, and K2L EVMs includes
a script in the directory</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="o">&lt;</span><span class="n">platform</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;/</span><span class="n">bin</span>
</pre></div>
</div>
<p>named <strong>program_evm.js</strong>. The purpose of this script is to automatically
flash bootable images onto your EVM.</p>
<p>The following sections will describe how to use this script and the
default flashable binaries in the Processor SDK RTOS.</p>
</div>
<div class="section" id="requirements">
<h4>10.2.2.1.2. Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>A Windows or Linux PC</li>
<li>Processor SDK RTOS installed on your PC. The version to install must
match the SOC you plan to use</li>
<li>Code Composer Studio installed on your PC</li>
<li>An USB connection to your EVM emulator</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Your board should be set to NO-BOOT mode. Please refer to the boot mode
dip switch settings for different boot modes on your EVM Hardware User
Guide. See <a class="reference external" href="index_release_specific.html#supported-platforms-and-versions">this page</a> for
a link to all supported EVM information.</p>
</div>
</div>
<div class="section" id="directory-structure">
<h4>10.2.2.1.3. Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h4>
<p>The files used are in the Processor SDK RTOS directory. Expanded below
are the relevant files and directories for flashing the bootable images
for C667x, but a similar structure is used for C665x.</p>
<div class="highlight-cpp"><div class="highlight"><pre>├── bin
│   ├── configs
│   │   └── evm6678l
│   │       ├── evm6678l.ccxml
│   │       ├── evm6678le.ccxml
│   │       ├── evm6678le-linuxhost.ccxml
│   │       └── evm6678l-linuxhost.ccxml
│   ├── logs
│   └── program_evm.js
└── prebuilt-images
    ├── eeprom50.bin
    ├── eeprom51.bin
    ├── eepromwriter_evm6678l.out
    ├── eepromwriter_input50.txt
    ├── eepromwriter_input51.txt
    ├── eepromwriter_input.txt
    ├── nandwriter_evm6678l.out
    ├── nand_writer_input.txt
    ├── norwriter_evm6678l.out
    └── nor_writer_input.txt
</pre></div>
</div>
<p>Below is the expanded tree for K2H. Similarly, this also applies to K2E
and K2L EVMs.</p>
<div class="highlight-cpp"><div class="highlight"><pre>├── bin
│   ├── configs
│   │   └── evmk2h
│   │       ├── evmk2h.ccxml
│   │       ├── evmk2h-linuxhost.ccxml
│   │       └── program_evm_config
│   ├── logs
│   └── program_evm.js
└── prebuilt-images
    ├── app
    ├── config
    ├── MLO
    └── spi_flash_writer.out
</pre></div>
</div>
</div>
<div class="section" id="default-binaries-and-setup">
<h4>10.2.2.1.4. Default Binaries and Setup<a class="headerlink" href="#default-binaries-and-setup" title="Permalink to this headline">¶</a></h4>
<p>Processor SDK RTOS provides the basic CCXML files to connect to your
SOC. There is a separate CCXML file for each SOC, emulator, and host OS
combination. These CCXML files are located in:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="o">&lt;</span><span class="n">platform</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;/</span><span class="n">bin</span><span class="o">/</span><span class="n">config</span><span class="o">/&lt;</span><span class="n">SOC</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Users can choose to use their own CCXML file by setting the environment
variable, <strong>PROGRAM_EVM_TARGET_CONFIG_FILE</strong>, to point to their CCXML
file in their terminal or command prompt.</p>
<p>You can create your own CCXML file by opening CCSv6 &#8211;&gt; View &#8211;&gt; Target
Configurations, and right-clicking on the Target Configuration pane to
select New Target Configuration. After selecting your SOC and emulator,
remember to set the appropriate GEL file in the advance options for Core
0. The GEL file is used to do basic SOC initialization upon connecting
to the core.</p>
<p>Processor SDK RTOS also provides the basic binaries needed to perform
flashing. These are separated into two categories - flashwriters and
flash images.</p>
<p>Flashwriters</p>
<ul class="simple">
<li>[C66x] eepromwriter_&lt;SOC&gt;.out - writes content to your EVM EEPROM
flash memory</li>
<li>[C66x] norwriter_&lt;SOC&gt;.out - writes content to your EVM NOR flash
memory</li>
<li>[C66x] nandwriter_&lt;SOC&gt;.out - writes content to your EVM NAND flash
memory</li>
<li>[K2H/E/L] spi_flash_writer.out - writes multiple images to your NOR
flash memory</li>
</ul>
<p>Flash images</p>
<ul class="simple">
<li>[C66x] eeprom50.bin - eeprom binary for address 0x50. The default for
C66x is the POST application.</li>
<li>[C66x] eeprom51.bin - eeprom binary for address 0x51. The default for
C66x is the Intermediate Boot Loader (IBL).</li>
<li>[C66x] nor.bin - nor binary to be used for NOR boot. May not be
provided for every EVM or release version.</li>
<li>[C66x] nand.bin - nand binary to be used for NAND boot. May not be
provided for every EVM or release version.</li>
<li>[K2H/K2E/K2L] app - NOR binary to be booted by Secondary Bootloader.
The default for Keystone 2 is the POST application</li>
<li>[K2H/K2E/K2L] MLO - Secondary Bootloader. The default flash location
is in SPI NOR flash memory at offset 0.</li>
</ul>
</div>
<div class="section" id="usage">
<h4>10.2.2.1.5. Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h4>
<p>For Windows users:</p>
<div class="highlight-cpp"><div class="highlight"><pre>&gt; cd [SDK Install Path]\processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;\bin
&gt; set DSS_SCRIPT_DIR=[CCS Install Path]\ccsv6\ccs_base\scripting\bin
&gt; %DSS_SCRIPT_DIR%\dss.bat program_evm.js [tmdx|tmds]evm(6678|6657|k2h|k2e|k2l)[l|le|ls][-le|-be]
</pre></div>
</div>
<p>For Linux users:</p>
<div class="highlight-cpp"><div class="highlight"><pre>&gt; cd [SDK Install Path]/processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;/bin
&gt; export DSS_SCRIPT_DIR=[CCS Install Path]/ccsv6/ccs_base/scripting/bin
&gt; $DSS_SCRIPT_DIR/dss.sh program_evm.js [tmdx|tmds]evm(6678|6657|k2h|k2e|k2l)[l|le|ls][-le|-be]
</pre></div>
</div>
<p>The last argument depends on the SOC that you have, concatenated with
the options to select emulator and endianness:</p>
<ul class="simple">
<li>l: EVM uses XDS100 on-board Emulator</li>
<li>le: EVM uses 560 Mezzanine Emulator daughter card</li>
<li>ls: EVM uses XDS200 Emulator card</li>
<li>-le: Little Endian</li>
<li>-be: Big Endian</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>By default, the images provided are little endian.</li>
<li>Also by default, Keystone 2 EVMs are expected to only use the XDS2xx
Emulator. You do not have to supply the emulator in the parameter for
K2H/K2E/K2L.</li>
</ul>
</div>
<p>Some examples are:</p>
<p>TMDXEVM6678LE little endian</p>
<div class="highlight-cpp"><div class="highlight"><pre>&gt; $DSS_SCRIPT_DIR/dss.sh program_evm.js tmdxevm6678le-le
</pre></div>
</div>
<p>TMDSEVM6657LS little endian</p>
<div class="highlight-cpp"><div class="highlight"><pre>&gt; $DSS_SCRIPT_DIR/dss.sh program_evm.js tmdxevm6657ls-le
</pre></div>
</div>
<p>EVMK2H little endian</p>
<div class="highlight-cpp"><div class="highlight"><pre>&gt; $DSS_SCRIPT_DIR/dss.sh program_evm.js tmdsevmk2h
</pre></div>
</div>
<p>EVMK2E little endian</p>
<div class="highlight-cpp"><div class="highlight"><pre>&gt; $DSS_SCRIPT_DIR/dss.sh program_evm.js tmdsevmk2e
</pre></div>
</div>
</div>
<div class="section" id="sample-output">
<h4>10.2.2.1.6. Sample Output<a class="headerlink" href="#sample-output" title="Permalink to this headline">¶</a></h4>
<div class="highlight-cpp"><div class="highlight"><pre>C:\ti\processor_sdk_rtos_c665x_2_00_01_07\bin&gt;%DSS_SCRIPT_DIR%\dss.bat program_evm.js tmdxevm6657ls-le
board: evm6657l
endian: Little
emulation: XDS200 emulator
binaries: ../prebuilt-images/
ccxml: C:\ti\processor_sdk_rtos_c665x_2_00_01_07\bin/configs/evm6657l/evm6657ls.ccxml
C66xx_0: GEL Output:
Connecting Target...

C66xx_0: GEL Output: DSP core #0

C66xx_0: GEL Output: C6657L GEL file Ver is 1.006

C66xx_0: GEL Output: Global Default Setup...

C66xx_0: GEL Output: Setup Cache...

C66xx_0: GEL Output: L1P = 32K

C66xx_0: GEL Output: L1D = 32K

C66xx_0: GEL Output: L2 = ALL SRAM

C66xx_0: GEL Output: Setup Cache... Done.

C66xx_0: GEL Output: Main PLL (PLL1) Setup ...

C66xx_0: GEL Output: PLL in Bypass ...

C66xx_0: GEL Output: PLL1 Setup for DSP @ 1000.0 MHz.

C66xx_0: GEL Output:            SYSCLK2 = 333.3333 MHz, SYSCLK5 = 200.0 MHz.

C66xx_0: GEL Output:            SYSCLK8 = 15.625 MHz.

C66xx_0: GEL Output: PLL1 Setup... Done.

C66xx_0: GEL Output: Power on all PSC modules and DSP domains...

C66xx_0: GEL Output: Set_PSC_State... Timeout Error #03 pd=12, md=4!

C66xx_0: GEL Output: Power on all PSC modules and DSP domains... Done.

C66xx_0: GEL Output: DDR3 PLL (PLL2) Setup ...

C66xx_0: GEL Output: DDR3 PLL Setup... Done.

C66xx_0: GEL Output: DDR3 Init begin (1333 auto)

C66xx_0: GEL Output: XMC Setup ... Done

C66xx_0: GEL Output: IFRDY bit is SET: DDR3 Interface Ready

C66xx_0: GEL Output:
DDR3 initialization is complete.

C66xx_0: GEL Output: DDR3 Init done

C66xx_0: GEL Output: DDR3 memory test... Started

C66xx_0: GEL Output: DDR3 memory test... Passed

C66xx_0: GEL Output: PLL and DDR3 Initialization completed(0) ...

C66xx_0: GEL Output: configSGMIISerdes Setup... Begin

C66xx_0: GEL Output: SGMII SERDES has been configured.

C66xx_0: GEL Output: Enabling EDC ...

C66xx_0: GEL Output: L1P error detection logic is enabled.

C66xx_0: GEL Output: L2 error detection/correction logic is enabled.

C66xx_0: GEL Output: MSMC error detection/correction logic is enabled.

C66xx_0: GEL Output: Enabling EDC ...Done

C66xx_0: GEL Output: Global Default Setup... Done.

Start writing eeprom50
Writer:../prebuilt-images/eepromwriter_evm6657l.out

Image:../prebuilt-images/eeprom50.bin

C66xx_0: GEL Output: Invalidate All Cache...

C66xx_0: GEL Output: Invalidate All Cache... Done.

C66xx_0: GEL Output: GEL Reset...

C66xx_0: GEL Output: GEL Reset... Done.

C66xx_0: GEL Output: Disable all EDMA3 interrupts and events.

EEPROM Writer Utility Version 01.00.00.05

Writing 57432 bytes from DSP memory address 0x0c000000 to EEPROM bus address 0x0050 starting from device address 0x0000
...
Reading 57432 bytes from EEPROM bus address 0x0050 to DSP memory address 0x0c010000 starting from device address 0x0000
...
Verifying data read ...
EEPROM programming completed successfully
Start writing eeprom51
Writer:../prebuilt-images/eepromwriter_evm6657l.out

Image:../prebuilt-images/eeprom51.bin

C66xx_0: GEL Output: Invalidate All Cache...

C66xx_0: GEL Output: Invalidate All Cache... Done.

C66xx_0: GEL Output: GEL Reset...

C66xx_0: GEL Output: GEL Reset... Done.

C66xx_0: GEL Output: Disable all EDMA3 interrupts and events.

EEPROM Writer Utility Version 01.00.00.05

Writing 47888 bytes from DSP memory address 0x0c000000 to EEPROM bus address 0x0051 starting from device address 0x0000
...
Reading 47888 bytes from EEPROM bus address 0x0051 to DSP memory address 0x0c010000 starting from device address 0x0000
...
Verifying data read ...
EEPROM programming completed successfully
Writer:../prebuilt-images/nandwriter_evm6657l.out

NAND:../prebuilt-images/nand.bin

Required NAND files does not exist in ../prebuilt-images/

Writer:../prebuilt-images/norwriter_evm6657l.out

NOR:../prebuilt-images/nor.bin

Required NOR files does not exist in ../prebuilt-images/
</pre></div>
</div>
<p>In the above example, nothing was flashed to NAND or NOR since there
were no nand.bin or nor.bin binaries to flash.</p>
</div>
</div>
</div>
<div class="section" id="porting">
<h2>10.2.3. Porting<a class="headerlink" href="#porting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="adding-custom-board-library-target-to-processor-sdk-rtos-makefiles">
<h3>10.2.3.1. Adding Custom Board_Library Target to Processor SDK RTOS makefiles<a class="headerlink" href="#adding-custom-board-library-target-to-processor-sdk-rtos-makefiles" title="Permalink to this headline">¶</a></h3>
<div class="section" id="introduction">
<h4>10.2.3.1.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h4>
<p>The following article describes how a custom Board can be added to the
Processor SDK RTOS. The scope of this article is to only describe how to
modify the build files in the PDK to add build steps for your custom
board library. The article does not describe modification of source
files to reflect changes to clocking, DDR and pinmux setup for the
custom board.</p>
<p>The instructions provided in this article uses example of AM572x custom
board but the instructions apply to all the processors supported in
Processor SDK RTOS. Note that the instructions on this wiki were created
using Processor SDK RTOS v3.2 and PDK_AM57xx_1_0_5 and are subject to
change. Also the wiki was created specifically for the newer board
variants like evmAM572x, idkAM572x and evmK2G. For AM335x and AM437x
variant board library has several dependencies on legacy starterware
package, hence additional steps are required and not covered in the
wiki.</p>
</div>
<div class="section" id="instructions-to-add-custom-board-to-the-pdk-build">
<h4>10.2.3.1.2. Instructions to add custom Board to the PDK build<a class="headerlink" href="#instructions-to-add-custom-board-to-the-pdk-build" title="Permalink to this headline">¶</a></h4>
<p><strong>Step 1: Creating new directory for custom board library</strong></p>
<p>In pdk_am57xx_x_x_x/packages/ti/board/src,
Create new directory myCustomBoard and copy files from existing board
library package. We recommend that you copy files from the board which
closely matches your custom board design. In this case, we assume that
the custom board is based on the design of evmAM572x so we copy over
the files from that directory into myCustomBoard folder.</p>
<p><strong>Step 2: Updating names and makefile inside the customBoard package</strong></p>
<p>In pdk_am57xx_x_x_x/packages/ti/board/src/myCustomBoard, Rename file
src_files_evmAM572x.mk to src_files_myCustomBoard.mk. This file will
need a bit of work depending on what elements of board you need for your
platform. We have left all the files evmAM572x_*.c but you can modify as
needed.</p>
<p><strong>Step 3: Adding MACRO based inclusion of updated board_cfg.h
corresponding to custom Board</strong></p>
<p>In packages/ti/board/board_cfg.h, add the lines pointing to board_cfg.h
file in your customBoard package so that updated peripheral instances
and board specific defines can be picked up</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#if defined (myCustomBoard)</span>
<span class="cp">#include &lt;ti/board/src/myCustomBoard/include/board_cfg.h&gt;</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p><strong>Step 4: Update top level board package makefile to include build for
customBoard Library</strong> The makefile is used to include all relevant make
files for including Low level driver(LLD), source files relevant to
board and the common board.c file</p>
<ul class="simple">
<li>In packages/ti/board/build/makefile.mk, add board.c to the
customBoard build&nbsp;:</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre>ifeq ($(BOARD),$(filter $(BOARD),evmAM335x icev2AM335x skAM335x bbbAM335x evmAM437x idkAM437x skAM437x myCustomBoard evmAM572x idkAM571x idkAM572x evmK2H evmK2K evmK2E evmK2L evmK2G iceK2G evmC6678 evmC6657))
# Common source files across all platforms and cores
SRCS_COMMON += board.c
endif
</pre></div>
</div>
<ul class="simple">
<li>Add board library source files and LLD files to the customBoard build</li>
</ul>
<p>In packages/ti/board/build/makefile.mk, change</p>
<div class="highlight-cpp"><div class="highlight"><pre>ifeq ($(BOARD),$(filter $(BOARD), evmAM572x idkAM571x idkAM572x))
include $(PDK_BOARD_COMP_PATH)/src/$(BOARD)/src_files_$(BOARD).mk
include $(PDK_BOARD_COMP_PATH)/src/src_files_lld.mk
CFLAGS_LOCAL_$(BOARD) += -D$(BOARD)
endif
</pre></div>
</div>
<p>to</p>
<div class="highlight-cpp"><div class="highlight"><pre>ifeq ($(BOARD),$(filter $(BOARD), myCustomBoard evmAM572x idkAM571x idkAM572x))
include $(PDK_BOARD_COMP_PATH)/src/$(BOARD)/src_files_$(BOARD).mk
include $(PDK_BOARD_COMP_PATH)/src/src_files_lld.mk
CFLAGS_LOCAL_$(BOARD) += -D$(BOARD)
endif
</pre></div>
</div>
<p><strong>Step 5: Update Global makerules</strong></p>
<p>build_config.mk defines the global CFLAGS used to compile different PDK
components. Add the following line in the BOARD Specific configurations.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">CFLAGS_GLOBAL_customAM572x</span>  <span class="o">=</span> <span class="o">-</span><span class="n">DSOC_AM572x</span> <span class="o">-</span><span class="n">DevmAM572x</span>
</pre></div>
</div>
<p>The SOC_AM572x macro ensures that the CSL aplicable to this SOC will be
included in the build and evmAM572x define will ensure all evmAM572x
specific includes that apply to the customAM572x are part of the build.</p>
<p><strong>Optional step to update RTSC platform definition</strong> If you have a
custom RTSC platform definition for your custom board that updates the
memory and platform configuration using RTSC Tool then you need to
update the platform.mk file that associates the RTSC platfom with the
corresponding board library</p>
<p>In packages/ti/buildmakerules/platform.mk, add the following lines:</p>
<div class="highlight-cpp"><div class="highlight"><pre>ifeq ($(BOARD),$(filter $(BOARD), evmAM572x))
  PLATFORM_XDC = &quot;ti.platforms.evmAM572X&quot;
endif
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>ifeq ($(BOARD),$(filter $(BOARD), myCustomBoard))
  PLATFORM_XDC = &quot;evmAM572XCustom&quot;
endif
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The SYSBIOS platforms follow the convention to consolidate all
platform definitions under SYSBIOS_INSTALL_PATH/packages/ti/platforms/*
hence the convention ti.platorms.&lt;platformName&gt; but for custom platform,
users are not required to follow this convention.</p>
</div>
<p><strong>Step 6: Update source files corresponding to drivers used in board
library</strong>. src_files_lld.mk file adds source files corresponding to LLD
drivers used in the board library. Usually most boards utilitize control
driver like I2C (for programming the PMIC or reading EEPROM), UART
drivers (for IO) and boot media drivers like (SPI/QSPI, MMC or NAND). In
the example below, we assume that the custom Board library has
dependency on I2C, SPI and UART LLD drivers. Since the LLD drivers will
be linked to the application along with board library, board library
only needs &lt;driver&gt;_soc.c corresponding to SOC used on the custom Board.</p>
<p>In packages/ti/board/src/src_files_lld.mk, add the following lines:</p>
<div class="highlight-cpp"><div class="highlight"><pre>ifeq ($(BOARD),$(filter $(BOARD), myCustomBoard))
SRCDIR +=  $(PDK_INSTALL_PATH)/ti/drv/i2c/soc/am572x \
           $(PDK_INSTALL_PATH)/ti/drv/uart/soc/am572x \
           $(PDK_INSTALL_PATH)/ti/drv/spi/soc/am572x
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>INCDIR +=  $(PDK_INSTALL_PATH)/ti/drv/i2c/soc/am572x \
           $(PDK_INSTALL_PATH)/ti/drv/uart/soc/am572x \
           $(PDK_INSTALL_PATH)/ti/drv/spi/soc/am572x
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp"># Common source files across all platforms and cores</span>
<span class="n">SRCS_COMMON</span> <span class="o">+=</span> <span class="n">I2C_soc</span><span class="p">.</span><span class="n">c</span> <span class="n">UART_soc</span><span class="p">.</span><span class="n">c</span> <span class="n">SPI_soc</span><span class="p">.</span><span class="n">c</span>
<span class="n">endif</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For all LLD drivers linked to the board library you need to include
corresponding &lt;drv&gt;_soc.c file. For example if you include GPIO driver
for setting board mux then GPIO_soc.c needs to be added to LLD source
files.</p>
</div>
<p><strong>Step 7: Add custom Board to BOARDLIST and update CORELIST</strong></p>
<p>In packages/ti/board/board_component.mk, modify the build to add your
custom board and specify the cores for which you want to build the board
library. Example to build board library for only A15 and C66x cores,
limit the build by specify only a15_0 and C66x in the CORELIST</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">board_lib_BOARDLIST</span>       <span class="o">=</span> <span class="n">myCustomBoard</span> <span class="n">evmAM335x</span> <span class="n">icev2AM335x</span> <span class="n">skAM335x</span> <span class="n">bbbAM335x</span> <span class="n">evmAM437x</span> <span class="n">idkAM437x</span> <span class="n">skAM437x</span> <span class="n">evmAM572x</span> <span class="n">idkAM571x</span> <span class="n">idkAM572x</span> <span class="n">evmK2H</span> <span class="n">evmK2K</span> <span class="n">evmK2E</span> <span class="n">evmK2L</span> <span class="n">evmK2G</span> <span class="n">iceK2G</span> \
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#board_lib_am572x_CORELIST = c66x a15_0 ipu1_0</span>
<span class="n">board_lib_am572x_CORELIST</span> <span class="o">=</span> <span class="n">a15_0</span> <span class="n">c66x</span>
</pre></div>
</div>
<p><strong>Step 8: Update .bld files for XDCTOOL based build steps.</strong></p>
<p>Make corresponding changes in packages/ti/board/config.bld, by adding
the following lines:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">var</span> <span class="n">myCustomBoard</span> <span class="o">=</span> <span class="p">{</span>
   <span class="nl">name:</span> <span class="s">&quot;myCustomBoard&quot;</span><span class="p">,</span>
   <span class="nl">ccOpts:</span> <span class="s">&quot;-DevmAM572x -DSOC_AM572x&quot;</span><span class="p">,</span>
   <span class="nl">targets:</span> <span class="p">[</span><span class="n">C66LE</span><span class="p">,</span><span class="n">A15LE</span> <span class="p">]</span>
   <span class="nl">lldFiles:</span> <span class="p">[</span> <span class="s">&quot;$(PDK_INSTALL_PATH)/ti/drv/i2c/soc/am572x/I2C_soc.c&quot;</span><span class="p">,</span>
           <span class="s">&quot;$(PDK_INSTALL_PATH)/ti/drv/uart/soc/am572x/UART_soc.c&quot;</span><span class="p">,</span>
           <span class="s">&quot;$(PDK_INSTALL_PATH)/ti/drv/spi/soc/am572x/SPI_soc.c&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">var</span> <span class="n">boards</span> <span class="o">=</span> <span class="p">[</span> <span class="n">evmAM335x</span><span class="p">,</span> <span class="n">icev2AM335x</span><span class="p">,</span> <span class="n">skAM335x</span><span class="p">,</span> <span class="n">bbbAM335x</span><span class="p">,</span> <span class="n">evmAM437x</span><span class="p">,</span> <span class="n">idkAM437x</span><span class="p">,</span> <span class="n">skAM437x</span><span class="p">,</span> <span class="n">myCustomBoard</span><span class="p">,</span> <span class="n">evmAM572x</span><span class="p">,</span> <span class="n">idkAM571x</span><span class="p">,</span> <span class="n">idkAM572x</span><span class="p">,</span> <span class="n">evmK2H</span><span class="p">,</span> <span class="n">evmK2K</span><span class="p">,</span> <span class="n">evmK2E</span><span class="p">,</span> <span class="n">evmK2L</span><span class="p">,</span> <span class="n">evmK2G</span><span class="p">,</span> <span class="n">evmC6678</span><span class="p">,</span> <span class="n">evmC6657</span> <span class="p">];</span>
</pre></div>
</div>
<p>Also, in packages/ti/board/package.bld, I added the following line:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">Pkg</span><span class="p">.</span><span class="n">otherFiles</span><span class="p">[</span><span class="n">Pkg</span><span class="p">.</span><span class="n">otherFiles</span><span class="p">.</span><span class="n">length</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;src/myCustomBoard/src_files_myCustomBoard.mk&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Step 9: Setup Top level PDK build files to add the Custom board to
setup environment.</strong></p>
<p>Final setup involves updating the top level setup file for PDK package
to update to setup the build environment to include the custom Board in
setup. This can be done by commenting out the top line and adding in the
bottom line in pdksetupenv.bat:</p>
<div class="highlight-cpp"><div class="highlight"><pre>@REM if not defined LIMIT_BOARDS set LIMIT_BOARDS=evmAM572x idkAM571x idkAM572x
if not defined LIMIT_BOARDS set LIMIT_BOARDS=myCustomBoard
</pre></div>
</div>
<p><strong>Alternative:</strong> Invoke the build using command line options to limit
the build to specific board, specific SOC and specific CORE. For
example, if you want to build the A15 version of board library for
AM572x EVM, you can invoke the build using:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">gmake</span> <span class="n">board_lib</span> <span class="n">LIMIT_SOCS</span><span class="o">=</span><span class="n">am572x</span> <span class="n">LIMIT_BOARDS</span><span class="o">=</span><span class="n">customAM572x</span> <span class="n">LIMIT_CORES</span><span class="o">=</span><span class="n">a15_0</span>
</pre></div>
</div>
<p><strong>Step 10&nbsp;: Building the custom board with the updated settings</strong></p>
<p>To build package change directory to
&lt;SDK_INSTALL_PATH&gt;/pdk_am57xx_x_x_x/packages, first run pdksetupenv.bat</p>
<p>To make just the board library: gmake board_lib</p>
</div>
<div class="section" id="example-custom-board-library-for-reference">
<h4>10.2.3.1.3. Example custom Board library for reference<a class="headerlink" href="#example-custom-board-library-for-reference" title="Permalink to this headline">¶</a></h4>
<p>The package provided below provides updated files for building
customBoard &#8220;customAM572x&#8221; following all steps described above. Please
compare the files to the evmAM57xx board library files to follow the
steps to add your own board library.</p>
<p><a class="reference external" href="/index.php?title=Special:Upload&amp;wpDestFile=Pdk_packages_ti_board_customAM572x.zip">File:Pdk packages ti board
customAM572x.zip</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Due to software distribution policy on the wiki, we have removed the
file linked here. Users can refer to the discussion and zipped package
linked from E2E post provided below:</p>
</div>
<ul class="simple">
<li><a class="reference external" href="https://e2e.ti.com/support/arm/sitara_arm/f/791/p/555022/2040948#pi316653=2">E2E post on creation of custom board
library</a></li>
</ul>
</div>
<div class="section" id="additional-steps-for-am335x-am437x-users">
<h4>10.2.3.1.4. Additional steps for AM335x/AM437x users<a class="headerlink" href="#additional-steps-for-am335x-am437x-users" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently the AM335x and AM437x board libraries re-use the board support
that was used in legacy starterware software. AM335x and AM437x users
will need to additionally modify build files in starterware to build
their custom board library. Additional steps required for AM335x/AM437x
will be added to this article soon in this section</p>
</div>
</div>
</div>
<div class="section" id="processor-sdk-rtos-porting-guide-for-am571x-am570x-speed-grades">
<h3>10.2.3.2. Processor SDK RTOS Porting Guide for AM571x/AM570x Speed Grades<a class="headerlink" href="#processor-sdk-rtos-porting-guide-for-am571x-am570x-speed-grades" title="Permalink to this headline">¶</a></h3>
<div class="section" id="description">
<h4>10.2.3.2.1. Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h4>
<p>The AM57x Family of Processors includes a wide range of operating
performance to meet the needs of a number of broad applications. Among
these options are a variety of speed grades to meet different
performance points. These devices have a number of specialized cores to
provide applications specific computation capabilities. These cores can
be run at different speeds to fine tune the processor to the needs of
the application, power budget, thermal characteristics, etc.</p>
<p>The Processor SDK for RTOS is a software development package provided to
speed development by providing a software reference. This package now
includes support for then entire AM57x family of processors which can be
broken down into the AM572x, AM571x, and AM570x sets of devices or
sub-familes. Most of the devices in this family are supported by the
Processor SDK for RTOS right out of the box. This support is tested and
validated on TI designed EVMs. These EVMs use the highest performance
devices in the family in order to allow users to evaluate the entire
spectrum of performance.</p>
<p>The AM571X and AM570x supports several lower power speed grades. If one
of these devices is being used on the custom board, the GEL file and the
board library needs to be changed to account for this difference. If
this change is not made, the device could be running out of
specification. These changes may reach across other cores and clocks on
the device as well, depending on what speeds they need to operate at.
This document is not an exhaustive list of all the changes needed for a
proper board port as it focused on the changes needed to enable
different speed grades.</p>
</div>
<div class="section" id="comparison-of-am572x-am571x-and-am570x-devices">
<h4>10.2.3.2.2. Comparison of AM572x, AM571x and AM570x devices<a class="headerlink" href="#comparison-of-am572x-am571x-and-am570x-devices" title="Permalink to this headline">¶</a></h4>
<p><strong>Quick Feature Set comparison between devices in Sitara AM57xx
family&nbsp;:</strong></p>
<img alt="../_images/AM572x_AM571X_AM570x_Comparison.png" src="../_images/AM572x_AM571X_AM570x_Comparison.png" />
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><strong>Supported OPP on AM57xx devices:</strong></div>
</div>
<img alt="../_images/AM57xx_OPP.png" src="../_images/AM57xx_OPP.png" />
</div>
<div class="section" id="code-composer-studio-ccs-and-emulation-support">
<h4>10.2.3.2.3. Code Composer Studio (CCS) and Emulation support<a class="headerlink" href="#code-composer-studio-ccs-and-emulation-support" title="Permalink to this headline">¶</a></h4>
<p>TI Supports following evaluation platform for AM57xx class of devices:</p>
<ul class="simple">
<li><a class="reference external" href="index_release_specific.html#supported-platforms-and-versions">AM572x GP EVM</a></li>
<li><a class="reference external" href="index_release_specific.html#supported-platforms-and-versions">AM571x IDK</a></li>
<li><a class="reference external" href="index_release_specific.html#supported-platforms-and-versions">AM572x IDK</a></li>
</ul>
<p>When developer selects any of the above platforms in Code composer
Studio, the target configuration automatically brings in the required
initialization files and GEL files to configure the clocks, slave cores,
external memory.</p>
<p>If you are using a custom platform or AM5708 device that is not
available on a TI Evaluation platform, you can follow the steps provided
below to connect to the SOC by reusing the GEL files that are provided
for TI evaluation platforms. For example, here we demonstrate how you
can create a target configuration for AM570x and connect to the device
if your board design is based of one of TI evalauation platforms listed
below. The assumption here is that the custom board is based off AM571X
IDK platform</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Support for AM5708 was added to Sitara Chip Support Package 1.3.4
in Code composer Studio. If you don`t see the device definition in CCS,
then you can update the Sitara Chip Support package by going to
<a class="reference external" href="http://ap-fpdsp-swapps.dal.design.ti.com/index.php/File:Check_Updates.png">Help-&gt;Check
Updates</a></p>
</div>
<p><strong>Step 1: Select the AM570x part number that is populated on your custom
platform:</strong></p>
<img alt="../_images/AM5708_EVM_target_configurations.png" src="../_images/AM5708_EVM_target_configurations.png" />
<p><strong>Step 2: Setup the GEL files for the SOC</strong> Go to the Advanced Tab as
shown in the previous screenshot and update startup GEL file in the A15
Core as shown in the screenshot below</p>
<img alt="../_images/Advanced_settings_GEL_setup.png" src="../_images/Advanced_settings_GEL_setup.png" />
</div>
<div class="section" id="board-library-changes-to-consider-for-using-processor-sdk-rtos">
<h4>10.2.3.2.4. Board Library Changes to Consider for Using Processor SDK RTOS<a class="headerlink" href="#board-library-changes-to-consider-for-using-processor-sdk-rtos" title="Permalink to this headline">¶</a></h4>
<div class="section" id="clock-and-prcm-updates-to-consider">
<h5>10.2.3.2.4.1. Clock and PRCM Updates to consider<a class="headerlink" href="#clock-and-prcm-updates-to-consider" title="Permalink to this headline">¶</a></h5>
<p>The board library provides setting for OPP_NOM, OPP_OD and OPP_HIGH in
the PLL settings using 20 MHz input clock that has been used on the
AM572x GP EVM as well as the AM571x IDK platform. This allows customers
to setup the MPU to 1.5, 1.176 and 1GHz. For AM570x devices, we support
the &#8220;J&#8221; and the &#8220;D&#8221; variant which support the following max speeds on
the DPLLs:</p>
<img alt="../_images/AM5706_Speed_Grades.png" src="../_images/AM5706_Speed_Grades.png" />
<p>When using the &#8220;J&#8221; speed grade, ensure that the DPLLs in the board set
the DPLL to OPP_NOM and not for OPP_OD or OPP_HIGH.</p>
<p>To do this, you can invoke the Board_Init from your application using
either</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">Board_initCfg</span> <span class="n">boardCfg</span><span class="p">;</span>
<span class="n">boardCfg</span> <span class="o">=</span> <span class="n">BOARD_INIT_PLL_OPP_NOM</span><span class="p">;</span>
<span class="n">boardCfg</span> <span class="o">|=</span> <span class="n">BOARD_INIT_UNLOCK_MMR</span> <span class="o">|</span>
       <span class="n">BOARD_INIT_MODULE_CLOCK</span> <span class="o">|</span>
       <span class="n">BOARD_INIT_PINMUX_CONFIG</span> <span class="o">|</span>
       <span class="n">BOARD_INIT_DDR</span> <span class="o">|</span>
       <span class="n">BOARD_INIT_UART_STDIO</span> <span class="o">|</span>
       <span class="n">BOARD_INIT_WATCHDOG_DISABLE</span><span class="p">;</span>
<span class="cm">/* Board Library Init. */</span>
   <span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When bootloading direct from flash media, this change may also be
required in the SBL code</p>
</div>
<p>When using &#8220;D&#8221; rated parts that run at 500 MHz, in addition to the
above configuration, you will also need to modify OPP_NOM settings in
the board library by updating the DPLL setting for MPU and DSP in the
file &lt;BoardName&gt;_pll.c as shown below:</p>
<p><strong>Step1&nbsp;: Update MPU, DSP, IVA and GPU DPLL setting</strong></p>
<ul class="simple">
<li><strong>MPU DPLL Changes:</strong></li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* Default to OPP_NOM */</span>
     <span class="cm">/* 500MHz at 20MHz sys_clk */</span>
     <span class="n">mpuPllcParam</span><span class="p">.</span><span class="n">mult</span> <span class="o">=</span> <span class="mi">250U</span><span class="p">;</span>
     <span class="n">mpuPllcParam</span><span class="p">.</span><span class="n">div</span> <span class="o">=</span> <span class="mi">9U</span><span class="p">;</span>
     <span class="n">mpuPllcParam</span><span class="p">.</span><span class="n">dccEnable</span> <span class="o">=</span> <span class="mi">0U</span><span class="p">;</span>
     <span class="n">mpuPllcParam</span><span class="p">.</span><span class="n">divM2</span> <span class="o">=</span> <span class="mi">1U</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>DSP DPLL Changes:</strong></li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* 500MHz at 20MHz sys_clk */</span>
<span class="n">dspPllcParam</span><span class="p">.</span><span class="n">mult</span> <span class="o">=</span> <span class="mi">130U</span><span class="p">;</span>
<span class="n">dspPllcParam</span><span class="p">.</span><span class="n">div</span> <span class="o">=</span> <span class="mi">3U</span><span class="p">;</span>
<span class="n">dspPllcParam</span><span class="p">.</span><span class="n">divM2</span> <span class="o">=</span> <span class="mi">1U</span><span class="p">;</span>
<span class="n">dspPllcParam</span><span class="p">.</span><span class="n">divM3</span> <span class="o">=</span> <span class="mi">3U</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>Remove IVA and GPU PLL settings</strong></li>
</ul>
<p>Since IVA and GPU modules are not available on the device, we recommend
removing the ivaPLL and gpuPLL settings in board.</p>
<div class="highlight-cpp"><div class="highlight"><pre>              <span class="cm">/* Default to OPP_NOM */</span>
              <span class="cm">/* 388.3MHz at 20MHz sys_clk */</span>
<span class="o">-</span>                <span class="n">ivaPllcParam</span><span class="p">.</span><span class="n">mult</span> <span class="o">=</span> <span class="mi">233U</span><span class="p">;</span>
<span class="o">-</span>                <span class="n">ivaPllcParam</span><span class="p">.</span><span class="n">div</span> <span class="o">=</span> <span class="mi">3U</span><span class="p">;</span>
<span class="o">-</span>                <span class="n">ivaPllcParam</span><span class="p">.</span><span class="n">divM2</span> <span class="o">=</span> <span class="mi">3U</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>             <span class="cm">/* Default to OPP_NOM */</span>
             <span class="cm">/* 425MHz at 20MHz sys_clk */</span>
<span class="o">-</span>                <span class="n">gpuPllcParam</span><span class="p">.</span><span class="n">mult</span> <span class="o">=</span> <span class="mi">170U</span><span class="p">;</span>
<span class="o">-</span>                <span class="n">gpuPllcParam</span><span class="p">.</span><span class="n">div</span> <span class="o">=</span> <span class="mi">3U</span><span class="p">;</span>
<span class="o">-</span>                <span class="n">gpuPllcParam</span><span class="p">.</span><span class="n">divM2</span> <span class="o">=</span> <span class="mi">2U</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Step 2&nbsp;: Disable clocks configuration and wakeup for IVA in PRCM</strong></p>
<ul class="simple">
<li><strong>Remove IVA wakeup and Module configuration</strong></li>
</ul>
<p>The following updates need to be made in the file &lt;BoardName&gt;_clock.c to
remove IVA wakeup and clock configuration</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="o">-</span>        <span class="n">CSL_FINST</span><span class="p">(</span><span class="n">ivaCmReg</span><span class="o">-&gt;</span><span class="n">CM_IVA_CLKSTCTRL_REG</span><span class="p">,</span>
<span class="o">-</span>        <span class="n">IVA_CM_CORE_CM_IVA_CLKSTCTRL_REG_CLKTRCTRL</span><span class="p">,</span> <span class="n">SW_WKUP</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre>   <span class="cm">/* PRCM Specialized module mode setting functions */</span>
<span class="o">-</span>   <span class="n">CSL_FINST</span><span class="p">(</span><span class="n">ivaCmReg</span><span class="o">-&gt;</span><span class="n">CM_IVA_SL2_CLKCTRL_REG</span><span class="p">,</span>
<span class="o">-</span>       <span class="n">IVA_CM_CORE_CM_IVA_SL2_CLKCTRL_REG_MODULEMODE</span><span class="p">,</span> <span class="n">AUTO</span><span class="p">);</span>
<span class="o">-</span>  <span class="k">while</span><span class="p">(</span><span class="n">CSL_IVA_CM_CORE_CM_IVA_SL2_CLKCTRL_REG_IDLEST_DISABLE</span> <span class="o">==</span>
<span class="o">-</span>      <span class="n">CSL_FEXT</span><span class="p">(</span><span class="n">ivaCmReg</span><span class="o">-&gt;</span><span class="n">CM_IVA_SL2_CLKCTRL_REG</span><span class="p">,</span>
<span class="o">-</span>       <span class="n">IVA_CM_CORE_CM_IVA_SL2_CLKCTRL_REG_IDLEST</span><span class="p">));</span>
<span class="o">-</span>   <span class="n">CSL_FINST</span><span class="p">(</span><span class="n">ivaCmReg</span><span class="o">-&gt;</span><span class="n">CM_IVA_IVA_CLKCTRL_REG</span><span class="p">,</span>
<span class="o">-</span>       <span class="n">IVA_CM_CORE_CM_IVA_IVA_CLKCTRL_REG_MODULEMODE</span><span class="p">,</span> <span class="n">AUTO</span><span class="p">);</span>
<span class="o">-</span>   <span class="k">while</span><span class="p">(</span><span class="n">CSL_IVA_CM_CORE_CM_IVA_IVA_CLKCTRL_REG_IDLEST_DISABLE</span> <span class="o">==</span>
<span class="o">-</span>      <span class="n">CSL_FEXT</span><span class="p">(</span><span class="n">ivaCmReg</span><span class="o">-&gt;</span><span class="n">CM_IVA_IVA_CLKCTRL_REG</span><span class="p">,</span>
<span class="o">-</span>       <span class="n">IVA_CM_CORE_CM_IVA_IVA_CLKCTRL_REG_IDLEST</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="configure-ddr-interfaces">
<h4>10.2.3.2.5. Configure DDR Interfaces<a class="headerlink" href="#configure-ddr-interfaces" title="Permalink to this headline">¶</a></h4>
<p>An important one to consider is the speed of the DDR memory. The clock
for the DDR is selected using the same dplls structure. Some higher
speed grade parts support a 667 MHz DDR clock, but some of the lower
speed grade parts only support a 533 MHz DDR3 clock. Make sure to choose
the appropriate DDR clock for the device on the custom board.</p>
<p>Over in the board/src/&lt;BoardName&gt;/&lt;BoardName_ddr&gt;.c file, make sure that
the EMIF is being configured correctly for the appropriate speed, and
that the appropriate number of EMIFs is being selected to match the part
being used. AM572x part has 2 DDR interfaces running at 533 MHz and the
AM571x (and AM570x) only have one running at 667 MHz. This code can be
kept or removed by the board port. As changes are made, the code must
make sure to configure the new board correctly, with the appropriate
number of DDR interfaces and speed configuration.</p>
<p>For AM571x and AM570x, make sure to use the code for the AM571x IDK in
board/src/&lt;BoardName&gt;/&lt;BoardName_ddr&gt;.c to select 1 EMIF:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* MA_LISA_MAP_i */</span>
<span class="n">hMampuLsm</span><span class="o">-&gt;</span><span class="n">MAP_0</span> <span class="o">=</span> <span class="mh">0x80600100U</span><span class="p">;</span>
<span class="cm">/* DMM_LISA_MAP_i */</span>
<span class="n">hDmmCfg</span><span class="o">-&gt;</span><span class="n">LISA_MAP</span><span class="p">[</span><span class="mi">0U</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x80600100U</span><span class="p">;</span>
</pre></div>
</div>
<p>For AM572x, this is mapped as following</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* MA_LISA_MAP_i */</span>
<span class="n">hMampuLsm</span><span class="o">-&gt;</span><span class="n">MAP_0</span> <span class="o">=</span> <span class="mh">0x80740300</span><span class="p">;</span>
<span class="n">hMampuLsm</span><span class="o">-&gt;</span><span class="n">MAP_1</span> <span class="o">=</span> <span class="mh">0x80740300</span><span class="p">;</span>
<span class="cm">/* DMM_LISA_MAP_i */</span>
<span class="n">hDmmCfg</span><span class="o">-&gt;</span><span class="n">LISA_MAP</span><span class="p">[</span><span class="mi">0U</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x80740300</span><span class="p">;</span>
<span class="n">hDmmCfg</span><span class="o">-&gt;</span><span class="n">LISA_MAP</span><span class="p">[</span><span class="mi">1U</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x80740300</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Processor SDK RTOS provides am570x_ddr.c file in the idkAM571x board
library for reference for configuring DDR on AM570x parts</p>
</div>
</div>
<div class="section" id="pinmux-changes-to-consider">
<h4>10.2.3.2.6. Pinmux Changes to Consider<a class="headerlink" href="#pinmux-changes-to-consider" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>For part number where the Display subsystem or SATA is not available,
the pins can be configured to any other pin functionality that may be
required in the system. If you don`t need to use these pins, we
recommend that you leave these pins in default MUXMODE and terminate
the pinmux as recommended in the <a class="reference external" href="http://processors.wiki.ti.com/index.php/AM57xx_Schematic_Checklist">Schematics
Checklist</a>.</li>
<li>There is no pinmux setting for CSI2 module so you can leave the
MUXMODE=0 on those pins if there is no instance of the peripheral</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Processor SDK RTOS provides board/src/idkAM571x/include/am570x_pinmux.h
file in the idkAM571x board library for reference for configuring pinmux
on AM570x based hardware platform</p>
</div>
</div>
<div class="section" id="driver-soc-module-clock-changes">
<h4>10.2.3.2.7. Driver SOC Module clock changes<a class="headerlink" href="#driver-soc-module-clock-changes" title="Permalink to this headline">¶</a></h4>
<p>Some control drivers use default Module input clock frequency settings
in &lt;module&gt;_soc.c file that gets used by the Low level drivers to
configure the peripheral clocks. The default module input clock
frequency is set to the OPP_NOM values that are available on the
superset variant of the device so if you are using lower speed grades.
Ensure you change the default to match the module clock on the 500 MHz
settings or you can use the following sequence to update the settings.
Code below describes how the SPI driver module input clock frequency can
be modified</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">SPI_v1_HWAttrs</span> <span class="n">spi_cfg</span><span class="p">;</span>
<span class="cm">/* Get the default SPI init configurations */</span>
<span class="n">SPI_socGetInitCfg</span><span class="p">(</span><span class="n">TEST_SPI_PORT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spi_cfg</span><span class="p">);</span>
<span class="cm">/* Modify the default SPI configurations if necessary */</span>
<span class="n">spi_cfg</span><span class="p">.</span><span class="n">inputClkFreq</span> <span class="o">=</span> <span class="mi">24000000</span><span class="p">;</span>
<span class="cm">/* Set the default SPI init configurations */</span>
<span class="n">SPI_socSetInitCfg</span><span class="p">(</span><span class="n">TEST_SPI_PORT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spi_cfg</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="related-article-for-processor-sdk-linux-developers">
<h4>10.2.3.2.8. Related Article for Processor SDK Linux developers<a class="headerlink" href="#related-article-for-processor-sdk-linux-developers" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://processors.wiki.ti.com/index.php/Linux_Porting_Guide_for_AM571x/AM570x_Speed_Grades">Linux_Porting_Guide_for_AM571x/AM570x_Speed_Grades</a></li>
</ul>
<p class="rubric" id="useful-utilities">Useful Utilities</p>
<ul class="simple">
<li><a class="reference external" href="http://www.ti.com/tool/clockTreeTool">Clock Tree Tool</a></li>
<li><a class="reference external" href="http://www.ti.com/tool/PinMuxTool">Pin Mux tool</a></li>
</ul>
</div>
<div class="section" id="support">
<h4>10.2.3.2.9. Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h4>
<p>For any questions related Usage of AM572x, AM571x and AM570x devices,
please post your question on TI E2E Forums</p>
<ul class="simple">
<li><a class="reference external" href="https://e2e.ti.com/support/arm/sitara_arm/">TI E2E Forums for Sitara
Processors</a></li>
</ul>
</div>
</div>
</div>
<div class="section" id="system-integration">
<h2>10.2.4. System Integration<a class="headerlink" href="#system-integration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-dsp-and-ipu-firmware-using-pdk-drivers-and-ipc-to-load-from-arm-linux-on-am57xx-devices">
<h3>10.2.4.1. Create DSP and IPU firmware using PDK drivers and IPC to load from ARM Linux on AM57xx devices<a class="headerlink" href="#create-dsp-and-ipu-firmware-using-pdk-drivers-and-ipc-to-load-from-arm-linux-on-am57xx-devices" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id4">
<h4>10.2.4.1.1. Introduction<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>This article is geared toward AM57xx users that are running Linux on the
Cortex A15. The goal is to help users understand how to gain entitlement
to the DSP (c66x) and IPU (Cortex M4) subsystems of the AM57xx.</p>
<p>AM572x device has two IPU subsystems (IPUSS), each of which has 2 cores.
IPU2 is used as a controller in multi-media applications, so if you have
Processor SDK Linux running, chances are that IPU2 already has firmware
loaded. However, IPU1 is open for general purpose programming to offload
the ARM tasks.</p>
<p>There are many facets to this task: building, loading, debugging, MMUs,
memory sharing, etc. This article intends to take incremental steps
toward understanding all of those pieces.</p>
<p class="rubric" id="software-dependencies-to-get-started">Software Dependencies to Get Started</p>
<p>Prerequisites</p>
<ul class="simple">
<li><a class="reference external" href="http://software-dl.ti.com/processor-sdk-linux/esd/AM57X/latest/index_FDS.html">Processor SDK Linux for
AM57xx</a>
(Version 3.01 or newer needed)</li>
<li><a class="reference external" href="http://software-dl.ti.com/processor-sdk-rtos/esd/AM57X/latest/index_FDS.html">Processor SDK RTOS for
AM57xx</a></li>
<li><a class="reference external" href="http://processors.wiki.ti.com/index.php/Download_CCS">Code Composer
Studio</a>
(choose version as specified on Proc SDK download page)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please be sure that you have the same version number
for both Processor SDK RTOS and Linux.</p>
</div>
<p>For reference within the context of this wiki page, the Linux SDK is
installed at the following location:</p>
<div class="highlight-cpp"><div class="highlight"><pre>/mnt/data/user/ti-processor-sdk-linux-am57xx-evm-xx.xx.xx.xx
├── bin
├── board-support
├── docs
├── example-applications
├── filesystem
├── ipc-build.txt
├── linux-devkit
├── Makefile
├── Rules.make
└── setup.sh
</pre></div>
</div>
<p>The RTOS SDK is installed at:</p>
<div class="highlight-cpp"><div class="highlight"><pre>/mnt/data/user/my_custom_install_sdk_rtos_am57xx_xx.xx
├── bios_6_xx_xx_xx
├── cg_xml
├── ctoolslib_x_x_x_x
├── dsplib_c66x_x_x_x_x
├── edma3_lld_2_xx_xx_xx
├── framework_components_x_xx_xx_xx
├── imglib_c66x_x_x_x_x
├── ipc_3_xx_xx_xx
├── mathlib_c66x_3_x_x_x
├── ndk_2_xx_xx_xx
├── opencl_rtos_am57xx_01_01_xx_xx
├── openmp_dsp_am57xx_2_04_xx_xx
├── pdk_am57xx_x_x_x
├── processor_sdk_rtos_am57xx_x_xx_xx_xx
├── uia_2_xx_xx_xx
├── xdais_7_xx_xx_xx
</pre></div>
</div>
<p>CCS is installed at:</p>
<div class="highlight-cpp"><div class="highlight"><pre>/mnt/data/user/ti/my_custom_ccs_x.x.x_install
├── ccsvX
│   ├── ccs_base
│   ├── doc
│   ├── eclipse
│   ├── install_info
│   ├── install_logs
│   ├── install_scripts
│   ├── tools
│   ├── uninstall_ccs
│   ├── uninstall_ccs.dat
│   ├── uninstallers
│   └── utils
├── Code Composer Studio x.x.x.desktop
└── xdctools_x_xx_xx_xx_core
    ├── bin
    ├── config.jar
    ├── docs
    ├── eclipse
    ├── etc
    ├── gmake
    ├── include
    ├── package
    ├── packages
    ├── package.xdc
    ├── tconfini.tcf
    ├── xdc
    ├── xdctools_3_xx_xx_xx_manifest.html
    ├── xdctools_3_xx_xx_xx_release_notes.html
    ├── xs
    └── xs.x86U
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="typical-boot-flow-on-am572x-for-arm-linux-users">Typical Boot Flow on AM572x for ARM Linux users</p>
<p>AM57xx SOC&#8217;s have multiple processor cores - Cortex A15, C66x DSP&#8217;s and
ARM M4 cores. The A15 typically runs a HLOS like Linux/QNX/Android and
the remotecores(DSP&#8217;s and M4&#8217;s) run a RTOS. In the normal operation,
boot loader(U-Boot/SPL) boots and loads the A15 with the HLOS. The A15
boots the DSP and the M4 cores.</p>
<img alt="../_images/Normal-boot.png" src="../_images/Normal-boot.png" />
<p>In this sequence, the interval between the Power on Reset and the
remotecores (i.e. the DSP&#8217;s and the M4&#8217;s) executing is dependent on the
HLOS initialization time.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="getting-started-with-ipc-linux-examples">
<h4>10.2.4.1.2. Getting Started with IPC Linux Examples<a class="headerlink" href="#getting-started-with-ipc-linux-examples" title="Permalink to this headline">¶</a></h4>
<p>The figure below illustrates how remoteproc/rpmsg driver from ARM Linux
kernel communicates with IPC driver on slave processor (e.g. DSP, IPU,
etc) running RTOS.</p>
<img alt="../_images/LinuxIPC_with_RTOS_Slave.png" src="../_images/LinuxIPC_with_RTOS_Slave.png" />
<p>In order to setup IPC on slave cores, we provide some pre-built examples
in IPC package that can be run from ARM Linux. The subsequent sections
describe how to build and run this examples and use that as a starting
point for this effort.</p>
<p class="rubric" id="building-the-bundled-ipc-examples">Building the Bundled IPC Examples</p>
<p>The instructions to build IPC examples found under
ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf have been provided in the
<strong>`Processor_SDK IPC Quick Start
Guide &lt;http://processors.wiki.ti.com/index.php/Processor_SDK_IPC_Quick_Start_Guide#Build_IPC_Linux_examples&gt;`__.</strong></p>
<p>Let&#8217;s focus on one example in particular, ex02_messageq, which is
located at
<strong>&lt;rtos-sdk-install-dir&gt;/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq</strong>.
Here are the key files that you should see after a successful build:</p>
<div class="highlight-cpp"><div class="highlight"><pre>├── dsp1
│   └── bin
│       ├── debug
│       │   └── server_dsp1.xe66
│       └── release
│           └── server_dsp1.xe66
├── dsp2
│   └── bin
│       ├── debug
│       │   └── server_dsp2.xe66
│       └── release
│           └── server_dsp2.xe66
├── host
│       ├── debug
│       │   └── app_host
│       └── release
│           └── app_host
├── ipu1
│   └── bin
│       ├── debug
│       │   └── server_ipu1.xem4
│       └── release
│           └── server_ipu1.xem4
└── ipu2
    └── bin
        ├── debug
        │   └── server_ipu2.xem4
        └── release
            └── server_ipu2.xem4
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="running-the-bundled-ipc-examples">Running the Bundled IPC Examples</p>
<p>On the target, let&#8217;s create a directory called ipc-starter:</p>
<div class="highlight-cpp"><div class="highlight"><pre>root@am57xx-evm:~# mkdir -p /home/root/ipc-starter
root@am57xx-evm:~# cd /home/root/ipc-starter/
</pre></div>
</div>
<p>You will need to copy the ex02_messageq directory of your host PC to
that directory on the target (through SD card, NFS export, SCP, etc.).
You can copy the entire directory, though we&#8217;re primarily interested in
these files:</p>
<ul class="simple">
<li>dsp1/bin/debug/server_dsp1.xe66</li>
<li>dsp2/bin/debug/server_dsp2.xe66</li>
<li>host/bin/debug/app_host</li>
<li>ipu1/bin/debug/server_ipu1.xem4</li>
<li>ipu2/bin/debug/server_ipu2.xem4</li>
</ul>
<p>The remoteproc driver is hard-coded to look for specific files when
loading the DSP/M4. Here are the files it looks for:</p>
<ul class="simple">
<li>/lib/firmware/dra7-dsp1-fw.xe66</li>
<li>/lib/firmware/dra7-dsp2-fw.xe66</li>
<li>/lib/firmware/dra7-ipu1-fw.xem4</li>
<li>/lib/firmware/dra7-ipu2-fw.xem4</li>
</ul>
<p>These are generally a soft link to the intended executable. So for
example, let&#8217;s update the DSP1 executable on the target:</p>
<div class="highlight-cpp"><div class="highlight"><pre>root@am57xx-evm:~# cd /lib/firmware/
root@am57xx-evm:/lib/firmware# rm dra7-dsp1-fw.xe66
root@am57xx-evm:/lib/firmware# ln -s /home/root/ipc-starter/ex02_messageq/dsp1/bin/debug/server_dsp1.xe66 dra7-dsp1-fw.xe66
</pre></div>
</div>
<p>To reload DSP1 with this new executable, we perform the following steps:</p>
<div class="highlight-cpp"><div class="highlight"><pre>root@am57xx-evm:/lib/firmware# cd /sys/bus/platform/drivers/omap-rproc/
root@am57xx-evm:/sys/bus/platform/drivers/omap-rproc# echo 40800000.dsp &gt; unbind
[27639.985631] omap_hwmod: mmu0_dsp1: _wait_target_disable failed
[27639.991534] omap-iommu 40d01000.mmu: 40d01000.mmu: version 3.0
[27639.997610] omap-iommu 40d02000.mmu: 40d02000.mmu: version 3.0
[27640.017557] omap_hwmod: mmu1_dsp1: _wait_target_disable failed
[27640.030571] omap_hwmod: mmu0_dsp1: _wait_target_disable failed
[27640.036605]  remoteproc2: stopped remote processor 40800000.dsp
[27640.042805]  remoteproc2: releasing 40800000.dsp
root@am57xx-evm:/sys/bus/platform/drivers/omap-rproc# echo 40800000.dsp &gt; bind
[27645.958613] omap-rproc 40800000.dsp: assigned reserved memory node dsp1_cma@99000000
[27645.966452]  remoteproc2: 40800000.dsp is available
[27645.971410]  remoteproc2: Note: remoteproc is still under development and considered experimental.
[27645.980536]  remoteproc2: THE BINARY FORMAT IS NOT YET FINALIZED, and backward compatibility isn&#39;t yet guaranteed.
root@am57xx-evm:/sys/bus/platform/drivers/omap-rproc# [27646.008171]  remoteproc2: powering up 40800000.dsp
[27646.013038]  remoteproc2: Booting fw image dra7-dsp1-fw.xe66, size 4706800
[27646.028920] omap_hwmod: mmu0_dsp1: _wait_target_disable failed
[27646.034819] omap-iommu 40d01000.mmu: 40d01000.mmu: version 3.0
[27646.040772] omap-iommu 40d02000.mmu: 40d02000.mmu: version 3.0
[27646.058323]  remoteproc2: remote processor 40800000.dsp is now up
[27646.064772] virtio_rpmsg_bus virtio2: rpmsg host is online
[27646.072271]  remoteproc2: registered virtio2 (type 7)
[27646.078026] virtio_rpmsg_bus virtio2: creating channel rpmsg-proto addr 0x3d
</pre></div>
</div>
<p>More info related to loading firmware to the various cores can be found
<a class="reference external" href="/index.php/Processor_Training:_Multimedia#Firmware_Loading_and_Unloading">here</a>.</p>
<p>Finally, we can run the example on DSP1:</p>
<div class="highlight-cpp"><div class="highlight"><pre>root@am57xx-evm:/sys/bus/platform/drivers/omap-rproc# cd /home/root/ipc-starter/ex02_messageq/host/bin/debug
root@am57xx-evm:~/ipc-starter/ex02_messageq/host/bin/debug# ./app_host DSP1
--&gt; main:
[33590.700700] omap_hwmod: mmu0_dsp2: _wait_target_disable failed
[33590.706609] omap-iommu 41501000.mmu: 41501000.mmu: version 3.0
[33590.718798] omap-iommu 41502000.mmu: 41502000.mmu: version 3.0
--&gt; Main_main:
--&gt; App_create:
App_create: Host is ready
&lt;-- App_create:
--&gt; App_exec:
App_exec: sending message 1
App_exec: sending message 2
App_exec: sending message 3
App_exec: message received, sending message 4
App_exec: message received, sending message 5
App_exec: message received, sending message 6
App_exec: message received, sending message 7
App_exec: message received, sending message 8
App_exec: message received, sending message 9
App_exec: message received, sending message 10
App_exec: message received, sending message 11
App_exec: message received, sending message 12
App_exec: message received, sending message 13
App_exec: message received, sending message 14
App_exec: message received, sending message 15
App_exec: message received
App_exec: message received
App_exec: message received
&lt;-- App_exec: 0
--&gt; App_delete:
&lt;-- App_delete:
&lt;-- Main_main:
&lt;-- main:
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The similar procedure can be used for DSP2/IPU1/IPU2 also to update
the soft link of the firmware, reload the firmware at run-time, and
run the host binary from A15.</p>
</div>
<div class="section" id="understanding-the-memory-map">
<h4>10.2.4.1.3. Understanding the Memory Map<a class="headerlink" href="#understanding-the-memory-map" title="Permalink to this headline">¶</a></h4>
<p class="rubric" id="overall-linux-memory-map">Overall Linux Memory Map</p>
<div class="highlight-cpp"><div class="highlight"><pre>root@am57xx-evm:~# cat /proc/iomem
[snip...]
58060000-58078fff : core
58820000-5882ffff : l2ram
58882000-588820ff : /ocp/mmu@58882000
80000000-9fffffff : System RAM
80008000-808d204b : Kernel code
80926000-809c96bf : Kernel data
a0000000-abffffff : CMEM
ac000000-ffcfffff : System RAM
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="cma-carveouts">CMA Carveouts</p>
<div class="highlight-cpp"><div class="highlight"><pre>root@am57xx-evm:~# dmesg | grep -i cma
[    0.000000] Reserved memory: created CMA memory pool at 0x0000000095800000, size 56 MiB
[    0.000000] Reserved memory: initialized node ipu2_cma@95800000, compatible id shared-dma-pool
[    0.000000] Reserved memory: created CMA memory pool at 0x0000000099000000, size 64 MiB
[    0.000000] Reserved memory: initialized node dsp1_cma@99000000, compatible id shared-dma-pool
[    0.000000] Reserved memory: created CMA memory pool at 0x000000009d000000, size 32 MiB
[    0.000000] Reserved memory: initialized node ipu1_cma@9d000000, compatible id shared-dma-pool
[    0.000000] Reserved memory: created CMA memory pool at 0x000000009f000000, size 8 MiB
[    0.000000] Reserved memory: initialized node dsp2_cma@9f000000, compatible id shared-dma-pool
[    0.000000] cma: Reserved 24 MiB at 0x00000000fe400000
[    0.000000] Memory: 1713468K/1897472K available (6535K kernel code, 358K rwdata, 2464K rodata, 332K init, 289K bss, 28356K reserved, 155648K  cma-reserved, 1283072K highmem)
[    5.492945] omap-rproc 58820000.ipu: assigned reserved memory node ipu1_cma@9d000000
[    5.603289] omap-rproc 55020000.ipu: assigned reserved memory node ipu2_cma@95800000
[    5.713411] omap-rproc 40800000.dsp: assigned reserved memory node dsp1_cma@9b000000
[    5.771990] omap-rproc 41000000.dsp: assigned reserved memory node dsp2_cma@9f000000
</pre></div>
</div>
<p>From the output above, we can derive the location and size of each CMA
carveout:</p>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="44%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Memory Section</th>
<th class="head">Physical Address</th>
<th class="head">Size</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>IPU2 CMA</td>
<td>0x95800000</td>
<td>56 MB</td>
</tr>
<tr class="row-odd"><td>DSP1 CMA</td>
<td>0x99000000</td>
<td>64 MB</td>
</tr>
<tr class="row-even"><td>IPU1 CMA</td>
<td>0x9d000000</td>
<td>32 MB</td>
</tr>
<tr class="row-odd"><td>DSP2 CMA</td>
<td>0x9f000000</td>
<td>8 MB</td>
</tr>
<tr class="row-even"><td>Default CMA</td>
<td>0xfe400000</td>
<td>24 MB</td>
</tr>
</tbody>
</table>
<p>For details on how to adjust the sizes and locations of the DSP/IPU CMA
carveouts, please see the corresponding section for changing the DSP or
IPU memory map.</p>
<p>To adjust the size of the &#8220;Default CMA&#8221; section, this is done as part of
the Linux config:</p>
<p>linux/arch/arm/configs/tisdk_am57xx-evm_defconfig</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#</span>
<span class="cp"># Default contiguous memory area size:</span>
<span class="cp">#</span>
<span class="n">CONFIG_CMA_SIZE_MBYTES</span><span class="o">=</span><span class="mi">24</span>
<span class="n">CONFIG_CMA_SIZE_SEL_MBYTES</span><span class="o">=</span><span class="n">y</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="cmem">CMEM</p>
<p>To view the allocation at run-time:</p>
<div class="highlight-cpp"><div class="highlight"><pre>root@am57xx-evm:~# cat /proc/cmem

Block 0: Pool 0: 1 bufs size 0xc000000 (0xc000000 requested)

Pool 0 busy bufs:

Pool 0 free bufs:
id 0: phys addr 0xa0000000
</pre></div>
</div>
<p>This shows that we have defined a CMEM block at physical base address of
0xA0000000 with total size 0xc000000 (192 MB). This block contains a
buffer pool consisting of 1 buffer. Each buffer in the pool (only one in
this case) is defined to have a size of 0xc000000 (192 MB).</p>
<p>Here is where those sizes/addresses were defined for the AM57xx EVM:</p>
<p>linux/arch/arm/boot/dts/am57xx-evm-cmem.dtsi</p>
<div class="highlight-cpp"><div class="highlight"><pre>{
       reserved-memory {
               #address-cells = &lt;2&gt;;
               #size-cells = &lt;2&gt;;
               ranges;

               cmem_block_mem_0: cmem_block_mem@a0000000 {
                       reg = &lt;0x0 0xa0000000 0x0 0x0c000000&gt;;
                       no-map;
                       status = &quot;okay&quot;;
               };

               cmem_block_mem_1_ocmc3: cmem_block_mem@40500000 {
                       reg = &lt;0x0 0x40500000 0x0 0x100000&gt;;
                       no-map;
                       status = &quot;okay&quot;;
               };
       };

       cmem {
               compatible = &quot;ti,cmem&quot;;
               #address-cells = &lt;1&gt;;
               #size-cells = &lt;0&gt;;

               #pool-size-cells = &lt;2&gt;;

               status = &quot;okay&quot;;

               cmem_block_0: cmem_block@0 {
                       reg = &lt;0&gt;;
                       memory-region = &lt;&amp;cmem_block_mem_0&gt;;
                       cmem-buf-pools = &lt;1 0x0 0x0c000000&gt;;
               };

               cmem_block_1: cmem_block@1 {
                       reg = &lt;1&gt;;
                       memory-region = &lt;&amp;cmem_block_mem_1_ocmc3&gt;;
               };
       };
};
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="changing-the-dsp-memory-map">Changing the DSP Memory Map</p>
<p>First, it is important to understand that there are a pair of Memory
Management Units (MMUs) that sit between the DSP subsystems and the L3
interconnect. One of these MMUs is for the DSP core and the other is for
its local EDMA. They both serve the same purpose of translating virtual
addresses (i.e. the addresses as viewed by the DSP subsystem) into
physical addresses (i.e. addresses as viewed from the L3 interconnect).</p>
<img alt="../_images/LinuxIpcDspMmu.png" src="../_images/LinuxIpcDspMmu.png" />
<p class="rubric" id="dsp-physical-addresses">DSP Physical Addresses</p>
<p>The physical location where the DSP code/data will actually reside is
defined by the CMA carveout. To change this location, you must change
the definition of the carveout. <strong>The DSP carveouts are defined in the
Linux dts file.</strong> For example for the AM57xx EVM:</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>linux/arch/arm/boot/dts/am57xx-beagle-x15-common.dtsi</p>
<div class="highlight-cpp"><div class="highlight"><pre>{
        dsp1_cma_pool: dsp1_cma@99000000 {
                compatible = &quot;shared-dma-pool&quot;;
                reg = &lt;0x0 0x99000000 0x0 0x4000000&gt;;
                reusable;
                status = &quot;okay&quot;;
        };

        dsp2_cma_pool: dsp2_cma@9f000000 {
                compatible = &quot;shared-dma-pool&quot;;
                reg = &lt;0x0 0x9f000000 0x0 0x800000&gt;;
                reusable;
                status = &quot;okay&quot;;
        };
};
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>You are able to change both the size and location. <strong>Be careful not to
overlap any other carveouts!</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>two</strong> location entries for a given DSP must be
identical!</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Additionally, when you change the carveout location, there is a
corresponding change that must be made to the resource table. For
starters, if you&#8217;re making a memory change you will need a <strong>custom</strong>
resource table. The resource table is a large structure that is the
&#8220;bridge&#8221; between physical memory and virtual memory. This structure is
utilized for configuring the MMUs that sit in front of the DSP
subsystem. There is detailed information available in the article <a class="reference external" href="/index.php/IPC_Resource_customTable">IPC
Resource customTable</a>.</p>
<p>Once you&#8217;ve created your custom resource table, you must update the
address of PHYS_MEM_IPC_VRING to be the same base address as your
corresponding CMA.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#if defined (VAYU_DSP_1)</span>
<span class="cp">#define PHYS_MEM_IPC_VRING      0x99000000</span>
<span class="cp">#elif defined (VAYU_DSP_2)</span>
<span class="cp">#define PHYS_MEM_IPC_VRING      0x9F000000</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The PHYS_MEM_IPC_VRING definition from the resource
table must match the address of the associated CMA carveout!</p>
</div>
<p class="rubric" id="dsp-virtual-addresses">DSP Virtual Addresses</p>
<p>These addresses are the ones seen by the DSP subsystem, i.e. these will
be the addresses in your linker command files, etc.</p>
<p>You must ensure that the sizes of your sections are consistent with the
corresponding definitions in the resource table. You should create your
own resource table in order to modify the memory map. This is describe
in the wiki page <a class="reference external" href="/index.php/IPC_Resource_customTable">IPC Resource
customTable</a>. You can look at an
existing resource table inside IPC:</p>
<p>ipc/packages/ti/ipc/remoteproc/rsc_table_vayu_dsp.h</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">DSP_MEM_TEXT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">DSP_MEM_TEXT_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_MEM_TEXT&quot;</span><span class="p">,</span>
<span class="p">},</span>

<span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">DSP_MEM_DATA</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">DSP_MEM_DATA_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_MEM_DATA&quot;</span><span class="p">,</span>
<span class="p">},</span>

<span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">DSP_MEM_HEAP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">DSP_MEM_HEAP_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_MEM_HEAP&quot;</span><span class="p">,</span>
<span class="p">},</span>

<span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">DSP_MEM_IPC_DATA</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">DSP_MEM_IPC_DATA_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_MEM_IPC_DATA&quot;</span><span class="p">,</span>
<span class="p">},</span>

<span class="p">{</span>
    <span class="n">TYPE_TRACE</span><span class="p">,</span> <span class="n">TRACEBUFADDR</span><span class="p">,</span> <span class="mh">0x8000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;trace:dsp&quot;</span><span class="p">,</span>
<span class="p">},</span>


<span class="p">{</span>
    <span class="n">TYPE_DEVMEM</span><span class="p">,</span>
    <span class="n">DSP_MEM_IPC_VRING</span><span class="p">,</span> <span class="n">PHYS_MEM_IPC_VRING</span><span class="p">,</span>
    <span class="n">DSP_MEM_IPC_VRING_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_MEM_IPC_VRING&quot;</span><span class="p">,</span>
<span class="p">},</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Let&#8217;s have a look at some of these to understand them better. For
example:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">DSP_MEM_TEXT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">DSP_MEM_TEXT_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_MEM_TEXT&quot;</span><span class="p">,</span>
<span class="p">},</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Key points to note are:</p>
<ol class="arabic simple">
<li>The &#8220;TYPE_CARVEOUT&#8221; indicates that the physical memory backing this
entry will come from the associated CMA pool.</li>
<li>DSP_MEM_TEXT is a #define earlier in the code providing the address
for the code section. It is 0x95000000 by default. <strong>This must
correspond to a section from your DSP linker command file, i.e.
EXT_CODE (or whatever name you choose to give it) must be linked to
the same address.</strong></li>
<li>DSP_MEM_TEXT_SIZE is the size of the MMU pagetable entry being
created (1MB in this particular instance). <strong>The actual amount of
linked code in the corresponding section of your executable must be
less than or equal to this size.</strong></li>
</ol>
<p>Let&#8217;s take another:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">{</span>
    <span class="n">TYPE_TRACE</span><span class="p">,</span> <span class="n">TRACEBUFADDR</span><span class="p">,</span> <span class="mh">0x8000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;trace:dsp&quot;</span><span class="p">,</span>
<span class="p">},</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Key points are:</p>
<ol class="arabic simple">
<li>The &#8220;TYPE_TRACE&#8221; indicates this is for trace info.</li>
<li>The TRACEBUFADDR is defined earlier in the file as
&amp;ti_trace_SysMin_Module_State_0_outbuf__A. That corresponds to the
symbol used in TI-RTOS for the trace buffer.</li>
<li>The &#8220;0x8000&#8221; is the size of the MMU mapping. The corresponding size
in the cfg file should be the same (or less). It looks like this:
<tt class="docutils literal"><span class="pre">SysMin.bufSize</span>&nbsp; <span class="pre">=</span> <span class="pre">0x8000;</span></tt></li>
</ol>
<p>Finally, let&#8217;s look at a TYPE_DEVMEM example:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">{</span>
    <span class="n">TYPE_DEVMEM</span><span class="p">,</span>
    <span class="n">DSP_PERIPHERAL_L4CFG</span><span class="p">,</span> <span class="n">L4_PERIPHERAL_L4CFG</span><span class="p">,</span>
    <span class="n">SZ_16M</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_PERIPHERAL_L4CFG&quot;</span><span class="p">,</span>
<span class="p">},</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Key points:</p>
<ol class="arabic simple">
<li>The &#8220;TYPE_DEVMEM&#8221; indicates that we are making an MMU mapping, but
this <em>does not come from the CMA pool</em>. This is intended for mapping
peripherals, etc. that already exist in the device memory map.</li>
<li>DSP_PERIPHERAL_L4CFG (0x4A000000) is the virtual address while
L4_PERIPHERAL_L4CFG (0x4A000000) is the physical address. <strong>This is
an identity mapping, meaning that peripherals can be referenced by
the DSP using their physical address.</strong></li>
</ol>
<p class="rubric" id="dsp-access-to-peripherals">DSP Access to Peripherals</p>
<p>The default resource table creates the following mappings:</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="30%" />
<col width="11%" />
<col width="31%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Virtual Address</th>
<th class="head">Physical Address</th>
<th class="head">Size</th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x4A000000</td>
<td>0x4A000000</td>
<td>16 MB</td>
<td>L4CFG + L4WKUP</td>
</tr>
<tr class="row-odd"><td>0x48000000</td>
<td>0x48000000</td>
<td>2 MB</td>
<td>L4PER1</td>
</tr>
<tr class="row-even"><td>0x48400000</td>
<td>0x48400000</td>
<td>4 MB</td>
<td>L4PER2</td>
</tr>
<tr class="row-odd"><td>0x48800000</td>
<td>0x48800000</td>
<td>8 MB</td>
<td>L4PER3</td>
</tr>
<tr class="row-even"><td>0x54000000</td>
<td>0x54000000</td>
<td>16 MB</td>
<td>L3_INSTR + CT_TBR</td>
</tr>
<tr class="row-odd"><td>0x4E000000</td>
<td>0x4E000000</td>
<td>1 MB</td>
<td>DMM config</td>
</tr>
</tbody>
</table>
<p>In other words, the peripherals can be accessed at their physical
addresses since we use an identity mapping.</p>
<p class="rubric" id="inspecting-the-dsp-iommu-page-tables-at-run-time">Inspecting the DSP IOMMU Page Tables at Run-Time</p>
<p>You can dump the DSP IOMMU page tables with the following commands:</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="9%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">DSP</th>
<th class="head">MMU</th>
<th class="head">Command</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>DSP1</td>
<td>MMU0</td>
<td>cat /sys/kernel/debug/omap_iommu/40d01000.mmu/pagetable</td>
</tr>
<tr class="row-odd"><td>DSP1</td>
<td>MMU1</td>
<td>cat /sys/kernel/debug/omap_iommu/40d02000.mmu/pagetable</td>
</tr>
<tr class="row-even"><td>DSP2</td>
<td>MMU0</td>
<td>cat /sys/kernel/debug/omap_iommu/41501000.mmu/pagetable</td>
</tr>
<tr class="row-odd"><td>DSP2</td>
<td>MMU1</td>
<td>cat /sys/kernel/debug/omap_iommu/41502000.mmu/pagetable</td>
</tr>
</tbody>
</table>
<p>In general, MMU0 and MMU1 are being programmed identically so you really
only need to take a look at one or the other to understand the mapping
for a given DSP.</p>
<p>For example:</p>
<div class="highlight-cpp"><div class="highlight"><pre>root@am57xx-evm:~# cat /sys/kernel/debug/omap_iommu/40d01000.mmu/pagetable
L:      da:     pte:
--------------------------
1: 0x48000000 0x48000002
1: 0x48100000 0x48100002
1: 0x48400000 0x48400002
1: 0x48500000 0x48500002
1: 0x48600000 0x48600002
1: 0x48700000 0x48700002
1: 0x48800000 0x48800002
1: 0x48900000 0x48900002
1: 0x48a00000 0x48a00002
1: 0x48b00000 0x48b00002
1: 0x48c00000 0x48c00002
1: 0x48d00000 0x48d00002
1: 0x48e00000 0x48e00002
1: 0x48f00000 0x48f00002
1: 0x4a000000 0x4a040002
1: 0x4a100000 0x4a040002
1: 0x4a200000 0x4a040002
1: 0x4a300000 0x4a040002
1: 0x4a400000 0x4a040002
1: 0x4a500000 0x4a040002
1: 0x4a600000 0x4a040002
1: 0x4a700000 0x4a040002
1: 0x4a800000 0x4a040002
1: 0x4a900000 0x4a040002
1: 0x4aa00000 0x4a040002
1: 0x4ab00000 0x4a040002
1: 0x4ac00000 0x4a040002
1: 0x4ad00000 0x4a040002
1: 0x4ae00000 0x4a040002
1: 0x4af00000 0x4a040002
</pre></div>
</div>
<p>The first column tells us whether the mapping is a Level 1 or Level 2
descriptor. All the lines above are a first level descriptor, so we look
at the associated format from the TRM:</p>
<img alt="../_images/LinuxIpcPageTableDescriptor1.png" src="../_images/LinuxIpcPageTableDescriptor1.png" />
<p>The &#8220;da&#8221; (&#8220;device address&#8221;) column reflects the virtual address. It is
<em>derived</em> from the index into the table, i.e. there does not exist a
&#8220;da&#8221; register or field in the page table. Each MB of the address space
maps to an entry in the table. The &#8220;da&#8221; column is displayed to make it
easy to find the virtual address of interest.</p>
<p>The &#8220;pte&#8221; (&#8220;page table entry&#8221;) column can be decoded according to Table
20-4 shown above. For example:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="mi">1</span><span class="o">:</span> <span class="mh">0x4a000000</span> <span class="mh">0x4a040002</span>
</pre></div>
</div>
<p>The 0x4a040002 shows us that it is a Supersection with base address
0x4A000000. This gives us a 16 MB memory page. Note the repeated entries
afterward. That&#8217;s a requirement of the MMU. Here&#8217;s an excerpt from the
TRM:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Supersection descriptors must be repeated 16 times,
because each descriptor in the first level translation table describes 1
MiB of memory. If an access points to a descriptor that is not
initialized, the MMU will behave in an unpredictable way.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="changing-cortex-m4-ipu-memory-map">Changing Cortex M4 IPU Memory Map</p>
<p>In order to fully understand the memory mapping of the Cortex M4 IPU
Subsystems, it&#8217;s helpful to recognize that there are two
distinct/independent levels of memory translation. Here&#8217;s a snippet from
the TRM to illustrate:</p>
<img alt="../_images/LinuxIpcIpuMmu.png" src="../_images/LinuxIpcIpuMmu.png" />
<p class="rubric" id="cortex-m4-ipu-physical-addresses">Cortex M4 IPU Physical Addresses</p>
<p>The physical location where the M4 code/data will actually reside is
defined by the CMA carveout. To change this location, you must change
the definition of the carveout. <strong>The M4 carveouts are defined in the
Linux dts file.</strong> For example for the AM57xx EVM:</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p>linux/arch/arm/boot/dts/am57xx-beagle-x15-common.dtsi</p>
<div class="highlight-cpp"><div class="highlight"><pre>{
        ipu2_cma_pool: ipu2_cma@95800000 {
                compatible = &quot;shared-dma-pool&quot;;
                reg = &lt;0x0 95800000 0x0 0x3800000&gt;;
                reusable;
                status = &quot;okay&quot;;
        };

        ipu1_cma_pool: ipu1_cma@9d000000 {
                compatible = &quot;shared-dma-pool&quot;;
                reg = &lt;0x0 9d000000 0x0 0x2000000&gt;;
                reusable;
                status = &quot;okay&quot;;
        };
};
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>You are able to change both the size and location. <strong>Be careful not to
overlap any other carveouts!</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>two</strong> location entries for a given carveout
must be identical!</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Additionally, when you change the carveout location, there is a
corresponding change that must be made to the resource table. For
starters, if you&#8217;re making a memory change you will need a <strong>custom</strong>
resource table. The resource table is a large structure that is the
&#8220;bridge&#8221; between physical memory and virtual memory. This structure is
utilized for configuring the IPUx_MMU (not the Unicache MMU). There is
detailed information available in the article <a class="reference external" href="/index.php/IPC_Resource_customTable">IPC Resource
customTable</a>.</p>
<p>Once you&#8217;ve created your custom resource table, you must update the
address of PHYS_MEM_IPC_VRING to be the same base address as your
corresponding CMA.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#if defined(VAYU_IPU_1)</span>
<span class="cp">#define PHYS_MEM_IPC_VRING      0x9D000000</span>
<span class="cp">#elif defined (VAYU_IPU_2)</span>
<span class="cp">#define PHYS_MEM_IPC_VRING      0x95800000</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The PHYS_MEM_IPC_VRING definition from the resource
table must match the address of the associated CMA carveout!</p>
</div>
<p class="rubric" id="cortex-m4-ipu-virtual-addresses">Cortex M4 IPU Virtual Addresses</p>
<p class="rubric" id="unicache-mmu">Unicache MMU</p>
<p>The Unicache MMU sits closest to the Cortex M4. It provides the first
level of address translation. The Unicache MMU is actually &#8220;self
programmed&#8221; by the Cortex M4. The Unicache MMU is also referred to as
the Attribute MMU (AMMU). There are a fixed number of small, medium and
large pages. Here&#8217;s a snippet showing some of the key mappings:</p>
<p>ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/ipu1/IpuAmmu.cfg</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/*********************** Large Pages *************************/</span>
<span class="cm">/* Instruction Code: Large page  (512M); cacheable */</span>
<span class="cm">/* config large page[0] to map 512MB VA 0x0 to L3 0x0 */</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pageEnabled</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Enable_YES</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">logicalAddress</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">translationEnabled</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Enable_NO</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">size</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Large_512M</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">L1_cacheable</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">CachePolicy_CACHEABLE</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">L1_posted</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">PostedPolicy_POSTED</span><span class="p">;</span>

<span class="cm">/* Peripheral regions: Large Page (512M); non-cacheable */</span>
<span class="cm">/* config large page[1] to map 512MB VA 0x60000000 to L3 0x60000000 */</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">pageEnabled</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Enable_YES</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">logicalAddress</span> <span class="o">=</span> <span class="mh">0x60000000</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">translationEnabled</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Enable_NO</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">size</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Large_512M</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">L1_cacheable</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">CachePolicy_NON_CACHEABLE</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">L1_posted</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">PostedPolicy_POSTED</span><span class="p">;</span>

<span class="cm">/* Private, Shared and IPC Data regions: Large page (512M); cacheable */</span>
<span class="cm">/* config large page[2] to map 512MB VA 0x80000000 to L3 0x80000000 */</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">pageEnabled</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Enable_YES</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">logicalAddress</span> <span class="o">=</span> <span class="mh">0x80000000</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">translationEnabled</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Enable_NO</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">size</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Large_512M</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">L1_cacheable</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">CachePolicy_CACHEABLE</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">L1_posted</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">PostedPolicy_POSTED</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<hr class="docutils" />
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="28%" />
<col width="28%" />
<col width="10%" />
<col width="16%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Page</th>
<th class="head">Cortex M4 Address</th>
<th class="head">Intermediate Address</th>
<th class="head">Size</th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Large Page 0</td>
<td>0x00000000-0x1fffffff</td>
<td>0x00000000-0x1fffffff</td>
<td>512 MB</td>
<td>Code</td>
</tr>
<tr class="row-odd"><td>Large Page 1</td>
<td>0x60000000-0x7fffffff</td>
<td>0x60000000-0x7fffffff</td>
<td>512 MB</td>
<td>Peripherals</td>
</tr>
<tr class="row-even"><td>Large Page 2</td>
<td>0x80000000-0x9fffffff</td>
<td>0x80000000-0x9fffffff</td>
<td>512 MB</td>
<td>Data</td>
</tr>
</tbody>
</table>
<p>These 3 pages are &#8220;identity&#8221; mappings, performing a passthrough of
requests to the associated address ranges. These intermediate addresses
get mapped to their physical addresses in the next level of translation
(IOMMU).</p>
<p>The AMMU ranges for code and data <em>need</em> to be identity mappings because
otherwise the remoteproc loader wouldn&#8217;t be able to match up the
sections from the ELF file with the associated IOMMU mapping. These
mappings should suffice for any application, i.e. no need to adjust
these. The more likely area for modification is the resource table in
the next section. The AMMU mappings are needed mainly to understand the
full picture with respect to the Cortex M4 memory map.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="iommu">IOMMU</p>
<p>The IOMMU sits closest to the L3 interconnect. It takes the intermediate
address output from the AMMU and translates it to the physical address
used by the L3 interconnect. The IOMMU is programmed by the ARM based on
the associated resource table. If you&#8217;re planning any memory changes
then you&#8217;ll want to make a custom resource table as described in the
wiki page <a class="reference external" href="/index.php/IPC_Resource_customTable">IPC Resource
customTable</a>.</p>
<p>The default resource table (which can be adapted to make a custom table)
can be found at this location:</p>
<p>ipc/packages/ti/ipc/remoteproc/rsc_table_vayu_ipu.h</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#define IPU_MEM_TEXT            0x0</span>
<span class="cp">#define IPU_MEM_DATA            0x80000000</span>

<span class="cp">#define IPU_MEM_IOBUFS          0x90000000</span>

<span class="cp">#define IPU_MEM_IPC_DATA        0x9F000000</span>
<span class="cp">#define IPU_MEM_IPC_VRING       0x60000000</span>
<span class="cp">#define IPU_MEM_RPMSG_VRING0    0x60000000</span>
<span class="cp">#define IPU_MEM_RPMSG_VRING1    0x60004000</span>
<span class="cp">#define IPU_MEM_VRING_BUFS0     0x60040000</span>
<span class="cp">#define IPU_MEM_VRING_BUFS1     0x60080000</span>

<span class="cp">#define IPU_MEM_IPC_VRING_SIZE  SZ_1M</span>
<span class="cp">#define IPU_MEM_IPC_DATA_SIZE   SZ_1M</span>

<span class="cp">#if defined(VAYU_IPU_1)</span>
<span class="cp">#define IPU_MEM_TEXT_SIZE       (SZ_1M)</span>
<span class="cp">#elif defined(VAYU_IPU_2)</span>
<span class="cp">#define IPU_MEM_TEXT_SIZE       (SZ_1M * 6)</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(VAYU_IPU_1)</span>
<span class="cp">#define IPU_MEM_DATA_SIZE       (SZ_1M * 5)</span>
<span class="cp">#elif defined(VAYU_IPU_2)</span>
<span class="cp">#define IPU_MEM_DATA_SIZE       (SZ_1M * 48)</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>&lt;snip...&gt;</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">IPU_MEM_TEXT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">IPU_MEM_TEXT_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;IPU_MEM_TEXT&quot;</span><span class="p">,</span>
<span class="p">},</span>

<span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">IPU_MEM_DATA</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">IPU_MEM_DATA_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;IPU_MEM_DATA&quot;</span><span class="p">,</span>
<span class="p">},</span>

<span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">IPU_MEM_IPC_DATA</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">IPU_MEM_IPC_DATA_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;IPU_MEM_IPC_DATA&quot;</span><span class="p">,</span>
<span class="p">},</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The 3 entries above from the resource table all come from the associated
IPU CMA pool (i.e. as dictated by the TYPE_CARVEOUT). The second
parameter represents the virtual address (i.e. input address to the
IOMMU). <strong>These addresses must be consistent with both the AMMU mapping
as well as the linker command file.</strong> The ex02_messageq example from ipc
defines these memory sections in the file
examples/DRA7XX_linux_elf/ex02_messageq/shared/config.bld.</p>
<p>You can dump the IPU IOMMU page tables with the following commands:</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">IPU</th>
<th class="head">Command</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>IPU1</td>
<td>cat /sys/kernel/debug/omap_iommu/58882000.mmu/pagetable</td>
</tr>
<tr class="row-odd"><td>IPU2</td>
<td>cat /sys/kernel/debug/omap_iommu/55082000.mmu/pagetable</td>
</tr>
</tbody>
</table>
<p>Please see the <a class="reference external" href="/index.php/Linux_IPC_on_AM57xx#Inspecting_the_DSP_IOMMU_Page_Tables_at_Run-Time">corresponding DSP
documentation</a>
for more details on interpreting the output.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="cortex-m4-ipu-access-to-peripherals">Cortex M4 IPU Access to Peripherals</p>
<p>The default resource table creates the following mappings:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Virtual
Address
used by
Cortex M4</th>
<th class="head">Address at
output of
Unicache
MMU</th>
<th class="head">Address at
output of
IOMMU</th>
<th class="head">Size</th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x6A000000</td>
<td>0x6A000000</td>
<td>0x4A000000</td>
<td>16 MB</td>
<td>L4CFG +
L4WKUP</td>
</tr>
<tr class="row-odd"><td>0x68000000</td>
<td>0x68000000</td>
<td>0x48000000</td>
<td>2 MB</td>
<td>L4PER1</td>
</tr>
<tr class="row-even"><td>0x68400000</td>
<td>0x68400000</td>
<td>0x48400000</td>
<td>4 MB</td>
<td>L4PER2</td>
</tr>
<tr class="row-odd"><td>0x68800000</td>
<td>0x68800000</td>
<td>0x48800000</td>
<td>8 MB</td>
<td>L4PER3</td>
</tr>
<tr class="row-even"><td>0x74000000</td>
<td>0x74000000</td>
<td>0x54000000</td>
<td>16 MB</td>
<td>L3_INSTR +
CT_TBR</td>
</tr>
</tbody>
</table>
<p>Example: Accessing UART5 from IPU</p>
<ol class="arabic simple">
<li>For this example, it&#8217;s assumed the pin-muxing was already setup in
the bootloader. If that&#8217;s not the case, you would need to do that
here.</li>
<li>The UART5 module needs to be enabled via the CM_L4PER_UART5_CLKCTRL
register. This is located at physical address 0x4A009870. So from the
M4 we would program this register at virtual address 0x6A009870.
Writing a value of 2 to this register will enable the peripheral.</li>
<li>After completing the previous step, the UART5 registers will become
accessible. Normally UART5 is accessible at physical base address
0x48066000. This would correspondingly be accessed from the IPU at
0x68066000.</li>
</ol>
</div>
<div class="section" id="power-management">
<h4>10.2.4.1.4. Power Management<a class="headerlink" href="#power-management" title="Permalink to this headline">¶</a></h4>
<p>The IPUs and DSPs auto-idle by default. This can prevent you from being
able to connect to the device using JTAG or from accessing local memory
via devmem2. There are some options sprinkled throughout sysfs that are
needed in order to force these subsystems on, as is sometimes needed for
development and debug purposes.</p>
<p>There are some hard-coded device names that originate in the device tree
(dra7.dtsi) that are needed for these operations:</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="46%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Remote Core</th>
<th class="head">Definition in dra7.dtsi</th>
<th class="head">System FS Name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>IPU1</td>
<td><a class="reference external" href="mailto:ipu&#37;&#52;&#48;58820000">ipu<span>&#64;</span>58820000</a></td>
<td>58820000.ipu</td>
</tr>
<tr class="row-odd"><td>IPU2</td>
<td><a class="reference external" href="mailto:ipu&#37;&#52;&#48;55020000">ipu<span>&#64;</span>55020000</a></td>
<td>55020000.ipu</td>
</tr>
<tr class="row-even"><td>DSP1</td>
<td><a class="reference external" href="mailto:dsp&#37;&#52;&#48;40800000">dsp<span>&#64;</span>40800000</a></td>
<td>40800000.dsp</td>
</tr>
<tr class="row-odd"><td>DSP2</td>
<td><a class="reference external" href="mailto:dsp&#37;&#52;&#48;41000000">dsp<span>&#64;</span>41000000</a></td>
<td>41000000.dsp</td>
</tr>
<tr class="row-even"><td>ICSS1-PRU0</td>
<td><a class="reference external" href="mailto:pru&#37;&#52;&#48;4b234000">pru<span>&#64;</span>4b234000</a></td>
<td>4b234000.pru0</td>
</tr>
<tr class="row-odd"><td>ICSS1-PRU1</td>
<td><a class="reference external" href="mailto:pru&#37;&#52;&#48;4b238000">pru<span>&#64;</span>4b238000</a></td>
<td>4b238000.pru1</td>
</tr>
<tr class="row-even"><td>ICSS2-PRU0</td>
<td><a class="reference external" href="mailto:pru&#37;&#52;&#48;4b2b4000">pru<span>&#64;</span>4b2b4000</a></td>
<td>4b2b4000.pru0</td>
</tr>
<tr class="row-odd"><td>ICSS2-PRU1</td>
<td><a class="reference external" href="mailto:pru&#37;&#52;&#48;4b2b8000">pru<span>&#64;</span>4b2b8000</a></td>
<td>4b2b8000.pru1</td>
</tr>
</tbody>
</table>
<p>To map these System FS names to the associated remoteproc entry, you can
run the following commands:</p>
<div class="highlight-cpp"><div class="highlight"><pre>root@am57xx-evm:~# ls -l /sys/kernel/debug/remoteproc/
root@am57xx-evm:~# cat /sys/kernel/debug/remoteproc/remoteproc*/name
</pre></div>
</div>
<p>The results of the commands will be a one-to-one mapping. For example,
58820000.ipu corresponds with remoteproc0.</p>
<p>Similarly, to see the power state of each of the cores:</p>
<div class="highlight-cpp"><div class="highlight"><pre>root@am57xx-evm:~# cat /sys/class/remoteproc/remoteproc*/state
</pre></div>
</div>
<p>The state can be suspended, running, offline, etc. You can only attach
JTAG if the state is &#8220;running&#8221;. If it shows as &#8220;suspended&#8221; then you must
force it to run. For example, let&#8217;s say DSP0 is &#8220;suspended&#8221;. You can run
the following command to force it on:</p>
<div class="highlight-cpp"><div class="highlight"><pre>root@am57xx-evm:~# echo on &gt; /sys/bus/platform/devices/40800000.dsp/power/control
</pre></div>
</div>
<p>The same is true for any of the cores, but replace 40800000.dsp with the
associated System FS name from the chart above.</p>
</div>
<div class="section" id="adding-ipc-to-an-existing-ti-rtos-application-on-slave-cores">
<h4>10.2.4.1.5. Adding IPC to an Existing TI-RTOS Application on slave cores<a class="headerlink" href="#adding-ipc-to-an-existing-ti-rtos-application-on-slave-cores" title="Permalink to this headline">¶</a></h4>
<p class="rubric" id="adding-ipc-to-an-existing-ti-rtos-application-on-the-dsp">Adding IPC to an existing TI RTOS application on the DSP</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>A common thing people want to do is take an existing DSP application
and add IPC to it. This is common when migrating from a DSP only
solution to a heterogeneous SoC with an Arm plus a DSP. This is the
focus of this section.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In order to describe this process, we need an example test case to
work with. For this purpose, we&#8217;ll be using the
GPIO_LedBlink_evmAM572x_c66xExampleProject example that&#8217;s part of the
PDK (installed as part of the Processor SDK RTOS). You can find it at
c:/ti/pdk_am57xx_1_0_4/packages/MyExampleProjects/GPIO_LedBlink_evmAM572x_c66xExampleProject.
This example uses SYS/BIOS and blinks the USER0 LED on the AM572x GP
EVM, it&#8217;s labeled D4 on the EVM silkscreen just to the right of the
blue reset button.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>There were several steps taken to make this whole process work, each of
which will be described in following sections</p>
<ol class="arabic simple">
<li>Build and run the out-of-box LED blink example on the EVM using Code
Composer Studio (CCS)</li>
<li>Take the ex02_message example from the IPC software bundle and turn
it into a CCS project. Build it and modify the Linux startup code to
use this new image. This is just a sanity check step to make sure we
can build the IPC examples in CCS and have them run at boot up on the
EVM.</li>
<li>In CCS, make a clone of the out-of-box LED example and rename it to
denote it&#8217;s the IPC version of the example. Then using the
ex02_messageq example as a reference, add in the IPC pieces to the
LED example. Build from CCS then add it to the Linux firmware folder.</li>
</ol>
<p class="rubric" id="running-led-blink-pdk-example-from-ccs">Running LED Blink PDK Example from CCS</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>TODO - Fill this section in with instructions on how to run the LED
blink example using JTAG and CCS after the board has booted Linux.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some edits were made to the LED blink example to allow it to run</p>
</div>
<p>in a Linux environment, specifically, removed the GPIO interrupts and
then added a Clock object to call the LED GPIO toggle function on a
periodic bases.</p>
<p class="rubric" id="make-ccs-project-out-of-ex02-messageq-ipc-example">Make CCS project out of ex02_messageq IPC example</p>
<p>TODO - fill this section in with instructions on how to make a CCS
project out of the IPC example source files.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="add-ipc-to-the-led-blink-example">Add IPC to the LED Blink Example</p>
<p>The first step is to clone our out-of-box LED blink CCS project and
rename it to denote it&#8217;s using IPC. The easiest way to do this is using
CCS. Here are the steps...</p>
<ul class="simple">
<li>In the <em>Edit</em> perspective, go into your <em>Project Explorer</em> window and
right click on your GPIO_LedBlink_evmAM572x+c66xExampleProject
project and select <em>copy</em> from the pop-up menu. Maske sure the
project is not is a closed state.</li>
<li>Rick click in and empty area of the project explorer window and
select past.</li>
<li>A dialog box pops up, modify the name to denote it&#8217;s using IPC. A
good name is GPIO_LedBlink_evmAM572x+c66xExampleProjec_with_ipc.</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>This is the project we&#8217;ll be working with from here on. The next thing
we want to do is select the proper RTSC platform and other components.
To do this, follow these steps.</p>
<ul class="simple">
<li>Right click on the GPIO_LedBlink_evmAM572x+c66xExampleProjec_with_ipc
project and select <em>Properties</em></li>
<li>In the left hand pane, click on <em>CCS General</em>.</li>
<li>On the right hand side, click on the <em>RTSC</em> tab</li>
<li>For <em>XDCtools version:</em> select 3.32.0.06_core</li>
<li>In the list of <em>Products and Repositories</em>, <em>check</em> the following...<ul>
<li>IPC 3.43.2.04</li>
<li>SYS/BIOS 6.45.1.29</li>
<li>am57xx PDK 1.0.4</li>
</ul>
</li>
<li>For <em>Target</em>, select ti.targets.elf.C66</li>
<li>For <em>Platform</em>, select ti.platforms.evmDRA7XX</li>
<li>Once the platform is selected, edit its name buy hand and
append&nbsp;:dsp1 to the end. After this it should be
ti.platforms.evmDRA7XX:dsp1</li>
<li>Go ahead and leave the <em>Build-profile</em> set to debug.</li>
<li>Hit the OK button.</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Now we want to copy configuration and source files from the
ex02_messageq IPC example into our project. The IPC example is located
at <em>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq</em>. To
copy files into your CCS project, you can simply select the files you
want in Windows explorer then drag and drop them into your project in
CCS.</p>
<p>Copy these files into your CCS project...</p>
<ul class="simple">
<li>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/shared/AppCommon.h</li>
<li>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/shared/config.bld</li>
<li>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/shared/ipc.cfg.xs</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Now copy these files into your CCS project...</p>
<ul class="simple">
<li>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/dsp1/Dsp1.cfg</li>
<li>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/dsp1/MainDsp1.c</li>
<li>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/dsp1/Server.c</li>
<li>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/dsp1/Server.h</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When you copy Dsp1.cfg into your CCS project, it
should show up greyed out. This is because the LED blink example
already has a cfg file (gpio_test_evmAM572x.cfg). The Dsp1.cfg will be
used for copying and pasting. When it&#8217;s all done, you can delete it
from your project.</p>
</div>
<p>Finally, you will likely want to use a custom resource table so copy
these files into your CCS project...</p>
<ul class="simple">
<li>C:/ti/ipc_3_43_02_04/packages/ti/ipc/remoteproc/rsc_table_vayu_dsp.h</li>
<li>C:/ti/ipc_3_43_02_04/packages/ti/ipc/remoteproc/rsc_types.h</li>
</ul>
<p>The rsc_table_vayu_dsp.h file defines an initialized structure so let&#8217;s
make a <em>.c</em> source file.</p>
<ul class="simple">
<li>In your CCS project, rename rsc_table_vayu_dsp.h to
rsc_table_vayu_dsp.c</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">Now we want to <em>merge</em> the IPC example configuration file with the LED
blink example configuration file. Follow these steps...</div>
</div>
<ul class="simple">
<li>Open up <em>Dsp1.cfg</em> using a text editor (don&#8217;t open it using the GUI).
Right click on it and select <em>Open With -&gt; XDCscript Editor</em></li>
<li>We want to copy the entire contents into the clipboard. Select all
and copy.</li>
<li>Now just like above, open the gpio_test_evmAM572x.cfg config file in
the text editor. Go to the very bottom and <em>paste</em> in the contents
from the Dsp1.cfg file. Basically we&#8217;ve appended the contents of
Dsp1.cfg into gpio_test_evmAM572x.cfg.</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>We&#8217;ve now added in all the necessary configuration and source files
into our project. Don&#8217;t expect it to build at this point, we have to
make edits first. These edits are listed below.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can download the full CCS project with source files to use as a reference.
See link towards the end of this section.</p>
</div>
<ul class="simple">
<li>Edit <strong>gpio_test_evmAM572x.cfg</strong></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add the following to the beginning of your configuration file</p>
<div class="highlight-cpp"><div class="highlight"><pre>var Program = xdc.useModule(&#39;xdc.cfg.Program&#39;);
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the Memory sections configuration as shown below</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* ================ Memory sections configuration ================ */</span>
<span class="c1">//Program.sectMap[&quot;.text&quot;] = &quot;EXT_RAM&quot;;</span>
<span class="c1">//Program.sectMap[&quot;.const&quot;] = &quot;EXT_RAM&quot;;</span>
<span class="c1">//Program.sectMap[&quot;.plt&quot;] = &quot;EXT_RAM&quot;;</span>
<span class="cm">/* Program.sectMap[&quot;BOARD_IO_DELAY_DATA&quot;] = &quot;OCMC_RAM1&quot;; */</span>
<span class="cm">/* Program.sectMap[&quot;BOARD_IO_DELAY_CODE&quot;] = &quot;OCMC_RAM1&quot;; */</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Since we are no longer using a shared folder, make the following change</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//var ipc_cfg = xdc.loadCapsule(&quot;../shared/ipc.cfg.xs&quot;);</span>
<span class="n">var</span> <span class="n">ipc_cfg</span> <span class="o">=</span> <span class="n">xdc</span><span class="p">.</span><span class="n">loadCapsule</span><span class="p">(</span><span class="s">&quot;../ipc.cfg.xs&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the following. We&#8217;ll be calling this function directly from
main.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//BIOS.addUserStartupFunction(&#39;&amp;IpcMgr_ipcStartup&#39;);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Increase the system stack size</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//Program.stack = 0x1000;</span>
<span class="n">Program</span><span class="p">.</span><span class="n">stack</span> <span class="o">=</span> <span class="mh">0x8000</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the entire TICK section</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* --------------------------- TICK --------------------------------------*/</span>
<span class="c1">// var Clock = xdc.useModule(&#39;ti.sysbios.knl.Clock&#39;);</span>
<span class="c1">// Clock.tickSource = Clock.TickSource_NULL;</span>
<span class="c1">// //Clock.tickSource = Clock.TickSource_USER;</span>
<span class="c1">// /* Configure BIOS clock source as GPTimer5 */</span>
<span class="c1">// //Clock.timerId = 0;</span>
<span class="c1">//</span>
<span class="c1">// var Timer = xdc.useModule(&#39;ti.sysbios.timers.dmtimer.Timer&#39;);</span>
<span class="c1">//</span>
<span class="c1">// /* Skip the Timer frequency verification check. Need to remove this later */</span>
<span class="c1">// Timer.checkFrequency = false;</span>
<span class="c1">//</span>
<span class="c1">// /* Match this to the SYS_CLK frequency sourcing the dmTimers.</span>
<span class="c1">//  * Not needed once the SYS/BIOS family settings is updated. */</span>
<span class="c1">// Timer.intFreq.hi = 0;</span>
<span class="c1">// Timer.intFreq.lo = 19200000;</span>
<span class="c1">//</span>
<span class="c1">// //var timerParams = new Timer.Params();</span>
<span class="c1">// //timerParams.period = Clock.tickPeriod;</span>
<span class="c1">// //timerParams.periodType = Timer.PeriodType_MICROSECS;</span>
<span class="c1">// /* Switch off Software Reset to make the below settings effective */</span>
<span class="c1">// //timerParams.tiocpCfg.softreset = 0x0;</span>
<span class="c1">// /* Smart-idle wake-up-capable mode */</span>
<span class="c1">// //timerParams.tiocpCfg.idlemode = 0x3;</span>
<span class="c1">// /* Wake-up generation for Overflow */</span>
<span class="c1">// //timerParams.twer.ovf_wup_ena = 0x1;</span>
<span class="c1">// //Timer.create(Clock.timerId, Clock.doTick, timerParams);</span>
<span class="c1">//</span>
<span class="c1">// var Idle = xdc.useModule(&#39;ti.sysbios.knl.Idle&#39;);</span>
<span class="c1">// var Deh = xdc.useModule(&#39;ti.deh.Deh&#39;);</span>
<span class="c1">//</span>
<span class="c1">// /* Must be placed before pwr mgmt */</span>
<span class="c1">// Idle.addFunc(&#39;&amp;ti_deh_Deh_idleBegin&#39;);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Make configuration change to use custom resource table. Add to the end
of the file.</p>
<div class="highlight-cpp"><div class="highlight"><pre>/* Override the default resource table with my own */
var Resource = xdc.useModule(&#39;ti.ipc.remoteproc.Resource&#39;);
Resource.customTable = true;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Edit <strong>main_led_blink.c</strong></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add the following external declarations</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">extern</span> <span class="n">Int</span> <span class="nf">ipc_main</span><span class="p">();</span>
<span class="k">extern</span> <span class="n">Void</span> <span class="nf">IpcMgr_ipcStartup</span><span class="p">(</span><span class="n">Void</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In main(), add a call to ipc_main() and IpcMgr_ipcStartup() just before
BIOS_start()</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">ipc_main</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="n">callIpcStartup</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">IpcMgr_ipcStartup</span><span class="p">();</span>
<span class="p">}</span>

<span class="cm">/* Start BIOS */</span>
<span class="n">BIOS_start</span><span class="p">();</span>
<span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the line that calls Board_init(boardCfg). This call is in
the original example because it assumes TI-RTOS is running on the Arm
but in our case here, we are running Linux and this call is
destructive so we comment it out.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#if defined(EVM_K2E) || defined(EVM_C6678)</span>
    <span class="n">boardCfg</span> <span class="o">=</span> <span class="n">BOARD_INIT_MODULE_CLOCK</span> <span class="o">|</span>
    <span class="n">BOARD_INIT_UART_STDIO</span><span class="p">;</span>
<span class="cp">#else</span>
    <span class="n">boardCfg</span> <span class="o">=</span> <span class="n">BOARD_INIT_PINMUX_CONFIG</span> <span class="o">|</span>
    <span class="n">BOARD_INIT_MODULE_CLOCK</span> <span class="o">|</span>
    <span class="n">BOARD_INIT_UART_STDIO</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="c1">//Board_init(boardCfg);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Edit <strong>MainDsp1.c</strong></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The app now has it&#8217;s own main(), so rename this one and get rid of args</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//Int main(Int argc, Char* argv[])</span>
<span class="n">Int</span> <span class="nf">ipc_main</span><span class="p">()</span>
<span class="p">{</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>No longer using args so comment these lines</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//taskParams.arg0 = (UArg)argc;</span>
<span class="c1">//taskParams.arg1 = (UArg)argv;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>BIOS_start() is done in the app main() so comment it out here</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* start scheduler, this never returns */</span>
<span class="c1">//BIOS_start();</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment this out</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//Log_print0(Diags_EXIT, &quot;&lt;-- main:&quot;);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Edit <strong>rsc_table_vayu_dsp.c</strong></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Set this #define before it&#8217;s used to select PHYS_MEM_IPC_VRING value</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#define VAYU_DSP_1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add this extern declaration prior to the symbol being used</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">extern</span> <span class="kt">char</span> <span class="n">ti_trace_SysMin_Module_State_0_outbuf__A</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Edit <strong>Server.c</strong></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>No longer have shared folder so change include path</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* local header files */</span>
<span class="c1">//#include &quot;../shared/AppCommon.h&quot;</span>
<span class="cp">#include &quot;../AppCommon.h&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="download-the-full-ccs-project">Download the Full CCS Project</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><a class="reference external" href="http://processors.wiki.ti.com/images/c/c9/GPIO_LedBlink_evmAM572x_c66xExampleProject_with_ipc.zip">GPIO_LedBlink_evmAM572x_c66xExampleProject_with_ipc.zip</a></p>
<p class="rubric" id="adding-ipc-to-an-existing-ti-rtos-application-on-the-ipu">Adding IPC to an existing TI RTOS application on the IPU</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>A common thing people want to do is take an existing IPU application
that may be controlling serial or control interfaces and add IPC to it
so that the firmware can be loaded from the ARM. This is common when
migrating from a IPU only solution to a heterogeneous SoC with an
MPUSS (ARM) and IPUSS. This is the focus of this section.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In order to describe this process, we need an example TI RTOS test
case to work with. For this purpose, we&#8217;ll be using the
UART_BasicExample_evmAM572x_m4ExampleProject example that&#8217;s part of
the PDK (installed as part of the Processor SDK RTOS). This example
uses TI RTOS and does serial IO using UART3 port on the AM572x GP EVM,
it&#8217;s labeled Serial Debug on the EVM silkscreen.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>There were several steps taken to make this whole process work, each of
which will be described in following sections</p>
<ol class="arabic simple">
<li>Build and run the out-of-box UART M4 example on the EVM using Code
Composer Studio (CCS)</li>
<li>Build and run the ex02_messageQ example from the IPC software bundle
and turn it into a CCS project. Build it and modify the Linux startup
code to use this new image. This is just a sanity check step to make
sure we can build the IPC examples in CCS and have them run at boot
up on the EVM.</li>
<li>In CCS, make a clone of the out-of-box UART M4 example and rename it
to denote it&#8217;s the IPC version of the example. Then using the
ex02_messageq example as a reference, add in the IPC pieces to the
UART example code. Build from CCS then add it to the Linux firmware
folder.</li>
</ol>
<p class="rubric" id="running-uart-readwrite-pdk-example-from-ccs">Running UART Read/Write PDK Example from CCS</p>
<p>Developers are required to run pdkProjectCreate script to generate this
example as described in the <a class="reference external" href="index_how_to_guides.html#rebuild-drivers-from-pdk-directory">Processor SDK RTOS wiki
article</a>.</p>
<p>For the UART M4 example run the script with the following arguments:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">pdkProjectCreate</span><span class="p">.</span><span class="n">bat</span> <span class="n">AM572x</span> <span class="n">evmAM572x</span> <span class="n">little</span> <span class="n">uart</span> <span class="n">m4</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p>After you run the script, you can find the UART M4 example project at
&lt;SDK_INSTALL_PATH&gt;/pdk_am57xx_1_0_4/packages/MyExampleProjects/UART_BasicExample_evmAM572x_m4ExampleProject.</p>
<p>Import the project in CCS and build the example. You can now connect to
the EVM using an emulator and CCS using the instructions provided here:
<a class="reference external" href="http://processors.wiki.ti.com/index.php/AM572x_GP_EVM_Hardware_Setup">http://processors.wiki.ti.com/index.php/AM572x_GP_EVM_Hardware_Setup</a></p>
<p>Connect to the ARM core and make sure GEL runs multicore initialization
and brings the IPUSS out of reset. Connect to IPU2 core0 and load and
run the M4 UART example. When you run the code you should see the
following log on the serial IO console:</p>
<div class="highlight-cpp"><div class="highlight"><pre>uart driver and utils example test cases :
Enter 16 characters or press Esc
1234567890123456  &lt;- user input
Data received is
1234567890123456  &lt;- loopback from user input
uart driver and utils example test cases :
Enter 16 characters or press Esc
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="build-and-run-ex02-messageq-ipc-example">Build and Run ex02_messageq IPC example</p>
<p>Follow instructions described in Article <a class="reference external" href="http://processors.wiki.ti.com/index.php/Processor_SDK_IPC_Quick_Start_Guide#Run_IPC_Linux_examples">Run IPC Linux
Examples</a></p>
<p class="rubric" id="update-linux-kernel-device-tree-to-remove-uart-that-will-be-controlled-by-m4">Update Linux Kernel device tree to remove UART that will be
controlled by M4</p>
<p>Linux kernel enables all SOC HW modules which are required for its
configuration. Appropriate drivers configure required clocks and
initialize HW registers. For all unused IPs clocks are not configured.</p>
<p>The uart3 node is disabled in kernel using device tree. Also this
restricts kernel to put those IPs to sleep mode.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="o">&amp;</span><span class="n">uart3</span> <span class="p">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;disabled&quot;</span><span class="p">;</span>
    <span class="n">ti</span><span class="p">,</span><span class="n">no</span><span class="o">-</span><span class="n">idle</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p class="rubric" id="add-ipc-to-the-uart-example">Add IPC to the UART Example</p>
<p>The first step is to clone our out-of-box UART example CCS project and
rename it to denote it&#8217;s using IPC. The easiest way to do this is using
CCS. Here are the steps...</p>
<ul class="simple">
<li>In the <em>Edit</em> perspective, go into your <em>Project Explorer</em> window and
right click on your UART_BasicExample_evmAM572x_m4ExampleProject
project and select <em>copy</em> from the pop-up menu. Maske sure the
project is not is a closed state.</li>
<li>Rick click in and empty area of the project explorer window and
select past.</li>
<li>A dialog box pops up, modify the name to denote it&#8217;s using IPC. A
good name is UART_BasicExample_evmAM572x_m4ExampleProject_with_ipc.</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>This is the project we&#8217;ll be working with from here on. The next thing
we want to do is select the proper RTSC platform and other components.
To do this, follow these steps.</p>
<ul class="simple">
<li>Right click on the
UART_BasicExample_evmAM572x_m4ExampleProject_with_ipc project and
select <em>Properties</em></li>
<li>In the left hand pane, click on <em>CCS General</em>.</li>
<li>On the right hand side, click on the <em>RTSC</em> tab</li>
<li>For <em>XDCtools version:</em> select 3.xx.x.xx_core</li>
<li>In the list of <em>Products and Repositories</em>, <em>check</em> the following...<ul>
<li>IPC 3.xx.x.xx</li>
<li>SYS/BIOS 6.4x.x.xx</li>
<li>am57xx PDK x.x.x</li>
</ul>
</li>
<li>For <em>Target</em>, select <strong>ti.targets.arm.elf.M4</strong></li>
<li>For <em>Platform</em>, select <strong>ti.platforms.evmDRA7XX</strong></li>
<li>Once the platform is selected, edit its name buy hand and
append&nbsp;:ipu2 to the end. After this it should be
ti.platforms.evmDRA7XX:ipu2</li>
<li>Go ahead and leave the <em>Build-profile</em> set to debug.</li>
<li>Hit the OK button.</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Now we want to copy configuration and source files from the
ex02_messageq IPC example into our project. The IPC example is located
at <em>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq</em>. To
copy files into your CCS project, you can simply select the files you
want in Windows explorer then drag and drop them into your project in
CCS.</p>
<p>Copy these files into your CCS project...</p>
<ul class="simple">
<li>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/shared/AppCommon.h</li>
<li>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/shared/config.bld</li>
<li>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/shared/ipc.cfg.xs</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Now copy these files into your CCS project...</p>
<ul class="simple">
<li>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/ipu2/Ipu2.cfg</li>
<li>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/ipu2/MainIpu2.c</li>
<li>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/ipu2/Server.c</li>
<li>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/ipu2/Server.h</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When you copy Ipu2.cfg into your CCS project, it
should show up greyed out. If not, right click and exclude it from
build. This is because the UART example already has a cfg file
(uart_m4_evmAM572x.cfg). The Ipu2.cfg will be used for copying and
pasting. When it&#8217;s all done, you can delete it from your project.</p>
</div>
<p>Finally, you will likely want to use a custom resource table so copy
these files into your CCS project...</p>
<ul class="simple">
<li>C:/ti/ipc_3_xx_xx_xx/packages/ti/ipc/remoteproc/rsc_table_vayu_ipu.h</li>
<li>C:/ti/ipc_3_xx_xx_xx/packages/ti/ipc/remoteproc/rsc_types.h</li>
</ul>
<p>The rsc_table_vayu_dsp.h file defines an initialized structure so let&#8217;s
make a <em>.c</em> source file.</p>
<ul class="simple">
<li>In your CCS project, rename rsc_table_vayu_ipu.h to
rsc_table_vayu_ipu.c</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Now we want to <em>merge</em> the IPC example configuration file with the LED
blink example configuration file. Follow these steps...</p>
<ul class="simple">
<li>Open up <em>Ipu2.cfg</em> using a text editor (don&#8217;t open it using the GUI).
Right click on it and select <em>Open With -&gt; XDCscript Editor</em></li>
<li>We want to copy the entire contents into the clipboard. Select all
and copy.</li>
<li>Now just like above, open the uart_m4_evmAM572x.cfg config file in
the text editor. Go to the very bottom and <em>paste</em> in the contents
from the Ipu2.cfg file. Basically we&#8217;ve appended the contents of
Ipu2.cfg into uart_m4_evmAM572x.cfg.</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>We&#8217;ve now added in all the necessary configuration and source files
into our project. Don&#8217;t expect it to build at this point, we have to
make edits first. These edits are listed below.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can download the full CCS project with source files to use as a reference.
See link towards the end of this section.</p>
</div>
<ul class="simple">
<li>Edit <strong>uart_m4_evmAM572x.cfg</strong></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add the following to the beginning(at the top) of your configuration
file</p>
<div class="highlight-cpp"><div class="highlight"><pre>var Program = xdc.useModule(&#39;xdc.cfg.Program&#39;);
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Since we are no longer using a shared folder, make the following
change</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//var ipc_cfg = xdc.loadCapsule(&quot;../shared/ipc.cfg.xs&quot;);</span>
<span class="n">var</span> <span class="n">ipc_cfg</span> <span class="o">=</span> <span class="n">xdc</span><span class="p">.</span><span class="n">loadCapsule</span><span class="p">(</span><span class="s">&quot;../ipc.cfg.xs&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the following. We&#8217;ll be calling this function directly from
main.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//BIOS.addUserStartupFunction(&#39;&amp;IpcMgr_ipcStartup&#39;);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Increase the system stack size</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//Program.stack = 0x1000;</span>
<span class="n">Program</span><span class="p">.</span><span class="n">stack</span> <span class="o">=</span> <span class="mh">0x8000</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the entire TICK section</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* --------------------------- TICK --------------------------------------*/</span>
<span class="c1">// var Clock = xdc.useModule(&#39;ti.sysbios.knl.Clock&#39;);</span>
<span class="c1">// Clock.tickSource = Clock.TickSource_NULL;</span>
<span class="c1">// //Clock.tickSource = Clock.TickSource_USER;</span>
<span class="c1">// /* Configure BIOS clock source as GPTimer5 */</span>
<span class="c1">// //Clock.timerId = 0;</span>
<span class="c1">//</span>
<span class="c1">// var Timer = xdc.useModule(&#39;ti.sysbios.timers.dmtimer.Timer&#39;);</span>
<span class="c1">//</span>
<span class="c1">// /* Skip the Timer frequency verification check. Need to remove this later */</span>
<span class="c1">// Timer.checkFrequency = false;</span>
<span class="c1">//</span>
<span class="c1">// /* Match this to the SYS_CLK frequency sourcing the dmTimers.</span>
<span class="c1">//  * Not needed once the SYS/BIOS family settings is updated. */</span>
<span class="c1">// Timer.intFreq.hi = 0;</span>
<span class="c1">// Timer.intFreq.lo = 19200000;</span>
<span class="c1">//</span>
<span class="c1">// //var timerParams = new Timer.Params();</span>
<span class="c1">// //timerParams.period = Clock.tickPeriod;</span>
<span class="c1">// //timerParams.periodType = Timer.PeriodType_MICROSECS;</span>
<span class="c1">// /* Switch off Software Reset to make the below settings effective */</span>
<span class="c1">// //timerParams.tiocpCfg.softreset = 0x0;</span>
<span class="c1">// /* Smart-idle wake-up-capable mode */</span>
<span class="c1">// //timerParams.tiocpCfg.idlemode = 0x3;</span>
<span class="c1">// /* Wake-up generation for Overflow */</span>
<span class="c1">// //timerParams.twer.ovf_wup_ena = 0x1;</span>
<span class="c1">// //Timer.create(Clock.timerId, Clock.doTick, timerParams);</span>
<span class="c1">//</span>
<span class="c1">// var Idle = xdc.useModule(&#39;ti.sysbios.knl.Idle&#39;);</span>
<span class="c1">// var Deh = xdc.useModule(&#39;ti.deh.Deh&#39;);</span>
<span class="c1">//</span>
<span class="c1">// /* Must be placed before pwr mgmt */</span>
<span class="c1">// Idle.addFunc(&#39;&amp;ti_deh_Deh_idleBegin&#39;);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Make configuration change to use custom resource table. Add to the end
of the file.</p>
<div class="highlight-cpp"><div class="highlight"><pre>/* Override the default resource table with my own */
var Resource = xdc.useModule(&#39;ti.ipc.remoteproc.Resource&#39;);
Resource.customTable = true;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Edit <strong>main_uart_example.c</strong></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add the following external declarations</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">extern</span> <span class="n">Int</span> <span class="nf">ipc_main</span><span class="p">();</span>
<span class="k">extern</span> <span class="n">Void</span> <span class="nf">IpcMgr_ipcStartup</span><span class="p">(</span><span class="n">Void</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In main(), add a call to ipc_main() and IpcMgr_ipcStartup() just before
BIOS_start()</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">ipc_main</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">callIpcStartup</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">IpcMgr_ipcStartup</span><span class="p">();</span>
 <span class="p">}</span>
 <span class="cm">/* Start BIOS */</span>
 <span class="n">BIOS_start</span><span class="p">();</span>
 <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the line that calls Board_init(boardCfg). This call is in
the original example because it assumes TI-RTOS is running on the Arm
but in our case here, we are running Linux and this call is destructive
so we comment it out. The board init call does all pinmux configuration,
module clock and UART peripheral initialization.</p>
<p>In order to run the UART Example on M4, you need to disable the UART in
the Linux DTB file and interact with the Linux kernel using Telnet (This
will be described later in the article). Since Linux will be running
uboot performs the pinmux configuration but clock and UART Stdio setup
needs to be performed by the M4.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Original code</strong></p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#if defined(EVM_K2E) || defined(EVM_C6678)</span>
    <span class="n">boardCfg</span> <span class="o">=</span> <span class="n">BOARD_INIT_MODULE_CLOCK</span> <span class="o">|</span> <span class="n">BOARD_INIT_UART_STDIO</span><span class="p">;</span>
<span class="cp">#else</span>
    <span class="n">boardCfg</span> <span class="o">=</span> <span class="n">BOARD_INIT_PINMUX_CONFIG</span> <span class="o">|</span> <span class="n">BOARD_INIT_MODULE_CLOCK</span> <span class="o">|</span> <span class="n">BOARD_INIT_UART_STDIO</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Modified Code&nbsp;:</strong></p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">boardCfg</span> <span class="o">=</span> <span class="n">BOARD_INIT_UART_STDIO</span><span class="p">;</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>We are not done yet as we still need to configure turn the clock control
on for the UART without impacting the other clocks. We can do that by
adding the following code before Board_init API call:</p>
<div class="highlight-cpp"><div class="highlight"><pre>CSL_l4per_cm_core_componentRegs *l4PerCmReg =
    (CSL_l4per_cm_core_componentRegs *)CSL_MPU_L4PER_CM_CORE_REGS;
CSL_FINST(l4PerCmReg-&gt;CM_L4PER_UART3_CLKCTRL_REG,
    L4PER_CM_CORE_COMPONENT_CM_L4PER_UART3_CLKCTRL_REG_MODULEMODE, ENABLE);
while(CSL_L4PER_CM_CORE_COMPONENT_CM_L4PER_UART3_CLKCTRL_REG_IDLEST_FUNC !=
   CSL_FEXT(l4PerCmReg-&gt;CM_L4PER_UART3_CLKCTRL_REG,
    L4PER_CM_CORE_COMPONENT_CM_L4PER_UART3_CLKCTRL_REG_IDLEST));
</pre></div>
</div>
<ul class="simple">
<li>Edit <strong>MainIpu2.c</strong></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The app now has it&#8217;s own main(), so rename this one and get rid of args</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//Int main(Int argc, Char* argv[])</span>
<span class="n">Int</span> <span class="nf">ipc_main</span><span class="p">()</span>
<span class="p">{</span>
</pre></div>
</div>
<p>No longer using args so comment these lines</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//taskParams.arg0 = (UArg)argc;</span>
<span class="c1">//taskParams.arg1 = (UArg)argv;</span>
</pre></div>
</div>
<p>BIOS_start() is done in the app main() so comment it out here</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* start scheduler, this never returns */</span>
<span class="c1">//BIOS_start();</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment this out</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//Log_print0(Diags_EXIT, &quot;&lt;-- main:&quot;);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Edit <strong>rsc_table_vayu_ipu.c</strong></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Set this #define before it&#8217;s used to select PHYS_MEM_IPC_VRING value</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#define VAYU_IPU_2</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add this extern declaration prior to the symbol being used</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">extern</span> <span class="kt">char</span> <span class="n">ti_trace_SysMin_Module_State_0_outbuf__A</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Edit <strong>Server.c</strong></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>No longer have shared folder so change include path</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* local header files */</span>
<span class="c1">//#include &quot;../shared/AppCommon.h&quot;</span>
<span class="cp">#include &quot;../AppCommon.h&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="handling-ammu-l1-unicache-mmu-and-l2-mmu">Handling AMMU (L1 Unicache MMU) and L2 MMU</p>
<p>There are two MMUs inside each of the IPU1, and IPU2 subsystems. The L1
MMU is referred to as IPU_UNICACHE_MMU or AMMU and L2 MMU. The
description of how this is configured in IPC-remoteproc has been
described in section
<a class="reference external" href="http://processors.wiki.ti.com/index.php/Linux_IPC_on_AM57xx#Changing_Cortex_M4_IPU_Memory_Map">Changing_Cortex_M4_IPU_Memory_Map</a>.
IPC handling of L1 and L2 MMU is different from how the PDK driver
examples setup the memory access using these MMUs which the users need
to manage when integrating the components. This difference is
highlighted below:</p>
<img alt="../_images/IPU_MMU_Peripheral_access.png" src="../_images/IPU_MMU_Peripheral_access.png" />
<ul class="simple">
<li>PDK examples use addresses (0x4X000000) to peripheral registers and
use following MMU setting<ul>
<li>L2 MMU uses default 1:1 Mapping</li>
<li>AMMU configuration translates physical 0x4X000000 access to
logical 0x4X000000</li>
</ul>
</li>
<li>IPC+ Remote Proc ARM+M4 requires IPU to use logical address
(0x6X000000) and uses following MMU setting<ul>
<li>L2 MMU is configured such that MMU translates 0x6X000000 access to
addresss 0x4X000000</li>
<li>AMMU is configured for 1:1 mapping 0x6X000000 and 0x6X000000</li>
</ul>
</li>
</ul>
<p>Therefore after integrating IPC with PDK drivers, it is recommended that
the alias addresses are used to access peripherals and PRCM registers.
This requires changes to the addresses used by PDK drivers and in
application code.</p>
<p>The following changes were then made to the IPU application source code:</p>
<p>Add UART_soc.c file to the project and modify the base addresses for all
IPU UART register instance in the UART_HwAttrs to use alias addresses:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#ifdef _TMS320C6X</span>
    <span class="n">CSL_DSP_UART3_REGS</span><span class="p">,</span>
    <span class="n">OSAL_REGINT_INTVEC_EVENT_COMBINER</span><span class="p">,</span>
<span class="cp">#elif defined(__ARM_ARCH_7A__)</span>
    <span class="n">CSL_MPU_UART3_REGS</span><span class="p">,</span>
    <span class="mi">106</span><span class="p">,</span>
<span class="cp">#else</span>
    <span class="p">(</span><span class="n">CSL_IPU_UART3_REGS</span> <span class="o">+</span> <span class="mh">0x20000000</span><span class="p">),</span>    <span class="c1">//Base Addr = 0x48000000 + 0x20000000 = 0x68000000</span>
    <span class="mi">45</span><span class="p">,</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Adding custom SOC configuration also means that you should use the
generic UART driver instead of driver with built in SOC setup. To do
this comment the following line in .cfg:</p>
<div class="highlight-cpp"><div class="highlight"><pre>var Uart              = xdc.loadPackage(&#39;ti.drv.uart&#39;);
//Uart.Settings.socType = socType;
</pre></div>
</div>
<p>There is also an instance in the application code where we added pointer
to PRCM registers that need to be changed as follows.</p>
<div class="highlight-cpp"><div class="highlight"><pre> <span class="n">CSL_l4per_cm_core_componentRegs</span> <span class="o">*</span><span class="n">l4PerCmReg</span> <span class="o">=</span>
<span class="p">(</span><span class="n">CSL_l4per_cm_core_componentRegs</span> <span class="o">*</span><span class="p">)</span> <span class="mh">0x6a009700</span><span class="p">;</span> <span class="c1">//CSL_MPU_L4PER_CM_CORE_REGS;</span>
</pre></div>
</div>
<p>Now, you are ready to build the firmware. After the .out is built,
change the extension to .xem4 and copy it over to the location in the
filesystem that is used to load M4 firmware.</p>
</div>
</div>
<div class="section" id="customizing-memory-map-for-creating-multicore-applications-on-am57xx-using-ipc">
<h3>10.2.4.2. Customizing Memory map for creating Multicore Applications on AM57xx using IPC<a class="headerlink" href="#customizing-memory-map-for-creating-multicore-applications-on-am57xx-using-ipc" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.ti.com/lit/an/sprac60/sprac60.pdf">http://www.ti.com/lit/an/sprac60/sprac60.pdf</a></p>
</div>
<div class="section" id="ipc-debugging-tools-and-techniques-on-am57xx">
<h3>10.2.4.3. IPC Debugging Tools and Techniques on AM57xx<a class="headerlink" href="#ipc-debugging-tools-and-techniques-on-am57xx" title="Permalink to this headline">¶</a></h3>
<p>The sections relevant to AM57xx have been pulled from the <a class="reference external" href="http://www.ti.com/lit/an/sprac12/sprac12.pdf">Debugging Tools and Techniques With IPC3.x Application Note</a> and placed here.</p>
<div class="section" id="id5">
<h4>10.2.4.3.1. Introduction<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>During development of software, it is common to encounter issues that must be debugged to provide a
robust software offering. When developing software that uses the IPC3.x product for inter-processor
communication, there are tools and techniques available to aid in the debugging process. These tools and
techniques help to more quickly understand and debug the issue. This document addresses all three
HLOS’s supported by IPC3.x: Android™ platform, Linux®, and QNX®. Where applicable, differences
between the OS&#8217;s are noted.
This document aims to provide tools, techniques, and resources for debugging issues encountered when
using the IPC3.x to communicate with remote core software.</p>
</div>
<div class="section" id="debug-tools">
<h4>10.2.4.3.2. Debug Tools<a class="headerlink" href="#debug-tools" title="Permalink to this headline">¶</a></h4>
<p>There are several tools that can be leveraged for debugging the IPC, from simple tracing to using Code
Composer Studio™ (CCS) to attach to the remote cores. Each provides different advantages in
the debugging process.</p>
<div class="section" id="tracing">
<h5>10.2.4.3.2.1. Tracing<a class="headerlink" href="#tracing" title="Permalink to this headline">¶</a></h5>
<p>When an issue occurs, checking the traces is often the first thing done. The traces can give quick insight
into what may be happening. In normal, non-error cases, you might see little to no traces from the IPC.
But when there is an error, there often is an error trace that can be used to shed light on the issue. An
error trace often gives an error code and a module or function name that can be used to identify where the
error was thrown.</p>
</div>
<div class="section" id="linux-and-android-debugfs">
<h5>10.2.4.3.2.2. Linux and Android - Debugfs<a class="headerlink" href="#linux-and-android-debugfs" title="Permalink to this headline">¶</a></h5>
<p>Another useful place to look for debug info is in the debugfs. Information for each remote processor can
be found there, as well as remote core traces, state information, and more.</p>
</div>
<div class="section" id="code-composer-studio">
<h5>10.2.4.3.2.3. Code Composer Studio<a class="headerlink" href="#code-composer-studio" title="Permalink to this headline">¶</a></h5>
<p>Connecting over JTAG using Code Composer Studio provides the ability to see exactly what is happening
on the remote core, providing access to a wealth of information including viewing memory, registers, and
stepping through the code.</p>
</div>
</div>
<div class="section" id="traces">
<h4>10.2.4.3.3. Traces<a class="headerlink" href="#traces" title="Permalink to this headline">¶</a></h4>
<p>The first place to check when an issue occurs is the traces. Often an error code or a trace regarding an
error gives some clue. Both the remote core traces and the HLOS-side traces can be checked.</p>
<div class="section" id="linux-and-android-enabling-ipc-traces">
<h5>10.2.4.3.3.1. Linux and Android - Enabling IPC Traces<a class="headerlink" href="#linux-and-android-enabling-ipc-traces" title="Permalink to this headline">¶</a></h5>
<p>By default, the IPC only prints error traces. To enable additional tracing, use the IPC_DEBUG
environment variable at runtime. This feature is only supported on Linux and is available starting in IPC
3.22.00.05. Table 1 lists the two levels of tracing supported.</p>
<p>Table 1. IPC_DEBUG Trace Levels</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Trace Level</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Enables all warnings and errors to be printed</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Turns on all tracing (including socket and LAD client tracing).</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="qnx-enabling-ipc-traces">
<h5>10.2.4.3.3.2. QNX – Enabling IPC Traces<a class="headerlink" href="#qnx-enabling-ipc-traces" title="Permalink to this headline">¶</a></h5>
<p>When using QNX, additional traces are enabled by setting environment variables. There are separate
environment variables for enabling traces in the resource manager and the user libraries.</p>
<p><strong>Resource Manager Traces</strong></p>
<p>Enable additional traces in the slog by setting the environment variable IPC_DEBUG_SLOG_LEVEL at
runtime. By default, only errors and warnings are printed. The IPC_DEBUG_SLOG_LEVEL can be set
before launching IPC to enable more traces. Setting the level to 7 enables all IPC traces. The default level
is 2.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">export</span> <span class="n">IPC_DEBUG_SLOG_LEVEL</span><span class="o">=</span><span class="mi">7</span>
</pre></div>
</div>
<p>These traces are printed to the slog, and can be viewed by using the sloginfo command. All IPC traces
use 42 as identification in the slog, and you can filter the slog to view only these traces:</p>
<div class="highlight-cpp"><div class="highlight"><pre>sloginfo –m42
</pre></div>
</div>
<p><strong>User Library Traces</strong></p>
<p>User library traces can be enabled by using the variable IPC_DEBUG when launching the application.
Valid levels are 1 to 3, with 3 being the most verbose. For example:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">IPC_DEBUG</span><span class="o">=&lt;</span><span class="n">level</span><span class="o">&gt;</span> <span class="n">app_host</span>
</pre></div>
</div>
</div>
<div class="section" id="linux-and-android-remote-core-traces">
<h5>10.2.4.3.3.3. Linux and Android - Remote Core Traces<a class="headerlink" href="#linux-and-android-remote-core-traces" title="Permalink to this headline">¶</a></h5>
<p>The remote core traces can be checked by using debugfs. Run the following command, replacing the “X”
with the core-id for the remote core to be checked.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">remoteproc</span><span class="o">/</span><span class="n">remoteprocX</span><span class="o">/</span><span class="n">trace0</span>
</pre></div>
</div>
<p>Check the following when checking the traces after an error recovery has occurred:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">remoteproc</span><span class="o">/</span><span class="n">remoteprocX</span><span class="o">/</span><span class="n">trace0_last</span>
</pre></div>
</div>
<p>This provides the last traces that happened before error recovery was triggered. For more information
about debugging remote core faults and exceptions, see <a class="reference internal" href="#debugging-mmu-faults-and-exceptions">Debugging MMU Faults and Exceptions</a>.</p>
<p>The core-id, “X”, starts at 0 and increments to include all of the remote cores supported by the remoteproc
module in the dts file. Because the number of remoteprocs supported can vary depending on the dts
configuration, it is not ensured that a certain remote core will always have a certain core-id if the
remoteprocs supported in the dts file changes.</p>
<p>The core associated with a particular core-id can be found by checking the name of the remoteproc (see <a class="reference internal" href="#linux-and-android-remoteproc">Linux and Android - Remoteproc</a>). Table 2 associates the remoteproc name with the common name of the
remote processor.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">remoteproc</span><span class="o">/</span><span class="n">remoteprocX</span><span class="o">/</span><span class="n">name</span>
</pre></div>
</div>
<p>Table 2. Remoteproc Names for AM57xx</p>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Debugfs Name</th>
<th class="head">Remote Core Name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>58820000.ipu</td>
<td>IPU1</td>
</tr>
<tr class="row-odd"><td>55020000.ipu</td>
<td>IPU2</td>
</tr>
<tr class="row-even"><td>40800000.dsp</td>
<td>DSP1</td>
</tr>
<tr class="row-odd"><td>41000000.dsp</td>
<td>DSP2</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="qnx-remote-core-traces">
<h5>10.2.4.3.3.4. QNX - Remote Core Traces<a class="headerlink" href="#qnx-remote-core-traces" title="Permalink to this headline">¶</a></h5>
<p>The remote core traces can be checked by using sysfs. Run the following command, replacing &lt;core
name&gt; with the core name for the remote core to check. Valid core names for AM57xx are IPU1, IPU2,
DSP1, and DSP2.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">cat</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">ipc</span><span class="o">-</span><span class="n">trace</span><span class="o">/&lt;</span><span class="n">core</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>When checking the traces after error recovery has happened, check the logfile specified at IPC startup, if
one was specified. When starting IPC, specify a logfile using the “-c” option. When an error recovery
happens, the last traces are dumped to this log file. For more information about debugging remote core
faults and exceptions, see <a class="reference internal" href="#debugging-mmu-faults-and-exceptions">Debugging MMU Faults and Exceptions</a>.</p>
</div>
<div class="section" id="qnx-adding-traces">
<h5>10.2.4.3.3.5. QNX - Adding Traces<a class="headerlink" href="#qnx-adding-traces" title="Permalink to this headline">¶</a></h5>
<p>In some cases, you may want to add traces to get more information about the issue. If the issue is reliably
reproducible, one technique is to add additional traces to get more information. If the issue is timing-related, this technique may not be helpful, as it may mask the issue</p>
<p><strong>SYS-BIOS</strong></p>
<p>You can add traces in the SYS-BIOS IPC code that come to the trace buffer by using the System_printf()
API. After adding traces to the SYS-BIOS IPC and rebuilding the IPC, you must rebuild the remote core
image. The traces come to the remote core trace buffer and can be viewed by following the instructions in
<a class="reference internal" href="#linux-and-android-remote-core-traces">Linux and Android - Remote Core Traces</a>.</p>
<p><strong>Linux</strong></p>
<p>Additionally, traces can be added in the Linux code. The modules of interest when adding traces are the
remoteproc, iommu, and rpmsg modules in the kernel, and the MessageQ, MMRPC, and LAD modules in
the user space.</p>
<p>In the kernel are these modules in the following paths:</p>
<ul class="simple">
<li>drivers/remoteproc/</li>
<li>drivers/iommu/</li>
<li>drivers/rpmsg/</li>
</ul>
<p>Most of the user space code can be found in the IPC package, in the linux folder. The MMRPC code is
found in the packages/ti/ipc/mm/ folder.</p>
</div>
</div>
<div class="section" id="remote-core-status-information">
<h4>10.2.4.3.4. Remote Core Status Information<a class="headerlink" href="#remote-core-status-information" title="Permalink to this headline">¶</a></h4>
<p>Useful information about the status of the remote cores can be found in debugfs.</p>
<div class="section" id="linux-and-android-remoteproc">
<h5>10.2.4.3.4.1. Linux and Android - Remoteproc<a class="headerlink" href="#linux-and-android-remoteproc" title="Permalink to this headline">¶</a></h5>
<p>Information about each remote core can be found in the following, where the “X” can be replaced with the
remote core id.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">remoteproc</span><span class="o">/</span><span class="n">remoteprocX</span><span class="o">/&lt;</span><span class="n">entry</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Table 3 lists what can be found for each core.</p>
<p>Table 3. Remoteproc Debugfs Entries</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Entry</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>name</td>
<td>Processor name, comprised of the RAM address and the processor type,
(for example, 58820000.ipu for IPU1). For a complete list of names, see Table 2.</td>
</tr>
<tr class="row-odd"><td>recovery</td>
<td>Returns either “enabled” or “disabled”, indicating if recovery is enabled or disabled for
the remote processor.</td>
</tr>
<tr class="row-even"><td>state</td>
<td>Gives the state of the remote processor. State is one of:
* offline (0)
* suspended (1)
* running (2)
* crashed (3)</td>
</tr>
<tr class="row-odd"><td>trace0</td>
<td>Returns the contents of the remote processor trace buffer.</td>
</tr>
<tr class="row-even"><td>trace0_last</td>
<td>Created after recovering the remote core. Returns the contents of the remote processor
trace buffer before recovery was triggered.</td>
</tr>
<tr class="row-odd"><td>version</td>
<td>Returns the version. Currently returns nothing.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="linux-and-android-iommu-info">
<h5>10.2.4.3.4.2. Linux and Android - IOMMU Info<a class="headerlink" href="#linux-and-android-iommu-info" title="Permalink to this headline">¶</a></h5>
<p>Information about the IOMMU can also be found in debugfs. It can be found in the following path, where
“XXXXXXXX” is replaced by the register address for the remote core MMU registers.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">omap_iommu</span><span class="o">/</span><span class="n">XXXXXXXX</span><span class="p">.</span><span class="n">mmu</span><span class="o">/&lt;</span><span class="n">entry</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Table 4 gives the corresponding core name for each MMU for AM57xx, and the register address in the TRM.</p>
<p>Table 4. IOMMU Entry Names</p>
<table border="1" class="docutils">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">IOMMU Entry</th>
<th class="head">Core Name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>58882000.mmu</td>
<td>IPU1</td>
</tr>
<tr class="row-odd"><td>55082000.mmu</td>
<td>IPU2</td>
</tr>
<tr class="row-even"><td>40d01000.mmu</td>
<td>DSP1 (MMU1)</td>
</tr>
<tr class="row-odd"><td>40d02000.mmu</td>
<td>DSP1 (MMU2)</td>
</tr>
<tr class="row-even"><td>41501000.mmu</td>
<td>DSP2 (MMU1)</td>
</tr>
<tr class="row-odd"><td>41502000.mmu</td>
<td>DSP2 (MMU2)</td>
</tr>
</tbody>
</table>
<p>Some of this information is inaccessible from a suspended state. Table 5 lists what can be found for each core.</p>
<p>Table 5. IOMMU Debugfs Entries</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Entry</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>nr_tlb_entries</td>
<td>Gives the number of tlb entries</td>
</tr>
<tr class="row-odd"><td>pagetable</td>
<td>Dumps the pagetable entries</td>
</tr>
<tr class="row-even"><td>regs</td>
<td>Gives the values of the MMU registers</td>
</tr>
<tr class="row-odd"><td>tlb</td>
<td>Lists the tlb entries.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="qnx-remote-core-state-information">
<h5>10.2.4.3.4.3. QNX – Remote Core State Information<a class="headerlink" href="#qnx-remote-core-state-information" title="Permalink to this headline">¶</a></h5>
<p>Find out the current state of the remote core by issuing the following command:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">cat</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">ipc</span><span class="o">-</span><span class="n">state</span><span class="o">/&lt;</span><span class="n">core_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The “core_name” is the name of the remote core. Valid names for AM57xx are IPU1, IPU2, DSP1, and
DSP2. The current state will show as “running” or “reset”.</p>
</div>
</div>
<div class="section" id="using-code-composer-studio">
<h4>10.2.4.3.5. Using Code Composer Studio<a class="headerlink" href="#using-code-composer-studio" title="Permalink to this headline">¶</a></h4>
<p>A useful tool for debugging issues is Code Composer Studio. CCS allows easy connection to the remote
core in order to see the state of the remote core.</p>
<div class="section" id="debug-symbols">
<h5>10.2.4.3.5.1. Debug Symbols<a class="headerlink" href="#debug-symbols" title="Permalink to this headline">¶</a></h5>
<p>The remote core image must be built with debug symbols to see information such as the call stack and
variables. Once attached, load the symbols. The symbols are built into the executable itself. When loading
symbols, point to the same executable that is loaded on the target (or the unstripped version locally, if it is stripped to save space when loading to the target.)</p>
</div>
<div class="section" id="linux-and-android-disabling-remoteproc-auto-suspend">
<h5>10.2.4.3.5.2. Linux and Android - Disabling Remoteproc Auto-Suspend<a class="headerlink" href="#linux-and-android-disabling-remoteproc-auto-suspend" title="Permalink to this headline">¶</a></h5>
<p>You may want to disable auto-suspend of the remote cores (provided that is not what is being debugged).
When the core is suspended, you will not be able to connect to the remote core using CCS. Auto-suspend
can be disabled by setting the power control to “on” for the remote core.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">echo</span> <span class="n">on</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">bus</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">devices</span><span class="o">/&lt;</span><span class="n">device</span><span class="o">&gt;/</span><span class="n">power</span><span class="o">/</span><span class="n">control</span>
</pre></div>
</div>
<p>The remote core device name for each remote core can be found in Table 2.</p>
</div>
<div class="section" id="linux-and-android-disabling-watchdog">
<h5>10.2.4.3.5.3. Linux and Android – Disabling Watchdog<a class="headerlink" href="#linux-and-android-disabling-watchdog" title="Permalink to this headline">¶</a></h5>
<p>You may decide to disable the watchdog timers when debugging and using CCS. Otherwise, while
connected to the target, the watchdog may expire, triggering an abort sequence. Disable the watchdog
timers for a remote core by removing their definitions from the dts file. For example, to disable the
watchdog timers for IPU1, change the dts file as below:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="o">&amp;</span><span class="n">ipu1</span> <span class="p">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;okay&quot;</span><span class="p">;</span>

    <span class="n">memory</span><span class="o">-</span><span class="n">region</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">ipu1_cma_pool</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="n">mboxes</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">mailbox5</span> <span class="o">&amp;</span><span class="n">mbox_ipu1_legacy</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="n">timers</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">timer11</span><span class="o">&gt;</span><span class="p">;</span>

   <span class="o">-</span> <span class="n">watchdog</span><span class="o">-</span><span class="n">timers</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">timer7</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;&amp;</span><span class="n">timer8</span><span class="o">&gt;</span><span class="p">;</span>

   <span class="o">+</span> <span class="cm">/*watchdog-timers = &lt;&amp;timer7&gt;, &lt;&amp;timer8&gt;;*/</span>
</pre></div>
</div>
</div>
<div class="section" id="sys-bios-disabling-watchdog">
<h5>10.2.4.3.5.4. SYS/BIOS – Disabling Watchdog<a class="headerlink" href="#sys-bios-disabling-watchdog" title="Permalink to this headline">¶</a></h5>
<p>When using QNX, you can disable the watchdog from within the remote core image itself.
If using Linux or Android, this step is not required; simply follow the instructions in <a class="reference internal" href="#linux-and-android-disabling-watchdog">Linux and Android – Disabling Watchdog</a>.</p>
<p>To disable the usage of the watchdog from the remote core without completely disabling the device
exception module (DEH), comment out the calls to Watchdog_init in the SYS/BIOS IPC code. These calls
can be found in packages/ti/deh/Deh.c, packages/ti/deh/DehDsp.c, and packages/ti/ipc/ipcmgr/IpcMgr.c.</p>
<p>packages/ti/deh/Deh.c:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">* ======== Deh_Module_startup ========</span>
<span class="cm">*/</span>
<span class="n">Int</span> <span class="nf">Deh_Module_startup</span><span class="p">(</span><span class="n">Int</span> <span class="n">phase</span><span class="p">)</span>
<span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="n">AMMU_Module_startupDone</span><span class="p">()</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span> <span class="p">{</span>
<span class="o">-</span> <span class="n">Watchdog_init</span><span class="p">(</span><span class="n">ti_sysbios_family_arm_m3_Hwi_excHandlerAsm__I</span><span class="p">);</span>
<span class="o">+</span> <span class="c1">//Watchdog_init(ti_sysbios_family_arm_m3_Hwi_excHandlerAsm__I);</span>
<span class="k">return</span> <span class="n">Startup_DONE</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">return</span> <span class="n">Startup_NOTDONE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>packages/ti/deh/DehDsp.c:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">Int</span> <span class="nf">Deh_Module_startup</span><span class="p">(</span><span class="n">Int</span> <span class="n">phase</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if defined(HAS_AMMU)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">AMMU_Module_startupDone</span><span class="p">()</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span> <span class="p">{</span>
<span class="o">-</span> <span class="n">Watchdog_init</span><span class="p">((</span><span class="n">Void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">Void</span><span class="p">))</span><span class="n">ti_sysbios_family_c64p_Exception_handler</span><span class="p">);</span>
<span class="o">+</span> <span class="c1">//Watchdog_init((Void (*)(Void))ti_sysbios_family_c64p_Exception_handler);</span>
<span class="k">return</span> <span class="n">Startup_DONE</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">return</span> <span class="n">Startup_NOTDONE</span><span class="p">;</span>
<span class="cp">#else</span>
<span class="o">-</span> <span class="n">Watchdog_init</span><span class="p">((</span><span class="n">Void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">Void</span><span class="p">))</span><span class="n">ti_sysbios_family_c64p_Exception_handler</span><span class="p">);</span>
<span class="o">+</span> <span class="c1">//Watchdog_init((Void (*)(Void))ti_sysbios_family_c64p_Exception_handler);</span>
<span class="k">return</span> <span class="n">Startup_DONE</span><span class="p">;</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>packages/ti/ipc/ipcmgr/IpcMgr.c:</p>
<div class="highlight-cpp"><div class="highlight"><pre>Void IpcMgr_rpmsgStartup(Void)
{
Assert_isTrue(MultiProc_self() != MultiProc_getId(&quot;HOST&quot;), NULL);
RPMessage_init(MultiProc_getId(&quot;HOST&quot;));
-#ifdef IpcMgr_USEDEH
+#if 0
/*
* When using DEH, initialize the Watchdog timers if not already done
* (i.e. late-attach)
*/
#ifdef IpcMgr_DSP
Watchdog_init((Void (*)(Void))ti_sysbios_family_c64p_Exception_handler);
#elif IpcMgr_IPU
Watchdog_init(ti_sysbios_family_arm_m3_Hwi_excHandlerAsm__I);
#endif
#endif
}
[...]
Void IpcMgr_ipcStartup(Void)
{
UInt procId = MultiProc_getId(&quot;HOST&quot;);
Int status;
/* TransportRpmsgSetup will busy wait until host kicks ready to recv: */
status = TransportRpmsgSetup_attach(procId, 0);
Assert_isTrue(status &gt;= 0, NULL);
/* Sets up to communicate with host&#39;s NameServer: */
status = NameServerRemoteRpmsg_attach(procId, 0);
Assert_isTrue(status &gt;= 0, NULL);
-#ifdef IpcMgr_USEDEH
+#if 0
/*
* When using DEH, initialize the Watchdog timers if not already done
* (i.e. late-attach)
*/
#ifdef IpcMgr_DSP
Watchdog_init((Void (*)(Void))ti_sysbios_family_c64p_Exception_handler);
#elif IpcMgr_IPU
Watchdog_init(ti_sysbios_family_arm_m3_Hwi_excHandlerAsm__I);
#endif
#endif
}
</pre></div>
</div>
<p>Following this, rebuild the IPC and the remote core image to have an image with DEH, but without
watchdog enabled.</p>
</div>
<div class="section" id="attaching-before-the-issue">
<h5>10.2.4.3.5.5. Attaching Before the Issue<a class="headerlink" href="#attaching-before-the-issue" title="Permalink to this headline">¶</a></h5>
<p>In certain cases, you may want to attach to the remote core before the issue has occurred. If the issue is
reliably reproducible and always occurs at the same location, then adding a breakpoint close to where the
issue happens could be a good way to get a better picture of what is happening.</p>
<p>One instance where it may be difficult is if the issue is happening during boot-up of the remote core. In
this case, it may be necessary to add a while loop in the main function, to attach before the issue occurs.
Add a loop similar to this:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">{</span>
<span class="k">volatile</span> <span class="kt">int</span> <span class="n">foo</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="n">foo</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, after attaching, load the symbols, add the breakpoints, change “foo” to 0, and continue running.</p>
</div>
<div class="section" id="attaching-after-the-issue">
<h5>10.2.4.3.5.6. Attaching After the Issue<a class="headerlink" href="#attaching-after-the-issue" title="Permalink to this headline">¶</a></h5>
<p>You can also attach to the core after the issue, load the symbols, and see the state and view memory.
You can view the Exception module’s exception CallStack ROV view and the task module’s per task
CallStack ROV view. For more information about the runtime object viewer (ROV) in the RTSC
documentation online, see <a class="reference external" href="http://rtsc.eclipse.org/docs-tip/Runtime_Object_Viewer/">Runtime Object Viewer</a>.</p>
</div>
<div class="section" id="viewing-the-state-of-the-remote-core">
<h5>10.2.4.3.5.7. Viewing the State of the Remote Core<a class="headerlink" href="#viewing-the-state-of-the-remote-core" title="Permalink to this headline">¶</a></h5>
<p>Once attached and with symbols loaded, the state of the processor can be inspected. You can see the
program counter, memory windows, registers, call stack, and the ROV, among other things.</p>
</div>
</div>
<div class="section" id="debugging-mmu-faults-and-exceptions">
<h4>10.2.4.3.6. Debugging MMU Faults and Exceptions<a class="headerlink" href="#debugging-mmu-faults-and-exceptions" title="Permalink to this headline">¶</a></h4>
<p>Errors commonly manifest as MMU faults, exceptions, and watchdog errors (if using a version of IPC with
watchdog available and enabled).</p>
<div class="section" id="linux-and-android-disabling-error-recovery">
<h5>10.2.4.3.6.1. Linux and Android - Disabling Error Recovery<a class="headerlink" href="#linux-and-android-disabling-error-recovery" title="Permalink to this headline">¶</a></h5>
<p>To debug an error, it may be necessary to turn of error recovery. Error recovery can be disabled by giving
the following command:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">echo</span> <span class="n">disabled</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">remoteproc</span><span class="o">/</span><span class="n">remoteprocX</span><span class="o">/</span><span class="n">recovery</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#linux-and-android-remoteproc">Linux and Android - Remoteproc</a> for more information.</p>
</div>
<div class="section" id="qnx-disabling-error-recovery">
<h5>10.2.4.3.6.2. QNX – Disabling Error Recovery<a class="headerlink" href="#qnx-disabling-error-recovery" title="Permalink to this headline">¶</a></h5>
<p>To disable error recovery on QNX using IPC version 3.22 and above, give the -d option when launching
the ipc binary. For example:</p>
<div class="highlight-cpp"><div class="highlight"><pre>ipc –d IPU2 dra7x-ipu2-fw.xem4
</pre></div>
</div>
</div>
<div class="section" id="crash-dump">
<h5>10.2.4.3.6.3. Crash Dump<a class="headerlink" href="#crash-dump" title="Permalink to this headline">¶</a></h5>
<p>If any of these three errors are encountered, you will get a crash dump from the remote core which is
visible in the remote core traces. If error recovery is disabled, the dump can be found in trace0 (when
using Linux/Android) or in /dev/ipc-trace/&lt;core_name&gt; (when using QNX); otherwise, the trace is found in
trace0_last (when using Linux/Android) and in the logfile (when using QNX).</p>
<p>An example of the crash dump will look like this:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">Exception</span> <span class="n">occurred</span> <span class="n">at</span> <span class="p">(</span><span class="n">PC</span><span class="p">)</span> <span class="o">=</span> <span class="mo">0000</span><span class="n">c976</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">CPU</span> <span class="n">context</span><span class="o">:</span> <span class="kr">thread</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">BIOS</span> <span class="n">Task</span> <span class="n">name</span><span class="o">:</span> <span class="p">{</span><span class="n">empty</span><span class="o">-</span><span class="n">instance</span><span class="o">-</span><span class="n">name</span><span class="p">}</span> <span class="n">handle</span><span class="o">:</span> <span class="mh">0x80060090</span><span class="p">.</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">BIOS</span> <span class="n">Task</span> <span class="n">stack</span> <span class="n">base</span><span class="o">:</span> <span class="mh">0x800600e0</span><span class="p">.</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">BIOS</span> <span class="n">Task</span> <span class="n">stack</span> <span class="n">size</span><span class="o">:</span> <span class="mh">0x800</span><span class="p">.</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="p">[</span><span class="n">t</span><span class="o">=</span><span class="mh">0x18f6df13</span><span class="p">]</span> <span class="n">ti</span><span class="p">.</span><span class="n">sysbios</span><span class="p">.</span><span class="n">family</span><span class="p">.</span><span class="n">arm</span><span class="p">.</span><span class="n">m3</span><span class="p">.</span><span class="n">Hwi</span><span class="o">:</span> <span class="n">ERROR</span><span class="o">:</span> <span class="n">line</span> <span class="mi">1078</span><span class="o">:</span> <span class="n">E_hardFault</span><span class="o">:</span> <span class="n">FORCED</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">ti</span><span class="p">.</span><span class="n">sysbios</span><span class="p">.</span><span class="n">family</span><span class="p">.</span><span class="n">arm</span><span class="p">.</span><span class="n">m3</span><span class="p">.</span><span class="n">Hwi</span><span class="o">:</span> <span class="n">line</span> <span class="mi">1078</span><span class="o">:</span> <span class="n">E_hardFault</span><span class="o">:</span> <span class="n">FORCED</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="p">[</span><span class="n">t</span><span class="o">=</span><span class="mh">0x18f9a0cb</span><span class="p">]</span> <span class="n">ti</span><span class="p">.</span><span class="n">sysbios</span><span class="p">.</span><span class="n">family</span><span class="p">.</span><span class="n">arm</span><span class="p">.</span><span class="n">m3</span><span class="p">.</span><span class="n">Hwi</span><span class="o">:</span> <span class="n">ERROR</span><span class="o">:</span> <span class="n">line</span> <span class="mi">1155</span><span class="o">:</span> <span class="n">E_busFault</span><span class="o">:</span> <span class="n">PRECISERR</span><span class="o">:</span> <span class="n">Immediate</span> <span class="n">Bus</span> <span class="n">Fault</span><span class="p">,</span> <span class="n">exact</span> <span class="n">addr</span> <span class="n">known</span><span class="p">,</span> <span class="n">address</span><span class="o">:</span> <span class="mi">96000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">ti</span><span class="p">.</span><span class="n">sysbios</span><span class="p">.</span><span class="n">family</span><span class="p">.</span><span class="n">arm</span><span class="p">.</span><span class="n">m3</span><span class="p">.</span><span class="n">Hwi</span><span class="o">:</span> <span class="n">line</span> <span class="mi">1155</span><span class="o">:</span> <span class="n">E_busFault</span><span class="o">:</span> <span class="n">PRECISERR</span><span class="o">:</span> <span class="n">Immediate</span> <span class="n">Bus</span>

<span class="n">Fault</span><span class="p">,</span> <span class="n">exact</span> <span class="n">addr</span> <span class="n">known</span><span class="p">,</span> <span class="n">address</span><span class="o">:</span> <span class="mi">96000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R0</span> <span class="o">=</span> <span class="mh">0x96000000</span> <span class="n">R8</span> <span class="o">=</span> <span class="mh">0xffffffff</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R1</span> <span class="o">=</span> <span class="mh">0x00000000</span> <span class="n">R9</span> <span class="o">=</span> <span class="mh">0xffffffff</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R2</span> <span class="o">=</span> <span class="mh">0x00000000</span> <span class="n">R10</span> <span class="o">=</span> <span class="mh">0xffffffff</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R3</span> <span class="o">=</span> <span class="mh">0x80060814</span> <span class="n">R11</span> <span class="o">=</span> <span class="mh">0xffffffff</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R4</span> <span class="o">=</span> <span class="mh">0x00013098</span> <span class="n">R12</span> <span class="o">=</span> <span class="mh">0x8006074c</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R5</span> <span class="o">=</span> <span class="mh">0x0000000a</span> <span class="n">SP</span><span class="p">(</span><span class="n">R13</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x80060820</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R6</span> <span class="o">=</span> <span class="mh">0xffffffff</span> <span class="n">LR</span><span class="p">(</span><span class="n">R14</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x0000c973</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R7</span> <span class="o">=</span> <span class="mh">0xffffffff</span> <span class="n">PC</span><span class="p">(</span><span class="n">R15</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x0000c976</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">PSR</span> <span class="o">=</span> <span class="mh">0x61000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">ICSR</span> <span class="o">=</span> <span class="mh">0x00438803</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">MMFSR</span> <span class="o">=</span> <span class="mh">0x00</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">BFSR</span> <span class="o">=</span> <span class="mh">0x82</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">UFSR</span> <span class="o">=</span> <span class="mh">0x0000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">HFSR</span> <span class="o">=</span> <span class="mh">0x40000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">DFSR</span> <span class="o">=</span> <span class="mh">0x00000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">MMAR</span> <span class="o">=</span> <span class="mh">0x96000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">BFAR</span> <span class="o">=</span> <span class="mh">0x96000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">AFSR</span> <span class="o">=</span> <span class="mh">0x00000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">Stack</span> <span class="n">trace</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mo">00</span> <span class="p">[</span><span class="n">op</span> <span class="n">faaaf00e</span><span class="p">]</span> <span class="mo">00006</span><span class="n">abd</span> <span class="p">(</span><span class="n">ret</span> <span class="n">from</span> <span class="n">call</span> <span class="n">to</span> <span class="mo">00015010</span><span class="p">)</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mo">01</span> <span class="p">[</span><span class="n">op</span> <span class="n">ff49f005</span><span class="p">]</span> <span class="mo">00006</span><span class="n">ac3</span> <span class="p">(</span><span class="n">ret</span> <span class="n">from</span> <span class="n">call</span> <span class="n">to</span> <span class="mo">0000</span><span class="n">c954</span><span class="p">)</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="n">op</span> <span class="mi">98009000</span><span class="p">]</span> <span class="mo">000154</span><span class="n">c9</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="n">op</span> <span class="mo">00000000</span><span class="p">]</span> <span class="mo">000</span><span class="n">a0001</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="n">op</span> <span class="mi">80084</span><span class="n">a64</span><span class="p">]</span> <span class="mf">0000f</span><span class="n">ec9</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="n">op</span> <span class="mo">0001</span><span class="n">a75c</span><span class="p">]</span> <span class="mo">00006</span><span class="mi">8</span><span class="n">b9</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="n">op</span> <span class="mi">80084</span><span class="n">a64</span><span class="p">]</span> <span class="mf">0000f</span><span class="n">ec9</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="n">op</span> <span class="n">bd0ef919</span><span class="p">]</span> <span class="mo">00015</span><span class="n">b91</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">Stack</span> <span class="n">dump</span> <span class="n">base</span> <span class="mf">800600e0</span> <span class="n">size</span> <span class="mi">2048</span> <span class="n">sp</span> <span class="mi">80060820</span><span class="o">:</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mi">80060820</span><span class="o">:</span> <span class="mo">00000001</span> <span class="mo">00006</span><span class="n">abd</span> <span class="mi">96000000</span> <span class="mo">00000000</span> <span class="n">ffffffff</span> <span class="mo">00006</span><span class="n">ac3</span> <span class="mo">0000000</span><span class="n">a</span> <span class="mo">00006</span><span class="n">bf4</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mi">80060840</span><span class="o">:</span> <span class="mo">00000000</span> <span class="mo">00000000</span> <span class="mi">80041800</span> <span class="mi">80060</span><span class="n">ab0</span> <span class="mo">000000</span><span class="mi">80</span> <span class="mi">56414</span><span class="n">c53</span> <span class="mf">50495f</span><span class="mi">45</span> <span class="n">be003155</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mi">80060860</span><span class="o">:</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mi">80060880</span><span class="o">:</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="mo">00000000</span> <span class="mo">00000000</span> <span class="mo">00000001</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mi">800608</span><span class="n">a0</span><span class="o">:</span> <span class="mo">00000001</span> <span class="mo">000154</span><span class="n">c9</span> <span class="mo">000130</span><span class="mi">9</span><span class="n">a</span> <span class="mo">0000000</span><span class="n">a</span> <span class="mo">00000000</span> <span class="mi">80041820</span> <span class="mo">00000001</span> <span class="n">ffffffff</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mi">800608</span><span class="n">c0</span><span class="o">:</span> <span class="n">ffffffff</span> <span class="mf">0000f</span><span class="n">ec9</span> <span class="mo">00000000</span> <span class="mo">00000000</span> <span class="mo">00006</span><span class="mi">8</span><span class="n">b9</span> <span class="mf">0000f</span><span class="n">ec9</span> <span class="mo">00015</span><span class="n">b91</span> <span class="n">bebebebe</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">Terminating</span> <span class="n">execution</span><span class="p">...</span>
</pre></div>
</div>
</div>
<div class="section" id="exception-dump-decoding">
<h5>10.2.4.3.6.4. Exception Dump Decoding<a class="headerlink" href="#exception-dump-decoding" title="Permalink to this headline">¶</a></h5>
<p>Some useful information that can be found in the dump is the fault address, PC address, register contents, and call stack.</p>
<p>When an error occurs, you gets a crash dump from the remote core that looks similar to the one in <a class="reference internal" href="#crash-dump">Crash Dump</a>.</p>
<p>The particular dump example above is from a MMU read fault. This dump provides important information
in helping to understand what has happened. Some of the useful parts are broken down in the following
section.</p>
<p><strong>Timestamp</strong></p>
<p>All traces (not just exception dumps) provide a timestamp for each trace. The time starts from the booting
of the remote core.</p>
<blockquote>
<div><p>[0] <strong>[ 91.045]</strong> Exception occurred at (PC) = 0000c976</p>
<p>[0] <strong>[ 91.045]</strong> CPU context: thread</p>
<p>[0] <strong>[ 91.045]</strong> BIOS Task name: {empty-instance-name} handle: 0x80060090.</p>
</div></blockquote>
<p>The timestamp information can be useful even in non-crash situations, indicating the amount of time taken
between two events. You can add traces at each event and then see when the events run.</p>
<p>For example, to check that a certain event is happening every second, put a trace at that event, then
check the timestamps to see that it is happening as expected.</p>
<p><strong>PC Address</strong></p>
<p>The PC address where the exception occurred is also provided. This can be used, in
conjunction with the map file or CCS, to identify the line of code where the exception happened.</p>
<blockquote>
<div><p>[0] [ 91.045] <strong>Exception occurred at (PC) = 0000c976</strong></p>
<p>[0] [ 91.045] CPU context: thread</p>
<p>[0] [ 91.045] BIOS Task name: {empty-instance-name} handle: 0x80060090.</p>
</div></blockquote>
<p><strong>Task Information</strong></p>
<p>The information about the task that was executing when the exception occurred is also provided.</p>
<blockquote>
<div><p>[0] [ 91.045] Exception occurred at (PC) = 0000c976</p>
<p>[0] [ 91.045] CPU context: thread</p>
<p>[0] <strong>[ 91.045] BIOS Task name: {empty-instance-name} handle: 0x80060090.</strong></p>
<p>[0] <strong>[ 91.045] BIOS Task stack base: 0x800600e0.</strong></p>
<p>[0] <strong>[ 91.045] BIOS Task stack size: 0x800.</strong></p>
</div></blockquote>
<p><strong>Fault Information</strong></p>
<p>The information about the fault is also provided. This can look different depending on the
type of exception that occurred, but often provides a fault address to identify the source of the fault.</p>
<blockquote>
<div><p>[0] [ 91.045] Exception occurred at (PC) = 0000c976</p>
<p>[0] [ 91.045] CPU context: thread</p>
<p>[0] [ 91.045] BIOS Task name: {empty-instance-name} handle: 0x80060090.</p>
<p>[0] [ 91.045] BIOS Task stack base: 0x800600e0.</p>
<p>[0] [ 91.045] BIOS Task stack size: 0x800.</p>
<p>[0] [ 91.045] <strong>[t=0x18f6df13] ti.sysbios.family.arm.m3.Hwi: ERROR: line 1078: E_hardFault: FORCED</strong></p>
<p>[0] [ 91.045] <strong>ti.sysbios.family.arm.m3.Hwi: line 1078: E_hardFault: FORCED</strong></p>
<p>[0] [ 91.045] <strong>[t=0x18f9a0cb] ti.sysbios.family.arm.m3.Hwi: ERROR: line 1155: E_busFault: PRECISERR: Immediate Bus Fault, exact addr known, address: 96000000</strong></p>
<p>[0] [ 91.045] <strong>ti.sysbios.family.arm.m3.Hwi: line 1155: E_busFault: PRECISERR: Immediate Bus Fault, exact addr known, address: 96000000</strong></p>
</div></blockquote>
<p><strong>Registers</strong></p>
<p>A dump of the register contents at the time of the exception is also provided.</p>
<img alt="../_images/RegisterDump.PNG" src="../_images/RegisterDump.PNG" />
<p><strong>Stack Trace</strong></p>
<p>The stack trace is also provided (see Figure 6). This can be used in conjunction with the source code and
the map file or CCS to get more information about what was executing at the time of the crash.</p>
<img alt="../_images/StackTraceDump.PNG" src="../_images/StackTraceDump.PNG" />
</div>
<div class="section" id="mmu-faults">
<h5>10.2.4.3.6.5. MMU Faults<a class="headerlink" href="#mmu-faults" title="Permalink to this headline">¶</a></h5>
<p>MMU faults occur when an address that is not mapped to the remote core MMU is accessed. This can be
due to a read, write, or an attempt to execute the address. When an MMU fault occurs, a crash dump from
the remote core occurs that looks similar to the example provided in <a class="reference internal" href="#crash-dump">Crash Dump</a>.</p>
<p>Some debugging techniques, as well as common times when an MMU fault occurs, are given as
examples in the following sections.</p>
<p><strong>Using CCS to Halt the Code When the Fault Happens</strong></p>
<p>If the fault always happens at the same address, pre-map the location and then set up CCS with a
breakpoint for that address. In this way, you can view the state of the remote core when the fault happens
and see the call stack. From there, put a breakpoint at the surrounding code and step through to see
where the fault happens.</p>
<p>Pre-mapping the address can be done either through the remote core resource table, or through CCS.
With CCS, you can connect to the debug DAP and then bring up a memory window to inspect the MMU
registers. Directly program the MMU from here to map some unused memory to the fault address location.</p>
<p>For example:</p>
<ul class="simple">
<li>MMU CAM: 0x9600000E (Change the most significant 20 bits here to match the fault address. For example, it would be 96000 if the fault address is 0x96000010)</li>
<li>MMU RAM: 0xBA300000 (Change the most significant 20 bits here to match an unused 4-KB physical region in the memory map)</li>
<li>MMU Lock: 0x00000400</li>
<li>MMU LD: 0x00000001</li>
</ul>
<p><strong>Using the Crash Dump to Find the Location of the Fault</strong></p>
<p>The crash dump call stack can indicate where the crash occurred. Using that information, connect to the
remote core with CCS and put a breakpoint in the code at the most recent function in the call stack before
the crash. From there, step through the code until the crash happens.</p>
<p><strong>Example – Accessing a Memory Region That is Not Mapped</strong></p>
<p>When using the L2 MMU, every address accessed by the remote core must be mapped. An attempt to
access an un-mapped address results in an MMU fault. The following example explores the crash dump of
an access to an un-mapped area.</p>
<p>Here is an example fault dump:</p>
<img alt="../_images/StackTraceDump2.PNG" src="../_images/StackTraceDump2.PNG" />
<p>From the crash dump, the fault address is 0x96000000. The address will not be found in the resource
table, which is why the fault occurred.</p>
<p>Avoid hard-coding of virtual addresses for peripherals and memory blocks with a one-time physical to
virtual address lookup using the resource table. There is an API available for this called
Resource_physToVirt() in the resource module. This alerts that the address is not mapped in the resource
table when the translation fails.</p>
<p>From here, either use the crash dump to see the PC and call stack or follow the instructions under the section &#8220;Using CCS to Halt the Code When the Fault Happens.&#8221; Error recovery, watchdog timers, and remoteproc autosuspend
may need to be disabled to connect CCS. See <a class="reference internal" href="#linux-and-android-disabling-error-recovery">Linux and Android - Disabling Error Recovery</a>, <a class="reference internal" href="#linux-and-android-disabling-watchdog">Linux and Android – Disabling Watchdog</a>, and <a class="reference internal" href="#linux-and-android-disabling-remoteproc-auto-suspend">Linux and Android - Disabling Remoteproc Auto-Suspend</a> for more
information on disabling these.</p>
<p>For this example, use the PC address which, as seen in the crash dump, is at 0xcfa6</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">107.092</span><span class="p">]</span> <span class="n">Exception</span> <span class="n">occurred</span> <span class="n">at</span> <span class="p">(</span><span class="n">PC</span><span class="p">)</span> <span class="o">=</span> <span class="mo">0000</span><span class="n">cfa6</span>
</pre></div>
</div>
<p>Find the corresponding function by looking this address up in the map file for the remote core image. If the
PC address is invalid due to an issue such as stack corruption, then this may not yield useful results. In
this case, something useful is found:</p>
<img alt="../_images/SourceInsightCrashDump.PNG" src="../_images/SourceInsightCrashDump.PNG" />
<p>Alternatively, use CCS to see the location of the fault. If CCS was already connected to the remote core
before the fault happened, the core will have halted in the abort function. From here, directly set the PC
address and see the line that caused the fault:</p>
<img alt="../_images/CCSFault.PNG" src="../_images/CCSFault.PNG" />
<p>Use this technique at any time after booting the remote core to see what a PC address corresponds to. It
will display the line that caused the error. This may, however, prevent proper execution because the
registers and call stack won’t have proper values.</p>
<p>You can now isolate the particular line in the fxnFault() function that was executing. That code is found in
the file &lt;ipc_package&gt;/packages/ti/ipc/tests/fault.c:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">case</span> <span class="mi">1</span>:
        <span class="n">System_printf</span><span class="p">(</span><span class="s">&quot;Generating read MMU Fault...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">a</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="mh">0x96000000</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
</pre></div>
</div>
<p>Figure 8 clearly shows what caused the fault in this code, but when it is not clear, use CCS to see the fault in action. Once connected and the symbols are loaded, put a breakpoint in this function (if this function does not happen often). Once the breakpoint is hit, step through the code to find what is causing the fault.</p>
<p>Upon stepping through, observe that the variable, a, is being set to the contents of 0x96000000, which is
equal to the fault address. This is the fault in this example.</p>
<p>Next, decide if this is a valid value that needs mapping, or if this is an invalid value that passed due to
some error in the code. If it is still not known where the value is coming from, use CCS to trace it back
through the call stack to fix the code. If it turns out that the address is an address that must be accessible to the remote core, then map it through the resource table to the appropriate physical memory.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="evm-hardware-setup">
<h1>10.3. EVM Hardware Setup<a class="headerlink" href="#evm-hardware-setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="am65x-evm">
<h2>10.3.1. AM65x EVM<a class="headerlink" href="#am65x-evm" title="Permalink to this headline">¶</a></h2>
<div class="section" id="evm-layout-and-key-components">
<h3>10.3.1.1. EVM Layout and Key Components<a class="headerlink" href="#evm-layout-and-key-components" title="Permalink to this headline">¶</a></h3>
<p>Refer to the image below which highlights the key components available on the AM65x EVM.</p>
<img alt="../_images/AM65x_IDK_Diagram.png" src="../_images/AM65x_IDK_Diagram.png" />
<p>The complete feature set for the AM65x EVM is described in AM65x EVM User Manual. This section only provides description
of components that are required to complete basic EVM setup for debugging code using an emulator and Code Composer Studio.</p>
<div class="section" id="supported-jtag-debug-probes-emulators">
<h4>10.3.1.1.1. Supported JTAG Debug Probes (Emulators)<a class="headerlink" href="#supported-jtag-debug-probes-emulators" title="Permalink to this headline">¶</a></h4>
<p>The AM65x EVM includes a cTI20 JTAG connector for external emulators and a micro USB connector for the on-board XDS110 emulator.</p>
<p>For XDS110 connect a USB cable to the micro USB connector J23 on the front of the board.</p>
<p>For external XDS200, connect the emulator to the cTI20 pin connector.</p>
<p>For Lauterbach or emulators with MIPI60 or TI14 pin connector, an adapter must be used to connect the emulator.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not connect an XDS560 emulator to the J16 application board connector. This may damage the EVM and the emulator pod.</p>
</div>
<a class="reference internal image-reference" href="../_images/AM65x_JTAG.png"><img alt="../_images/AM65x_JTAG.png" src="../_images/AM65x_JTAG.png" style="width: 600px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>If you are using an external emulator pod, you must select which connector sources the clock. The AM65x EVM can support the MIPI60 or cTI20 connector. The JTAG select jumper must be set correctly to specify the clock source as either the MIPI60 or the cTI20 connector.</p>
<img alt="../_images/AM65x_Clock_Select.png" src="../_images/AM65x_Clock_Select.png" />
</div>
<div class="section" id="bootmode-switches">
<h4>10.3.1.1.2. BOOTMODE Switches<a class="headerlink" href="#bootmode-switches" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/AM65x_Boot_Modes.png" src="../_images/AM65x_Boot_Modes.png" />
<p><strong>MCU BOOTMODE shown:</strong></p>
<p>MCUBOOTMODE[8:0] – <strong>0000</strong> 10 <strong>011</strong></p>
<p>Values in bold are fixed with resistors.</p>
<p><strong>BOOTMODE shown:</strong></p>
<p>BOOTMODE[18:0] - 1111111000011110000</p>
<div class="section" id="recommended-boot-mode">
<h5>10.3.1.1.2.1. Recommended Boot Mode<a class="headerlink" href="#recommended-boot-mode" title="Permalink to this headline">¶</a></h5>
<p>BOOTMODE[18:0] = 000000000 0000000000  MCUBOOTMODE[8:0]= 000000011 (SLEEP BOOT)</p>
<dl class="docutils">
<dt><strong>Boot Settings</strong></dt>
<dd><ul class="first last simple">
<li>SW2 – All switches OFF</li>
<li>SW3 – All switches OFF</li>
</ul>
</dd>
</dl>
<p>BOOTMODE[18:0] = 000000100 0000000110     MCUBOOTMODE[8:0]= 000000011 (SD BOOT)</p>
<img alt="../_images/AM65x_Boot_Switches.png" src="../_images/AM65x_Boot_Switches.png" />
<p>For full details on supported boot modes, please refer to the table below.</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">SW3.4</th>
<th class="head">SW3.3</th>
<th class="head">SW3.2</th>
<th class="head">SW3.1</th>
<th class="head">Primary Boot Device Selected</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>OFF</td>
<td>OFF</td>
<td>OFF</td>
<td>OFF</td>
<td>Sleep (No boot - debug mode)</td>
</tr>
<tr class="row-odd"><td>OFF</td>
<td>OFF</td>
<td>OFF</td>
<td>ON</td>
<td>OSPI</td>
</tr>
<tr class="row-even"><td>OFF</td>
<td>OFF</td>
<td>ON</td>
<td>OFF</td>
<td>QSPI</td>
</tr>
<tr class="row-odd"><td>OFF</td>
<td>OFF</td>
<td>ON</td>
<td>ON</td>
<td>Hyperflash</td>
</tr>
<tr class="row-even"><td>OFF</td>
<td>ON</td>
<td>OFF</td>
<td>OFF</td>
<td>SPI (on QSPI/OSPI port 0 in legacy SPI mode)</td>
</tr>
<tr class="row-odd"><td>OFF</td>
<td>ON</td>
<td>OFF</td>
<td>ON</td>
<td>I2C</td>
</tr>
<tr class="row-even"><td>OFF</td>
<td>ON</td>
<td>ON</td>
<td>OFF</td>
<td>MMC/SD card, eMMC boot from UDA or file system</td>
</tr>
<tr class="row-odd"><td>OFF</td>
<td>ON</td>
<td>ON</td>
<td>ON</td>
<td>Ethernet</td>
</tr>
<tr class="row-even"><td>ON</td>
<td>OFF</td>
<td>OFF</td>
<td>OFF</td>
<td>USB</td>
</tr>
<tr class="row-odd"><td>ON</td>
<td>OFF</td>
<td>OFF</td>
<td>ON</td>
<td>PCIe</td>
</tr>
<tr class="row-even"><td>ON</td>
<td>OFF</td>
<td>ON</td>
<td>OFF</td>
<td>UART</td>
</tr>
<tr class="row-odd"><td>ON</td>
<td>OFF</td>
<td>ON</td>
<td>ON</td>
<td>Reserved</td>
</tr>
<tr class="row-even"><td>ON</td>
<td>ON</td>
<td>OFF</td>
<td>OFF</td>
<td>GPMC XIP</td>
</tr>
<tr class="row-odd"><td>ON</td>
<td>ON</td>
<td>OFF</td>
<td>ON</td>
<td>eMMC boot from boot partition (with auto-fall back to file system)</td>
</tr>
<tr class="row-even"><td>ON</td>
<td>ON</td>
<td>ON</td>
<td>OFF</td>
<td>Reserved (acts as no boot)</td>
</tr>
<tr class="row-odd"><td>ON</td>
<td>ON</td>
<td>ON</td>
<td>ON</td>
<td>Reserved (acts as no boot)</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On the AM65x EVM, ensure that the PLL configuration is set to 25 MHz (see bolded line in table below).</p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Bit 2</th>
<th class="head">Bit 1</th>
<th class="head">Bit 0</th>
<th class="head">PLL REF CLK (MHz)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>0</td>
<td>0</td>
<td>Sleep (No boot - debug mode)</td>
</tr>
<tr class="row-odd"><td>0</td>
<td>0</td>
<td>1</td>
<td>20</td>
</tr>
<tr class="row-even"><td>0</td>
<td>1</td>
<td>0</td>
<td>24</td>
</tr>
<tr class="row-odd"><td><strong>0</strong></td>
<td><strong>1</strong></td>
<td><strong>1</strong></td>
<td><strong>25</strong></td>
</tr>
<tr class="row-even"><td>1</td>
<td>0</td>
<td>0</td>
<td>26</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>0</td>
<td>1</td>
<td>27</td>
</tr>
<tr class="row-even"><td>1</td>
<td>1</td>
<td>0</td>
<td>Reserved</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>1</td>
<td>1</td>
<td>No PLL Configuration Done (slow speed backup)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="uart-connection">
<h4>10.3.1.1.3. UART Connection<a class="headerlink" href="#uart-connection" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Connect a micro USB cable between UART port (J42) of the EVM and host PC.</li>
<li>Open a serial console (e.g. Tera Term) on host PC, connect to COM port on which SOC UART0 port is connected. Four COM ports should appear in the serial console application. Connect to the first COM port in the list.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>First COM port – SoC MAIN UART0</li>
<li>Second COM port – MCU UART</li>
<li>Third COM port – Wakeup UART</li>
<li>Fourth COM port – SoC MAIN UART1</li>
</ul>
</div></blockquote>
<img alt="../_images/AM65x_Tera_Term.png" src="../_images/AM65x_Tera_Term.png" />
<ol class="arabic simple" start="3">
<li>Open a serial console (e.g Tera Term) on host PC, connect to COM port on which EVM UART port is connected and set the following configuration.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>Baud rate - 115200</li>
<li>Data length - 8 bit</li>
<li>Parity - None</li>
<li>Stop bits - 1</li>
<li>Flow control - None</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="powering-the-evm">
<h4>10.3.1.1.4. Powering the EVM<a class="headerlink" href="#powering-the-evm" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="30%" />
<col width="27%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Connector</th>
<th class="head">Specifications</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Power DIN, 4-pin</td>
<td>24VDC, 5A Output (Max)</td>
<td>CUI Inc.SDI120-24-U-P51</td>
</tr>
<tr class="row-odd"><td>Barrel Plug, 2.5mm I.D x 5.5mm
O.D x 9.55</td>
<td>12-24VDC, positive center,
2.71A Output (Max)</td>
<td>CUI Inc. SDI65-24UD-P6</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The DIN connector power supply is recommended to provide enough power for applications that make use of the PCIe interface.</p>
</div>
</div>
</div>
<div class="section" id="minimum-hardware-setup-required-to-connect-to-evm">
<h3>10.3.1.2. Minimum Hardware Setup Required to Connect to EVM<a class="headerlink" href="#minimum-hardware-setup-required-to-connect-to-evm" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="arabic simple">
<li>Connect micro USB cable to J23 and connect USB to Host PC on which CCS is installed.</li>
<li>Connect micro USB cable to J42 for UART serial IO.</li>
<li>Set boot switches to &#8220;Sleep Boot&#8221; or &#8220;SD Boot&#8221; as described in the BOOT Switches section.</li>
<li>Connect power supply to DC jack and power on EVM.</li>
<li>Set switches and jumpers as indicated below.</li>
</ol>
</div></blockquote>
<dl class="docutils">
<dt><strong>Boot Settings</strong></dt>
<dd><ul class="first last simple">
<li>SW2 - All switches OFF</li>
<li>SW3 - All switches OFF</li>
</ul>
</dd>
<dt><strong>Jumpers</strong></dt>
<dd><ul class="first last simple">
<li>J4 – Short all the pins</li>
<li>JP37 – Short pins 1 &amp; 2</li>
<li>J43 - Short pins 1 &amp; 2</li>
<li>J8 – Short pins 1 &amp; 2</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="am65x-debug-software-setup">
<h3>10.3.1.3. AM65x Debug Software Setup<a class="headerlink" href="#am65x-debug-software-setup" title="Permalink to this headline">¶</a></h3>
<p>The following software packages are required to setup the AM65x EVM</p>
<ul class="simple">
<li>Code Composer Studio IDE Environment</li>
<li>Processor SDK RTOS for AM65xx</li>
</ul>
<div class="section" id="ccs-host-setup">
<h4>10.3.1.3.1. CCS Host Setup<a class="headerlink" href="#ccs-host-setup" title="Permalink to this headline">¶</a></h4>
<p>1. Download CCS from the following link:
<a class="reference external" href="http://processors.wiki.ti.com/index.php/Download_CCS">http://processors.wiki.ti.com/index.php/Download_CCS</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Check the <a class="reference external" href="http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_release_specific.html#release-notes">Processor SDK Release Notes</a> for the recommended CCS version.</p>
</div>
<p>Ensure that at least &#8220;Sitara AMx Processors&#8221; is selected:</p>
<blockquote>
<div><img alt="../_images/AM65x_CCS_Install.png" src="../_images/AM65x_CCS_Install.png" />
</div></blockquote>
<div class="section" id="install-the-latest-emulation-package-and-device-support-package">
<h5>10.3.1.3.1.1. Install the latest Emulation Package and Device Support Package<a class="headerlink" href="#install-the-latest-emulation-package-and-device-support-package" title="Permalink to this headline">¶</a></h5>
<p>1. In CCS, navigate to Help -&gt; Check for Updates and select &#8220;Sitara device support&#8221;
and &#8220;TI Emulators&#8221; and click Next.</p>
<blockquote>
<div><img alt="../_images/CCS_Check_for_Updates.PNG" src="../_images/CCS_Check_for_Updates.PNG" />
</div></blockquote>
<p>2. Click &#8220;Next&#8221; again, select &#8220;I accept the terms of the license agreements&#8221;
and click Finish to begin the installation.</p>
<blockquote>
<div><img alt="../_images/CCS_Updating_Software.png" src="../_images/CCS_Updating_Software.png" />
</div></blockquote>
<p>3. You may be prompted to restart CCS for the updates to take effect. Click &#8220;Restart Now&#8221; when
prompted to complete the installation.</p>
<p><strong>Disable Automatic Updates</strong></p>
<p>To disable automatic updates in CCS, navigate to Windows -&gt; Preferences -&gt; Install/Update -&gt; Automatic Updates, and uncheck &#8220;Automatically find new updates and notify me.&#8221;</p>
<p>This is a precautionary step to avoid automatic updates overwriting files updated through TI Emulation Updates for AM65x</p>
</div>
</div>
<div class="section" id="basic-ccs-setup">
<h4>10.3.1.3.2. Basic CCS Setup<a class="headerlink" href="#basic-ccs-setup" title="Permalink to this headline">¶</a></h4>
<p>The Basic CCS setup is similar to earlier Sitara devices which involves creation of target configuration and connecting
to cores using the GEL files. This step is suitable for new board bring up and getting hello world going on the AM65x cores.</p>
<p>Users can use this setup for benchmarking code on cores, test basic pin functionality or to run diagnostics. However, multi-core application developers
requiring resource management, power management or security services will require the advanced CCS setup in addition to the basic core setup.</p>
<p>We recommend that you follow the steps in basic setup and then migrate to the advanced SOC CCS setup for application development.</p>
<div class="section" id="creating-the-target-configuration">
<h5>10.3.1.3.2.1. Creating the Target Configuration<a class="headerlink" href="#creating-the-target-configuration" title="Permalink to this headline">¶</a></h5>
<ol class="arabic simple">
<li>In CCS, open the Target Configurations window by navigating to View -&gt; Target Configurations.</li>
<li>In Target Configurations, right click and select &#8220;New Target Configuration.&#8221;</li>
<li>Populate the Target Configuration File name, set the location, and click Finish.</li>
</ol>
<blockquote>
<div><img alt="../_images/AM65x_Target_Configuration.png" src="../_images/AM65x_Target_Configuration.png" />
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Select &#8220;Texas Instruments XDS110 USB Debug Probe&#8221; for the Connection and &#8220;GPEVM_AM65x&#8221; for the Board or Device.</li>
</ol>
<blockquote>
<div><img alt="../_images/AM65x_Target_Configuration2.png" src="../_images/AM65x_Target_Configuration2.png" />
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The GEL files are automatically populated in the Target Configuration when selecting an EVM instead of an SOC. The SOC option is generally used for custom board bring up or secondary boot debugging.</p>
</div>
<ol class="arabic simple" start="5">
<li>Navigate to the &#8220;Advanced&#8221; tab to ensure the GEL files are populated in the &#8220;initialization script&#8221; field for the various cores.</li>
</ol>
<blockquote>
<div><img alt="../_images/AM65x_Target_Configuration3.png" src="../_images/AM65x_Target_Configuration3.png" />
</div></blockquote>
<p>The initialization script for the Cortex M3 will setup the MCU domain and Main domain PLL clocks, PSC registers, and bring the R5 and Cortex A53 cores out of reset.</p>
<p>The initialization script for the Cortex A53 and Cortex R5 will perform a similar step to setup the DDR clocks and initialize DDR from the cores if required.</p>
<ol class="arabic simple" start="6">
<li>Save the Target Configuration.</li>
</ol>
<blockquote>
<div><img alt="../_images/AM65x_Target_Configuration4.png" src="../_images/AM65x_Target_Configuration4.png" />
</div></blockquote>
</div>
<div class="section" id="connecting-to-the-cores-on-am65x">
<h5>10.3.1.3.2.2. Connecting to the Cores on AM65x<a class="headerlink" href="#connecting-to-the-cores-on-am65x" title="Permalink to this headline">¶</a></h5>
<p>1. <strong>Launch Target Configuration</strong>
In CCS Editor View, go to View -&gt; Target Configuration, and right click on the configuration that was created in the previous section and select &#8220;Launch Selected Configuration.&#8221;</p>
<ol class="arabic simple" start="2">
<li><strong>Connect to DMSC_Cortex_M3</strong></li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When connecting to the M3 core for the first time, you may be prompted with a firmware update. Please click &#8220;Update&#8221; to update the emulator firmware.</p>
</div>
<img alt="../_images/AM65x_FW_Update.png" src="../_images/AM65x_FW_Update.png" />
<p>On AM65x DMSC_Cortex_M3 is the boot master and is the first core that wakes up and starts the R5F ROM. Upon launching the target configuration, <strong>connect to DMSC_Cortex_M3 first</strong>, as this will automatically perform the PSC and PLL initialization. The following GEL output will appear in the CCS Console:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Configuring</span> <span class="n">AM65xEVM</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Init</span> <span class="n">value</span> <span class="n">actual</span> <span class="n">value</span><span class="o">:</span> <span class="mh">0x00000888</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Register</span> <span class="n">value</span><span class="o">:</span> <span class="mh">0x00000888</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">ATCM</span> <span class="n">is</span> <span class="n">on</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">ATCM</span> <span class="n">configured</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Assuming</span> <span class="n">execution</span> <span class="n">from</span> <span class="n">M3</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">This</span> <span class="n">script</span> <span class="n">sets</span> <span class="n">the</span> <span class="n">first</span> <span class="n">address</span> <span class="n">translation</span> <span class="n">region</span> <span class="n">to</span> <span class="p">[</span><span class="mh">0x8000</span><span class="n">_0000</span><span class="p">,</span> <span class="mh">0x0000</span><span class="n">_0000</span><span class="p">].</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">It</span> <span class="n">also</span> <span class="n">sets</span> <span class="n">the</span> <span class="n">second</span> <span class="n">address</span> <span class="n">translation</span> <span class="n">region</span> <span class="n">to</span>    <span class="p">[</span><span class="mh">0x6000</span><span class="n">_0000</span><span class="p">,</span> <span class="mh">0x4000</span><span class="n">_0000</span><span class="p">].</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Setting</span> <span class="n">all</span> <span class="n">PLLs</span> <span class="n">in</span> <span class="n">progress</span><span class="p">.</span> <span class="n">This</span> <span class="n">may</span> <span class="n">take</span> <span class="n">some</span> <span class="n">time</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">0</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">10</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">20</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">30</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">40</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">50</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">60</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">70</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">80</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">90</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Setting</span> <span class="n">all</span> <span class="n">PLLs</span> <span class="n">done</span><span class="o">!</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">all</span> <span class="n">PSC</span> <span class="n">power</span> <span class="n">domains</span> <span class="n">in</span> <span class="n">progress</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_WKUP_COMMON</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_DMSC</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_WKUP2MCU</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_WKUP2MAIN_INFRA</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_DEBUG2DMSC</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_WKUP_GPIO</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU2MAIN_INFRA</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU2MAIN</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU2WKUP</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MAIN2MCU</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_COMMON</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_TEST</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_MCAN_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_MCAN_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_OSPI_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_OSPI_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_HYPERBUS</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_DEBUG</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_R5_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_R5_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MAIN_INFRA</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MAIN_TEST</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MAIN_PBIST</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_CC_TOP</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_A53_CLUSTER_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_A53_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span>  <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_A53_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_A53_CLUSTER_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_A53_2</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_A53_3</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MAIN_DEBUG</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_DSS</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MMC</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_CAL</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_PCIE_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_PCIE_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_USB_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_USB_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_SAUL</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_PER_COMMON</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_NB</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_SERDES_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_SERDES_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_ICSSG_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_ICSSG_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_ICSSG_2</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_GPU</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_EMIF_DATA</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_EMIF_CFG</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">all</span> <span class="n">PSC</span> <span class="n">power</span> <span class="n">domains</span> <span class="n">done</span><span class="o">!</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>3. <strong>Connect to Cortex A53 or Cortex R5F</strong>
Users must now connect to either the Cortex A53 (CortexA53_0_0) or Cortex R5 (MCU_PULSAR_Cortex_R5_0). The following GEL output will appear in the CCS console when connecting to the Cortex A53:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">VTT</span> <span class="n">Regulator</span> <span class="n">Enabled</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">PHY</span> <span class="n">Init</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x8000000F</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">DRAM</span> <span class="n">Init</span> <span class="n">to</span> <span class="n">complete</span><span class="p">...</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DRAM</span> <span class="n">Init</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x8000001F</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">write</span> <span class="n">leveling</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Write</span> <span class="n">leveling</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x8000003F</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">checking</span> <span class="n">status</span> <span class="n">per</span> <span class="n">byte</span><span class="p">...</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX0GSR0</span> <span class="o">=</span> <span class="mh">0x00932420</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX1GSR0</span> <span class="o">=</span> <span class="mh">0x009224A0</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX2GSR0</span> <span class="o">=</span> <span class="mh">0x00992620</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX3GSR0</span> <span class="o">=</span> <span class="mh">0x009825A0</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">Read</span> <span class="n">DQS</span> <span class="n">training</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Read</span> <span class="n">DQS</span> <span class="n">training</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x8000007F</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">checking</span> <span class="n">status</span> <span class="n">per</span> <span class="n">byte</span><span class="p">...</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX0RSR0</span> <span class="o">=</span> <span class="mh">0x00000000</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX1RSR0</span> <span class="o">=</span> <span class="mh">0x00000000</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX2RSR0</span> <span class="o">=</span> <span class="mh">0x00000000</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX3RSR0</span> <span class="o">=</span> <span class="mh">0x00000000</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">Write</span> <span class="n">leveling</span> <span class="n">adjustment</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Write</span> <span class="n">leveling</span> <span class="n">adjustment</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x800000FF</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">Read</span> <span class="n">deskew</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Read</span> <span class="n">deskew</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x800001FF</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">Write</span> <span class="n">deskew</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Write</span> <span class="n">deskew</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x800003FF</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">Read</span> <span class="n">Eye</span> <span class="n">training</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Read</span> <span class="n">Eye</span> <span class="n">training</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x800007FF</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">Write</span> <span class="n">Eye</span> <span class="n">training</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Write</span> <span class="n">Eye</span> <span class="n">training</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x80000FFF</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">VREF</span> <span class="n">training</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">VREF</span> <span class="n">training</span> <span class="n">complete</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x80004FFF</span>
<span class="nl">CortexA53_0_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>

<span class="o">====</span>

<span class="n">DDR4</span> <span class="n">Initialization</span> <span class="n">has</span> <span class="n">PASSED</span><span class="o">!!!!</span>

<span class="o">====</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The same GEL output will be shown if connecting to the Cortex R5 first instead of the Cortex A53.</p>
<ol class="arabic simple" start="4">
<li>The EVM is now completely initialized to load and run code on the cores and access the full device address range. User level software is responsible to configure the pin multiplexing and peripheral configuration.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="advanced-am65x-debug-setup-with-dmsc-firmware-load">
<h4>10.3.1.3.3. Advanced AM65x Debug Setup with DMSC Firmware Load<a class="headerlink" href="#advanced-am65x-debug-setup-with-dmsc-firmware-load" title="Permalink to this headline">¶</a></h4>
<p><strong>Description</strong></p>
<p>AM65x EVM users testing basic functionality like R5F and A53 bring up and DDR configuration can use the basic setup described in the previous section for setting up the EVM. However, advanced application level debug that uses resource management for UDMAs, interrupt setup, power management to setup clock modules, or wakeup/power of slave cores will require loading of SYSFW (DMSC Firmware) on the M3 core so that the application can make API calls to leverage its services.</p>
<p>To load the SYSFW firmware, the DMSC ROM expects R5F secondary bootloader/application to provide board configuration message to initialize the cores and SOC services. The R5F application provided in SciClient  uses a default board configuration message to the SYSFW and sets up the device for application debugging.</p>
<p>For more details, refer to the Initialization Chapter in the TRM and the SciClient User guide.</p>
<p><strong>Additional Software Dependency</strong></p>
<blockquote>
<div><ul class="simple">
<li>Processor SDK RTOS for AM65x</li>
</ul>
</div></blockquote>
<p>Users are required to install Processor SDK RTOS to obtain the SciClient component package before proceeding to the Next Step.</p>
<p>After installing Processor SDK RTOS, users should locate the latest R5F CCS init app, SYSFW binary, and the debug server script within the following directory:</p>
<p>${PDK_INSTALL_PATH}/packages/ti/drv/sciclient/tools/ccsLoadDmsc</p>
<p>The following files are provided as part for the SciClient tools:</p>
<blockquote>
<div><ul class="simple">
<li>launch_am65xx.js: CCS Debug Server script to perform on target connect and load DMSC firmware and R5F CCS Init app.</li>
</ul>
<p><strong>Location:</strong>: ${PDK_INSTALL_PATH}/packages/ti/drv/sciclient/tools/ccsLoadDmsc</p>
<ul class="simple">
<li>sciclient_ccs_init_mcu1_0_release.xer5f: R5F Application with default board config</li>
</ul>
<p><strong>Location:</strong>: ${PDK_INSTALL_PATH}/packages/ti/drv/sciclient/tools/ccsLoadDmsc/am65xx</p>
<ul class="simple">
<li>ti-sci-firmware-am6x-gp.bin: TISCI SYSFW binary loaded on the DMSC</li>
</ul>
<p><strong>Location:</strong>: ${PDK_INSTALL_PATH}/packages/ti/drv/sciclient/src/V0</p>
</div></blockquote>
<p>AM65x Advanced Debug Script Flow</p>
<img alt="../_images/AM65x_Advanced_Flow.png" src="../_images/AM65x_Advanced_Flow.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="creating-debug-configuration-to-integrate-ccs-gel-and-dmsc-firmware-initialization">
<h5>10.3.1.3.3.1. Creating Debug Configuration to Integrate CCS GEL and DMSC Firmware Initialization<a class="headerlink" href="#creating-debug-configuration-to-integrate-ccs-gel-and-dmsc-firmware-initialization" title="Permalink to this headline">¶</a></h5>
<p>With the intent to maintain the same CCS target connect flow as existing devices, we provide a Debug Server Script (DSS) that users can link to in their target configuration to allow for loading SYSFW firmware on the DMSC as part of the target connect process.</p>
<p>The DSS script allows users to perform all of the initialization using a single click. When the script is run, the following actions happens sequentially:</p>
<ol class="arabic simple">
<li>Running On Target Connect M3 existing GEL scripts.</li>
<li>Loading the DMSC firmware <tt class="docutils literal"><span class="pre">*</span></tt>.bin file to DMSC M3.</li>
<li>Run the R5F Init code which performs the board configuration initialization.</li>
</ol>
<p>At the end of the setup, the R5F and A53 are in a clean state to load code and debug the application with the SYSFW loaded on the M3 core.</p>
<p><strong>Steps to Link and Run the DSS Script for DMSC Firmware Loading</strong></p>
<ol class="arabic simple">
<li>Update the file &#8220;pdk/packages/ti/drv/sciclient/tools/ccsLoadDmsc/launch_am65xx.js&#8221; for the following variable to your PC location:</li>
</ol>
<blockquote>
<div><div class="highlight-c"><div class="highlight"><pre>     <span class="c1">//&lt;!!!!!! EDIT THIS !!!!!&gt;</span>
     <span class="c1">// Set this to 1 to allow loading the GEL files directly from the ccxml file.</span>
     <span class="n">disableGelLoad</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">disableGelLoad</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
     <span class="p">{</span>
     <span class="c1">//Path to GEL files</span>
<span class="hll">     <span class="n">gelFilePath</span> <span class="o">=</span> <span class="s">&quot;C:/ti/ccsv8/ccs_base/emulation/gel/AM65xEVM&quot;</span><span class="p">;</span>
</span>     <span class="p">}</span>
     <span class="c1">// Path to the directory in which this file would be residing. CCS expects</span>
     <span class="c1">// absolute paths to load the binaries.</span>
<span class="hll">     <span class="n">thisJsFileDirectory</span> <span class="o">=</span> <span class="s">&quot;pdk/packages/ti/drv/sciclient/tools/ccsLoadDmsc&quot;</span><span class="p">;</span>
</span>     <span class="c1">//&lt;!!!!!! EDIT THIS !!!!!&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>Set disableGelLoad =1 if GEL files is linked to the cores in the target configuration file.</li>
<li>The variable &#8220;gelFilePath&#8221; doesn&#8217;t need to be updated if CCS is installed in the default C:/ti/ directory.</li>
<li>The variable &#8220;thisJsFileDirectory&#8221; needs to be updated to point to the PDK install directory.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Connect the Javascript to the CCXML file with the steps shown below.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This step needs to be repeated if you switch workspaces or clean your workspace.</p>
</div>
<p>In the debug view after completing the basic CCS setup, Click on Debug Configurations from the button as show below:</p>
<img alt="../_images/CCS_Debug_Config.png" src="../_images/CCS_Debug_Config.png" />
<p>Select the CCXML file from the left-hand side and populate the path to the launch_am65xx.js file in the &#8220;Initialization Script&#8221; free form field and click on &#8220;Apply&#8221;.</p>
<img alt="../_images/CCS_Debug_XML.png" src="../_images/CCS_Debug_XML.png" />
<p>Once you Launch the CCXML file, the java script will automatically run and connect to R5F.</p>
<p><strong>Steps to re-run the script once ccxml is already launched:</strong></p>
<p>In the CCS window, navigate to &#8220;View → Scripting Console.&#8221;</p>
<p>In the CCS Scripting Console, type:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="o">&gt;</span>  <span class="n">load</span> <span class="p">(</span><span class="s">&quot;&lt;Your Path&gt;</span><span class="se">\\</span><span class="s">launch_am65xx.js&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This would give the following output on the scripting console:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="nl">js:</span><span class="o">&gt;</span> <span class="n">load</span><span class="p">(</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">Users</span><span class="se">\\</span><span class="s">User</span><span class="se">\\</span><span class="s">Documents</span><span class="se">\\</span><span class="s">PDK</span><span class="se">\\</span><span class="s">pdk</span><span class="se">\\</span><span class="s">packages</span><span class="se">\\</span><span class="s">ti</span><span class="se">\\</span><span class="s">drv</span><span class="se">\\</span><span class="s">sciclient</span><span class="se">\\</span><span class="s">tools</span><span class="se">\\</span><span class="s">ccsLoadDmsc</span><span class="se">\\</span><span class="s">launch_am65xx.js&quot;</span><span class="p">)</span>
<span class="n">Connecting</span> <span class="n">to</span> <span class="n">DMSC_Cortex_M3_0</span><span class="o">!</span>
<span class="n">Loading</span> <span class="n">DMSC</span> <span class="n">Firmware</span><span class="p">...</span>
<span class="n">DMSC</span> <span class="n">Firmware</span> <span class="n">Load</span> <span class="n">Done</span><span class="p">...</span>
<span class="n">DMSC</span> <span class="n">Firmware</span> <span class="n">run</span> <span class="n">starting</span> <span class="n">now</span><span class="p">...</span>
<span class="n">Connecting</span> <span class="n">to</span> <span class="n">MCU</span> <span class="n">Cortex_R5_0</span><span class="o">!</span>
</pre></div>
</div>
<p>GEL Output Log:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Configuring</span> <span class="n">AM65xEVM</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Init</span> <span class="n">value</span> <span class="n">actual</span> <span class="n">value</span><span class="o">:</span> <span class="mh">0x00000888</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Register</span> <span class="n">value</span><span class="o">:</span> <span class="mh">0x00000888</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">ATCM</span> <span class="n">is</span> <span class="n">on</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">ATCM</span> <span class="n">configured</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Assuming</span> <span class="n">execution</span> <span class="n">from</span> <span class="n">M3</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">This</span> <span class="n">script</span> <span class="n">sets</span> <span class="n">the</span> <span class="n">first</span> <span class="n">address</span> <span class="n">translation</span> <span class="n">region</span> <span class="n">to</span> <span class="p">[</span><span class="mh">0x8000</span><span class="n">_0000</span><span class="p">,</span> <span class="mh">0x0000</span><span class="n">_0000</span><span class="p">].</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">It</span> <span class="n">also</span> <span class="n">sets</span> <span class="n">the</span> <span class="n">second</span> <span class="n">address</span> <span class="n">translation</span> <span class="n">region</span> <span class="n">to</span>    <span class="p">[</span><span class="mh">0x6000</span><span class="n">_0000</span><span class="p">,</span> <span class="mh">0x4000</span><span class="n">_0000</span><span class="p">].</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Setting</span> <span class="n">all</span> <span class="n">PLLs</span> <span class="n">in</span> <span class="n">progress</span><span class="p">.</span> <span class="n">This</span> <span class="n">may</span> <span class="n">take</span> <span class="n">some</span> <span class="n">time</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">0</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">10</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">20</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">30</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">40</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">50</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">60</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">70</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">80</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="mi">90</span> <span class="n">Percent</span> <span class="n">Complete</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Setting</span> <span class="n">all</span> <span class="n">PLLs</span> <span class="n">done</span><span class="o">!</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">all</span> <span class="n">PSC</span> <span class="n">power</span> <span class="n">domains</span> <span class="n">in</span> <span class="n">progress</span><span class="p">...</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_WKUP_COMMON</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_DMSC</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_WKUP2MCU</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_WKUP2MAIN_INFRA</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_DEBUG2DMSC</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_WKUP_GPIO</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU2MAIN_INFRA</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU2MAIN</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU2WKUP</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MAIN2MCU</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_COMMON</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_TEST</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_MCAN_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_MCAN_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_OSPI_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_OSPI_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_HYPERBUS</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_DEBUG</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_R5_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MCU_R5_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MAIN_INFRA</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MAIN_TEST</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MAIN_PBIST</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_CC_TOP</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_A53_CLUSTER_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_A53_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_A53_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_A53_CLUSTER_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_A53_2</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_A53_3</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MAIN_DEBUG</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_DSS</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_MMC</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_CAL</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_PCIE_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_PCIE_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_USB_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_USB_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_SAUL</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_PER_COMMON</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_NB</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">No</span> <span class="n">change</span> <span class="n">needed</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_SERDES_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_SERDES_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_ICSSG_0</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_ICSSG_1</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_ICSSG_2</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_GPU</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_EMIF_DATA</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">LPSC_EMIF_CFG</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Power</span> <span class="n">domain</span> <span class="n">and</span> <span class="n">module</span> <span class="n">state</span> <span class="n">changed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nl">DMSC_Cortex_M3_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">Powering</span> <span class="n">up</span> <span class="n">all</span> <span class="n">PSC</span> <span class="n">power</span> <span class="n">domains</span> <span class="n">done</span><span class="o">!</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">VTT</span> <span class="n">Regulator</span> <span class="n">Enabled</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">PHY</span> <span class="n">Init</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x8000000F</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">DRAM</span> <span class="n">Init</span> <span class="n">to</span> <span class="n">complete</span><span class="p">...</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DRAM</span> <span class="n">Init</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x8000001F</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">write</span> <span class="n">leveling</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Write</span> <span class="n">leveling</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x8000003F</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">checking</span> <span class="n">status</span> <span class="n">per</span> <span class="n">byte</span><span class="p">...</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX0GSR0</span> <span class="o">=</span> <span class="mh">0x00A728A0</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX1GSR0</span> <span class="o">=</span> <span class="mh">0x00AA2920</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX2GSR0</span> <span class="o">=</span> <span class="mh">0x00AB2920</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX3GSR0</span> <span class="o">=</span> <span class="mh">0x00AA2A20</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">Read</span> <span class="n">DQS</span> <span class="n">training</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Read</span> <span class="n">DQS</span> <span class="n">training</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x8000007F</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">checking</span> <span class="n">status</span> <span class="n">per</span> <span class="n">byte</span><span class="p">...</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX0RSR0</span> <span class="o">=</span> <span class="mh">0x00000000</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX1RSR0</span> <span class="o">=</span> <span class="mh">0x00000000</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX2RSR0</span> <span class="o">=</span> <span class="mh">0x00000000</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">DDRSS_DDRPHY_DX3RSR0</span> <span class="o">=</span> <span class="mh">0x00000000</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">Write</span> <span class="n">leveling</span> <span class="n">adjustment</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Write</span> <span class="n">leveling</span> <span class="n">adjustment</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x800000FF</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">Read</span> <span class="n">deskew</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Read</span> <span class="n">deskew</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x800001FF</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">Write</span> <span class="n">deskew</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Write</span> <span class="n">deskew</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x800003FF</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">Read</span> <span class="n">Eye</span> <span class="n">training</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Read</span> <span class="n">Eye</span> <span class="n">training</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x800007FF</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">Write</span> <span class="n">Eye</span> <span class="n">training</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Write</span> <span class="n">Eye</span> <span class="n">training</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x80000FFF</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">VREF</span> <span class="n">training</span> <span class="n">to</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>
<span class="n">VREF</span> <span class="n">training</span> <span class="n">complete</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span> <span class="n">DDRSS_DDRPHY_PGSR0</span> <span class="o">=</span> <span class="mh">0x80004FFF</span>
<span class="nl">MCU_PULSAR_Cortex_R5_0:</span> <span class="n">GEL</span> <span class="n">Output</span><span class="o">:</span>

<span class="o">====</span>

<span class="n">DDR4</span> <span class="n">Initialization</span> <span class="n">has</span> <span class="n">PASSED</span><span class="o">!!!!</span>

<span class="o">====</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="additional-notes-for-gel-users">
<h5>10.3.1.3.3.2. Additional Notes for GEL Users<a class="headerlink" href="#additional-notes-for-gel-users" title="Permalink to this headline">¶</a></h5>
<p><strong>R5F in Split Mode Configuration</strong></p>
<p>AM65x EVM ships with the dual Cortex R5F configured in lockstep mode. The AM65x EVM GEL file provides a GEL function &#8220;Change_MCUSS_to_SplitMode&#8221;
that can be added to OnTargetConnect or invoked from the DMSC_Cortex_M3 to set the dual R5F in split mode.</p>
<p><strong>Configuring PRU-ICSS in Sync Mode</strong></p>
<p>The PRU-ICSS subsystem can be configured to SYNC mode (250 Mhz) using the GEL function &#8220;PRU_ICSSG_SyncMode_250MHz&#8221; from Cortex A53 or R5F</p>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="FAQ.html" class="btn btn-neutral float-right" title="11. Frequently Asked Questions" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="How_to_Guides.html" class="btn btn-neutral" title="10. How to Guides" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyight 1995-2018</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'05_03_00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });

        $('body').on("mousewheel", function () {
            // Remove default behavior
            event.preventDefault();
            // Scroll without smoothing
            var wheelDelta = event.wheelDelta;
            var currentScrollPosition = window.pageYOffset;
            window.scrollTo(0, currentScrollPosition - wheelDelta);
        });
      });
  </script>
   

</body>
</html>