

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.1. CSL &mdash; Processor SDK RTOS Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Processor SDK RTOS Documentation" href="../index.html"/>
        <link rel="up" title="6. Device Drivers" href="Device_Drivers.html"/>
        <link rel="next" title="7. PRU-ICSS Firmware" href="PRU_ICSS.html"/>
        <link rel="prev" title="6. Device Drivers" href="Device_Drivers.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Processor SDK RTOS
          

          
          </a>

          
            
            
              <div class="version">
                06_01_00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Release_Specific.html">2. Release Specific</a></li>
<li class="toctree-l1"><a class="reference internal" href="Board_EVM_Abstration.html">3. Board/EVM Abstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Foundational_Components.html">4. Foundational Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="DSP_Software.html">5. DSP Software</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Device_Drivers.html">6. Device Drivers</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">6.1. CSL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#am57x-k2x-c66x-c674x">6.1.1. AM57x/K2x/C66x/C674x</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#application-integration">6.1.1.1. Application Integration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#csl-fl-examples">6.1.2. CSL-FL EXAMPLES</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#uart">6.2. UART</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">6.2.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">6.2.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#user-interface">6.2.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#driver-configuration">6.2.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#apis">6.2.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#application">6.2.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#examples">6.2.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-uart-examples">6.2.4. Building UART examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-references">6.2.5. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#usb">6.3. USB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">6.3.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#driver-overview">6.3.1.1. Driver Overview</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id3">6.3.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">6.3.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api-call-flow">6.3.2.2. API Call Flow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id5">6.3.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">6.3.3.1. Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#test-application">6.3.3.2. Test Application</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#benchmark-tool">6.3.4. Benchmark tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#usb-host-msc">6.3.4.1. USB host MSC</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usb-device-msc">6.3.4.2. USB device MSC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#hardware-setup">6.3.5. Hardware Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pcie">6.4. PCIe</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">6.4.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">6.4.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id10">6.4.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">6.4.2.2. API Call Flow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id13">6.4.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id14">6.4.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#debug-faq">6.4.4. Debug FAQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">6.4.5. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gpio">6.5. GPIO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id16">6.5.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id17">6.5.1.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id20">6.5.1.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id21">6.5.2. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id22">6.5.2.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-gpio-examples">6.5.3. Building GPIO examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#faq">6.5.4. FAQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23">6.5.5. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#i2c">6.6. I2C</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id24">6.6.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id25">6.6.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id26">6.6.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id27">6.6.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id29">6.6.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id30">6.6.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id31">6.6.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-i2c-examples">6.6.4. Building I2C examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id32">6.6.5. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#serdes-diag">6.7. Serdes Diag</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id33">6.7.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id34">6.7.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id35">6.7.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id36">6.7.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id37">6.7.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id38">6.7.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id39">6.7.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-serdes-diag-examples">6.7.4. Building Serdes Diag examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id40">6.7.5. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mcspi-qspi-ospi">6.8. McSPI-QSPI-OSPI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id41">6.8.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id42">6.8.2. Modes of Operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id43">6.8.3. Driver Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id44">6.8.3.1. Board Specific Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#soc-specific-configuration">6.8.3.2. SoC Specific Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spi-configuration-structure">6.8.3.3. SPI Configuration Structure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id45">6.8.4. APIs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#open-spi">6.8.4.1. Open SPI</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id46">6.8.5. Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#spi">6.8.5.1. SPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#qspi">6.8.5.2. QSPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ospi">6.8.5.3. OSPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mcspi">6.8.5.4. MCSPI</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-spi-examples">6.8.6. Building SPI examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#support-for-benchmark-testing">6.8.7. Support for Benchmark Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id53">6.8.8. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#edma3">6.9. EDMA3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id54">6.9.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id55">6.9.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id56">6.9.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id57">6.9.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id58">6.9.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id59">6.9.3. FAQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id60">6.9.4. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#icss-emac">6.10. ICSS-EMAC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id61">6.10.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id62">6.10.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id63">6.10.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id64">6.10.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id67">6.10.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id68">6.10.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#debug-guide">6.10.4. Debug Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id69">6.10.5. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pruss">6.11. PRUSS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id70">6.11.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id71">6.11.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id74">6.11.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id75">6.11.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id77">6.11.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id79">6.11.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id80">6.11.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id81">6.11.4. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fatfs">6.12. FATFS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id82">6.12.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id83">6.12.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id84">6.12.2. Driver Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id85">6.12.3. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id86">6.12.3.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id88">6.12.3.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id90">6.12.4. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id91">6.12.4.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-ccs-projects-based-examples">6.12.5. Building CCS projects based examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-fatfs-test-applications-via-makefiles">6.12.6. Building FATFS Test applications via makefiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id92">6.12.7. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mmcsd">6.13. MMCSD</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id93">6.13.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id94">6.13.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id95">6.13.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id96">6.13.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id98">6.13.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id100">6.13.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#examples-unit-tests">6.13.3.1. Examples &amp; Unit tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#benchmarking-read-write-performance-on-am65x">6.13.4. Benchmarking Read/Write Performance (on AM65x)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#benchmarking-steps">6.13.5. Benchmarking Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id101">6.13.6. Building CCS projects based examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-mmcsd-test-applications-via-makefiles">6.13.7. Building MMCSD Test applications via makefiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id102">6.13.8. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#qmss">6.14. QMSS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id103">6.14.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id104">6.14.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id106">6.14.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id107">6.14.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id108">6.14.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id109">6.14.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id110">6.14.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id112">6.14.4. Debug FAQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id113">6.14.5. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cppi">6.15. CPPI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id114">6.15.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id115">6.15.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id116">6.15.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id117">6.15.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id118">6.15.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id119">6.15.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id120">6.15.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id123">6.15.4. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pa">6.16. PA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id124">6.16.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id125">6.16.1.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id126">6.16.1.2. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id127">6.16.1.3. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id128">6.16.2. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id129">6.16.2.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id130">6.16.3. FAQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id131">6.16.4. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sa">6.17. SA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id132">6.17.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id133">6.17.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id135">6.17.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id136">6.17.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id137">6.17.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id138">6.17.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id139">6.17.3.1. Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-sa-examples-unit-test">6.17.3.2. Building SA Examples/Unit Test</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id140">6.17.4. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#srio">6.18. SRIO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id141">6.18.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id142">6.18.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id144">6.18.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id145">6.18.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id147">6.18.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id148">6.18.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id149">6.18.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id150">6.18.4. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hyplnk">6.19. HYPLNK</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id151">6.19.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id152">6.19.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id155">6.19.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id156">6.19.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id157">6.19.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id159">6.19.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id160">6.19.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id162">6.19.4. Debug FAQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id163">6.19.5. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tsip">6.20. TSIP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id164">6.20.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id165">6.20.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id166">6.20.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id167">6.20.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id168">6.20.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id169">6.20.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id170">6.20.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id171">6.20.4. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mcbsp">6.21. MCBSP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id172">6.21.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id173">6.21.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id174">6.21.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id175">6.21.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id176">6.21.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id177">6.21.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id178">6.21.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id179">6.21.4. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#emac">6.22. EMAC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id180">6.22.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id181">6.22.2. Driver Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id182">6.22.2.1. Board Specific Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id183">6.22.3. APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interposer-card-support">6.22.4. Interposer Card Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-and-test-applications">6.22.5. Example and Test Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id185">6.22.6. Support for Benchmark Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-emac-test-applications-via-makefiles">6.22.7. Building EMAC Test applications via makefiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-emac-examples-and-test-applications">6.22.8. Running EMAC Examples and Test applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id186">6.22.9. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mcasp">6.23. MCASP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id187">6.23.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id188">6.23.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id189">6.23.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id190">6.23.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id191">6.23.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id192">6.23.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id193">6.23.3.1. Examples &amp; Unit tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id194">6.23.4. Building CCS projects based examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-mcasp-test-applications-via-makefiles">6.23.5. Building MCASP Test applications via makefiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id195">6.23.6. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dss">6.24. DSS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id196">6.24.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id197">6.24.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id198">6.24.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id199">6.24.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id200">6.24.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id201">6.24.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id202">6.24.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id203">6.24.4. Additional References</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-dss-examples">6.24.5. Building DSS examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dss-examples">6.24.6. DSS examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cal">6.25. CAL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id205">6.25.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id206">6.25.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id207">6.25.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id208">6.25.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id209">6.25.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id210">6.25.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id211">6.25.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id212">6.25.4. Additional References</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-cal-examples">6.25.5. Building CAL examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cal-examples">6.25.6. CAL examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#udma">6.26. UDMA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id214">6.26.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id215">6.26.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id216">6.26.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id217">6.26.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id218">6.26.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id219">6.26.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id220">6.26.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id221">6.26.4. Additional References</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-udma-examples">6.26.5. Building UDMA examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#udma-examples">6.26.6. UDMA examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pm">6.27. PM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id223">6.27.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id224">6.27.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id225">6.27.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id226">6.27.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id228">6.27.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id229">6.27.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id230">6.27.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id231">6.27.4. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rm">6.28. RM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id232">6.28.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id233">6.28.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id234">6.28.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id235">6.28.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id236">6.28.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id237">6.28.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id238">6.28.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id239">6.28.4. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gpmc">6.29. GPMC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id240">6.29.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id241">6.29.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id242">6.29.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id243">6.29.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id245">6.29.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id246">6.29.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id247">6.29.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id248">6.29.4. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sciclient">6.30. SCICLIENT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id249">6.30.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#terms-and-abbreviation">6.30.2. Terms and Abbreviation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#directory-structure">6.30.3. Directory Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-and-run">6.30.4. Build and Run</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#build-targets">6.30.4.1. Build targets</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-using-a-boot-media">6.30.4.2. Load using a boot-media</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-using-ccs">6.30.4.3. Load using CCS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#handling-two-or-more-ccxml-files">6.30.4.4. Handling Two or more ccxml files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#system-firmware-logs-parse">6.30.5. System Firmware Logs Parse</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api-descriptions">6.30.6. API descriptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sciclient-core">6.30.6.1. SCIClient Core</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sciclient-shim-layer">6.30.6.2. SCIClient Shim Layer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ipclld">6.31. IPCLLD</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id254">6.31.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id255">6.31.2. Terms and Abbreviation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">6.31.3. References</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#features">6.31.3.1. Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation">6.31.3.2. Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build">6.31.3.3. Build</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#compilers-and-tool-chains-required">6.31.4. Compilers and Tool-chains Required:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dependency-of-external-pdk-components">6.31.5. Dependency of External PDK Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-to-build-ipclld">6.31.6. Command to build IPCLLD:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#core-names">6.31.7. Core names:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-the-ipclld-examples">6.31.7.1. Running the IPCLLD examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#example-details">6.31.8. Example Details:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-remote-firmware">6.31.9. Loading Remote Firmware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-ipc-echo-test">6.31.10. Running the ipc_echo_test</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ipclld-design-details">6.31.10.1. IPCLLD Design Details</a></li>
<li class="toctree-l4"><a class="reference internal" href="#typical-data-flow-in-ipclld-communication-between-two-cores">6.31.10.2. Typical Data-Flow in IPCLLD communication between two cores</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-helloworld-app-using-ipclld">6.31.10.3. Writing HelloWorld App using IPCLLD</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#vps-drivers">6.32. VPS Drivers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id256">6.32.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id257">6.32.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id258">6.32.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id259">6.32.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id261">6.32.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id262">6.32.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id263">6.32.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id264">6.32.4. Additional References</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-vps-examples">6.32.5. Building VPS examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vps-examples">6.32.6. VPS examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#display-dss-example">6.32.6.1. Display DSS Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#display-dss-wb-example">6.32.6.2. Display DSS WB example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id266">6.32.7. FAQ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#iolink">6.33. IOLINK</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id267">6.33.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id268">6.33.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id270">6.33.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id271">6.33.2.1. Driver Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id273">6.33.2.2. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id274">6.33.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id275">6.33.3.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-iolink-example">6.33.4. Building IOLINK example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id276">6.33.5. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#osal">6.34. OSAL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id277">6.34.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id278">6.34.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#operating-system-extension">6.34.2. Operating System Extension</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id279">6.34.2.1. APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#application-integration-details">6.34.3. Application Integration Details</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id280">6.34.4. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id281">6.34.4.1. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id285">6.34.5. Additional References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#profiling">6.35. Profiling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id286">6.35.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id287">6.35.1.1. Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#integration">6.35.2. Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rebuild-the-project">6.35.3. Rebuild the project</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="PRU_ICSS.html">7. PRU-ICSS Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="Compilers.html">8. Compilers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Examples_and_Demonstrations.html">9. Examples and Demonstrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="How_to_Guides.html">10. How to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">11. Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Documentation_Tarball.html">12. Documentation Tarball</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Processor SDK RTOS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="Device_Drivers.html">6. Device Drivers</a> &raquo;</li>
      
    <li>6.1. CSL</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="csl">
<h1>6.1. CSL<a class="headerlink" href="#csl" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="overview-1">Overview</p>
<p>The Chip Support Library constitutes a set of well-defined APIs that
abstract low-level details of the underlying SoC device so that a user
can configure, control (start/stop, etc.) and have read/write access to
peripherals without having to worry about register bit-field details.
The CSL services are implemented as distinct modules that correspond
with the underlying SoC device modules themselves. By design, CSL APIs
follow a consistent style, uniformly across Processor Instruction Set
Architecture and are independent of the OS. This helps in improving
portability of code written using the CSL.</p>
<p>CSL is realized as twin-layer – a basic register-layer and a more
abstracted functional-layer. The lower register layer comprises of a
very basic set of macros and type definitions. The upper functional
layer comprises of “C” functions that provide an increased degree of
abstraction, but intended to provide “directed” control of underlying
hardware.</p>
<p>It is important to note that CSL does not manage data-movement over
underlying h/w devices. Such functionality is considered a prerogative
of a device-driver and serious effort is made to not blur the boundary
between device-driver and CSL services in this regard.</p>
<p>CSL does not model the device state machine. However, should there exist
a mandatory (hardware dictated) sequence (possibly atomically executed)
of register reads/writes to setup the device in chosen “operating modes”
as per the device data sheet, then CSL does indeed support services for
such operations.</p>
<p>The CSL services are decomposed into modules, each following the
twin-layer of abstraction described above. The APIs of each such module
are completely orthogonal (one module’s API does not internally call API
of another module) and do not allocate memory dynamically from within.
This is key to keeping CSL scalable to fit the specific usage scenarios
and ease the effort to ROM a CSL based application.</p>
<p>In general for application recommended interfaces to be used will be
driver API. CSL Functional layer APIs could be used for low-level access
when required. CSL Register layer memory map is available for being used
under rare cases in application when required.</p>
<p>The source code of the CSL is located under $(TI_PDK_INSTALL_DIR)\packages\ti\csl directory.</p>
<p class="rubric" id="am335xam437x">AM335x/AM437x</p>
<p>The CSL component of AM335x/AM437x Processor SDK is referred as
StarterWare in the legacy baseline releases.To maintain backward
compatibility for existing applications on AM335x/AM437x SOCs,
StarterWare low level package is retained. Customers are recommended
to use driver interfaces for ease of migration of application software
across SOCs.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Chip Support Library/DAL Summary</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Component Type</strong></p></td>
<td><p><strong>Library</strong></p></td>
</tr>
<tr class="row-odd"><td><p>Install Package</p></td>
<td><p>PDK</p></td>
</tr>
<tr class="row-even"><td><p>Install Directory</p></td>
<td><p>pdk_AMX_&lt;version&gt;\packages\ti\starterware</p></td>
</tr>
<tr class="row-odd"><td><p>Endian Support</p></td>
<td><p>Little</p></td>
</tr>
<tr class="row-even"><td><p>Linker Path</p></td>
<td><p>PDK_INSTALL_DIR\packages\ti\starterware\binary</p></td>
</tr>
<tr class="row-odd"><td><p>Include Paths</p></td>
<td><p>PDK_INSTALL_DIR\packages\ti\starterware\include</p></td>
</tr>
</tbody>
</table>
<div class="section" id="am57x-k2x-c66x-c674x">
<h2>6.1.1. AM57x/K2x/C66x/C674x<a class="headerlink" href="#am57x-k2x-c66x-c674x" title="Permalink to this headline">¶</a></h2>
<div class="section" id="application-integration">
<h3>6.1.1.1. Application Integration<a class="headerlink" href="#application-integration" title="Permalink to this headline">¶</a></h3>
<p>CSL is common package supporting multiple devices.Software layer using
CSL source would need to pass compile time define -DSOC_XXX. Refer
ticslsoc.h for list of devices/SOC’s</p>
<p>Refer list of APIs/interfaces available under &lt;PDK_INSTALL_DIR\packages\ti\csl&gt; directory.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Chip Support Library Summary</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Component Type</p></td>
<td><p>Library</p></td>
</tr>
<tr class="row-odd"><td><p>Install Package</p></td>
<td><p>PDK</p></td>
</tr>
<tr class="row-even"><td><p>Install Directory</p></td>
<td><p>PDK_INSTALL_DIR\packages\ti\csl</p></td>
</tr>
<tr class="row-odd"><td><p>Endian Support</p></td>
<td><p>Little</p></td>
</tr>
<tr class="row-even"><td><p>Linker Path</p></td>
<td><p>PDK_INSTALL_DIR\packages\ti\csl</p></td>
</tr>
<tr class="row-odd"><td><p>Include Paths</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\</p></td>
</tr>
<tr class="row-even"><td><p>Reference Guides</p></td>
<td><p>See docs under Install Directory</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="csl-fl-examples">
<h2>6.1.2. CSL-FL EXAMPLES<a class="headerlink" href="#csl-fl-examples" title="Permalink to this headline">¶</a></h2>
<p>These are example projects to test the functionality of API in CSL-FL
layers. The following is the list of CSL-FL test examples which are
supported with the CSL library:</p>
<ul class="simple">
<li><p>DCAN</p></li>
<li><p>EDMA</p></li>
<li><p>GPIO</p></li>
<li><p>MAILBOX</p></li>
<li><p>I2C</p></li>
<li><p>QSPI</p></li>
<li><p>WDTIMER</p></li>
<li><p>MMCSD</p></li>
<li><p>MMU</p></li>
<li><p>SPINLOCK</p></li>
<li><p>UART</p></li>
<li><p>ECC : Limited to applicable SOC’s/Boards:idkAM574x</p></li>
<li><p>GPMC : Limited to a15 core on idkAM572 and evmAM572x</p></li>
</ul>
<p>In order build the projects:</p>
<ul class="simple">
<li><p>Navigate to pdk_[soc]_[version]\packages</p></li>
<li><p>Run pdksetupenv.bat (windows) OR pdksetupenv.sh (linux).</p></li>
<li><p>Navigate to pdk_[soc]_[version]\packages\ti\csl</p></li>
</ul>
<p>All CSL-FL examples can be cleaned and rebuilt with the following
commands on windows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>C:\ti\pdk_[soc]_[version]\packages\ti\csl&gt;gmake app_clean
C:\ti\pdk_[soc]_[version]\packages\ti\csl&gt;gmake apps
</pre></div>
</div>
<p>All CSL-FL examples can be cleaned and rebuilt with the following
commands on linux:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>~/ti/pdk_[soc]_[version]/packages/ti/csl$ make app_clean
~/ti/pdk_[soc]_[version]/packages/ti/csl$ make apps
</pre></div>
</div>
<ul class="simple">
<li><p>All the output binary files will be generated in common location i.e.
pdk_[soc]_[version]\packages\ti\binary\[EXAMPLE]\bin\[BOARD]\</p></li>
<li><p>DCAN RTOS example</p></li>
</ul>
<p>TI RTOS support is available for CSL DCAN example on AM572x platform.
Refer to the readme document at below path for more details.</p>
<p>&lt;PDK Root&gt;/packages/ti/csl/example/dcan/dcanLoopback</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="uart">
<h1>6.2. UART<a class="headerlink" href="#uart" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>6.2.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction">
<h3>6.2.1.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>Driver enables UART’s available on SOC for reading and writing to any
peripherals on board. Additionally it supports simple APIs for
Console/STDIO operations.</p>
<p class="rubric" id="modes-of-operation">Modes of Operation</p>
<p>Following modes of operations are supported</p>
<p><strong>UART_MODE_BLOCKING</strong>: In this mode, read and write APIs, blocks on
semaphore until required operation is complete. By default, UART driver
operates in blocking mode. In this mode, code execution of a task blocks
until UART transaction is complete. While transaction is in progress
additional tasks pending requests will remain in blocked state waiting
for semaphore.</p>
<p><strong>UART_MODE_CALLBACK</strong>: In this mode, read and write operation returns
immediately. On trigger of hardware Interrupt (hwi) callback function
gets triggered.</p>
</div>
</div>
<div class="section" id="user-interface">
<h2>6.2.2. User Interface<a class="headerlink" href="#user-interface" title="Permalink to this headline">¶</a></h2>
<div class="section" id="driver-configuration">
<h3>6.2.2.1. Driver Configuration<a class="headerlink" href="#driver-configuration" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="board-specific-configuration"><strong>Board Specific Configuration</strong></p>
<p>All board specific configurations eg:enabling clock and pin-mux for UART
pins are required before calling any driver APIs.By default Board_Init()
API supports all initialization sequence for TI supported EVMs. In
addition it initializes UART instance for Console/STDIO.Refer <a class="reference external" href="index_board.html#board-support">Processor
SDK RTOS Board Support</a>
for additional details.Once board specific configuration is complete
UART_init() API can be called to initialize driver.</p>
<p class="rubric" id="uart-configuration-structure"><strong>UART Configuration Structure</strong></p>
<p>The UART_soc.c file binds driver with hardware attributes on the board
through UART_config structure. This structure must be provided to UART
driver. It must be initialized before the UART_init() function is called
and cannot be changed afterwards. For details about individual fields of
this structure, see the Doxygen help by opening
PDK_INSTALL_DIRpackagestidrvuartdocsdoxygenhtmlindex.html.</p>
</div>
<div class="section" id="apis">
<h3>6.2.2.2. APIs<a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h3>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/uart/UART.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>STDIO API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/uart/UART_stdio.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p class="rubric" id="open-uart">Open UART</p>
<p>There are three ways to open a UART instance:</p>
<ol class="arabic simple">
<li><p>UART_open()</p></li>
</ol>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">UART_socGetInitCfg</span><span class="p">(</span><span class="n">UART_INSTANCE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart_cfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">UART_socSetInitCfg</span><span class="p">(</span><span class="n">UART_INSTANCE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart_cfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">UART_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">params</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">handle</span> <span class="o">=</span> <span class="n">UART_open</span><span class="p">(</span><span class="n">UART_INSTANCE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">params</span><span class="p">);</span>
</pre></div>
</div>
<p>At this point UART driver is ready for data transfer on specific
instance identified by handle. Application can call UART_read/write
API for read/write operation</p>
<ol class="arabic simple" start="2">
<li><p>UART_stdioInit() using the default UART parameters</p></li>
</ol>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">UART_socGetInitCfg</span><span class="p">(</span><span class="n">UART_INSTANCE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart_cfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">UART_socSetInitCfg</span><span class="p">(</span><span class="n">UART_INSTANCE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart_cfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">UART_stdioInit</span><span class="p">(</span><span class="n">UART_INSTANCE</span><span class="p">);</span>
</pre></div>
</div>
<p>At this point UART driver is ready for data transfer on specific
instance. Application can call UART_printf/scanFmt API for read/write
operation</p>
<ol class="arabic simple" start="3">
<li><p>UART_stdioInit2() using Application specified UART parameters</p></li>
</ol>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">UART_socGetInitCfg</span><span class="p">(</span><span class="n">UART_INSTANCE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart_cfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">UART_socSetInitCfg</span><span class="p">(</span><span class="n">UART_INSTANCE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart_cfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">UART_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">params</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">UART_stdioInit2</span><span class="p">(</span><span class="n">UART_INSTANCE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">params</span><span class="p">);</span>
</pre></div>
</div>
<p>At this point UART driver is ready for data transfer on specific
instance. Application can call UART_printf/scanFmt API for read/write
operation</p>
<p class="rubric" id="readwrite-apis">Read/Write APIs</p>
<p><strong>Interrupt</strong>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">UART_read</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="n">scanPrompt</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">scanPrompt</span><span class="p">));</span><span class="cm">/* Read API */</span>
<span class="p">...</span>
<span class="n">UART_write</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">bufferPrompt</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bufferPrompt</span><span class="p">));</span><span class="cm">/* Write API */</span>

<span class="n">Or</span>

<span class="nf">UART_transactionInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">transaction</span><span class="p">);</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">scanPrompt</span><span class="p">;</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">scanPrompt</span><span class="p">);</span>
<span class="n">UART_read2</span><span class="p">(</span><span class="n">uart</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">transaction</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">UART_transactionInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">transaction</span><span class="p">);</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">bufferPrompt</span><span class="p">;</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bufferPrompt</span><span class="p">);</span>
<span class="n">UART_write2</span><span class="p">(</span><span class="n">uart</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">transaction</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Polling</strong>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">UART_readPolling</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="n">scanPrompt</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">scanPrompt</span><span class="p">));</span><span class="cm">/* Read Polling mode API */</span>
<span class="p">...</span>
<span class="n">UART_writePolling</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">bufferPrompt</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bufferPrompt</span><span class="p">));</span><span class="cm">/* Write Polling API */</span>
</pre></div>
</div>
<p class="rubric" id="dma-usage">DMA Usage :</p>
<p>UART driver supports DMA operations to transfer data between</p>
<ul class="simple">
<li><p>Memory and RX FIFO for read transfer</p></li>
<li><p>Memory and TX FIFO for write transfer.</p></li>
</ul>
<p>DMA Driver is DMA family IP (EDMA and UDMA) and UART IP (V0 and V1) specific.
Refer soc/dma/v#/UART_dma.c for these operations. Application need to
create DMA handle and update the configuration before UART_init() API.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">uartInitCfg</span><span class="p">[</span><span class="n">UART_INSTANCE</span><span class="p">].</span><span class="n">edmaHandle</span> <span class="o">=</span> <span class="n">UartApp_edmaInit</span><span class="p">();</span><span class="cm">/* For AM/K1/K2 devices */</span>

<span class="n">or</span>

<span class="n">uartInitCfg</span><span class="p">[</span><span class="n">UART_INSTANCE</span><span class="p">].</span><span class="n">udmaHandle</span> <span class="o">=</span> <span class="n">UartApp_udmaInit</span><span class="p">();</span><span class="cm">/* For K3 devices */</span>

<span class="n">UART_init</span><span class="p">();</span>
</pre></div>
</div>
<p>Refer “UART_BasicExample_[SOC]_[cpu]DMATestproject” or “UART_DMA_[evm]_[cpu]TestApp”
for additional reference. Refer SDK Release Note for supported EVMs.</p>
</div>
</div>
<div class="section" id="application">
<h2>6.2.3. Application<a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h2>
<div class="section" id="examples">
<h3>6.2.3.1. Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
<th class="head"><p>SoC Supported</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>UART_Example
application</p></td>
<td><p>Example
demonstrating
<em>simple</em> UART use
case. Reference
example for
developers</p></td>
<td><p>Application prompts
user to enter input
data in console.</p>
<p>User can enter up
to 16 characters or
terminate with
enter
key.Application
echoes back
characters.</p>
</td>
<td><p>AM335x,
AM437x,
AM571x,
AM572x,
AM574x,
k2g,
k2hk,k2l,k2e,k2l
c6657,c6678
omapl137,
omapl138,</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>UART_TestApplication</p></td>
<td rowspan="2"><p>Unit Test
application to test
all APIs</p></td>
<td rowspan="2"><p>User can enter up to
16 characters using
serial
console.Application
echoes back</p></td>
<td><p>AM335x,AM437x,AM571x
AM572x,AM574X
k2g,k2hk,k2l,k2e,k2l
c6657,c6678
omapl137,omapl138</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-even"><td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>UART_DMATestApplication</p></td>
<td rowspan="2"><p>Unit Test
application with
DMA mode.</p></td>
<td rowspan="2"><p>User can enter up to
16 characters using
serial
console.Application
echoes back</p></td>
<td><p>AM335x,AM437x,AM571x
AM572x,AM574X
k2g,k2hk,k2l,k2e,k2l
c6657,c6678
omapl137,omapl138</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-even"><td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>UART_SMP_TestApplication</p></td>
<td rowspan="2"><p>Unit Test
application to test
all APIs in SMP mode
<em>(A15 &amp; A53 cores)</em></p></td>
<td rowspan="2"><p>User can enter up to
16 characters using
serial
console.Application
echoes back</p></td>
<td><p>AM572x-EVM</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-even"><td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>UART_SMP_DMATestApplica
tion</p></td>
<td rowspan="2"><p>Unit Test
application
in SMP mode with DMA
enabled
<em>(A15 &amp; A53 cores)</em></p></td>
<td rowspan="2"><p>User can enter up to
16 characters using
serial
console.Application
echoes back</p></td>
<td><p>AM572x-EVM</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-even"><td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="building-uart-examples">
<h2>6.2.4. Building UART examples<a class="headerlink" href="#building-uart-examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Makefile based examples and dependent libraries can be built from the top level or module level UART makefile, refer to the <a class="reference external" href="index_overview.html#setup-environment">Processor SDK RTOS Getting Started Guide</a>  for details of how to setup the build environment. Once you have setup the build environment, issue the following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">To</span> <span class="n">build</span> <span class="n">and</span> <span class="n">clean</span> <span class="n">libs</span><span class="o">/</span><span class="n">apps</span> <span class="n">from</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="nl">makefile</span><span class="p">:</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span>
<span class="n">make</span> <span class="n">uart</span>
<span class="n">make</span> <span class="n">uart_clean</span>

<span class="n">To</span> <span class="n">build</span> <span class="n">and</span> <span class="n">clean</span> <span class="n">libs</span><span class="o">/</span><span class="n">apps</span> <span class="n">from</span> <span class="n">module</span><span class="o">-</span><span class="n">level</span> <span class="nl">makefile</span><span class="p">:</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">drv</span><span class="o">/</span><span class="n">uart</span>
<span class="n">make</span> <span class="n">all</span>
<span class="n">make</span> <span class="n">clean</span>
</pre></div>
</div>
<ul class="simple">
<li><p>RTSC CCS project based examples are built from CCS</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span>
<span class="p">.</span><span class="o">/</span><span class="n">pdkProjectCreate</span><span class="p">.</span><span class="n">sh</span> <span class="p">[</span><span class="n">soc</span><span class="p">]</span> <span class="p">[</span><span class="n">board</span><span class="p">]</span> <span class="p">[</span><span class="n">endian</span><span class="p">]</span> <span class="n">uart</span> <span class="p">[</span><span class="n">project</span> <span class="n">type</span><span class="p">]</span> <span class="p">[</span><span class="n">processor</span><span class="p">]</span> <span class="p">[</span><span class="n">SECUREMODE</span><span class="o">=&lt;</span><span class="n">yes</span><span class="o">/</span><span class="n">no</span><span class="o">&gt;</span><span class="p">]</span>
<span class="n">Import</span> <span class="n">and</span> <span class="n">build</span> <span class="n">CCS</span> <span class="n">Project</span> <span class="n">from</span>  <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">MyExampleProjects</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="additional-references">
<h2>6.2.5. Additional References<a class="headerlink" href="#additional-references" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 61%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)/packages/ti
/drv/gpio/docs/doxygen/html/index
.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)/packages/ti
/drv/gpio/docs/ReleaseNotes_UART
_LLD.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="usb">
<h1>6.3. USB<a class="headerlink" href="#usb" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>6.3.1. Overview<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="driver-overview">
<h3>6.3.1.1. Driver Overview<a class="headerlink" href="#driver-overview" title="Permalink to this headline">¶</a></h3>
<p>PDK USB driver (USB LLD) provides the following USB class/functions
while isolating application from the complexity of low level USB and USB
class protocols:</p>
<ul class="simple">
<li><p>USB device Mass Storage Class</p></li>
<li><p>USB host Mass Storage Class</p></li>
<li><p>USB device Audio Class</p></li>
<li><p>USB generic bulk device class</p></li>
</ul>
<p>In rest of the page AM437x EVM is being refered as an example. Please
check Release Notes for list of supported EVMs for driver.</p>
<p class="rubric" id="id2">Modes of Operation</p>
<ul class="simple">
<li><p><strong>USB device Mass Storage Class</strong></p>
<ul>
<li><p><strong>USB device Mass Storage Class with RAM DISK</strong></p></li>
</ul>
</li>
</ul>
<p>In this mode, a user-selected USB instance of the EVM will be working in
device mode and will behave like a USB thumb drive. It uses part of the
EVM DDR memory and exposes it as a physical storage for another USB host
application. After the host PC enumerates this EVM-thumb drive, the PC
will see a USB storage device. This EVM-thumb drive is not yet formatted
with any file system and requires user to format it before use.</p>
<img alt="../_images/USB_MSC_device.PNG" src="../_images/USB_MSC_device.PNG" />
<p>The following screen shots show what one would expect when running the
device mode demo application and plugging in a USB cable from the EVM
USB port #0 to a PC running Windows</p>
<p>Printout from demo application:</p>
<img alt="../_images/Device_mode_printout.png" src="../_images/Device_mode_printout.png" />
<p>The MSC device is detected in Windows, and a FAT formatted USB drive
named “PDK-USBDEV” should be seen in the “Window Explorer”. The content
of the drive is just a readme.txt file. This USB drive can be
manipulated like any other removable USB drive.</p>
<img alt="../_images/Windows_pdk_usb.png" src="../_images/Windows_pdk_usb.png" />
<p>Windows might show a message saying it should be scanned and fixed. We
can just ignore it and just continue without scanning.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><ul class="simple">
<li><p><strong>USB device Mass Storage Class with MMCSD card</strong></p></li>
</ul>
</div></blockquote>
<p>This example acts like a USB - MMCSD card reader. The example exposes
the EVM’s MMCSD card to the Host PC via USB MSC. The Host PC can
manipulate files on the attached MMCSD card on the EVM. This example is
currently supported on AM335GP EVM. This is how it looks. Its code is
similar to that of the USB device MSC example but with the call back
functions calling MMCSD API’s instead of RamDisk APIs</p>
<img alt="../_images/Usb_device_mmcsd.PNG" src="../_images/Usb_device_mmcsd.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p><strong>USB host Mass Storage Class</strong></p></li>
</ul>
<p>In this mode, the USB instance will act as a USB host communicating with
a USB device that supports Mass Storage Class function (USB thumb drive
or a small USB hard drive). The demo example code utilizes a shell
interface via the EVM via UART for interaction with the example. The
shell provides some basic commands to manipulate the content of the
attached USB disk drive.</p>
<img alt="../_images/USB_MSC_host.PNG" src="../_images/USB_MSC_host.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Screenshot of a MSC host mode example running in RTOS after plugging in
a USB thumb drive into USB port #1</p>
<img alt="../_images/Host_shell_screen_shot.png" src="../_images/Host_shell_screen_shot.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p><strong>USB device Audio Class</strong></p></li>
</ul>
<p>In this mode, USB instance of the EVM will be working in device mode and
will behave like a USB headset with MIC. It uses audio codec on the EVM
for running playback and record initiated by the USB host. McASP module
will be used to transfer the data between USB device and audio codec on
the board. EVM will appear as a new USB audio device on the host PC.
Changing the default audio device on the host PC to EVM USB device will
allow the playback and record operations between EVM and USB host. This
mode of operation is currently supported on AM335X GP EVM, OMAP-L137 EVM
and OMAP-L138 LCDK.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../_images/Am335x_usb_ac_bd.jpg" src="../_images/Am335x_usb_ac_bd.jpg" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p><strong>USB generic bulk device class</strong></p></li>
</ul>
<p>In this mode, a user-selected USB instance of the EVM will be working in
device mode. The mentioned USB device will show up in the host PC as a generic
USB bulk device with one single interface containing a bulk IN and a bulk OUT
endpoints. The configuration and interface descriptors published by the device
contain vendor-specific class identifiers, so an application on the host will
have to communicate with the device using either a custom driver or a subsystem
such as WinUSB or libusb-win32 on Windows (or just libusb on Linux) to read and
write to the device.</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Running USB bulk device demo application</strong></p></li>
</ul>
</div></blockquote>
<p>The bulk demo application requires a host PC with USB host plugged to the USB device
port on the EVM. Depending on the platform, the USB device port might be USB port #0
or #1.</p>
<img alt="../_images/USB_MSC_device.PNG" src="../_images/USB_MSC_device.PNG" />
<p>Please refer to PDK user guide for how to generate USB example projects. Once the demo
application is loaded and run, the EVM UART console shows the following:</p>
<img alt="../_images/usb_dev_bulk_console.png" src="../_images/usb_dev_bulk_console.png" />
<p>A Python host PC example application is provided in
ti/drv/usb/example/usb_dev/bulk/usb_dev_bulk_host_application.py</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The example Python script requires PyUSB to run. On Linux host, proper UDEV rule is
also required in order to access the USB bulk device as non-sudo user.  The script
itself also lists the requirements to run it as well as what command options available.
The example UDEV rule is also placed in the same place where the Python script is located.
It does the following:</p>
<ul class="simple">
<li><p>The Python script looks for the USB device with the example PID:VID,</p></li>
<li><p>Sends an ASCII text string to the USB bulk demo application running on the EVM</p></li>
<li><p>Expects the same text string with reversed case letter returned back, and also</p></li>
<li><p>Verifies the received data with the data that it has sent and report the test result.</p></li>
</ul>
<p>A screen shot of what the Python test script outputs</p>
<img alt="../_images/usb_dev_bulk_host_tool_output.png" src="../_images/usb_dev_bulk_host_tool_output.png" />
<p>The USB bulk demo application configures the USB endpoints as high speed endpoints with 512B packet size.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h2>6.3.2. User Interface<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3>6.3.2.1. Driver Configuration<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Data Structures</strong>:</p>
<ul>
<li><p><strong>tUSBDMSCDevice</strong>: Defined in usbdmsc.h. It is used in USB device
mode application. This structure must be filled with the intended
vendor and product ID as well as other product information and
also the function pointers to functions that handle the disk
functions (open/read/write/close, etc.). These product information
will show up in the device and interface USB descriptors that are
used during device enumeration. This device MSC class data is then
assigned to the field usbClassData of the USB_Params bellow.</p></li>
<li><p><strong>USB params</strong>: USB_Params structure is declared in usb_drv.h.
This structure must be provided to the USB driver. It must be
initialized before the USB_open() function is called.</p></li>
<li><p><strong>USB APIs</strong>: main USB LLD and USB MSC API’s are declared in
usb_drv.h and usbdmsc.h and usbhmsc.h provided in the root USB LLD
directory.</p></li>
</ul>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p><strong>General USB LLD expectations</strong>:</p></li>
</ul>
<p>The USB LLD will setup appropriate USB clock and power domains for the
particular SOC being in used as part of its “device specific peripheral”
functions.</p>
<p>After the USB_open() is called, the driver expects the application code
to sets up USB interrupts with the interrupt handler being the USB LLD
provided interrupt handler. Then the application have to call the USB
LLD provided API USB_irqConfig() which enables USB module’s interrupts.
In device mode, both USB core and USB misc interrupts are used in the
USB device MSC application. In host mode, the USB host MSC only uses USB
core interrupts.</p>
<p>After these steps, application code then can expect to have USB
enumeration done and start USB transfer through the provided APIs.</p>
</div>
<div class="section" id="api-call-flow">
<h3>6.3.2.2. API Call Flow<a class="headerlink" href="#api-call-flow" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>USB Device MSC</strong></p></li>
</ul>
<p>The example application code uses the USB library, configures it as a
USB device with MSC function. The example also provides functional codes
that access a RAM disk (included from the Utils library in the included
Starterware). The LLD calls these MSC back-ends functions to access the
RAM disk. User can replace these functions with other functions that
access other types of media or devices (MMCSD for example). The RAM disk
image provided in the example demo application is not currently
formatted. Thus the once enumerated, the PC will require the USB disc to
be formatted before use.</p>
<p>Below diagram is the sequence of API calls that starts the USB device
MSC application. All USB events are handled internally in the LLD and in
the interrupt context.</p>
<img alt="../_images/USB_MSC_device_API_flow.PNG" src="../_images/USB_MSC_device_API_flow.PNG" />
<p>User provided disk functions will be called from the LLD to handle the
actual physical disk access. The overview of USB Device MSC example
application:</p>
<img alt="../_images/USB_MSC_device_example_blocks.PNG" src="../_images/USB_MSC_device_example_blocks.PNG" />
<p>The content of the file: usb_msc_structs.c can be replaced with customer
USB device information (PID/VID, device names, etc.)</p>
<ul class="simple">
<li><p><strong>USB Host MSC</strong></p></li>
</ul>
<p>The LLD also provides a USB host MSC example. The USB LLD is acting as a
USB host, waiting for a USB thumb drive/memory stick to be plugged in. A
console with a simple shell command is also provided so that the demo
example can display and manipulate content of the USB device.</p>
<p>The following is how the USB host MSC example demo is organized:</p>
<img alt="../_images/USB_MSC_host_example_blocks.PNG" src="../_images/USB_MSC_host_example_blocks.PNG" />
<p>The following is the sequence of the APIs that were used:</p>
<img alt="../_images/USB_MSC_host_API_flow.PNG" src="../_images/USB_MSC_host_API_flow.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p><strong>USB Device Audio</strong></p></li>
</ul>
<p>The example application code uses the USB library, configures it as a
USB device with Audio class function. USB LLD along with the application
enumerates as the USB audio class device and allows accessing the audio
ports on the EVM from USB host. It supports audio playback and record
operations.</p>
<p>Below diagram is the sequence of API calls that starts the USB device
audio application. All USB events are handled internally in the LLD and
in the interrupt context.</p>
<img alt="../_images/USB_Audio_class_flowchart.jpg" src="../_images/USB_Audio_class_flowchart.jpg" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p><strong>USB Device Bulk</strong></p></li>
</ul>
<p>Sequence of API calls as long as what the example application looks like are
described bellow</p>
<img alt="../_images/usb_device_generic_bulk_example_application.png" src="../_images/usb_device_generic_bulk_example_application.png" />
<ul class="simple">
<li><p>Main APIs that are used to read/write from and to the USB bulk device are USBD_bulkRead() and USBD_bulkWrite().</p></li>
</ul>
<p>These two functions will block the caller until they finish their operation.</p>
<ul class="simple">
<li><p>The main application should wait for about 500ms after the USB host sends the SetConfig request to make sure that the enumeration is completely finished before calling USBD_bulkRead/Write functions</p></li>
</ul>
</div>
</div>
<div class="section" id="id5">
<h2>6.3.3. Application<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id6">
<h3>6.3.3.1. Examples<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Examples are CCS projects. Generated with pdkProjectCreate scripts.
Please refer  <a class="reference external" href="index_overview.html#pdk-example-and-test-project-creation">Processor SDK RTOS Getting Started Guide</a>
for how to create and build examples projects</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Example Name</p></th>
<th class="head"><p>EVM’s supported</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>USB_DevMsc_mmcsd</strong></p></td>
<td><p>AM335GP EVM,
BeagleBoneBlack,
AM572 EVM</p></td>
<td><p>eMMC is used on AM572
and BealgeBoneBlack
examples
This example can be
used to format eMMC,
just like any other
USB storage device</p></td>
</tr>
<tr class="row-odd"><td><p><strong>USB_DevMsc</strong></p></td>
<td><p>AM335GP, AM437xGP,
OMAP137EVM,
OMAPL138LCDK,
AM57xIDK, AM572 EVM,
K2G EVM, DRA7xx EVM,
AM65x EVM/IDK</p></td>
<td><p>OMAPL13 LCDK host and
device examples share
the same USB port.</p></td>
</tr>
<tr class="row-even"><td><p><strong>USB_HostMsc</strong></p></td>
<td><p>AM335GP, AM437xGP,
OMAP136EVM,
OMAPL137LCDK,
AM57xIDK, K2G EVM,
DRA7xx EVM,
AM65x EVM/IDK</p></td>
<td><p>OMAPL13 LCDK host and
device examples share
the same USB port.
Need OTG cable for
EVM with OTG port to
work in host mode.</p>
<p>USB3.0 host supported
on AM572IDK.</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>USB_DevAudio</strong></p></td>
<td><p>AM335xGP,OMAPL137
EVM,OMAPL138 LCDK</p></td>
<td><p>Refer to Hardware
Setup and How to Run
the Demo sections
below</p></td>
</tr>
<tr class="row-even"><td><p><strong>USB_DevBulk</strong></p></td>
<td><p>AM335xGP, AM437xGP,
AM572xIDK, AM571xIDK,
AM574xIDK, K2GEVM,
OMAPL137EVM,
OMAP138LCDK,
AM654x EVM/IDK</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="test-application">
<h3>6.3.3.2. Test Application<a class="headerlink" href="#test-application" title="Permalink to this headline">¶</a></h3>
<p>USB test applications are built using makefile. Some of the test application are
RTOS/BIOS apps, other are bare metal apps. They are replica of the USB examples but built by
makefile instead of CCS projects.</p>
<p>Refer to the <a class="reference external" href="index_overview.html#setup-environment">Processor SDK RTOS Getting Started Guide</a>
for details  of how to setup the build environment. Once you have setup the build environment,
issue the following commands:</p>
<blockquote>
<div><ul class="simple">
<li><p>cd &lt;pdk&gt;/packages/</p></li>
<li><p>To build: make usb</p></li>
<li><p>To clean: make usb_clean</p></li>
<li><p>Test applications are then under (TI_PDK_INSTALL_DIR)/packages/ti/binary/</p></li>
</ul>
</div></blockquote>
<table class="docutils align-default">
<colgroup>
<col style="width: 36%" />
<col style="width: 23%" />
<col style="width: 7%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Test App Name</p></th>
<th class="head"><p>EVM’s supported</p></th>
<th class="head"><p>Bare
metal</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>USB_Baremetal_DevMsc_TestApp</strong></p></td>
<td><p>AM65xx EVM/IDK</p></td>
<td><p>yes</p></td>
<td><p>Equivalent to DevMsc example</p></td>
</tr>
<tr class="row-odd"><td><p><strong>USB_Baremetal_HostMsc_TestApp</strong></p></td>
<td><p>AM654x EVM/IDK</p></td>
<td><p>yes</p></td>
<td><p>Same function as HostMsc example</p></td>
</tr>
<tr class="row-even"><td><p><strong>USB_HostMsc_TestApp</strong></p></td>
<td><p>AM654x EVM/IDK</p></td>
<td><p>no</p></td>
<td><p>Same as HostMsc example</p></td>
</tr>
<tr class="row-odd"><td><p><strong>USB_DevMsc_TestApp</strong></p></td>
<td><p>AM654x EVM/IDK</p></td>
<td><p>no</p></td>
<td><p>Same as DevMsc example</p></td>
</tr>
<tr class="row-even"><td><p><strong>USB_DevBulk_TestApp</strong></p></td>
<td><p>AM654x EVM/IDK</p></td>
<td><p>no</p></td>
<td><p>Same as DevBulk example</p></td>
</tr>
<tr class="row-odd"><td><p><strong>usb_d_msc_&lt;platform&gt;</strong></p></td>
<td><p>AM335xGP,AM437xEVM
OMAPL137 EVM
OMAPL138 LCDK</p></td>
<td><p>yes</p></td>
<td><p>Same as USB DevMsc example.</p>
<p>Build by going to
example/usb_dev/msc/
build/&lt;platform&gt;</p>
</td>
</tr>
<tr class="row-even"><td><p><strong>usb_h_msc_&lt;platform&gt;</strong></p></td>
<td><p>AM335xGP,AM437xEVM
OMAPL137 EVM
OMAPL138 LCDK</p></td>
<td><p>yes</p></td>
<td><p>Same as USB HostMsc example</p>
<p>Build by going to
example/usb_dev/msc/
build/&lt;platform&gt;</p>
</td>
</tr>
</tbody>
</table>
<dl>
<dt>Both examples and test applications can be loaded and run on their intended EVM via</dt><dd><ul class="simple">
<li><p>CCS JTAG connector, or</p></li>
<li><p>Via SBL: the “app” file under CCS project’s debug directory (&lt;PDK_INSTALL_PATH/MyExampleProjects/&lt;ExampleProjectDirectory&gt;/Debug&gt;) is SBL loadable file of the built project.</p></li>
</ul>
<p>–  Project Memory layout must be considered and following SBL guideline so that examples can run safely via SBL. Please refer to <a class="reference external" href="index_Foundational_Components.html#boot">SBL Component</a>   for more detail</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="benchmark-tool">
<h2>6.3.4. Benchmark tool<a class="headerlink" href="#benchmark-tool" title="Permalink to this headline">¶</a></h2>
<div class="section" id="usb-host-msc">
<h3>6.3.4.1. USB host MSC<a class="headerlink" href="#usb-host-msc" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>To measure the USB host MSC throughput, a new command (bm) is added into the USB host mode example (or test application).</p></li>
<li><p>This command is to run with a good known fast USB thumb drive attached to the USB host port.</p></li>
<li><p>The throughput measurement result varies greatly depends on which USB device is plugged in and which filesystem is used</p></li>
<li><p>The USB drive needs to be formated as FAT32 (since the USB host example only supports FAT filesystem) and has at least 100MB free space. Fast blank USB thumb drive is recomended.</p></li>
<li><p>The command, when run, writes a 100MB file into the thumb drive and measures the time it takes to do so. It then reads back this 100MB file with time measurement to find the read throughput.</p></li>
<li><p>The write and read are done in block size of 100KB, 256KB, 1MB, and 5MB. It prints throughput measurements for each of these blocks.</p></li>
<li><p>This command is only supported in AM65xx at the moment.</p></li>
<li><p>Syntax:</p></li>
</ul>
</div></blockquote>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">bm</span> <span class="o">&lt;</span><span class="n">test_file_name</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="usb-device-msc">
<h3>6.3.4.2. USB device MSC<a class="headerlink" href="#usb-device-msc" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>To measure USB device MSC throughtput a simple linux shell script usb_dev_msc_perf.sh is provided in PDK/packages/ti/drv/usb/example/usb_dev/msc/</p></li>
<li><p>This script assumes the USB Dev MSC drive (PDK-USBDEV) is already mounted on the Linux host PC (under /media/$USER/PDK-USBDEV) when it runs</p></li>
<li><p>It uses “dd” command to report the thoughput</p></li>
<li><p>Tested on Ubuntu 16.04. Different version of Linux might mount the MSC drive at different place. Please adjust the script accordingly.</p></li>
<li><p>The script writes a file to the PDK-USBDEV drive with a number of blocksize. By default it creates a 15MB test file by writing 150 blocks of 100K each (which would fit inside the 16MB RAM disk provided by the USB Dev MSC.)</p></li>
<li><p>User is free to change the block size and number of blocks for the test. However it doens’t check if the end result file would fit the PDK-USBDEV drive or not.</p></li>
<li><p>Syntax:</p></li>
</ul>
</div></blockquote>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">usb_dev_msc_perf</span><span class="p">.</span><span class="n">sh</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">blocksize</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">count</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hardware-setup">
<h2>6.3.5. Hardware Setup<a class="headerlink" href="#hardware-setup" title="Permalink to this headline">¶</a></h2>
<p>This section provides the specific HW setup required to run the USB
examples.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p><strong>USB Device Audio</strong></p></li>
</ul>
<p>USB audio class demo requires additional setup for running playback and
record operations. Below sections provide the setup details for each
platform supported.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>AM335x GP EVM</strong></p>
<img alt="../_images/Am335x_usb_ac_setup.jpg" src="../_images/Am335x_usb_ac_setup.jpg" />
<p><strong>OMAPL137 EVM</strong></p>
<img alt="../_images/Omapl137_usb_ac_setup.jpg" src="../_images/Omapl137_usb_ac_setup.jpg" />
<p><strong>OMAPL138 LCDK</strong></p>
<img alt="../_images/Omapl138_usb_ac_setup.jpg" src="../_images/Omapl138_usb_ac_setup.jpg" />
<p><strong>How to Run the Demo</strong></p>
<ul class="simple">
<li><p>Follow this link <a class="reference external" href="How_to_Guides.html#setup-ccs-for-evm-and-processor-sdk-rtos">Processor SDK RTOS Setup CCS</a>
to get target configuration setup correctly.</p></li>
<li><p>Use CCS to import the USB_DevAudio_&lt;board&gt;_&lt;core&gt;ExampleProject under
pdk_&lt;platform&gt;_&lt;version&gt;/packages/MyExampleProjects.</p></li>
<li><p>Build the imported project. the OUT file will be at
pdk_&lt;platform&gt;_&lt;version&gt;/packages/MyExampleProjects/USB_DevAudio_&lt;board&gt;_&lt;core&gt;ExampleProject/Debug.</p></li>
<li><p>Make the HW connections as shown in <a class="reference external" href="index_device_drv.html#hardware-setup">Hardware
Setup</a> section</p></li>
<li><p>Launch the target configuration for the EVM from CCS 7.x.</p></li>
<li><p>Connect to ARM or DSP core as applicable.</p></li>
<li><p>Load the
pdk_&lt;platform&gt;_&lt;version&gt;/packages/MyExampleProjects/USB_DevAudio_&lt;board&gt;_&lt;core&gt;ExampleProject/Debug/USB_DevAudio_&lt;board&gt;_armExampleProject.out.</p></li>
<li><p>Run the program (loaded previously) by pressing F8</p></li>
<li><p>The CCS ConsoleIO will display the following:</p></li>
</ul>
<img alt="../_images/CCS_console_output.png" src="../_images/CCS_console_output.png" />
<ul class="simple">
<li><p>Right click on the “Speaker Icon” on the USB Host (right side of the
toolbar), then select “Playback devices”</p></li>
<li><p>Wait until the “Speakers USB Audio Device” shows up in the “Sound”
dialog</p></li>
</ul>
<img alt="../_images/Sound.png" src="../_images/Sound.png" />
<ul class="simple">
<li><p>Select the “Speakers USB Audio Device” in the “Sound” dialog, then
click the “Configure”</p></li>
</ul>
<img alt="../_images/Speaker_setup.png" src="../_images/Speaker_setup.png" />
<ul class="simple">
<li><p>Click the “Test” in “Speaker Setup”, you should hear the testing tone
in the headphone connected to the EVM</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>‘board’ can be evmAM335x, evmOMAPL137 or lcdkOMAPL138</p>
<p>‘core’ can be arm or c674x</p>
</div>
</div>
</div>
<div class="section" id="pcie">
<h1>6.4. PCIe<a class="headerlink" href="#pcie" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id7">
<h2>6.4.1. Overview<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>PCIe module supports dual operation mode: End Point (EP or Type0) or
Root Complex (RC or Type1). This driver focuses on EP mode but it also
provides access to some basic RC configuration/functionality. For RC
this is the lowest level; additional software is needed to perform
generic enumeration of third party devices.</p>
<p>The PCIe subsystem has two address spaces. The first (Address Space 0)
is dedicated for local application registers, local configuration
accesses and remote configuration accesses. The second (Address Space 1)
is dedicated for data transfer. This PCIe driver focuses on
configuration of the interface and sending/receiving interrupts via
Address Space 0. Data is transferred outside the scope of the LLD using
CPU or EDMA through the data area.</p>
<p>There are three revisions of the pcie hardware. The first, v0, in KeyStone
devices (C66x, K2x). The second, v1, is in AM57xx devices. The third,
v2, is in AM65xx devices.  The LLD
abstacts the configuration of standards-based PCIe registers (Type 0,
Type 1 and Capabilities registers) so same user code can be used on both
device types. However, there are different interfaces for the registers
not based on PCIe standards (port logic and ti-conf which generally
covers interrupts and address translation). That portion of user code
needs to differ between C66x/K2x, AM57xx, and AM65xx devices.</p>
<p>The example includes configuration of one SoC as EP and a second as RC.
It then performs a simple CPU-based memory transfer (EDMA can be used
via the same addresses used by the CPU), and interrupt generation (from
EP) and reception (to RC). It also shows differences in user code
required to support both C66x/K2x, AM57xx and AM65xx devices.</p>
<p class="rubric" id="differences-in-operation-between-c66xk2x-and-am57xx-devices">Differences in Operation between C66x/K2x and AM57xx devices</p>
<p>C66x/K2x, AM57xx, and AM65xx are functionally identical, except that interrupts
are handled by example and lld only on AM57xx.  Also older devices only support
gen 1/2, while AM65xx supports gen 3.</p>
<p class="rubric" id="id8">Modes of Operation</p>
<p>The LLD is intended to bring up the PCIe peripheral, open memory
mappings, and send/receive interrupts.</p>
<p class="rubric" id="root-complex-rc">Root Complex (RC)</p>
<p>The PCIe peripheral can be used as a root complex. One or more other
endpoints can be connected (more than one requires a PCIe switch on the
board). The LLD configures the peripheral in RC mode. It doesn’t attempt
to emulate the full enumeration capability of a Linux driver. Instead
the user will need to supply code specific to each endpoint they intend
to support.</p>
<p class="rubric" id="endpoint-ep">Endpoint (EP)</p>
<p>The PCIe peripheral can be used as an endpoint. This is the more
intended usecase for the LLD. Once the link is initialized, the LLD can
provide data addresses and send interrupts to the RC.</p>
<p class="rubric" id="interrupts">Interrupts</p>
<p>The example for AM57XX provides code to send interrupts from an
endpoint, and the LLD/example together contain code to receive/demux the
interrupts (both MSI and Legacy) on an RC.</p>
</div>
<div class="section" id="id9">
<h2>6.4.2. User Interface<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id10">
<h3>6.4.2.1. Driver Configuration<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="id11">Board-specific configuration</p>
<p>PCIe’s board specific configuration is in the example in
PDK_INSTALL_DIR/packages/ti/drv/pcie/example/sample/am57x/src/pcie_sample_board.c.
Calling sequence is in example and repeated below.</p>
<p class="rubric" id="pcie-configuration-structure">PCIe configuration structure</p>
<p>The pcie_soc.c binds the driver to the hardware on the board. It is
passed into the driver via the call to Pcie_init().</p>
</div>
<div class="section" id="id12">
<h3>6.4.2.2. API Call Flow<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>The API call flow is covered in pcie_sample.c.</p>
<p>The overall components are:</p>
<ol class="arabic simple">
<li><p>Initialize the driver</p></li>
<li><p>Initialize the SERDES and Power the peripheral (see example code for
order for each device)</p></li>
<li><p>Configure RC or EP symmetrically to talk to another similar device</p></li>
<li><p>Perform data IO and interrupt.</p></li>
</ol>
</div>
</div>
<div class="section" id="id13">
<h2>6.4.3. Application<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id14">
<h3>6.4.3.1. Examples<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>EVM
Configuration</p></th>
<th class="head"><p>Expected
Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PCIE_idkAM57[124]x*ExampleProject</p></td>
<td><p>2-device PCIe
connection</p></td>
<td><p><strong>IMPORTANT:</strong>
Cable must be
<a class="reference external" href="http://processors.wiki.ti.com/index.php/PCIe_CableMod">MODIFIED</a>
in order to
avoid damaging
the clock
drivers in the
SoC!</p>
<p>Connect two
like AM57xx
IDK EVMs J22
<a class="reference external" href="http://processors.wiki.ti.com/index.php/PCIe_CableMod">MODIFIED</a>
male-male
crossover
PCIe x1 or x4
cable and
optional
straight-through
extender. For
AM572x/AM574x
we used a
one-lane
cross cable;
for AM571x we
used a 4-lane
cross cable.
| Projects
available for
C66, A15, and
M4.</p>
</td>
<td><p><strong>AM572x/AM574x
or AM571x
EVM</strong> : One
board is
EP/other is RC;
link is
established and
data/interrupts
exchanged. All
printed output
goes to the
serial console.</p></td>
</tr>
<tr class="row-odd"><td><p>PCIE_sample_ExampleProject</p>
<p>(for AM65xx IDK)</p>
</td>
<td><p>2-device PCIe
connection</p></td>
<td><p><strong>IMPORTANT:</strong>
Cable must be
<a class="reference external" href="http://processors.wiki.ti.com/index.php/PCIe_CableMod">MODIFIED</a>
in order to
avoid damaging
the clock
drivers in the
SoC!</p>
<p>Connect two
like AM65xx
IDK EVMs PCIe
using a
<a class="reference external" href="http://processors.wiki.ti.com/index.php/PCIe_CableMod">MODIFIED</a>
male-male
crossover
PCIe x1 or x4
cable and
optional
straight-through
extender.</p>
<p>We used a
one-lane
cross cable.</p>
<p>Executables
for A53 (mpu)
and R5 (mcu)
available.</p>
<p>Note: this is
NOT a CCS
project.  It
is built from
running
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">pcie</span></code>
from $(TI_PDK_INSTALL_DIR)/packages.
Result is in
ti/binary.</p>
</td>
<td><p><strong>AM65xx IDK</strong>
One board is EP/
other
is
RC;
link is
established and
data
exchanged. All
printed output
goes to the
serial console.</p></td>
</tr>
<tr class="row-even"><td><p>PCIE_evmK2G*ExampleProject</p></td>
<td><p>2-device PCIe
connection</p></td>
<td><p><strong>IMPORTANT:</strong>
Cable must be
<a class="reference external" href="http://processors.wiki.ti.com/index.php/PCIe_CableMod">MODIFIED</a>
in order to
avoid damaging
the clock
drivers in the
SoC!</p>
<p>Connect two
K2G  EVMs J5
using a
<a class="reference external" href="http://processors.wiki.ti.com/index.php/PCIe_CableMod">MODIFIED</a>
male-male
crossover
PCIe x1 cable
and optional
straight-through
extender. We
used a
one-lane
cross cable.
Ensure that
jumper J15 is
positioned to
the left hand
two pins as
viewed with
“J15”
silkscreen
right side up
(pin 0 isn’t
clearly
marked). In
the right
hand
position, the
PCIe PLL will
NOT get
clock.
Projects
available for
C66 and A15.</p>
</td>
<td><p><strong>K2G EVM</strong> :
One board is
EP/other is RC;
link is
established and
data is
exchanged. All
printed output
goes to serial
console.</p></td>
</tr>
<tr class="row-odd"><td><p>PCIE_idkAM571x_*armEdmaPktExampleProject
<em>(Available
starting in
Processor-SDK
3.1)</em></p></td>
<td><p>Packet Exchange
over PCIe
Benchmark</p></td>
<td><p><strong>IMPORTANT:</strong>
Cable must be
<a class="reference external" href="http://processors.wiki.ti.com/index.php/PCIe_CableMod">MODIFIED</a>
in order to
avoid damaging
the clock
drivers in the
SoC!</p>
<p>Connect two
like
&gt;=REV1.3A
AM571x  IDK
EVMs J22
using a
<a class="reference external" href="http://processors.wiki.ti.com/index.php/PCIe_CableMod">MODIFIED</a>
male-male
crossover
PCIe x4 cable
and optional
straight-through
extender. We
used a 4-lane
cross cable.
Projects
available for
A15 only.
&gt;=REV1.3A EVM
required (for
x4 PCIe
connectors).</p>
</td>
<td><p><strong>AM571X
&gt;=REV1.3A
IDK</strong> : One
board is
EP/other is RC;
link is
established and
data is
exchanged.
Produces same
output as
standard
ExampleProject,
except EP also
prints packet
exchange
benchmark
results.</p></td>
</tr>
<tr class="row-even"><td><p>Remaining
PCIE_*ExampleProject</p></td>
<td><p>2-device PCIe
connection</p></td>
<td><p>Connect two
like C66x/K2x
(except K2G,
see previous
row) EVMs using
an AMC breakout
card. For K2L,
it is necessary
to configure
the mux via the
BMC console
with
“interface_muxs
el
pcie” command.
Projects
available for
A15 and/or C66
as present in
each device.</p></td>
<td><p><strong>6678, 6657,
K2E, K2H,
K2L</strong> : One
board is
EP/other is RC;
link is
established and
data exchanged.
For A15
projects, all
printed output
goes to serial
console. For
C66 projects,
all printed
output goes to
CCS console.</p></td>
</tr>
<tr class="row-odd"><td><p>PCIE_Qos_ExampleProject</p>
<p>(for AM65xx IDK)</p>
</td>
<td><p>2-device PCIe
connection</p></td>
<td><p><strong>IMPORTANT:</strong>
Cable must be
<a class="reference external" href="http://processors.wiki.ti.com/index.php/PCIe_CableMod">MODIFIED</a>
in order to
avoid damaging
the clock
drivers in the
SoC!</p>
<p>Connect two
like AM65xx
IDK EVMs PCIe
using a
<a class="reference external" href="http://processors.wiki.ti.com/index.php/PCIe_CableMod">MODIFIED</a>
male-male
crossover
PCIe x1 or x4
cable and
optional
straight-through
extender.</p>
<p>We used a
one-lane
cross cable.</p>
<p>Executables
for A53 (mpu)
and R5 (mcu)
available.</p>
<p>Note: this is
NOT a CCS
project.  It
is built from
running
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">pcie</span></code>
from $(TI_PDK_INSTALL_DIR)/packages.
Result is in
ti/binary.</p>
</td>
<td><p><strong>AM65xx IDK</strong>
One board is EP/
other
is
RC;
link is
established and
data
exchanged with
TC0/TC1/TC2(DDR)
/TC3(MSMC).
Then PCIE CPU
read latency
with TC3 is
measured with
background PCIE
read traffic
over TC0 using
DMA.
All printed
output goes to
serial console.</p></td>
</tr>
</tbody>
</table>
<p class="rubric" id="quick-setup-of-xds100-for-two-evms">Quick setup of xds100 for two EVMs</p>
<ol class="arabic simple">
<li><p>create new target configuration using XDS100v2 and AM572x (or AM571x)
from the basic tab.</p></li>
<li><p>Select Advanced tab.</p></li>
<li><p>Highlight the XDS100v2, and click the “new” button and add second
XDS100v2.</p></li>
<li><p>Highlight the newly added XDS100v2, click the “add” button and select
a second Am572x.</p></li>
<li><p>open command prompt, and run ticcs_basecommonuscifxds100serial to
get your serial numbers</p></li>
<li><p>Highlight first XDS100v2, select “Debug Probe Selection” to “Select
by Serial number” and enter one of the 2 serial numbers</p></li>
<li><p>Repeat second XDS100v2, setting to to the second serial number.</p></li>
</ol>
<p>General instructions for configuring multiple EVMs with any emulator
type are available in
<a class="reference external" href="http://software-dl.ti.com/ccs/esd/documents/sdto_ccs_multi-probe-debug.html">Debugging with Multiple Debug Probes</a></p>
<p class="rubric" id="detailed-instructions-to-run-example">Detailed instructions to run example</p>
<p>Ensure 2 Like EVMs are connected with a x1 PCIe male/male cross cable
(for AM5XX) or a breakout card (for C667x, C665x, K2x)</p>
<p>Build project(s) appropriate for your EVM. Projects for A15 and C66 are
provided based on core types available on each device.</p>
<p>Load via jtag either the ARM or DSP projects (but don’t mix and match)
onto the first arm or dsp core of each the 2 EVMs. Same .out file
supports both RC and EP. Use an “expressions” window to set PcieModeGbl
to PCIE_RC_MODE on one EVM (it makes that EVM RC). Leave the second EVM
alone (pcie_EP_MODE). Run the loaded cores. See table above to determine
whether output is expected on serial console or CCS console.</p>
<p class="rubric" id="sample-example-output">Sample example output</p>
<p>Note that output will vary slightly based on device type. The following
is from A57XX. The output from the RC and EP are interleaved since this
is run from a 2*XDS1000 double config as described in <a class="reference external" href="#quick-setup-of-xds100-for-two-evms">Quick setup of
xds100 for two EVMs</a></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>**********************************************
*             PCIe Test Start                *
*                RC mode                     *
**********************************************

Version #: 0x02020003; string PCIE LLD Revision: 02.02.00.03:Dec 24 2015:17:38:37

PCIe Power Up.
PLL configured.
Successfully configured Inbound Translation!
Successfully configured Outbound Translation!
Starting link training...
**********************************************
*             PCIe Test Start                *
*                EP mode                     *
**********************************************

Version #: 0x02020003; string PCIE LLD Revision: 02.02.00.03:Dec 24 2015:17:38:37

PCIe Power Up.
PLL configured.
Successfully configured Inbound Translation!
Successfully configured Outbound Translation!
Starting link training...
Link is up.
Link is up.
End Point received data.
End Point sent data to Root Complex, completing the loopback.
EP sending interrupts to RC
Root Complex received data.
RC waiting for 10 of each of 2 types of interrupts
RC got all 20 interrupts
Test passed.
End of Test.
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="debug-faq">
<h2>6.4.4. Debug FAQ<a class="headerlink" href="#debug-faq" title="Permalink to this headline">¶</a></h2>
<p><strong>If example fails to get link up</strong></p>
<blockquote>
<div><ol class="arabic">
<li><p>Confirm that male/male cross cable or breakout board is correctly
connected.</p></li>
<li><p>If running from ARM cores, confirm that immediately after
reset/reload that both devices have PcieModeGbl=PCIE_EP_MODE. If
the PCIE_RC_MODE seems to survive reset/reload, it seems to mean
watch window failed to refresh. Click the “Refresh” button for the
watch window and it should flip back to EP, where you can reset it
to RC. Simply running will cause both sides to run as EP, which
leads to test failure.</p></li>
<li><p>Confirm that one side of the example has PcieModeGbl=PCIE_RC_MODE
and the other is PCIE_EP_MODE.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When changing to RC you must click somewhere outside
the expression value to make the modification for RC to “take
effect”. Simply pressing F8 after modifying the value will run
without actually modifying the variable! The modification will
be done when the ARM or DSP is stopped, <strong>so everything looks
right, except that the log will show “PCIe test start EP mode”
twice</strong> instead of “PCIe test start EP mode” once and “PCIe
test start RC mode” once.</p>
</div>
</li>
</ol>
</div></blockquote>
<p><strong>How to debug common PCIe issues</strong></p>
<p>Please refer to <a class="reference external" href="http://www.ti.com/lit/an/sprac59a/sprac59a.pdf">PCI Express (PCIe)
FAQ</a> for Keystone devices.</p>
</div>
<div class="section" id="id15">
<h2>6.4.5. Additional References<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>Additional documentation can be found in:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 44%" />
<col style="width: 56%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>Hardware Peripheral Users Guide</p></td>
<td><ul class="simple">
<li><p>C66x/K2x: <a class="reference external" href="http://www.ti.com/lit/sprugs6">User
Guide</a></p></li>
<li><p>AM57XX: TRM Chapter 24.9
titled “PCIe Controller”</p></li>
<li><p>AM65XX: TRM Chapter 12.2.2
titled “Peripheral Component Controller
Interconnect Express (PCIe)
Subsystem”</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)/packages/ti
/drv/pcie/docs/doxygen/html/index
.html</p></td>
</tr>
<tr class="row-even"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)/packages/ti
/drv/pcie/docs/ReleaseNotes_PCIE_LLD.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="gpio">
<h1>6.5. GPIO<a class="headerlink" href="#gpio" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id16">
<h2>6.5.1. Overview<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id17">
<h3>6.5.1.1. Introduction<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>GPIO module allows application to manage General Purpose I/O  instances
and pins via simple portable APIs. Because of its simplicity, APIs are
pin based and does not follow model of other drivers inside PDK which
requires handle abstraction.</p>
<p class="rubric" id="id18">Modes of Operation</p>
<p>Following modes of operations are supported
<strong>Input or Output</strong>
Each gpio pin can be configured as either input: GPIO_CFG_INPUT or
output: GPIO_CFG_OUTPUT. If it is configured as an output then pin
level can be additionally configured</p>
<p><strong>Interrupt support</strong>
Each gpio pin can be configured to generate interrupts based on event
type GPIO_CFG_IN_INT_XXX configuration. To generate interrupt, gpio
pin has to be configured as input pin.</p>
<p class="rubric" id="driver-configuration-gpio">Driver Configuration</p>
<p class="rubric" id="id19"><strong>Board Specific Configuration</strong></p>
<p>All board specific configurations like enabling clock and pin-mux are
required before calling any driver APIs. By default Board_Init() API
available under board module supports all initialization sequence for TI
supported EVMs. In addition it initializes UART instance for
Console/STDIO. Refer <a class="reference external" href="index_board.html#board-support">Processor SDK RTOS Board
Support</a> for additional
details.</p>
<p class="rubric" id="gpio-configuration-structure"><strong>GPIO Configuration Structure</strong></p>
<p>GPIO_soc.c binds driver with hardware attributes on the board.
Hardware attributes includes base address, interrupt number etc. GPIO
pin behavior can be configured statically, or alternatively
dynamically during runtime.</p>
<p>GPIO_init () API triggers all static configuration information available
through hardware attributes. Once initialization is complete additional
APIs can be used to configure and access pins.</p>
</div>
<div class="section" id="id20">
<h3>6.5.1.2. APIs<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>API reference for Application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/gpio/GPIO.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>Below sequence indicates API calling sequence for a simple use case of
LED toggling</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
<span class="n">GPIO_init</span><span class="p">();</span>
<span class="n">While</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">{</span>
<span class="n">GPIO_write</span><span class="p">(</span><span class="n">Board_LED1</span><span class="p">,</span> <span class="n">GPIO_PIN_VAL_HIGH</span><span class="p">);</span>
<span class="n">Delay</span><span class="p">();</span>
<span class="n">GPIO_write</span><span class="p">(</span><span class="n">Board_LED1</span><span class="p">,</span> <span class="n">GPIO_PIN_VAL_LOW</span><span class="p">);</span>
<span class="n">Delay</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id21">
<h2>6.5.2. Application<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id22">
<h3>6.5.2.1. Examples<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>Refer SDK Release Note for GPIO support across different EVMs.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><div class="line-block">
<div class="line">Expected Results</div>
</div>
</th>
<th class="head"><p>SoC Supported</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="2"><p>GPIO_LedBlink</p></td>
<td rowspan="2"><p>Simple example
demonstrating LED
Toggling</p></td>
<td rowspan="2"><div class="line-block">
<div class="line">Following LED
blinks based on EVM
being used.</div>
</div>
<div class="line-block">
<div class="line"><strong>AM335x
ICEv2</strong>:
USER  LED 1</div>
</div>
<div class="line-block">
<div class="line"><strong>AM437x
EVM</strong>:
USER  LED 1</div>
</div>
<div class="line-block">
<div class="line"><strong>AM572x IDK</strong> :
STATUS LED 1 Yellow
<strong>AM572x GP
EVM</strong> : USER LED1
<strong>AM574x IDK</strong> :
STATUS LED 1 Yellow
<strong>AM572x GP
EVM</strong> : USER LED1
<strong>AM571x IDK</strong> :
Industrial LED 3
Red</div>
</div>
<div class="line-block">
<div class="line"><strong>K2H EVM:</strong>
USER LED 2 Blue</div>
</div>
<div class="line-block">
<div class="line"><strong>K2E EVM:</strong>
USER LED 1 Blue</div>
</div>
<div class="line-block">
<div class="line"><strong>K2G EVM:</strong>
USER LED 1 Yellow</div>
</div>
<div class="line-block">
<div class="line"><strong>AM65xx EVM:</strong>
USER LD16, LD17</div>
</div>
</td>
<td><p>AM335x,
AM437x,
AM571x,
AM572x,
AM574x,
k2g,
k2hk,
k2l,
k2e,
c6657,
c6678,
omapl137,</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-odd"><td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are no user mode LEDs directly connected to GPIO pins on K2L, C6678 and C6657 EVMs.</p>
</div>
</div>
</div>
<div class="section" id="building-gpio-examples">
<h2>6.5.3. Building GPIO examples<a class="headerlink" href="#building-gpio-examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Makefile based examples and dependent libraries can be built from the top level or module level GPIO makefile, refer to the <a class="reference external" href="index_overview.html#setup-environment">Processor SDK RTOS Getting Started Guide</a>  for details of how to setup the build environment. Once you have setup the build environment, issue the following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">To</span> <span class="n">build</span> <span class="n">and</span> <span class="n">clean</span> <span class="n">libs</span><span class="o">/</span><span class="n">apps</span> <span class="n">from</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="nl">makefile</span><span class="p">:</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span>
<span class="n">make</span> <span class="n">gpio</span>
<span class="n">make</span> <span class="n">gpio_clean</span>

<span class="n">To</span> <span class="n">build</span> <span class="n">and</span> <span class="n">clean</span> <span class="n">libs</span><span class="o">/</span><span class="n">apps</span> <span class="n">from</span> <span class="n">module</span><span class="o">-</span><span class="n">level</span> <span class="nl">makefile</span><span class="p">:</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">drv</span><span class="o">/</span><span class="n">gpio</span>
<span class="n">make</span> <span class="n">all</span>
<span class="n">make</span> <span class="n">clean</span>
</pre></div>
</div>
<ul class="simple">
<li><p>RTSC CCS project based examples are built from CCS</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span>
<span class="p">.</span><span class="o">/</span><span class="n">pdkProjectCreate</span><span class="p">.</span><span class="n">sh</span> <span class="p">[</span><span class="n">soc</span><span class="p">]</span> <span class="p">[</span><span class="n">board</span><span class="p">]</span> <span class="p">[</span><span class="n">endian</span><span class="p">]</span> <span class="n">gpio</span> <span class="p">[</span><span class="n">project</span> <span class="n">type</span><span class="p">]</span> <span class="p">[</span><span class="n">processor</span><span class="p">]</span> <span class="p">[</span><span class="n">SECUREMODE</span><span class="o">=&lt;</span><span class="n">yes</span><span class="o">/</span><span class="n">no</span><span class="o">&gt;</span><span class="p">]</span>
<span class="n">Import</span> <span class="n">and</span> <span class="n">build</span> <span class="n">CCS</span> <span class="n">Project</span> <span class="n">from</span>  <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">MyExampleProjects</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="faq">
<h2>6.5.4. FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h2>
<p><strong>Is there any example using GPIO as input</strong></p>
<p>Please refer to <a class="reference external" href="index_how_to_guides.html#rtos-customization-using-an-external-input-to-trigger-an-interrupt-on-am57x">RTOS Customization: using an external input to trigger an interrupt
on AM57x</a> for details.</p>
</div>
<div class="section" id="id23">
<h2>6.5.5. Additional References<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 44%" />
<col style="width: 56%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)/packages/ti
/drv/gpio/docs/doxygen/html/index
.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)/packages/ti
/drv/gpio/docs/ReleaseNotes_GPIO
_LLD.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="i2c">
<h1>6.6. I2C<a class="headerlink" href="#i2c" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id24">
<h2>6.6.1. Overview<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id25">
<h3>6.6.1.1. Introduction<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<p>I2C module provides an interface to any I2C-bus-compatible device
accessible via I2C serial bus. External components attached to I2C bus
can serially transmit/receive data to/from the CPU through two-wire
interface. Driver supports three types of transfers in both I2C master
mode and slave mode</p>
<ul class="simple">
<li><p>Read</p></li>
<li><p>Write</p></li>
<li><p>Write followed by read</p></li>
</ul>
<p>In addition driver supports following modes of operation:</p>
<ul class="simple">
<li><p><strong>I2C_MODE_BLOCKING:</strong> By default, driver operates in blocking mode.
In blocking mode, a Task’s code execution is blocked until
transaction is complete. This ensures only one transaction operates
at a given time. Driver supports both interrupt or non-interrupt
based blocking modes.</p></li>
<li><p><strong>I2C_MODE_CALLBACK</strong> In callback mode, an I2C transaction functions
asynchronously, which means that it does not block a Task’s code
execution. After an I2C transaction is complete, I2C driver calls a
user-provided hook function. Only interrupt based callback is
supported.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If I2C peripheral is in reset during a transfer, it can cause the I2C
bus to hang. I2C V0 IP (Keystone SoCs) does not have hardware support to
recover the I2C bus from hanging, user needs to power cycle the board as
a workaround. For I2C V1 IP (AM3/4/5 SoCs), the application can call
I2C_control() API and use I2C_CMD_RECOVER_BUS to recover the I2C bus.</p>
</div>
<p class="rubric" id="firmware">Firmware</p>
<p>TI PRU-ICSS cores (Programmable Real-Time Unit Industrial Communication
Subsystem) is firmware programmable and can take on various
personalities. Processor SDK package includes I2C Firmware support.
Refer <a class="reference external" href="index_pru_icss_fw.html#pru-icss-i2c">I2C FW</a> for
additional details.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id26">
<h2>6.6.2. User Interface<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id27">
<h3>6.6.2.1. Driver Configuration<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="id28"><strong>Board Specific Configuration</strong></p>
<p>All the board specific configurations eg:enabling and pin-mux of I2C
pins should be performed before calling any driver APIs.By default
Board_Init() API supports all initialization sequence for TI supported
EVMs.Refer <a class="reference external" href="index_board.html#board-support">Processor SDK RTOS Board
Support</a> for additional
details.</p>
<p>Once the board specific configuration is complete driver API I2C_init()
can be called to initialize driver</p>
<p class="rubric" id="i2c-configuration-structure"><strong>I2C Configuration Structure</strong></p>
<p>I2C_soc.c file binds driver with hardware attributes on the board
through I2C_config structure. This structure must be provided to I2C
driver. It must be initialized before the I2C_init() function is called
and cannot be changed afterwards. For details about the individual
fields of this structure, see the Doxygen help by opening
PDK_INSTALL_DIR\packages\ti\drv\i2c\docs\doxygen\html\index.html.</p>
</div>
<div class="section" id="id29">
<h3>6.6.2.2. APIs<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/i2c/I2C.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p> Sample code for initiating I2C transaction:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">I2C_socGetInitCfg</span><span class="p">(</span><span class="n">peripheralNum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2c_cfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">I2C_socSetInitCfg</span><span class="p">(</span><span class="n">peripheralNum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2c_cfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">i2c</span> <span class="o">=</span> <span class="n">I2C_open</span><span class="p">(</span><span class="n">peripheralNum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2cParams</span><span class="p">);</span>
<span class="p">...</span>
<span class="p">...</span>

<span class="cm">/* Initiate I2C transfers. Refer Example for details</span>
<span class="cm">*/</span>
<span class="n">I2C_transactionInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2cTransaction</span><span class="p">);</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">masterMode</span>   <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">...</span>
<span class="p">...</span>
<span class="n">transferOK</span> <span class="o">=</span> <span class="n">I2C_transfer</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2cTransaction</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">transferOK</span> <span class="o">!=</span> <span class="n">I2C_STS_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
<span class="cm">/* I2C transaction failed */</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id30">
<h2>6.6.3. Application<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id31">
<h3>6.6.3.1. Examples<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<p>Refer Release Note for I2C support across different EVMs</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 19%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">Name</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Expected Results</div>
</div>
</th>
<th class="head"><p>SoC Supported</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>I2C_EepromRead
Example application</p></td>
<td><div class="line-block">
<div class="line">Simple example to
read fixed number
of bytes from
EEPROM on board and
compares it with
expected data.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Following prints will
come on console based
on pass/fail
criteria:</div>
<div class="line"><br /></div>
<div class="line"><strong>Pass criteria:</strong></div>
<div class="line"><br /></div>
<div class="line">EEPROM data matched
All tests have
passed.</div>
</div>
</td>
<td><p>AM335x,
AM437x,
AM571x,
AM572x,
AM574x,
k2g,
k2hk,k2l,k2e,k2l
c6657,c6678
omapl137,</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>I2C_TestApplication</p></td>
<td rowspan="2"><div class="line-block">
<div class="line">Driver Unit Test
application for
additional I2C
speed and other tests</div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line">Following prints will
come on console based
on pass/fail
criteria:</div>
<div class="line"><br /></div>
<div class="line"><strong>Pass criteria:</strong></div>
<div class="line"><br /></div>
<div class="line">I2C Test: 100Kbps:
PASS</div>
<div class="line"><br /></div>
<div class="line">I2C Test: 400Kbps:
PASS</div>
<div class="line"><br /></div>
<div class="line">I2C Test: timeout
test passed</div>
<div class="line"><br /></div>
<div class="line">All tests have
passed.</div>
</div>
</td>
<td><p>AM335x,
AM437x,
AM571x,
AM572x,
AM574x,
k2g,
k2hk,
k2l,
k2e,
c6657,
c6678,
omapl137,</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-even"><td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>I2C_SMP_Test
Application</p></td>
<td rowspan="2"><div class="line-block">
<div class="line">Driver Unit Test
application for
additional I2C
speed and other tests
with SMP enabled.
(A15 and A53 cores)</div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line">Following prints will
come on console based
on pass/fail
criteria:</div>
<div class="line"><br /></div>
<div class="line"><strong>Pass criteria:</strong></div>
<div class="line"><br /></div>
<div class="line">I2C Test: 100Kbps:
PASS</div>
<div class="line"><br /></div>
<div class="line">I2C Test: 400Kbps:
PASS</div>
<div class="line"><br /></div>
<div class="line">I2C Test: timeout
test passed</div>
<div class="line"><br /></div>
<div class="line">All tests have
passed.</div>
</div>
</td>
<td><p>am572x-evm</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-even"><td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
<tr class="row-odd"><td><p>I2C_TemperatureSensor</p></td>
<td><div class="line-block">
<div class="line">Example to get the
temperature value
from the temperature
sensor and displays
on the serial
console.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Following prints will
come on console based
on pass/fail
criteria:</div>
<div class="line"><br /></div>
<div class="line"><strong>Pass criteria:</strong></div>
<div class="line"><br /></div>
<div class="line">Temperature =
“value in
centigrades” C
All tests have
passed.</div>
</div>
</td>
<td><p>AM572x,</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-even"><td><p>I2C_master/slave</p></td>
<td><div class="line-block">
<div class="line">Application
demonstrates
master/slave
transfer of I2C.
Application use
case requires two
EVMs. One acts as
Master and the
other as slave. I2C
connections
information and
addtional details
are as follows:</div>
<div class="line"><br /></div>
<div class="line">AM57xx boards I2C bus
connection on J9
(master board &lt;–&gt;
slave board)</div>
<div class="line"><br /></div>
<div class="line">pin22 (SCL)&lt;–&gt;
pin22 (SCL)</div>
<div class="line"><br /></div>
<div class="line">pin24 (SDA)&lt;–&gt; pin24
(SDA)</div>
<div class="line"><br /></div>
<div class="line">pin21 (GND)&lt;–&gt; pin21
(GND)</div>
<div class="line"><br /></div>
<div class="line">K2G boards I2C bus
connection on J12
(master board &lt;–&gt;
slave board)
pin28 (SCL)&lt;–&gt;
pin28 (SCL)
pin30 (SDA)&lt;–&gt;
pin30 (SDA)
pin50 (GND)&lt;–&gt;
pin50 (GND)</div>
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">OMAPL138/C6748
boards I2C bus
connection on J15
(master board &lt;–&gt;
slave board)
pin13 (SCL)&lt;–&gt;
pin13 (SCL)
pin15 (SDA)&lt;–&gt;
pin15 (SDA)
pin35 (GND)&lt;–&gt;
pin35 (GND)</div>
<div class="line"><br /></div>
<div class="line">Run
“I2C_Slave_&lt;BoardTy
pe&gt;_&lt;arm/c66x/m4&gt;Test
Project”
first on Slave EVM
and then
“I2C_Master_&lt;BoardT
ype&gt;_&lt;arm/c66x/m4&gt;Tes
tProject”
on Master EVM.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Following prints will
come on console based
on pass/fail
criteria:</div>
<div class="line"><br /></div>
<div class="line"><strong>Pass criteria:</strong></div>
<div class="line"><br /></div>
<div class="line">All tests have
passed.</div>
</div>
</td>
<td><p>AM572x,
AM574x,
k2g,
omapl138,</p></td>
<td><p>CCS project</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I2C_Test Application supports write test on Keystone II EVMs, by default
write test is disabled, user can enable the write test by defining
I2C_EEPROM_WRITE_ENABLE in test/eeprom_read/src/I2C_board.h.
I2C_TemperatureSensor Application is supported only on AM572x GP EVM.</p>
</div>
</div>
</div>
<div class="section" id="building-i2c-examples">
<h2>6.6.4. Building I2C examples<a class="headerlink" href="#building-i2c-examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Makefile based examples and dependent libraries can be built from the top level or module level I2C makefile, refer to the <a class="reference external" href="index_overview.html#setup-environment">Processor SDK RTOS Getting Started Guide</a>  for details of how to setup the build environment. Once you have setup the build environment, issue the following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">To</span> <span class="n">build</span> <span class="n">and</span> <span class="n">clean</span> <span class="n">libs</span><span class="o">/</span><span class="n">apps</span> <span class="n">from</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="nl">makefile</span><span class="p">:</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span>
<span class="n">make</span> <span class="n">i2c</span>
<span class="n">make</span> <span class="n">i2c_clean</span>

<span class="n">To</span> <span class="n">build</span> <span class="n">and</span> <span class="n">clean</span> <span class="n">libs</span><span class="o">/</span><span class="n">apps</span> <span class="n">from</span> <span class="n">module</span><span class="o">-</span><span class="n">level</span> <span class="nl">makefile</span><span class="p">:</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">drv</span><span class="o">/</span><span class="n">i2c</span>
<span class="n">make</span> <span class="n">all</span>
<span class="n">make</span> <span class="n">clean</span>
</pre></div>
</div>
<ul class="simple">
<li><p>RTSC CCS project based examples are built from CCS</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span>
<span class="p">.</span><span class="o">/</span><span class="n">pdkProjectCreate</span><span class="p">.</span><span class="n">sh</span> <span class="p">[</span><span class="n">soc</span><span class="p">]</span> <span class="p">[</span><span class="n">board</span><span class="p">]</span> <span class="p">[</span><span class="n">endian</span><span class="p">]</span> <span class="n">i2c</span> <span class="p">[</span><span class="n">project</span> <span class="n">type</span><span class="p">]</span> <span class="p">[</span><span class="n">processor</span><span class="p">]</span> <span class="p">[</span><span class="n">SECUREMODE</span><span class="o">=&lt;</span><span class="n">yes</span><span class="o">/</span><span class="n">no</span><span class="o">&gt;</span><span class="p">]</span>
<span class="n">Import</span> <span class="n">and</span> <span class="n">build</span> <span class="n">CCS</span> <span class="n">Project</span> <span class="n">from</span>  <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">MyExampleProjects</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="id32">
<h2>6.6.5. Additional References<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\i2c\docs\doxygen\html\index.
html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\i2c\docs\ReleaseNotes_I2C_LL
D.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="serdes-diag">
<h1>6.7. Serdes Diag<a class="headerlink" href="#serdes-diag" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id33">
<h2>6.7.1. Overview<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id34">
<h3>6.7.1.1. Introduction<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h3>
<p>This tool demonstrates how to configure and use the Serdes Diag APIs
on KeyStone 3 device family. The DIAG APIs currently support R5F arch.
There are 2 tests included in the package:</p>
<ul class="simple">
<li><p>Serdes Diag BER Test</p></li>
<li><p>Serdes Diag EYE Test</p></li>
<li><p><strong>Serdes Diag BER Test:</strong> The example finds out the optimal TX coefficients
(CM, C1, C2) by performing Bit Error Rate (BER) sweeps on the Serdes where the
EVM sends the transmit pattern (for example PRBS 31) and the EVM also detects
the receive sequence and performs BER calculations across the desired serdes
using the CPU. The sweep results are printed into a text file.</p></li>
<li><p><strong>Serdes Diag EYE Test</strong> The example performs on chip eye measurement
allowing the user to see the eye opening of the receive data after
equalization. The EVM sends the transmit pattern (for example PRBS 31) and
detects the sequence and performs EYE measurements across the desired serdes
using the CPU. The results are printed into a text file.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently only internal loopback is supported on the EVM.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id35">
<h2>6.7.2. User Interface<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id36">
<h3>6.7.2.1. Driver Configuration<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="serdes-diag-configuration-structure"><strong>Serdes Diag Configuration Structure</strong></p>
<p>serdes_diag_test_main.c contains the main function. It initializes all the
serdes peripherals using the serdes_diag_test_init( ) API. The
serdes_diag_test_phy_type should be specified in serdes_diag_platform.h
in order to run the BER/EYE test for that specific SERDES.</p>
</div>
<div class="section" id="id37">
<h3>6.7.2.2. APIs<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h3>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/diag/serdes_diag/src/am65xx/serdes_diag_k3.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p> Sample code for initiating Serdes Diag transaction:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="cm">/* Initiatize the serdes using serdes_diag_platform.h</span>
<span class="cm">*/</span>
<span class="n">serdes_diag_test_init</span><span class="p">();</span>
<span class="p">...</span>
<span class="cm">/* BER Test Initialization Parameters can be edited</span>
<span class="cm">inside this API */</span>
<span class="n">Serdes_Example_BERTest</span><span class="p">();</span>
<span class="n">OR</span>
<span class="cm">/* On Die Scope/Eye Scan Test Initialization Parameters</span>
<span class="cm">can be edited inside this API */</span>
<span class="n">Serdes_Example_EYETest</span><span class="p">();</span>
<span class="p">...</span>
<span class="p">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id38">
<h2>6.7.3. Application<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id39">
<h3>6.7.3.1. Examples<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h3>
<p>Refer Release Note for Serdes Diag support across different EVMs</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 19%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">Name</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Expected Results</div>
</div>
</th>
<th class="head"><p>SoC Supported</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>serdes_diag_BER_app</p></td>
<td><div class="line-block">
<div class="line">BER example</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Following prints will
come on console based
on pass/fail
criteria:</div>
<div class="line"><br /></div>
<div class="line"><strong>Pass criteria:</strong></div>
<div class="line"><br /></div>
<div class="line">The sweep results are
printed into a text
file</div>
</div>
</td>
<td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
<tr class="row-odd"><td><p>serdes_diag_EYE_app</p></td>
<td><div class="line-block">
<div class="line">EYE example</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Following prints will
come on console based
on pass/fail
criteria:</div>
<div class="line"><br /></div>
<div class="line"><strong>Pass criteria:</strong></div>
<div class="line"><br /></div>
<div class="line">I2C Test: 100Kbps:
PASS</div>
<div class="line"><br /></div>
<div class="line">I2C Test: 400Kbps:
PASS</div>
<div class="line"><br /></div>
<div class="line">I2C Test: timeout
test passed</div>
<div class="line"><br /></div>
<div class="line">All tests have
passed.</div>
</div>
</td>
<td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently only R5F platform is supported with the above examples.</p>
</div>
</div>
</div>
<div class="section" id="building-serdes-diag-examples">
<h2>6.7.4. Building Serdes Diag examples<a class="headerlink" href="#building-serdes-diag-examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Makefile based examples and dependent libraries can be built from the top level or module level Serdes Diag makefile, refer to the <a class="reference external" href="index_overview.html#setup-environment">Processor SDK RTOS Getting Started Guide</a>  for details of how to setup the build environment. Once you have setup the build environment, issue the following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">To</span> <span class="n">build</span> <span class="n">and</span> <span class="n">clean</span> <span class="n">libs</span><span class="o">/</span><span class="n">apps</span> <span class="n">from</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="nl">makefile</span><span class="p">:</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span>
<span class="n">make</span> <span class="n">serdes_diag</span>
<span class="n">make</span> <span class="n">serdes_diag_clean</span>

<span class="n">To</span> <span class="n">build</span> <span class="n">and</span> <span class="n">clean</span> <span class="n">libs</span><span class="o">/</span><span class="n">apps</span> <span class="n">from</span> <span class="n">module</span><span class="o">-</span><span class="n">level</span> <span class="nl">makefile</span><span class="p">:</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">diag</span><span class="o">/</span><span class="n">serdes_diag</span>
<span class="n">make</span> <span class="n">all</span>
<span class="n">make</span> <span class="n">clean</span>
</pre></div>
</div>
<ul class="simple">
<li><p>CCS project based examples are built from CCS</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span>
<span class="p">.</span><span class="o">/</span><span class="n">pdkProjectCreate</span><span class="p">.</span><span class="n">sh</span> <span class="p">[</span><span class="n">soc</span><span class="p">]</span> <span class="p">[</span><span class="n">board</span><span class="p">]</span> <span class="p">[</span><span class="n">endian</span><span class="p">]</span> <span class="n">serdes_diag</span> <span class="p">[</span><span class="n">project</span> <span class="n">type</span><span class="p">]</span> <span class="p">[</span><span class="n">processor</span><span class="p">]</span> <span class="p">[</span><span class="n">SECUREMODE</span><span class="o">=&lt;</span><span class="n">yes</span><span class="o">/</span><span class="n">no</span><span class="o">&gt;</span><span class="p">]</span>
<span class="n">Import</span> <span class="n">and</span> <span class="n">build</span> <span class="n">CCS</span> <span class="n">Project</span> <span class="n">from</span>  <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">MyExampleProjects</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="id40">
<h2>6.7.5. Additional References<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\diag\serdes_diag\docs\doxygen\html
\index.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\diag\serdes_diag\docs\Serdes_Diag_
Release_Notes.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="mcspi-qspi-ospi">
<h1>6.8. McSPI-QSPI-OSPI<a class="headerlink" href="#mcspi-qspi-ospi" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id41">
<h2>6.8.1. Introduction<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h2>
<p>SPI driver enables communication for general SPI, MCSPI (Multichannel
SPI), QSPI (Quad SPI) and OSPI (Octal SPI) based peripherals on board
through common API to application.
MCSPI is a generic full-duplex interface supporting transmit and
receive of data over SPI bus. QSPI/OSPI is a variant of SPI supports four
receive data lanes. Driver supports configuration for either single,
dual, quad or octal data lines</p>
</div>
<div class="section" id="id42">
<h2>6.8.2. Modes of Operation<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h2>
<p>Following modes of operations are supported:</p>
<p><strong>SPI_MODE_BLOCKING</strong>
<em>SPI_transfer()</em> API blocks code execution until transaction has
completed. By default, SPI driver operates in blocking mode. This
ensures only one SPI transaction operates at a given time. This mode
is supported in both interrupt or non-interrupt configurations.</p>
<p><strong>SPI_MODE_CALLBACK</strong>
<em>SPI_transfer()</em> API returns without waiting for completion of
transaction in this case. Callback function registered by application
is invoked once transaction is complete.This mode is supported only in
interrupt configuration.</p>
</div>
<div class="section" id="id43">
<h2>6.8.3. Driver Configuration<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id44">
<h3>6.8.3.1. Board Specific Configuration<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h3>
<p>All board specific configurations eg:enabling clock and pin-mux for SPI
pins are required before calling any driver APIs.By default Board_Init()
API supports all initialization sequence for TI supported EVMs. In
addition it initializes UART instance for Console/STDIO.Refer <a class="reference external" href="index_board.html#board-support">Processor
SDK RTOS Board Support</a>
for additional details.Once board specific configuration is
complete <em>SPI_init()</em> API should be called to initialize driver.</p>
</div>
<div class="section" id="soc-specific-configuration">
<h3>6.8.3.2. SoC Specific Configuration<a class="headerlink" href="#soc-specific-configuration" title="Permalink to this headline">¶</a></h3>
<p>All SoC specific configurations (eg: SPI module registers base address,
interrupt configurations, etc.) can be set using SPI_socSetInitCfg() SoC
driver API before calling any SPI driver APIs. The default SoC specific
configurations can be retrieved using SPI_socGetInitCfg() SoC driver
API.</p>
</div>
<div class="section" id="spi-configuration-structure">
<h3>6.8.3.3. SPI Configuration Structure<a class="headerlink" href="#spi-configuration-structure" title="Permalink to this headline">¶</a></h3>
<p>The <em>SPI_soc.c</em> file binds driver with hardware attributes on the board
through <em>SPI_config[]</em> structure. This structure must be provided to the
SPI driver. It must be initialized before the <em>SPI_init()</em> function is
called and cannot be changed afterwards. For details about individual
fields of this structure, see Doxygen help by opening
<em>PDK_INSTALL_DIRpackagestidrvspidocsdoxygenhtmlindex.html.</em></p>
<p>Driver  requires common <em>SPI_config[]</em>  to configure hardware attributes
of MCSPI and QSPI/OSPI peripherals on SOC and board. First all MCSPI related
hardware attributes is defined followed by QSPI/OSPI hardware attributes.
Application will need to include appropriate offset to instance while
invoking <em>SPI_open()</em> API..</p>
</div>
</div>
<div class="section" id="id45">
<h2>6.8.4. APIs<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h2>
<p>API Reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/spi/SPI.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>SPI IP V1 driver also supports multi-channel API’s:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/spi/MCSPI.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<div class="section" id="open-spi">
<h3>6.8.4.1. Open SPI<a class="headerlink" href="#open-spi" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">SPI_socGetInitCfg</span><span class="p">(</span><span class="n">peripheralNum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spi_cfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">SPI_socSetInitCfg</span><span class="p">(</span><span class="n">peripheralNum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spi_cfg</span><span class="p">);</span>
<span class="n">SPI_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spiParams</span><span class="p">);</span>
<span class="n">spiParams</span><span class="p">.</span><span class="n">transferMode</span> <span class="o">=</span> <span class="n">SPI_MODE_BLOCKING</span><span class="p">;</span>
<span class="n">spiParams</span><span class="p">.</span><span class="n">transferCallbackFxn</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="n">handle</span> <span class="o">=</span> <span class="n">SPI_open</span><span class="p">(</span><span class="n">peripheralNum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spiParams</span><span class="p">);</span>
</pre></div>
</div>
<p>SPI IP V1 driver also supports multi-channel open API’s:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">MCSPI_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spiParams</span><span class="p">);</span>
<span class="n">spiParams</span><span class="p">.</span><span class="n">transferMode</span> <span class="o">=</span> <span class="n">SPI_MODE_BLOCKING</span><span class="p">;</span>
<span class="n">spiParams</span><span class="p">.</span><span class="n">transferCallbackFxn</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="n">handle</span> <span class="o">=</span> <span class="n">MCSPI_open</span><span class="p">(</span><span class="n">peripheralNum</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spiParams</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>At this point SPI driver is ready for data transfer in blocking mode
on specific instance identified by handle. Pseudo/Sample code for
SPI read/write transaction is included below. Refer example for
additional details</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">spiTransaction</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>    <span class="cm">/* Transfer Length */</span>
<span class="n">spiTransaction</span><span class="p">.</span> <span class="n">txBuf</span> <span class="o">=</span> <span class="n">transmitBuffer</span><span class="p">;</span> <span class="cm">/* Buffer to be written */</span>
<span class="n">spiTransaction</span><span class="p">.</span><span class="n">rxBuf</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>  <span class="cm">/* Buffer holding the received data */</span>
<span class="n">transferOK</span> <span class="o">=</span> <span class="n">SPI_transfer</span><span class="p">(</span><span class="n">spi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spiTransaction</span><span class="p">);</span> <span class="cm">/* Perform SPI transfer */</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">transferOK</span><span class="p">)</span> <span class="p">{</span>
<span class="cm">/* SPI transaction failed */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>SPI IP V1 driver also supports multi-channel transfer API’s:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">spiTransaction</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>    <span class="cm">/* Transfer Length */</span>
<span class="n">spiTransaction</span><span class="p">.</span> <span class="n">txBuf</span> <span class="o">=</span> <span class="n">transmitBuffer</span><span class="p">;</span> <span class="cm">/* Buffer to be written */</span>
<span class="n">spiTransaction</span><span class="p">.</span><span class="n">rxBuf</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>  <span class="cm">/* Buffer holding the received data */</span>
<span class="n">transferOK</span> <span class="o">=</span> <span class="n">MCSPI_transfer</span><span class="p">(</span><span class="n">spi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spiTransaction</span><span class="p">);</span> <span class="cm">/* Perform SPI transfer */</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">transferOK</span><span class="p">)</span> <span class="p">{</span>
<span class="cm">/* SPI transaction failed */</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SPI_open API supports configuration of data word length in the
SPI_Params. Currently IP V1 driver (for AM3/4/5 devices) supports
8/16/32-bit word length, IP V0 driver (for Keystone devices) supports
8/16-bit word length.</p>
</div>
</div>
</div>
<div class="section" id="id46">
<h2>6.8.5. Examples<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h2>
<div class="section" id="spi">
<h3>6.8.5.1. SPI<a class="headerlink" href="#spi" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 19%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
<th class="head"><p>SoC Supported</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SPI_FlashReadWrite</p>
<p>Example application</p>
</td>
<td><p>Sample application
demonstrating read
and write of data
to a NOR flash
device connected
over SPI interface.
By default, write
test is disabled,
user can enable
write test by
defining
TEST_SPI_NOR_WRITE
in
test/src/SPI_board.h</p>
<p>If write test is
enabled, write
transaction is
verified
for correctness by
reading contents
back.</p>
</td>
<td><p>Following prints on
console expected:
<strong>Pass criteria:</strong></p>
<p>All tests have
passed.</p>
</td>
<td><p>k2g,
k2hk,
k2l,
k2e,
c6657,
c6678,
omapl137,</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-odd"><td><p>SPI_TestApplication</p></td>
<td><p>Driver unit test
application to
validate features
and interfaces for
SPI driver</p></td>
<td><p>Following prints on
console expected:
<strong>Pass criteria:</strong>
All tests have
passed.</p></td>
<td><p>am335x
AM437x,
AM571x,
AM572x,
AM574x,</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-even"><td><p>spiLoopback example</p></td>
<td><p>Example application
to validate
features and
interfaces for SPI
driver in loopback
mode. Configures
the SPI in loopback
mode, transmits a
test pattern and
receives it back
from SPI.</p>
<p>Note: This example
is intended to
demonstrate the SPI
LLD API usage on
the HW platforms
where SPI memory is
not available.
Currently this
example is
supported on
OMAPL138/C6748
platforms.</p>
</td>
<td><p>Following prints on
console expected:
<strong>Pass criteria:</strong>
All tests have
passed.</p></td>
<td><p>k2g,
k2l,
k2e,
omapl138,
AM335x,
AM437x,
AM571x,
AM572x,
AM574x,</p></td>
<td><p>CCS project</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="qspi">
<h3>6.8.5.2. QSPI<a class="headerlink" href="#qspi" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 19%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
<th class="head"><p>SoC Supported</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>QSPI_FlashReadWrite</p>
<p>Example application</p>
</td>
<td><p>Sample application
demonstrating read
and write of data
to a flash device
connected over QSPI
interface. Write
transaction is
verified  for
correctness by
reading contents
back.</p></td>
<td><p>Following prints on
console expected:
<strong>Pass criteria:</strong></p>
<p>All tests have
passed.</p>
</td>
<td><p>AM437x,
AM571x,
AM572x,
AM574x,
k2g,</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-odd"><td><p>QSPI_TestApplication</p></td>
<td><p>Driver unit test
application to
validate features
and interfaces for
QSPI driver</p></td>
<td><p>Following prints on
console expected:
<strong>Pass criteria:</strong>
All tests have
passed.</p></td>
<td><p>AM437x,
AM571x,
AM572x,
AM574x,
k2g,</p></td>
<td><p>CCS project</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="ospi">
<h3>6.8.5.3. OSPI<a class="headerlink" href="#ospi" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 19%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
<th class="head"><p>SoC Supported</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>OSPI_TestApplication</p></td>
<td><p>Driver unit test
application to
validate features
and interfaces for
OSPI driver</p></td>
<td><p>Following prints on
console expected:
<strong>Pass criteria:</strong>
All tests have
passed.</p></td>
<td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
<tr class="row-odd"><td><p>OSPI_SMP_Test
Application</p></td>
<td><p>Driver unit test
application to
validate features
and interfaces for
OSPI driver in SMP
mode. (A53 core)</p></td>
<td><p>Following prints on
console expected:
<strong>Pass criteria:</strong>
All tests have
passed.</p></td>
<td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mcspi">
<h3>6.8.5.4. MCSPI<a class="headerlink" href="#mcspi" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 30%" />
<col style="width: 13%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Additional EVM
Configuration</p></th>
<th class="head"><p>Expected
Results</p></th>
<th class="head"><p>SoC Supported</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MCSPI_Serialize
r
Example
application</p></td>
<td><p>Sample
Application
demonstrating
reading data
generated from
industrial
input module.
Application
uses GPIO pins
to assert load
signal in order
to generate
date from
industrial
input module.</p></td>
<td><p><strong>AM57x IDK EVM:</strong></p>
<p>Short pins 1  and 2 on header
J37(Industrial I/O)</p>
<p><strong>AM335x ICE v2:</strong>
Short pins 1 and 2 on header
J14(Industrial I/O)</p>
<p><strong>AM437x IDK EVM:</strong>
Short pins 1 and 2 on
header J1(Industrial I/O)</p>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line">** **</div>
</div>
<p>Following
prints  on
console
expected:</p>
<p><strong>Pass
criteria:</strong></p>
<p>All tests have
passed.</p>
</td>
<td><p>AM335x,
AM437x,
AM571x,
AM572x,
AM574x,</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-odd"><td><p>MCSPI_Dma_Seria
lizer
Example
application</p></td>
<td><p>Sample
Application
demonstrating
reading data
generated from
industrial
input module
through EDMA.
Application
uses GPIO pins
to assert load
signal in order
to generate
date from
industrial
input module.</p></td>
<td><p><strong>AM57x IDK EVM:</strong>
Short pins 1 and 2 on header
J37(Industrial I/O)
|
<strong>AM437x IDK EVM:</strong>
Short pins 1 and 2 on header
J1(Industrial I/O)</p></td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line">** **</div>
</div>
<p>Following
prints  on
console
expected:</p>
<p><strong>Pass
criteria:</strong></p>
<p>All tests have
passed.</p>
</td>
<td><p>AM437x,
AM571x,
AM572x,
AM574x,</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-even"><td><p>MCSPI_SerialFla
sh</p></td>
<td><p>Sample
Application
demonstrating
writing and
reading data
from the serial
flash through
MCSPI EDMA
interface.</p></td>
<td><p><strong>AM335x GP EVM:</strong>
Set the EVM in profile 2
(SW8[1] = OFF,</p>
<blockquote>
<div><p>SW8[2] = ON,
SW8[3:4] = OFF)</p>
</div></blockquote>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line">** **</div>
</div>
<p>Following
prints  on
console
expected:</p>
<p><strong>Pass
criteria:</strong></p>
<p>All tests have
passed.</p>
</td>
<td><p>AM335x,</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>MCSPI_slavemode
example
application</p></td>
<td rowspan="2"><p>Application
demonstrates
slave recieve
and transmit
features of
McSPI.
Application use
case requires
two EVMs. One
acts as Master
and Another as
slave. McSPI
connections
information and
addtional
details are as
follows.</p>
<p><strong>No of Boards
Required</strong>:</p>
<p>2</p>
<p><strong>Connection
requirements:</strong></p>
<div class="line-block">
<div class="line">Consider EVM1
as Master and
EVM2 as
slave.</div>
<div class="line">MasterSPI_CLK
——-SlaveS</div>
</div>
<p>PI_CLK
| MasterSPI_D0-
———SlaveS
PI_D1
| MasterSPI_D1-
———Slave</p>
<blockquote>
<div><p>SPI_D0</p>
</div></blockquote>
<div class="line-block">
<div class="line">MasterSPI_CS0</div>
</div>
<p>——–SlaveSP
I_CS0
| DGND———
————-DG
ND</p>
<p><strong>Additional
Requirements:</strong></p>
<p>Run
“MCSPI_SlaveMod
<a href="#id288"><span class="problematic" id="id289">e_SlaveExample_</span></a>
&lt;BoardType&gt;&lt;arm
/c66x/m4&gt;Exampl
eProject”
first on Slave
EVM and then
“MCSPI_SlaveMode
_MasterExample
&lt;BoardType&gt;_&lt;ar
m/c66x/m4&gt;Examp
leProject”
on Master EVM.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><strong>Note:</strong></div>
</div>
<p>A DGND
connection may
be required
from expansion
connector on
each board to
make sure the
data transfer
is proper.</p>
</td>
<td rowspan="2"><p><strong>Pin Connections:</strong></p>
<div class="line-block">
<div class="line"><strong>IDK AM571x,</strong></div>
<div class="line"><strong>IDK AM572x or IDK AM574x:</strong></div>
<div class="line">EVM1(master) ==== EVM2(slave)</div>
<div class="line">J21-Pin24(CLK)—J21-Pin24(CLK)</div>
<div class="line">J21-Pin26(MISO)—J21-Pin28(MISO)</div>
<div class="line">J21-Pin28(MOSI)—J21-Pin26(MOSI)</div>
<div class="line">J21-Pin30(CS)——J21-Pin30(CS)</div>
<div class="line">J21-Pin22(DGND)–J21-Pin22(DGND)</div>
<div class="line"><br /></div>
<div class="line"><strong>IDK AM437x:</strong></div>
<div class="line">EVM1(master) ==== EVM2(slave)</div>
<div class="line">J16-Pin24(CLK)—–J16-Pin24(CLK)</div>
<div class="line">J16-Pin26(MISO)—J16-Pin28(MISO)</div>
<div class="line">J16-Pin28(MOSI)—J16-Pin26(MOSI)</div>
<div class="line">J16-Pin30(CS)——J16-Pin30(CS)</div>
<div class="line">J16-Pin22(DGND)–J16-Pin22(DGND)</div>
<div class="line"><br /></div>
<div class="line"><strong>ICEv2AM335x:</strong></div>
<div class="line">EVM1(master) ========= EVM2(slave)</div>
<div class="line">J3-Pin12(CLK)———J3-Pin12(CLK)</div>
<div class="line">J3-Pin14(MIS0)——-J3-Pin16(MISO)</div>
<div class="line">J3-Pin16(MOSI)——-J3-Pin14(MOSI)</div>
<div class="line">J3-Pin18(CS)———–J3-Pin18(CS)</div>
<div class="line">J3-Pin2(DGND)——–J3-Pin2(DGND)</div>
<div class="line"><br /></div>
<div class="line"><strong>BBB AM335x:</strong></div>
<div class="line">EVM1(master) ===== EVM2(slave)</div>
<div class="line">P9-Pin31(CLK)——-P9-Pin31(CLK)</div>
<div class="line">P9-Pin29(MISO)——P9-Pin30(MISO)</div>
<div class="line">P9-Pin30(MOSI)——P9-Pin29(MOSI)</div>
<div class="line">P9-Pin28(CS)———P9-Pin28(CS)</div>
<div class="line">P9-Pin1(DGND)——-P9-Pin1(DGND)</div>
<div class="line"><br /></div>
<div class="line"><strong>K2G EVM:</strong></div>
<div class="line">EVM1(master) ======= EVM2(slave)</div>
<div class="line">J12-Pin9(MISO)——-J12-Pin9(MISO)</div>
<div class="line">J12-Pin11(MOSI)—-J12-Pin11(MOSI)</div>
<div class="line">J12-Pin13(CLK)——J12-Pin13(CLK)</div>
<div class="line">J12-Pin15(CS0)——J12-Pin15(CS0)</div>
<div class="line">J12-Pin49(DGND)–J12-Pin49(DGND)</div>
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><strong>icev2AMIC110 EVM:</strong></div>
<div class="line">EVM1(master) ======= EVM2(slave)</div>
<div class="line">J5-Pin12(MISO)——-J5-Pin14(MISO)</div>
<div class="line">J5-Pin14(MOSI)——J5-Pin12(MOSI)</div>
<div class="line">J4-Pin13(CLK)——J4-Pin13(CLK)</div>
<div class="line">J5-Pin4(CS)———J5-Pin4(CS)</div>
<div class="line">J5-Pin2(DGND)——-J5-Pin2(DGND)</div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line"><a href="#id47"><span class="problematic" id="id48">**</span></a>On
slave EVM
console:
<a href="#id49"><span class="problematic" id="id50">**</span></a>SPI
initialized</div>
<div class="line">Slave: PASS:
Txd from
master SPI</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><a href="#id51"><span class="problematic" id="id52">**</span></a>On Master
EVM console:</div>
</div>
<blockquote>
<div><p>initialized</p>
</div></blockquote>
<div class="line-block">
<div class="line">Master: PASS:
Txd from
slave SPI</div>
<div class="line">Done</div>
</div>
</td>
<td><p>AM335x,
AM437x,
AM571x,
AM572x,
AM574x,
k2g,</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-even"><td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
<tr class="row-odd"><td><p>MCSPI_SMP_Basic
Example
application</p></td>
<td><p>Sample
Application
demonstrating
reading data
generated from
industrial
input module.
Application
uses GPIO pins
to assert load
signal in order
to generate
date from
industrial
input module
in SMP mode.
(A15 core)</p></td>
<td></td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line">** **</div>
</div>
<p>Following
prints  on
console
expected:</p>
<p><strong>Pass
criteria:</strong></p>
<p>All tests have
passed.</p>
</td>
<td><p>AM572x-EVM</p></td>
<td><p>CCS project</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="building-spi-examples">
<h2>6.8.6. Building SPI examples<a class="headerlink" href="#building-spi-examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Makefile based examples and dependent libraries can be built from the top level or module level SPI makefile, refer to the <a class="reference external" href="index_overview.html#setup-environment">Processor SDK RTOS Getting Started Guide</a>  for details of how to setup the build environment. Once you have setup the build environment, issue the following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">To</span> <span class="n">build</span> <span class="n">and</span> <span class="n">clean</span> <span class="n">libs</span><span class="o">/</span><span class="n">apps</span> <span class="n">from</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="nl">makefile</span><span class="p">:</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span>
<span class="n">make</span> <span class="n">spi</span>
<span class="n">make</span> <span class="n">spi_clean</span>

<span class="n">To</span> <span class="n">build</span> <span class="n">and</span> <span class="n">clean</span> <span class="n">libs</span><span class="o">/</span><span class="n">apps</span> <span class="n">from</span> <span class="n">module</span><span class="o">-</span><span class="n">level</span> <span class="nl">makefile</span><span class="p">:</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">drv</span><span class="o">/</span><span class="n">spi</span>
<span class="n">make</span> <span class="n">all</span>
<span class="n">make</span> <span class="n">clean</span>
</pre></div>
</div>
<ul class="simple">
<li><p>RTSC CCS project based examples are built from CCS</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span>
<span class="p">.</span><span class="o">/</span><span class="n">pdkProjectCreate</span><span class="p">.</span><span class="n">sh</span> <span class="p">[</span><span class="n">soc</span><span class="p">]</span> <span class="p">[</span><span class="n">board</span><span class="p">]</span> <span class="p">[</span><span class="n">endian</span><span class="p">]</span> <span class="n">spi</span> <span class="p">[</span><span class="n">project</span> <span class="n">type</span><span class="p">]</span> <span class="p">[</span><span class="n">processor</span><span class="p">]</span> <span class="p">[</span><span class="n">SECUREMODE</span><span class="o">=&lt;</span><span class="n">yes</span><span class="o">/</span><span class="n">no</span><span class="o">&gt;</span><span class="p">]</span>
<span class="n">Import</span> <span class="n">and</span> <span class="n">build</span> <span class="n">CCS</span> <span class="n">Project</span> <span class="n">from</span>  <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">MyExampleProjects</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="support-for-benchmark-testing">
<h2>6.8.7. Support for Benchmark Testing<a class="headerlink" href="#support-for-benchmark-testing" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 31%" />
<col style="width: 17%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
<th class="head"><p>SOC/Core Suppported</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>OSPI flash Test App</p></td>
<td><p>Test application used
for performance
benchmarking</p></td>
<td><p>Test application
will print on the UART console:</p>
<p>Board_flashWrite ### bytes at transfer
rate #### Kbps</p>
<p>Board_flashRead ### bytes at transfer
rate #### Mbps</p>
<p>Board_flashWrite CPU Load %##</p>
<p>Board_flashRead CPU Load %##</p>
</td>
<td><p>am65xx/A53
am65xx/R5</p></td>
<td><p>make</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>Data transfer between DDR and OSPI flash memory, performance measurement does not include time to invalidate/write back cache</p></li>
<li><p>GTC counter (200MHz) used for throughput measurement on A53, and PMU cycle counter (400MHz) on R5</p></li>
<li><p>sysbios load moduel used for load measurement</p></li>
<li><p>Pipeline PHY enabled, DDR mode enabled in DAC mode</p></li>
<li><p>Pipeline PHY disabled, DDR mode disabled in INDAC mode with ospi clock divider of 32</p></li>
<li><p>Read/write transfer size of 1M bytes</p></li>
<li><p>Write transfer size 1M bytes with DMA chunk size of 16 bytes in DAC DMA mode</p></li>
</ol>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id53">
<h2>6.8.8. Additional References<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="edma3">
<h1>6.9. EDMA3<a class="headerlink" href="#edma3" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id54">
<h2>6.9.1. Overview<a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id55">
<h3>6.9.1.1. Introduction<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h3>
<p>EDMA3 Low Level Driver is targeted to device drivers and applications
for submitting and synchronizing EDMA3-based DMA transfers.</p>
<p>EDMA3 is a peripheral that supports data transfers between two memory
mapped devices. It supports EDMA as well as QDMA channels for data
transfer.</p>
<p>The EDMA3 LLD consists of an EDMA3 Driver and EDMA3 Resource Manager.
The <strong>EDMA3 Driver</strong> provides functionality that allows device drivers
and applications for submitting and synchronizing with EDMA3 based DMA
transfers. In order to simplify the usage, this component internally
uses the services of the <strong>EDMA3 Resource Manager</strong> and provides one
consistent interface for applications or device drivers.</p>
</div>
</div>
<div class="section" id="id56">
<h2>6.9.2. User Interface<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id57">
<h3>6.9.2.1. Driver Configuration<a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h3>
<p>EDMA3 peripheral IP is re-used in different SoCs with only a few
configuration changes:</p>
<ul class="simple">
<li><p>Number of DMA and QDMA channels supported</p></li>
<li><p>Number of PARAM sets available</p></li>
<li><p>Number of event queues and transfer controllers etc.</p></li>
</ul>
<p>The EDMA3 peripheral is used by other peripherals for their DMA needs
thus the EDMA3 Driver needs to cater to the requirements of device
drivers of these peripherals as well as other application software that
may need to use DMA services. Resources for EDMA driver is managed
through RM sub module within driver.</p>
</div>
<div class="section" id="id58">
<h3>6.9.2.2. APIs<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h3>
<p>API reference for EDMA3 driver</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/sdo/edma3/drv/edma3_drv.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>API reference for EDMA3 Resource Management layer</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/sdo/edma3/rm/edma3_rm.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id59">
<h2>6.9.3. FAQ<a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h2>
<p><strong>How to debug common EDMA issues?</strong></p>
<p>Please refer to <a class="reference external" href="http://www.ti.com/lit/an/sprac52/sprac52.pdf">EDMA3
FAQ</a> for Keystone devices.</p>
</div>
<div class="section" id="id60">
<h2>6.9.4. Additional References<a class="headerlink" href="#id60" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>EDMA3 Driver Summary</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Component Type</p></td>
<td><p>Library</p></td>
</tr>
<tr class="row-odd"><td><p>Install Package</p></td>
<td><p>EDMA3 Low level drivers</p></td>
</tr>
<tr class="row-even"><td><p>Install Directory</p></td>
<td><p>&lt;root_install_dir&gt;/edma3_lld_xx_xx_xx_xx</p></td>
</tr>
<tr class="row-odd"><td><p>Project Type</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>Endian Support</p></td>
<td><p>Little and Big</p></td>
</tr>
<tr class="row-odd"><td><p>Library Name</p></td>
<td><p>edma3_lld_drv.ae66 (little endian),
edma3_lld_drv.ae66e (big endian),
edma3_lld_drv.aa15fg (A15),
edma3_lld_drv.aem4 (M4)</p></td>
</tr>
<tr class="row-even"><td><p>Linker Path</p></td>
<td><p>&lt;ti/sdo/edma3/drv/lib/[cpu]&gt;
&lt;ti/sdo/edma3/rm/lib/[soc-evm]&gt;</p></td>
</tr>
<tr class="row-odd"><td><p>Include Paths</p></td>
<td><p>&lt;ti/sdo/edma3/drv&gt;
&lt;ti/sdo/edma3/rm&gt;</p></td>
</tr>
<tr class="row-even"><td><p>Reference Guides</p></td>
<td><p>See docs under install directory</p></td>
</tr>
<tr class="row-odd"><td><p>Additional
Resources</p></td>
<td><p>Programming the EDMA3 using the
Low-Level Driver (LLD)</p></td>
</tr>
<tr class="row-even"><td><p>License</p></td>
<td><p>BSD</p></td>
</tr>
</tbody>
</table>
<p class="rubric" id="edma3-sample-libs">EDMA3 sample libs</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>EDMA3 Driver Sample Summary</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Component Type</p></td>
<td><p>Library</p></td>
</tr>
<tr class="row-odd"><td><p>Install Package</p></td>
<td><p>EDMA3 Low level drivers</p></td>
</tr>
<tr class="row-even"><td><p>Install Directory</p></td>
<td><p>&lt;root_install_dir&gt;/edma3_lld_xx_xx_xx_xx</p></td>
</tr>
<tr class="row-odd"><td><p>Project Type</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>Endian Support</p></td>
<td><p>Little and Big</p></td>
</tr>
<tr class="row-odd"><td><p>Library Name</p></td>
<td><p>edma3_lld_drv_sample.ae66 (little endian),
edma3_lld_drv_sample.ae66e (big endian),
edma3_lld_drv_sample.aa15fg (A15),
edma3_lld_drv_sample.aem4 (M4)</p>
<p>edma3_lld_rm_sample.ae66 (little endian),
edma3_lld_rm_sample.ae66e (big endian),
edma3_lld_rm_sample.aa15fg (A15),
edma3_lld_rm_sample.aem4 (M4)</p>
</td>
</tr>
<tr class="row-even"><td><p>Linker Path</p></td>
<td><p>&lt;ti/sdo/edma3/drv/sample/lib/[soc-evm]/[cpu]&gt;
&lt;ti/sdo/edma3/rm/sample/lib/[soc-evm]/[cpu]&gt;</p></td>
</tr>
<tr class="row-odd"><td><p>Include Paths</p></td>
<td><p>&lt;ti/sdo/edma3/drv&gt;
&lt;ti/sdo/edma3/rm&gt;</p></td>
</tr>
<tr class="row-even"><td><p>Reference Guides</p></td>
<td><p>See docs under install directory</p></td>
</tr>
<tr class="row-odd"><td><p>Additional
Resources</p></td>
<td><p>Programming the EDMA3 using the
Low-Level Driver (LLD)</p></td>
</tr>
<tr class="row-even"><td><p>License</p></td>
<td><p>BSD</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="icss-emac">
<h1>6.10. ICSS-EMAC<a class="headerlink" href="#icss-emac" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id61">
<h2>6.10.1. Introduction<a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h2>
<p>The ICSS_EMAC (industrial communications subsystem Ethernet Media Access
Controller) driver provide APIs to transmit and receive packets with a
firmware based Ethernet switch that has been implemented on TI’s
PRU-ICSS (Programmable Real-Time Unit Subsystem and Industrial
Communication SubSystem) 32-bit RISC cores.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="software-architecture">Software Architecture</p>
<p>The ICSS EMAC low level driver can be partitioned into the following:</p>
<ul class="simple">
<li><p>Driver software running on the host processor, provides a well
defined set of APIs to configure the driver, send packets to the
firmware and receive packet from the firmware.</p></li>
<li><p>Firmware which implements a 2 port ethernet switch supporting 802.1d
&#64;100 Mbps. This runs on the TI-PRU-ICSS cores.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="driver-features">Driver Features</p>
<p>ICSS_EMAC LLD implements following:</p>
<ul class="simple">
<li><p>Rx - Copying packet received from firmware and providing it to TCP/IP
stack</p></li>
<li><p>Tx - Providing packet from TCP/IP stack to firmware</p></li>
<li><p>Learning/Forwarding Data Base</p></li>
<li><p>Storm Prevention implementation</p></li>
<li><p>Host Statistics implementation</p></li>
<li><p>TCP/IP stack related initialization</p></li>
<li><p>Configuring IP address</p></li>
<li><p>ARM interrupt management</p></li>
</ul>
<dl class="simple">
<dt>For details of the driver, please refer to</dt><dd><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/Processor_SDK_RTOS_ICSS-EMAC-Design">[1]</a></p>
</dd>
</dl>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id62">
<h2>6.10.2. User Interface<a class="headerlink" href="#id62" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id63">
<h3>6.10.2.1. Driver Configuration<a class="headerlink" href="#id63" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>Board Specific Configuration</strong></div>
<div class="line">All the board specific configurations eg: enabling clock and pin-mux
for GPIO/MDIP/IEP pins should be performed before calling any driver
APIs. By default Board_Init() API supports all initialization sequence
for TI supported EVMs. In addition it initializes UART instance for
Console/STDIO.Refer <a class="reference external" href="index_board.html#board-support">Processor SDK RTOS Board
Support</a> for
additional details.Once board specific configuration is complete
driver APIS can be invoked.</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><strong>ICSS_EMAC Configuration Structure</strong></div>
<div class="line">The icss_emacSoc.c file contains the declaration of the hardware
attributes corresponding to the ICSS_EMAC subsystem. Hardware
attributes includes base address of various sub-subsystems required by
the the ICSS_EMAC LLD. This configuration is required and needs to be
passed in as part of the ICSS_EMAC Handle when calling the
icss_emacInit API. For details about individual fields of this
structure, see the Doxygen help by opening
PDK_INSTALL_DIR\packages\ti\drv\icss_emac\docs\doxygen\html\index.html.</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id64">
<h3>6.10.2.2. APIs<a class="headerlink" href="#id64" title="Permalink to this headline">¶</a></h3>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/icss_emac/icss_emacDrv.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p class="rubric" id="id65">API Call Flow</p>
<p>The below sequence indicates the calling sequence of ICSS_EMAC driver
APIs for a use case of an EMAC example which implements single Ethernet
MAC using PRU-ICSS Instance 2, ETH0. For additional details refer
example inside package</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">cfg</span><span class="p">);</span>

<span class="cm">/* Perform MDIO init */</span>
<span class="n">ICSS_EMAC_testMdioInit</span><span class="p">(</span><span class="n">CSL_MPU_PRUSS2_U_MII_MDIO_REGS</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Create handle for PRUICSS instance*/</span>
<span class="n">ICSS_EMAC_testPruIcssHandle2</span><span class="o">=</span> <span class="n">PRUICSS_create</span><span class="p">(</span><span class="n">pruss_config</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>

<span class="cm">/* Setup crossbar configuration to receive PRU-ICSS interrupts and map them to A15 (illustration for PRU2ETH0) */</span>
<span class="n">CSL_xbarDspIrqConfigure</span><span class="p">(..);</span>  <span class="cm">/* Link ISR */</span>
<span class="n">CSL_xbarDspIrqConfigure</span><span class="p">(..);</span>  <span class="cm">/* RX PKT ISR */</span>
<span class="n">CSL_xbarDspIrqConfigure</span><span class="p">(..);</span>  <span class="cm">/* TX PKT ISR */</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*Initialize driver */</span>
<span class="p">...</span>
<span class="n">ICSS_EmacInit</span><span class="p">(..);</span>

<span class="cm">/* Register callbacks for RX/TX, Link Interrupts, these are called in context of ISR */</span>
<span class="n">ICSS_EmacRegisterPort0ISRCallback</span><span class="p">(..);</span>
<span class="n">ICSS_EmacRegisterHwIntRx</span><span class="p">(..);</span>
<span class="n">ICSS_EmacRegisterHwIntTx</span><span class="p">(..);</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Enable interrupts for RX/TX/Link*/</span>
<span class="n">ICSS_EMAC_testInterruptInit</span><span class="p">(</span><span class="n">ICSS_EMAC_testHandle2</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Enable Link Interrupt in MDIO sub-system */</span>
<span class="n">ICSS_EMAC_testMdioEnableLinkInterrupt</span><span class="p">(..);</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* At this point, ICSS_EMAC LLD APIs can be called */</span>
<span class="o">&lt;/</span><span class="n">syntaxhighlight</span><span class="o">&gt;</span>
</pre></div>
</div>
<p class="rubric" id="id66">Firmware</p>
<p>TI PRU-ICSS cores (Programmable Real-Time Unit Industrial Communication
Subsystem) is firmware programmable and can take on various
personalities. Examples include an SORTE, ethernet Switch, Industrial
protocol switch. Please refer to <a class="reference external" href="index_pru_icss_fw.html#pru-icss-firmware">ICSS-EMAC Firmwares</a> for
further explanation.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id67">
<h2>6.10.3. Application<a class="headerlink" href="#id67" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id68">
<h3>6.10.3.1. Examples<a class="headerlink" href="#id68" title="Permalink to this headline">¶</a></h3>
<p>Refer “ICSS_EMAC_&lt;Basic/Switch&gt;Example_&lt;SOC&gt;_&lt;CPU&gt;Testproject” for
additional reference. Refer Release Note for ICSS_EMAC supported on
different EVMs.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">Name</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">EVM
Configuration</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Expected
Results</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ICSS_EMAC_Basic
Example</p></td>
<td><p>EMAC Loopback
test at
PRU-ICSS
EMAC PHY.</p>
<div class="line-block">
<div class="line">Example
demonstrates
loopback
capability by
sending dummy
broadcast
packet to
PRU-ICSS
instance 2,
ethernet port
0 (PRU ETH0).
Unit test
registers
receive
packet
callback
routine with
LLD to be
called for RX
packet. Call
back routine
will extract
packet
received,
perform
simple memory
comparison
against
packet sent
for integrity
check. Unit
test will
iterate 10
times for
packet
transmission
and reception
check.</div>
</div>
</td>
<td><p>10/100 Mb/s
loopback cable</p></td>
<td><p>Unit Test will
print ^All
tests have
passed^ via
UART console.</p></td>
</tr>
<tr class="row-odd"><td><p>ICSS_EMAC_Switc
hExample</p></td>
<td><p>Switch Loopback
test at
PRU-ICSS
EMAC PHY.</p>
<div class="line-block">
<div class="line">Example
demonstrates
switch
learning
loopback
capability by
sending dummy
broadcast
packet to
PRU-ICSS
instance,
ethernet
port. Unit
test
registers
receive
packet
callback
routine with
LLD to be
called for RX
packet. Call
back routine
will extract
packet
received,
perform
simple memory
comparison
against
packet sent
for integrity
check. As
with switch
for every 1
transmitted
packet,
firmware will
respond back
with 2
recieved
packets. Unit
test will
iterate 10
times for
packet
transmission
and reception
check.</div>
</div>
</td>
<td><p>100 Mb/s
loopback cable</p></td>
<td><p>Unit Test will
print ^All
tests have
passed^ via
UART console.</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="debug-guide">
<h2>6.10.4. Debug Guide<a class="headerlink" href="#debug-guide" title="Permalink to this headline">¶</a></h2>
<p>For debugging ICSS EMAC examples or LLD. Please refer to <a class="reference external" href="http://processors.wiki.ti.com/index.php/ICSS_EMAC_LLD_debug_guide">ICSS-EMAC
Debug Guide</a>.</p>
</div>
<div class="section" id="id69">
<h2>6.10.5. Additional References<a class="headerlink" href="#id69" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 45%" />
<col style="width: 55%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\icss_emac\docs\doxygen\html\
index.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\icss_emac\docs\ReleaseNotes_
ICSS_EMAC_LLD.pdf</p></td>
</tr>
<tr class="row-even"><td><p>ICSS-EMAC LLD Details</p></td>
<td><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/ICSS-EMAC">[2]</a></p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="pruss">
<h1>6.11. PRUSS<a class="headerlink" href="#pruss" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id70">
<h2>6.11.1. Overview<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id71">
<h3>6.11.1.1. Introduction<a class="headerlink" href="#id71" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The PRUSS (Programmable Real-Time Unit Subsystem) provides a
well-defined API layer which allows applications to use the PRUSS low
level driver to control  sub system.</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="id72">Firmware</p>
<p>The PRUSS (Programmable Real-Time Unit Subsystem) is firmware
programmable and can take on various personalities. Examples include an
ethernet MAC, ethernet Switch, Industrial protocol switch. For a good
example, please refer to <a class="reference external" href="index_pru_icss_fw.html#pru-icss-sorte">Simple Open Real Time Ethernet Protocol (SORTE)</a></p>
<p class="rubric" id="id73">Driver Features</p>
<ul class="simple">
<li><p>PRU control features i.e enable/disable/reset a PRU</p></li>
<li><p>Helper functions i.e. load and execute firmware in PRU</p></li>
<li><p>Memory mapping of PRU/L3/External memories</p></li>
<li><p>PRU and Host event management (i.e. map sys_evt/channel/hosts in PRU
INTC generate interrupts, wait for occurrence of an event, and
acknowledge interrupts</p></li>
<li><p>Interrupt management for A15/C66x CPU targets</p></li>
</ul>
</div>
</div>
<div class="section" id="id74">
<h2>6.11.2. User Interface<a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id75">
<h3>6.11.2.1. Driver Configuration<a class="headerlink" href="#id75" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="id76"><strong>Board Specific Configuration</strong></p>
<p>All the board specific configurations like enabling the clock and
pin-mux of UART/GPIO/PRUSS ICSS pins should be performed before
calling any of the driver APIs.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="pruss-configuration-structure"><strong>PRUSS Configuration Structure</strong></p>
<p>The pruicss_device.c file contains the declaration of the PRUICSS
config structure. This structure must be provided to the driver at the
time when PRUICSS_create() API is called to creat the PRUICSS_Handle.
This handle is subsequently required to make any PRUSS LLD API call.</p>
</div>
<div class="section" id="id77">
<h3>6.11.2.2. APIs<a class="headerlink" href="#id77" title="Permalink to this headline">¶</a></h3>
<p>Reference API header file:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/pruss/pruicss.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p class="rubric" id="id78">API Call Flow</p>
<p>Below sequence indicates calling sequence of PRUSS driver APIs for a use
case of sending INTC event to the PRU. Refer example code within module
for additional details</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="cm">/* Initialize Board */</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>

<span class="cm">/* Creates handle for PRUICSS instance */</span>
<span class="n">handle</span> <span class="o">=</span> <span class="n">PRUICSS_create</span><span class="p">(</span><span class="n">pruss_config</span><span class="p">,</span><span class="n">instance</span><span class="p">);</span>

<span class="cm">/* Disable PRUICSS instance */</span>
<span class="n">PRUICSS_pruDisable</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="n">instance</span> <span class="p">);</span>

<span class="cm">/* Register an Interrupt Handler for an event */</span>
<span class="n">PRUICSS_registerIrqHandler</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="n">pruEvtoutNum</span><span class="p">,</span><span class="n">intrNum</span><span class="p">,</span><span class="n">eventNum</span><span class="p">,</span><span class="n">waitEnable</span><span class="p">,</span><span class="n">irqHandler</span><span class="p">);</span>

<span class="cm">/* Sets the buffer pointer for PRU */</span>
<span class="n">PRUICSS_setPRUBuffer</span><span class="p">(..);</span>

<span class="cm">/* API to do Interrupt-Channel-host mapping */</span>
<span class="n">PRUICSS_pruIntcInit</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pruss_intc_initdata</span><span class="p">);</span>

<span class="cm">/* Execute program on PRU */</span>
<span class="n">PRUICSS_pruExecProgram</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

 <span class="cm">/* Enable PRU */</span>
<span class="n">PRUICSS_pruEnable</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

<span class="cm">/* Generates INTC event */</span>
<span class="n">PRUICSS_pruSendEvent</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="n">ARM_PRU0_EVENT</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id79">
<h2>6.11.3. Application<a class="headerlink" href="#id79" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id80">
<h3>6.11.3.1. Examples<a class="headerlink" href="#id80" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Expected Results</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PRUSS_TestApplication</p></td>
<td><div class="line-block">
<div class="line">Test application is
designed to ping
pong an event
between CPU
target(A15/C66x)
and PRU for a fixed
count.Application
is to test PRU’s
load, control and
Interrupt
controller
functionalities.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Following prints
expected on console
based on pass/fail
criteria:</div>
<div class="line"><br /></div>
<div class="line"><strong>Pass criteria:</strong></div>
</div>
<div class="line-block">
<div class="line">Prints related to
sending and
receiving  event from
PRU will be printed
on  console. Test
program at the end
expected to output:
“All tests have
passed”</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id81">
<h2>6.11.4. Additional References<a class="headerlink" href="#id81" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\pruss\docs\doxygen\html\inde
x.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\pruss\docs\ReleaseNotes_PRUS
S_LLD.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="fatfs">
<h1>6.12. FATFS<a class="headerlink" href="#fatfs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id82">
<h2>6.12.1. Overview<a class="headerlink" href="#id82" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id83">
<h3>6.12.1.1. Introduction<a class="headerlink" href="#id83" title="Permalink to this headline">¶</a></h3>
<p>FATFS module provides an interface to configure a driver for FAT file
system compatible device that connects via MMCSD, USB, etc. It
configures FATFS for disk operations driver disk Initialize, disk
read, disk write</p>
</div>
</div>
<div class="section" id="id84">
<h2>6.12.2. Driver Overview<a class="headerlink" href="#id84" title="Permalink to this headline">¶</a></h2>
<p>PDK FATFS driver provides support for both single and multiple partition on a given
SD/MMC card. The driver uses a volume to partition mapping technique to handle multiple
storage device with multiple partition. The driver supports file operations such as
open, read and wirte on to the SD/MMC card. The FATFS driver access the SD/MMC card
through the PDK MMCSD driver which needs to be configured from the application as part
of the FATFS_config structure. The FATFS driver is used in other PDK module application
such as MMCSD, USB and SBL.</p>
<p>FATFS file operation API’s can be accessed from the application only after FATFS_open
function is invoked.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FATFS_init</span><span class="p">();</span>
<span class="n">FATFS_open</span><span class="p">(</span><span class="mi">0U</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fatfsHandle</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id85">
<h2>6.12.3. User Interface<a class="headerlink" href="#id85" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id86">
<h3>6.12.3.1. Driver Configuration<a class="headerlink" href="#id86" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="id87"><strong>Board Specific Configuration</strong></p>
<p>All board specific configurations eg:enabling clock and pin-mux for UART
pins are required before calling any driver APIs.By default Board_Init()
API supports all initialization sequence for TI supported EVMs. In
addition it initializes UART instance for Console/STDIO.Refer <a class="reference external" href="index_board.html#board-support">Processor
SDK RTOS Board Support</a>
for additional details.Once board specific configuration is complete
FATFS_init() API can be called to initialize FATFS for the driver.</p>
<p class="rubric" id="fatfs-configuration-structure"><strong>FATFS Configuration Structure</strong></p>
<p>Application is expected to perform driver specific configuration for
FATFS_config structure. The structure supports initialization of
multiple drivers for FATFS, i.e. both MMCSD and USB can be configured
to use FATFS file system by configuring each driver to different drive
instance. This structure must be provided to the FATFS driver. It must
be initialized before the FATFS_init() function is called and cannot
be changed subsequently. For details about individual fields of this
structure, see the Doxygen
help:PDK_INSTALL_DIR\packages\ti\fs\fatfs\docs\doxygen\html\index.html.</p>
</div>
<div class="section" id="id88">
<h3>6.12.3.2. APIs<a class="headerlink" href="#id88" title="Permalink to this headline">¶</a></h3>
<p>In order to use the FATFS module APIs, the FATFS.h and ff.h header file
should be included in an application as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/fs/fatfs/FATFS.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ti/fs/fatfs/ff.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p class="rubric" id="id89">API Call Flow</p>
<p>Below sequence indicates the calling sequence of FATFS driver APIs:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FATFS_Handle</span> <span class="n">FATFS</span><span class="p">;</span>
<span class="n">FATFS_Params</span> <span class="n">FATFSParams</span><span class="p">;</span>
<span class="n">FATFS_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">FATFSParams</span><span class="p">);</span>
<span class="n">FATFS</span> <span class="o">=</span> <span class="n">FATFS_open</span><span class="p">(</span><span class="n">peripheralNum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">FATFSParams</span><span class="p">);</span>
</pre></div>
</div>
<p>At this point application can invoke additional FAT File system API
eg: f_open(), f_write(), f_read() etc to perform file operations on
device</p>
</div>
</div>
<div class="section" id="id90">
<h2>6.12.4. Application<a class="headerlink" href="#id90" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id91">
<h3>6.12.4.1. Examples<a class="headerlink" href="#id91" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 22%" />
<col style="width: 22%" />
<col style="width: 15%" />
<col style="width: 13%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><p>Expected Results</p></th>
<th class="head"><p>Supported SOCs</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FATFS_Console_ExampleProject</p></td>
<td><div class="line-block">
<div class="line">Example will
initialize card and
checks for valid
FAT partition. When
a valid FAT
partition is
detected console
interface for
command execution
is provided.
Supported console
commands include ls
(to list files of
directory), cd
(change directory),
pwd (present
working directory)
and cat (text file
read operation).</div>
</div>
</td>
<td><p>When a card is
detected with valid
FAT partition console
interface output will
indicate “0:&gt; “</p></td>
<td><p>AM335x
AM437x
AM571x
AM572x
AM574x</p></td>
<td><p>CCS  Project</p></td>
</tr>
<tr class="row-odd"><td><p>FATFS_Console_TestApp</p></td>
<td><div class="line-block">
<div class="line">Same as above</div>
</div>
</td>
<td><p>Same as above</p></td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
<tr class="row-even"><td><p>FATFS_Console_SMP_Example
Project</p></td>
<td><div class="line-block">
<div class="line">Example will
initialize card and
checks for valid
FAT partition. When
a valid FAT
partition is
detected console
interface for
command execution
is provided.
Supported console
commands include ls
(to list files of
directory), cd
(change directory),
pwd (present
working directory)
and cat (text file
read operation)
with SMP enabled.</div>
</div>
</td>
<td><p>When a card is
detected with valid
FAT partition console
interface output will
indicate “0:&gt; “</p></td>
<td><p>AM572x-EVM
(A15 core)</p></td>
<td><p>CCS  Project</p></td>
</tr>
<tr class="row-odd"><td><p>FATFS_Console_SMP_TestApp</p></td>
<td><div class="line-block">
<div class="line">Same as above</div>
</div>
</td>
<td><p>Same as above</p></td>
<td><p>AM65x(A53 core)</p></td>
<td><p>Makefile</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="building-ccs-projects-based-examples">
<h2>6.12.5. Building CCS projects based examples<a class="headerlink" href="#building-ccs-projects-based-examples" title="Permalink to this headline">¶</a></h2>
<p>CCS Projects mentioned in the above table are built using pdkProjectCreate.bat/sh as explained in
<a class="reference external" href="index_overview.html#pdk-example-and-test-project-creation">PDK Example and Test Project Creation</a></p>
</div>
<div class="section" id="building-fatfs-test-applications-via-makefiles">
<h2>6.12.6. Building FATFS Test applications via makefiles<a class="headerlink" href="#building-fatfs-test-applications-via-makefiles" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>FATFSD Test applications and dependent libraries are built from the top level fatfs makefile</p></li>
<li><p>Refer to the <a class="reference external" href="index_overview.html#setup-environment">Processor SDK RTOS Getting Started Guide</a>  for details
of how to setup the build environment. Once you have setup the build environment, issue the following commands:</p>
<blockquote>
<div><ul class="simple">
<li><p>cd &lt;pdk&gt;/packages/</p></li>
<li><p>To build: make fatfs</p></li>
<li><p>To clean: make fatfs_clean</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Similarly, to build at the module level, issue the following commands for rebuilding :</p>
<blockquote>
<div><ul class="simple">
<li><p>cd &lt;pdk&gt;/packages/ti/fs/fatfs</p></li>
<li><p>To build: make all</p></li>
<li><p>To clean: make clean</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id92">
<h2>6.12.7. Additional References<a class="headerlink" href="#id92" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\fs\fatfs\docs\doxygen\html\index
.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\fs\fatfs\docs\ReleaseNotes_FATFS
_LLD.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="mmcsd">
<h1>6.13. MMCSD<a class="headerlink" href="#mmcsd" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id93">
<h2>6.13.1. Overview<a class="headerlink" href="#id93" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id94">
<h3>6.13.1.1. Introduction<a class="headerlink" href="#id94" title="Permalink to this headline">¶</a></h3>
<p>MMCSD module provides an interface between CPU and any
MMCSD-bus-compatible device that connects via MMCSD serial bus. External
components attached to MMCSD bus can serially transmit/receive data
to/from the CPU device through two-wire interface</p>
<p class="rubric" id="key-features">Key Features</p>
<div class="line-block">
<div class="line">Type of transfers</div>
</div>
<blockquote>
<div><ul class="simple">
<li><p> Read</p></li>
<li><p> Write</p></li>
<li><p> Write followed by read</p></li>
</ul>
</div></blockquote>
<div class="line-block">
<div class="line">Operating modes</div>
</div>
<blockquote>
<div><ul class="simple">
<li><p> Blocking(interrupt or Non interrupt)</p></li>
<li><p> Callback mode(interrupt)</p></li>
</ul>
</div></blockquote>
<div class="line-block">
<div class="line">Supports only master mode. Slave mode is not supported</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id95">
<h2>6.13.2. User Interface<a class="headerlink" href="#id95" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id96">
<h3>6.13.2.1. Driver Configuration<a class="headerlink" href="#id96" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="id97"><strong>Board Specific Configuration</strong></p>
<p>All board specific configurations eg:enabling clock and pin-mux for
UART pins are required before calling any driver APIs.By default
Board_Init() API supports all initialization sequence for TI supported
EVMs. In addition it initializes UART instance for Console/STDIO.Refer
<a class="reference external" href="index_board.html#board-support">Processor SDK RTOS Board
Support</a> for
additional details.Once board specific configuration is complete
MMCSD_init() API can be called to initialize driver.</p>
<p class="rubric" id="mmcsd-configuration-structure"><strong>MMCSD Configuration Structure</strong></p>
<p>The MMCSD_soc.c file binds driver with hardware attributes on the
board through MMCSD_config structure. This structure must be
initialized before the MMCSD_init() function is called and cannot be
changed afterwards. For details about the individual fields of this
structure, see the Doxygen help by opening
\docs\doxygen\html\index.html</p>
</div>
<div class="section" id="id98">
<h3>6.13.2.2. APIs<a class="headerlink" href="#id98" title="Permalink to this headline">¶</a></h3>
<p>Reference for API header file with documentation</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/mmcsd/MMCSD.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p class="rubric" id="id99">API Call Flow</p>
<p>The below sequence indicates the calling sequence of MMCSD driver APIs
for a use case of write transaction in blocking mode:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MMCSD_Handle</span> <span class="n">MMCSD</span><span class="p">;</span>
<span class="n">UInt</span> <span class="n">peripheralNum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* Such as MMCSD0 */</span>
<span class="n">MMCSD_Params</span> <span class="n">MMCSDParams</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">MMCSD_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MMCSDParams</span><span class="p">);</span>
<span class="n">MMCSD</span> <span class="o">=</span> <span class="n">MMCSD_open</span><span class="p">(</span><span class="n">peripheralNum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">MMCSDParams</span><span class="p">);</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span><span class="k">if</span> <span class="p">(</span><span class="n">MMCSD</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span> <span class="cm">/* Error opening MMCSD */</span>
<span class="p">...</span>
<span class="n">readOK</span> <span class="o">=</span> <span class="n">MMCSD_read</span><span class="p">(</span><span class="n">MMCSD</span><span class="p">,</span> <span class="n">rxBuffer</span> <span class="p">,</span> <span class="n">startBlock</span><span class="p">,</span> <span class="n">numBlock</span><span class="p">);</span> <span class="cm">/* Perform MMCSD read */</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">transferOK</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* MMCSD transaction failed */</span><span class="p">}</span>

<span class="n">writeOK</span> <span class="o">=</span> <span class="n">MMCSD_write</span><span class="p">(</span><span class="n">MMCSD</span><span class="p">,</span> <span class="n">TxBuffer</span> <span class="p">,</span> <span class="n">startBlock</span><span class="p">,</span> <span class="n">numBlock</span><span class="p">);</span> <span class="cm">/* Perform MMCSD write */</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">writeOK</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* MMCSD transaction failed */</span><span class="p">}</span>
</pre></div>
</div>
<p class="rubric" id="emmc-usage">eMMC Usage</p>
<p>MMCSD driver supports eMMC device. Application need to configure the
eMMC device for an instance of peripheral. It is also recommended to
configure the operating bus width of eMMC device.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mmcsdInitCfg</span><span class="p">[</span><span class="n">MMCSD_INSTANCE</span><span class="p">].</span><span class="n">cardType</span> <span class="o">=</span> <span class="n">MMCSD_CARD_EMMC</span><span class="p">;</span>
<span class="n">mmcsdInitCfg</span><span class="p">[</span><span class="n">MMCSD_INSTANCE</span><span class="p">].</span><span class="n">supportedBusWidth</span> <span class="o">=</span> <span class="n">MMCSD_BUS_WIDTH_8BIT</span><span class="p">;</span>
<span class="n">MMCSD_init</span><span class="p">();</span>
</pre></div>
</div>
<p class="rubric" id="edma-usage">EDMA Usage</p>
<p>MMCSD driver supports EDMA operations to transfer data between memory
and MMCSD peripheral.</p>
<p>Driver uses separate source files for these operations.Refer source
MMCSD_soc.c for DMA MMCSD SOC configuration. Application need to create
EDMA handle and update the configuration before MMCSD_init() API.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mmcsdInitCfg</span><span class="p">[</span><span class="n">MMCSD_INSTANCE</span><span class="p">].</span><span class="n">edmaHandle</span> <span class="o">=</span> <span class="n">MMCSDApp_edmaInit</span><span class="p">();</span><span class="cm">/* Refer Example/Test */</span>
<span class="n">MMCSD_init</span><span class="p">();</span>
</pre></div>
</div>
<p>Refer “MMCSD_[Usecase]_[Board/SoC]_DMA_[cpu][Example/Test]project” for
additional reference. Refer SDK Release Note for supported EVMs.</p>
<p class="rubric" id="uhs-mode-usage">UHS Mode Usage</p>
<p>The MMCSD driver supports UHS-I cards. Feature is available for AM57x
SOC and is dependent on board or platform support for run-time switching
from 3.0V to 1.8V. Feature is validated on AM572x GP EVM 3.0</p>
</div>
</div>
<div class="section" id="id100">
<h2>6.13.3. Application<a class="headerlink" href="#id100" title="Permalink to this headline">¶</a></h2>
<div class="section" id="examples-unit-tests">
<h3>6.13.3.1. Examples &amp; Unit tests<a class="headerlink" href="#examples-unit-tests" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 26%" />
<col style="width: 19%" />
<col style="width: 14%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
<th class="head"><p>Supported SOCs</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MMCSD_FATFS_ExampleProject</p></td>
<td><p>Example initializes
the card and checks
for valid FAT
partition. When a
valid FAT partition
is detected console
interface for
command execution
is provided.
Console commands
supported are ls
(to list files of
directory), cd
(change directory),
pwd (present
working directory)
and cat (text file
read operation).</p></td>
<td><p>When a card is
detected with valid
FAT partition a
console interface
apperas like “0:&gt; “</p></td>
<td><p>AM335x
AM437x
AM571x
AM572x
AM574x
K2G
OMAPL137x
OMAPL138x</p></td>
<td><p>CCS Project</p></td>
</tr>
<tr class="row-odd"><td><p>MMCSD_Test_Project</p></td>
<td><p>Unit Test
application
demonstrating write
and read a fixed
number of bytes
into MMCSD card.
Verifies written
data pattern to
conclude PASS/FAIL.</p></td>
<td><p>Prints  on  console
All tests have passed</p></td>
<td><p>AM335x
AM437x
AM571x
AM572x
AM574x
K2G
OMAPL137x
OMAPL138x</p></td>
<td><p>CCS Project</p></td>
</tr>
<tr class="row-even"><td><p>MMCSD_DMA_Test_Project</p></td>
<td><p>Unit Test
application
demonstrating write
and read a fixed
number of bytes
into MMCSD card.
Verifies written
data pattern to
conclude PASS/FAIL.</p></td>
<td><p>Prints on console
All tests have passed</p></td>
<td><p>AM335x
AM437x
AM571x
AM572x
AM574x
K2G
OMAPL137x
OMAPl138x</p></td>
<td><p>CCS Project</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>MMCSD_SMP_Test_Project</p></td>
<td rowspan="2"><p>Unit Test
application
demonstrating write
and read a fixed
number of bytes
into MMCSD card.
Verifies written
data pattern to
conclude PASS/FAIL in SMP
mode.</p></td>
<td rowspan="2"><p>Prints  on  console
All tests have passed</p></td>
<td><p>AM572x - EVM</p></td>
<td><p>CCS Project</p></td>
</tr>
<tr class="row-even"><td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>MMCSD_SMP_DMA_Test_Project</p></td>
<td rowspan="2"><p>Unit Test
application
demonstrating write
and read a fixed
number of bytes
into MMCSD card.
Verifies written
data pattern to
conclude PASS/FAIL in SMP
mode with DMA enabled.</p></td>
<td rowspan="2"><p>Prints on console
All tests have passed</p></td>
<td><p>AM572x - EVM</p></td>
<td><p>CCS Project</p></td>
</tr>
<tr class="row-even"><td><p>am65xx</p></td>
<td><p>makefile</p></td>
</tr>
<tr class="row-odd"><td><p>MMCSD_EMMC_TestProject</p></td>
<td><p>Unit Test
application
demonstrating write
and read a fixed
number of bytes
into eMMC device.
Verifies written
data pattern to
conclude PASS/FAIL.</p></td>
<td><p>Prints on console
All tests have passed</p></td>
<td><p>AM335x
AM437x
AM571x
AM572x
AM574x
K2G
OMAPL137x
OMAPL138x</p></td>
<td><p>CCS Project</p></td>
</tr>
<tr class="row-even"><td><p>MMCSD_EMMC_DMA_TestProject</p></td>
<td><p>Unit Test
application
demonstrating write
and read a fixed
number of bytes
into eMMC device.
Verifies written
data pattern to
conclude PASS/FAIL.</p></td>
<td><p>Prints on console
All tests have passed</p></td>
<td><p>AM335x
AM437x
AM571x
AM572x
AM574x
K2G
OMAPL137x
OMAPL138x</p></td>
<td><p>CCS Project</p></td>
</tr>
<tr class="row-odd"><td><p>MMC Test Application</p></td>
<td><p>Unit Test
application
demonstrating write
and read a fixed
number of bytes
into MMC device.
Verifies written
data pattern to
conclude PASS/FAIL.
Supported only on
OMAPL137 platform.</p>
<p>There is no on-board
eMMC chip on OMAPL137
platform. Need to use
external MMC card
inserted into MMCSD
slot of the board.
Currently the driver
supports standard MMC
card and other cards
like MMCplus may not
work. The example
requires the card
size to be at least
2GB.</p>
</td>
<td><p>Prints on console
All tests have passed</p></td>
<td><p>OMAPL137x</p></td>
<td><p>CCS Project</p></td>
</tr>
<tr class="row-even"><td><p>MMCSD_TestApp</p></td>
<td><p>Unit Test
application
demonstrating write
and read a fixed
number of bytes
into MMCSD card.
Verifies written
data pattern to
conclude PASS/FAIL.</p></td>
<td><p>Prints on console
All tests have passed</p></td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
<tr class="row-odd"><td><p>MMCSD_DMA_TestApp</p></td>
<td><p>Functionally same
as MMCSD_TestApp
but with DMA enabled</p></td>
<td><p>Prints on console
All tests have passed</p></td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
<tr class="row-even"><td><p>MMCSD_EMMC_TestApp</p></td>
<td><p>Unit Test
application
demonstrating write
and read a fixed
number of bytes
into the onboard
EMMC.Verifies written
data pattern to
conclude PASS/FAIL.</p></td>
<td><p>Prints  on console
All tests have passed</p></td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
<tr class="row-odd"><td><p>MMCSD_EMMC_DMA_TestApp</p></td>
<td><p>Functionally
Same as EMMC_TestApp
but using  DMA mode</p></td>
<td><p>Prints on console
All tests have passed</p></td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
<tr class="row-even"><td><p>MMCSD_Baremetal_TestApp</p></td>
<td><p>Baremetal version of
MMCSD_TestApp</p></td>
<td><p>Prints on console
All tests have passed</p></td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
<tr class="row-odd"><td><p>MMCSD_Baremetal_DMA_TestApp</p></td>
<td><p>Baremetal version of
MMCSD_EMMC_TestApp</p></td>
<td><p>Prints on console
All tests have passed</p></td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
<tr class="row-even"><td><p>MMCSD_Baremetal_EMMC_TestApp</p></td>
<td><p>Baremetal version of
MMCSD_EMMC_TestApp</p></td>
<td><p>Prints on console
All tests have passed</p></td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
<tr class="row-odd"><td><p>MMCSD_Baremetal_EMMC_DMA_TestApp</p></td>
<td><p>Functionally same as
MMCSD_Baremetal_EMMC_TestApp
but with DMA enabled</p></td>
<td><p>Prints on console
All tests have passed</p></td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
<tr class="row-even"><td><p>MMCSD_Regression_TestApp</p></td>
<td><p>Menu driven regression test
which tests various
configurations of SD card</p></td>
<td><p>Prints on console
All tests have passed</p></td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
<tr class="row-odd"><td><p>MMCSD_EMMC_Regression_TestApp</p></td>
<td><p>Menu driven regression test
which tests various
configurations of EMMC</p></td>
<td><p>Prints on console
All tests have passed</p></td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="benchmarking-read-write-performance-on-am65x">
<h2>6.13.4. Benchmarking Read/Write Performance (on AM65x)<a class="headerlink" href="#benchmarking-read-write-performance-on-am65x" title="Permalink to this headline">¶</a></h2>
<p>The MMCSD_&lt;EMMC&gt;_Regression_TestApp application (listed above) measures read/write throughput (in mega bytes per sec).</p>
<dl class="simple">
<dt>It measures the following</dt><dd><ul class="simple">
<li><p>RAW read/write throughput:  This involves the reading/writing of a continuous block of data, say 1MB data buffer on
to the SD/eMMC using MMCSD_Read()/MMCSD_Write().</p></li>
<li><p>FATFS read/write (SD Only) throughput: This involves reading/writing of a 1MB buffer of data through f_read()/f_write().
Please note that FAT32 is tested with SD card only</p></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="benchmarking-steps">
<h2>6.13.5. Benchmarking Steps<a class="headerlink" href="#benchmarking-steps" title="Permalink to this headline">¶</a></h2>
<p>The performance benchmarks on SD Read/Write can be done with the following steps</p>
<blockquote>
<div><ul class="simple">
<li><p>Load the MMCSD_Regression_TestApp on A53/R5 core of AM65x</p></li>
<li><p>Insert SD Card formatted with FAT32 format preferably with allocation size=4096 bytes for better performance.</p></li>
<li><p>Run the application. It presents with a menu of various modes the SD card which can be run on the UART console</p></li>
<li><p>Select the desired mode from the list (say HS mode) and press Enter</p></li>
<li><p>The test will run RAW &amp; FATFS read/writes of various buffer sizes 256K, 512K, 1024K and 2048K.
This might take a minute or two to complete.</p></li>
<li><p>Two tables are printed at the end of the test run for this mode with RAW &amp; FATFS throughput numbers
for each buffer size.</p></li>
<li><p>Note: Instead of running each mode seperately, you can select “All non powercycle tests” option (-1)
which runs all the supported modes along with the throughput numbers for each of them.</p></li>
</ul>
</div></blockquote>
<p>EMMC performance benchmarks can be measured with the following steps</p>
<blockquote>
<div><ul class="simple">
<li><p>Load the MMCSD_EMMC_Regression_TestApp on A53/R5 core of AM65x</p></li>
<li><p>Run the application. It presents with a menu of various eMMC modes which can be run on the UART console</p></li>
<li><p>Select the desired mode from the list (say HS-DDR mode) and press Enter</p></li>
<li><p>The test will run RAW read/writes of various buffer sizes 256K, 512K, 1024K and 2048K.
This might take a minute or two to complete.</p></li>
<li><p>A table is printed at the end of the test with the RAW throughput numbers for each buffer size.</p></li>
<li><p>Note: Instead of running each mode seperately, you can select “All non powercycle tests” option (-1)
which runs all the supported modes along with the throughput numbers for each of them.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id101">
<h2>6.13.6. Building CCS projects based examples<a class="headerlink" href="#id101" title="Permalink to this headline">¶</a></h2>
<p>CCS Projects mentioned in the above table are built using pdkProjectCreate.bat/sh as explained in
<a class="reference external" href="index_overview.html#pdk-example-and-test-project-creation">PDK Example and Test Project Creation</a></p>
</div>
<div class="section" id="building-mmcsd-test-applications-via-makefiles">
<h2>6.13.7. Building MMCSD Test applications via makefiles<a class="headerlink" href="#building-mmcsd-test-applications-via-makefiles" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>MMCSD Test applications and dependent libraries are built from the top level mmcsd makefile</p></li>
<li><p>Refer to the <a class="reference external" href="index_overview.html#setup-environment">Processor SDK RTOS Getting Started Guide</a>  for details
of how to setup the build environment. Once you have setup the build environment, issue the following commands:</p>
<blockquote>
<div><ul class="simple">
<li><p>cd &lt;pdk&gt;/packages/</p></li>
<li><p>To build: make mmcsd</p></li>
<li><p>To clean: make mmcsd_clean</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Similarly, to build at the module level, issue the following commands for rebuilding :</p>
<blockquote>
<div><ul class="simple">
<li><p>cd &lt;pdk&gt;/packages/ti/drv/mmcsd</p></li>
<li><p>To build: make all</p></li>
<li><p>To clean: make clean</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id102">
<h2>6.13.8. Additional References<a class="headerlink" href="#id102" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 44%" />
<col style="width: 56%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\mmcsd\docs\doxygen\html\inde
x.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\mmcsd\docs\ReleaseNotes_MMCS
D_LLD.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="qmss">
<h1>6.14. QMSS<a class="headerlink" href="#qmss" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id103">
<h2>6.14.1. Overview<a class="headerlink" href="#id103" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id104">
<h3>6.14.1.1. Introduction<a class="headerlink" href="#id104" title="Permalink to this headline">¶</a></h3>
<p>The Queue Manager Sub System (QMSS) low level driver provides the
interface to Queue Manager Subsystem hardware which is part of the
Multicore Navigator functional unit for a keystone device. QMSS provides
hardware assisted queue system and implements fundamental operations
such as en-queue and de-queue, descriptor management, accumulator
functionality and configuration of infrastructure DMA mode. The LLD
provides APIs to get full entitlement of supported hardware
functionality.</p>
<p>The LLD also includes accumulation and QoS (Quality of Service)
firmware. QoS enables restriction of data rates in bytes per second or
packets per second, weighted round robin queue selection, and selective
descriptor dropping for oversubscribed queues. Accumulation The APIs are
provided through the LLD. The API documentation for both QoS and
Accumulator is available in the API Reference manual below. The
capabilities of the QoS firmware are documented in their design
documents. The capabilities of the accumulator are documented in the
Hardware Peripheral User Guide.</p>
<p class="rubric" id="id105">Modes of Operation</p>
<p>QMSS library (ti.drv.qm) supports below modes</p>
<p><strong>Joint Mode</strong>: In this mode, only linkingRAM0Base, linkingRAM0Size, and
linkingRAM1Base are used to configure all QM groups simultaneously. For
all existing devices (K2H, K2K) this is only mode that should be used.
For the rest of the devices such as K2L, K2E, 6678 and 6657, this is the
only mode available.</p>
<p><strong>Split Mode</strong>: This mode shouldn’t be used as it doesn’t support all
peripherals on the device.</p>
</div>
</div>
<div class="section" id="id106">
<h2>6.14.2. User Interface<a class="headerlink" href="#id106" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id107">
<h3>6.14.2.1. Driver Configuration<a class="headerlink" href="#id107" title="Permalink to this headline">¶</a></h3>
<p>The driver configures the QMSSSS subsystem using
Qmss_GlobalConfigGroupRegs(system configuration) structure. The default
global configuration per device is present under qmss_device.c file
provided per device.</p>
<p>For details about individual fields of this structure, see the Doxygen
help by opening
PDK_INSTALL_DIRQMSSckagestidrvQMSSdocsdoxygenhtmlindex.html.</p>
</div>
<div class="section" id="id108">
<h3>6.14.2.2. APIs<a class="headerlink" href="#id108" title="Permalink to this headline">¶</a></h3>
<p>API header for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/QMSS/QMSS_drv.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>Please see the doxygen in “API Reference Manual” below for details.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id109">
<h2>6.14.3. Application<a class="headerlink" href="#id109" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id110">
<h3>6.14.3.1. Examples<a class="headerlink" href="#id110" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><p>Expected Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>QMSS_Example
application</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
<em>infra DMA,
interrupt test</em> use
case. Reference
example for
developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">User observes the
output printed over
the CCS console</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>QMSS_UnitTestApplicat
ion</p></td>
<td><div class="line-block">
<div class="line">Unit Test
application to test
all APIs</div>
</div>
</td>
<td><div class="line-block">
<div class="line">User observes the
output printed over
the CCS console</div>
</div>
</td>
</tr>
</tbody>
</table>
<p class="rubric" id="id111">Sample Example Output</p>
<p>This came from K2K multicore example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>**************************************************
************ QMSS Multicore Example **************
**************************************************
**************************************************
************ QMSS Multicore Example **************
**************************************************
**************************************************
**************************************************
************ QMSS Multicore Example **************
************ QMSS Multicore Example **************
**************************************************
**************************************************
Core 1 : Starting BIOS...
Core 2 : Starting BIOS...
Core 3 : Starting BIOS...
Core 0 : Starting BIOS...
Core 0 : Created RM packet heap
Core 0 : Created IPC MessageQ heap
Core 0 : Created receive Q for Client1
Core 1 : Opened RM packet heap
Core 2 : Opened RM packet heap
Core 3 : Opened RM packet heap
Core 1 : Opened IPC MessageQ heap
Core 2 : Opened IPC MessageQ heap
Core 3 : Opened IPC MessageQ heap
Core 1 : Created receive Q for Server
Core 2 : Created receive Q for Server
Core 3 : Created receive Q for Server
Core 1 : Opened Server&#39;s receive Q
Core 1 : Waiting for QMSS to be initialized...

Core 0 : Opened Client1&#39;s receive Q for Server
Core 0 : Created receive Q for Client2
Core 0 : Opened Client2&#39;s receive Q for Server
Core 0 : Created receive Q for Client3
Core 2 : Opened Server&#39;s receive Q
Core 2 : Waiting for QMSS to be initialized...

Core 0 : Opened Client3&#39;s receive Q for Server

-----------------------Initializing---------------------------
Core 0 : L1D cache size 4. L2 cache size 0.
Core 0 : Memory region 0 inserted
Core 0 : Memory region 1 inserted
Core 0 : Tx Completion Queue Number     : 897 opened
Core 0 : Number of Tx descriptors requested : 32. Number of descriptors allocated : 32
Core 0 : Number of Rx descriptors requested : 32. Number of descriptors allocated : 32
Core 0 : Number of Sync free descriptors requested : 32. Number of descriptors allocated : 32
Core 0 : Sync Queue Number              : 9025 opened
Core 0 : Sync Cfg Queue Number          : 9026 opened
Core 0 : Sync Free Queue Number         : 898 opened
Core 0 : Receive Free Queue Number      : 736 opened
Core 0 : Transmit Free Queue Number     : 8928 opened
Core 0 : System initialization completed: 8928
Core 0 : Publishing RM nameserver names for shared queues

--------------------Queue status CORE 0----------------------
                    After Initialization

Tx Free Queue 8928 Entry Count            : 32
Rx Free Queue 736 Entry Count            : 32
Tx completion Queue 897 Entry Count     : 0
Sync Queue 9025 Entry Count              : 0
Sync free Queue 898 Entry Count         : 32
Sync Cfg Queue 9026 Entry Count          : 0
-------------------------------------------------------------

Core 0 : Registering High Priority interrupt channel : 0 eventId : 48 queue Number : 704


Core 3 : Opened Server&#39;s receive Q
Core 1 : QMSS initialization done.
Core 2 : QMSS initialization done.
Core 3 : Waiting for QMSS to be initialized...




Core 3 : QMSS initialization done.

Core 1 : Rx Free Queue Number       : 736 opened
Core 2 : Rx Free Queue Number       : 736 opened
Core 3 : Rx Free Queue Number       : 736 opened
Core 1 : Tx Free Queue Number       : 8928 opened
Core 2 : Tx Free Queue Number       : 8928 opened
Core 3 : Tx Free Queue Number       : 8928 opened
Core 1 : Tx Completion Queue Number : 897 opened
Core 2 : Tx Completion Queue Number : 897 opened
Core 3 : Tx Completion Queue Number : 897 opened
Core 1 : Sync Queue Number          : 9025 opened
Core 2 : Sync Queue Number          : 9025 opened
Core 3 : Sync Queue Number          : 9025 opened
Core 1 : Sync Free Queue Number     : 898 opened
Core 2 : Sync Free Queue Number     : 898 opened
Core 3 : Sync Free Queue Number     : 898 opened
Core 1 : Sync Cfg Queue Number      : 9026 opened
Core 2 : Sync Cfg Queue Number      : 9026 opened
Core 3 : Sync Cfg Queue Number      : 9026 opened
Core 1 : Registering High Priority interrupt channel : 1 eventId : 48 queue Number : 705
Core 2 : Registering High Priority interrupt channel : 2 eventId : 48 queue Number : 706
Core 3 : Registering High Priority interrupt channel : 3 eventId : 48 queue Number : 707
Core 1 : Waiting for sync signal
Core 2 : Waiting for sync signal
Core 3 : Waiting for sync signal
Core 0 : Opened Tx channel      : 0
Core 0 : Opened Rx channel      : 0
Core 0 : Transmit Queue Number  : 800
Core 0 : Receive Queue Number   : 704
Core 0 : Opened Rx flow         : 0
Core 0 : High priority accumulator programmed for channel : 0 queue : 704

Core 0 : Transmitting 8 packets..........

*************************************************************
Core 0 : Opened Tx channel      : 0
Core 0 : Opened Rx channel      : 0
Core 0 : Transmit Queue Number  : 800
Core 0 : Receive Queue Number   : 705
Core 0 : Opened Rx flow         : 0
Core 0 : High priority accumulator programmed for channel : 1 queue : 705

Core 0 : Transmitting 8 packets..........

*************************************************************
Core 0 : Opened Tx channel      : 0
Core 0 : Opened Rx channel      : 0
Core 0 : Transmit Queue Number  : 800
Core 0 : Receive Queue Number   : 706
Core 0 : Opened Rx flow         : 0
Core 0 : High priority accumulator programmed for channel : 2 queue : 706

Core 0 : Transmitting 8 packets..........

*************************************************************
Core 0 : Opened Tx channel      : 0
Core 0 : Opened Rx channel      : 0
Core 0 : Transmit Queue Number  : 800
Core 0 : Receive Queue Number   : 707
Core 0 : Opened Rx flow         : 0
Core 0 : High priority accumulator programmed for channel : 3 queue : 707

Core 0 : Transmitting 8 packets..........

*************************************************************
Core 0 : Waiting for sync signal
Core 0 : Got sync signal
*************************************************************


--------------------Queue status CORE 0----------------------
                    After packet processing

Tx Free Queue 8928 Entry Count            : 0
Rx Free Queue 736 Entry Count            : 32
Tx completion Queue 897 Entry Count     : 32
Sync Queue 9025 Entry Count              : 4
Sync free Queue 898 Entry Count         : 27
Sync Cfg Queue 9026 Entry Count          : 1
-------------------------------------------------------------

Core 0 : Waiting for other cores to ack sync signal
Core 1 : Got sync signal
Core 2 : Got sync signal
Core 3 : Got sync signal
*************************************************************
*************************************************************
*************************************************************



Core 0 : acks found

--------------------Deinitializing---------------------------

--------------------Queue status CORE 0----------------------
                    Before exit

Tx Free Queue 8928 Entry Count            : 0
Rx Free Queue 736 Entry Count            : 32
Tx completion Queue 897 Entry Count     : 32
Sync Queue 9025 Entry Count              : 0
Sync free Queue 898 Entry Count         : 28
Sync Cfg Queue 9026 Entry Count          : 4
-------------------------------------------------------------

Core 0 : Receive free queue closed successfully. Ref count : 0
Core 0 : Transmit completion queue closed successfully. Ref count : 3
Core 0 : Transmit free queue closed successfully. Ref count : 3
Core 0 : Sync queue closed successfully. Ref count : 3
Core 0 : Sync free queue closed successfully. Ref count : 3
Core 0 : Sync queue closed successfully. Ref count : 3
Core 0 : CPPI CPDMA closed successfully
Core 0 : CPPI exit successful
Core 0: Cleaning regions
Core 0: exit QMSS
Core 1 : Receive free queue closed successfully. Ref count : 3
Core 2 : Receive free queue closed successfully. Ref count : 2
Core 3 : Receive free queue closed successfully. Ref count : 1
Core 1 : Transmit completion queue closed successfully. Ref count : 2
Core 2 : Transmit completion queue closed successfully. Ref count : 1
Core 3 : Transmit completion queue closed successfully. Ref count : 0
Core 1 : Transmit free queue closed successfully. Ref count : 2
Core 2 : Transmit free queue closed successfully. Ref count : 1
Core 3 : Transmit free queue closed successfully. Ref count : 0
Core 1 : Sync queue closed successfully. Ref count : 2
Core 2 : Sync queue closed successfully. Ref count : 1
Core 3 : Sync queue closed successfully. Ref count : 0
Core 1 : Sync free queue closed successfully. Ref count : 2
Core 2 : Sync free queue closed successfully. Ref count : 1
Core 3 : Sync free queue closed successfully. Ref count : 0
Core 1 : Sync queue closed successfully. Ref count : 2
Core 2 : Sync queue closed successfully. Ref count : 1
Core 3 : Sync queue closed successfully. Ref count : 0
*******************************************************
*******************************************************
*******************************************************
******** QMSS Multicore (1) Example Done (PASS) *******
******** QMSS Multicore (2) Example Done (PASS) *******
******** QMSS Multicore (3) Example Done (PASS) *******
*******************************************************
*******************************************************
*******************************************************
Core 0 : Deleting RM nameserver names for shared queues
Instance name: RM_Server
Handle: 0x00854578
Type:   Server

Resource Status:

Core 0 : All resources freed successfully
*******************************************************
******** QMSS Multicore (0) Example Done (PASS) *******
*******************************************************
</pre></div>
</div>
</div>
</div>
<div class="section" id="id112">
<h2>6.14.4. Debug FAQ<a class="headerlink" href="#id112" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Double Push - Some queue elements lost.</p>
<ol class="arabic simple">
<li><p>Pushing the same pointer twice is illegal. In hardware it does
something similar to double linking the same object into two
places of a software linked list. It corrupts the list, such that
some items will be orphaned/lost.</p></li>
</ol>
</li>
<li><p>NULL Push - Entire queue lost</p>
<ol class="arabic simple">
<li><p>Pushing NULL (0) clears the entire queue. This is intentionally
done by Qmss_QueueEmpty(). However the various Qmss_QueuePush
functions don’t check for NULL (to save cycles). Don’t push NULL
(for example received when Qmss_QueuePop finds an empty queue).</p></li>
</ol>
</li>
<li><p>Hint Bits (4 low LSBs of desc pointer)</p>
<ol class="arabic simple">
<li><p>These are used to tell DMAs such as CPPI the size of the
descriptor. Thus, when receiving descriptors from hardware, you
must use QMSS_DESC_PTR() to discard them, else unaligned memory
accesses that corrupt descriptors will be generated by software.</p></li>
</ol>
</li>
<li><p>General lost descriptors</p>
<ol class="arabic simple">
<li><p>Its not a bad idea to have code that can inventory all your
descriptors as part of destructive debug. Iterate over all queues,
and pop all descriptors. Set a bit in a large bitmap for each
descriptor found. Bits that remain 0 indicate “lost” descriptors
which could have happened due to double push or null push or
software bugs that simply lost them. By examining the contents of
descriptor(s) and buffer(s), can often determine who last used
them therefore what part of code lost them.</p></li>
<li><p>Its also good to have nondestructive debug code that can call
Qmss_getQueueByteCount() and Qmss_getQueueEntryCount() for each
queue. This should be able to find all but a few (~4) descriptors
per hardware DMA that are in flight. If large amounts of
descriptors are missing, it means there is a bug. For this
debug/monitor purpose, its OK to make own Qmss_QueueHandle by
casting the queue number (eg (Qmss_QueueHandle)queueNum) since its
undesirable to generate accounting/management for purpose of
nondestructive debug.</p></li>
</ol>
</li>
</ol>
</div>
<div class="section" id="id113">
<h2>6.14.5. Additional References<a class="headerlink" href="#id113" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)/packages/ti
/drv/QMSS/docs/doxygen/html/index
.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)/packages/ti
/drv/QMSS/docs/<a href="#id290"><span class="problematic" id="id291">ReleaseNotes_QMSS_</span></a>
LLD.pdf</p></td>
</tr>
<tr class="row-even"><td><p>QoS (Weighted Round Robin and SP
QoS tree)</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)/packages/ti
/drv/QMSS/docs/firmware/qos_sched
,qos_sched_drop_sched,qos_sched_w
ide.pdf</p></td>
</tr>
<tr class="row-odd"><td><p>QoS (Leaky bucket and SRIO TX
Scheduler)</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)/packages/ti
/drv/QMSS/docs/firmware/qos.pdf</p></td>
</tr>
<tr class="row-even"><td><p>Hardware Userguide/TRM</p></td>
<td><p><a class="reference external" href="http://www.ti.com/lit/sprugr9">UG TRM
PDF</a></p></td>
</tr>
<tr class="row-odd"><td><p>CPPI LLD (Navigator/QMSS DMA
component)</p></td>
<td><p><a class="reference external" href="index_device_drv.html#cppi">CPPI LLD</a></p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="cppi">
<h1>6.15. CPPI<a class="headerlink" href="#cppi" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id114">
<h2>6.15.1. Overview<a class="headerlink" href="#id114" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id115">
<h3>6.15.1.1. Introduction<a class="headerlink" href="#id115" title="Permalink to this headline">¶</a></h3>
<p>CPPI offers developers a common way of handling different protocol
interfaces that may require multiple priorities and multiple channels on
a single port. CPPI defines the register set, data structures,
interrupts and buffer handling for all peripherals, regardless of
protocol.</p>
<p>CPPI is based on a buffer scatter/gather scheme, in which individual
packets are broken up and then stored into small buffers, from which
they are retrieved and reassembled (as opposed to using buffers that are
located contiguously in memory). When protocol translation is required,
a packet header can be appended in a small buffer, saving the CPU from
having to rewrite the entire packet and header by performing a copy from
one large buffer to another. The considerable savings in CPU cycles that
result make buffer scatter/gathering the most efficient scheme for
bridging and routing.</p>
<p>The LLD provides resource management for descriptors, receive/transmit
channels and receive flows.</p>
</div>
</div>
<div class="section" id="id116">
<h2>6.15.2. User Interface<a class="headerlink" href="#id116" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id117">
<h3>6.15.2.1. Driver Configuration<a class="headerlink" href="#id117" title="Permalink to this headline">¶</a></h3>
<p>The driver configures the CPPI subsystem using cppiGblCfgParams(system
configuration) structure. The default global configuration per device is
present under cppi_device.c file provided per device.</p>
<p>For details about individual fields of this structure, see the Doxygen
help by opening
PDK_INSTALL_DIRCPPIckagestidrvCPPIdocsdoxygenhtmlindex.html.</p>
</div>
<div class="section" id="id118">
<h3>6.15.2.2. APIs<a class="headerlink" href="#id118" title="Permalink to this headline">¶</a></h3>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/CPPI/CPPI_drv.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id119">
<h2>6.15.3. Application<a class="headerlink" href="#id119" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id120">
<h3>6.15.3.1. Examples<a class="headerlink" href="#id120" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><p>Expected Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPPI_Example
application</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
<em>sample test</em> use
case. Reference
example for
developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">User observes the
output printed over
the CCS console</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>CPPI_UnitTestApplicat
ion</p></td>
<td><div class="line-block">
<div class="line">Unit Test
application to test
all APIs</div>
</div>
</td>
<td><div class="line-block">
<div class="line">User observes the
output printed over
the CCS console</div>
</div>
</td>
</tr>
</tbody>
</table>
<p class="rubric" id="id121">Sample Example output</p>
<p>This came from k2k example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>**************************************************
*************** CPPI LLD usage example ***********
**************************************************
**************************************************
*************** CPPI LLD usage example ***********
**************************************************
**************************************************
**************************************************
*************** CPPI LLD usage example ***********
*************** CPPI LLD usage example ***********
**************************************************
**************************************************
*******Test running on Core 1 *******************
*******Test running on Core 0 *******************
*******Test running on Core 2 *******************
*******Test running on Core 3 *******************
Core 0 : L1D cache size 4. L2 cache size 0.
Core 2 : Starting BIOS...
Core 3 : Starting BIOS...
Core 0 : Starting BIOS...
Core 1 : Starting BIOS...
Core 0 : Created RM packet heap
Core 0 : Created IPC MessageQ heap
Core 0 : Created receive Q for Client1
Core 1 : Opened RM packet heap
Core 2 : Opened RM packet heap
Core 3 : Opened RM packet heap
Core 1 : Opened IPC MessageQ heap
Core 2 : Opened IPC MessageQ heap
Core 3 : Opened IPC MessageQ heap
Core 1 : Created receive Q for Server
Core 2 : Created receive Q for Server
Core 3 : Created receive Q for Server
Core 1 : Opened Server&#39;s receive Q
Core 1 : Waiting for QMSS to be initialized...

Core 0 : Opened Client1&#39;s receive Q for Server
Core 0 : Created receive Q for Client2
Core 0 : Opened Client2&#39;s receive Q for Server
Core 0 : Created receive Q for Client3
Core 2 : Opened Server&#39;s receive Q
Core 2 : Waiting for QMSS to be initialized...

Core 0 : Opened Client3&#39;s receive Q for Server

Core 0 : QMSS initialization done


Core 3 : Opened Server&#39;s receive Q
Core 1 : QMSS initialization done
Core 2 : QMSS initialization done
Core 3 : Waiting for QMSS to be initialized...


Core 3 : QMSS initialization done


Core 0 : QMSS CPDMA Opened
Core 1 : QMSS CPDMA Opened


Core 0 : Memory region 0 inserted
Core 0 : Number of descriptors requested : 8. Number of descriptors allocated : 8
Core 0 : Opened Rx channel : 0
Core 0 : Opened Tx channel : 0
Core 0 : Queue Number : 8192 opened
Core 0 : Queue Number : 8193 opened
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@10853b20
Receive Queue 8193 Entry Count : 1 Rx descriptor 0x@10853b20
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@10853b50
Receive Queue 8193 Entry Count : 1 Rx descriptor 0x@10853b50
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@10853b80
Receive Queue 8193 Entry Count : 1 Rx descriptor 0x@10853b80
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@10853bb0
Receive Queue 8193 Entry Count : 1 Rx descriptor 0x@10853bb0
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@10853be0
Receive Queue 8193 Entry Count : 1 Rx descriptor 0x@10853be0
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@10853c10
Receive Queue 8193 Entry Count : 1 Rx descriptor 0x@10853c10
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@10853c40
Receive Queue 8193 Entry Count : 1 Rx descriptor 0x@10853c40
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@10853c70
Receive Queue 8193 Entry Count : 1 Rx descriptor 0x@10853c70
Core 0 : Received host descriptor from Queue 897 Sucessfully
Core 0 : Tx Channel closed successfully. Ref count :0
Core 0 : Rx Channel closed successfully. Ref count :0
Core 0 : Rx queue closed successfully. Ref count :0
Core 0 : Tx queue closed successfully. Ref count :0
Core 0 : Free queue closed successfully. Ref count :0
Core 0 : Closing CPPI CPDMA Ref count : 3
Core 0 : CPPI CPDMA closed successfully
Core 1 : Memory region 1 inserted


Core 1 : Number of descriptors requested : 8. Number of descriptors allocated : 8
Core 2 : QMSS CPDMA Opened
Core 3 : QMSS CPDMA Opened
Core 1 : Opened Rx channel : 0


Core 1 : Opened Tx channel : 0
Core 2 : Memory region 2 inserted
Core 3 : Memory region 3 inserted
Core 1 : Queue Number : 0 opened
Core 2 : Number of descriptors requested : 8. Number of descriptors allocated : 8
Core 3 : Number of descriptors requested : 8. Number of descriptors allocated : 8
Core 1 : Queue Number : 1 opened
Core 2 : Opened Rx channel : 1
Core 3 : Opened Rx channel : 2
Transmit Queue 0 Entry Count : 1 Tx descriptor 0x@11853b20
Core 2 : Opened Tx channel : 1
Core 3 : Opened Tx channel : 2
Receive Queue 1 Entry Count : 1 Rx descriptor 0x@11853b20
Core 2 : Queue Number : 8192 opened
Core 3 : Queue Number : 8193 opened
Transmit Queue 0 Entry Count : 1 Tx descriptor 0x@11853b50
Core 2 : Queue Number : 8194 opened
Core 3 : Queue Number : 8195 opened
Receive Queue 1 Entry Count : 1 Rx descriptor 0x@11853b50
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@12853b20
Transmit Queue 8193 Entry Count : 1 Tx descriptor 0x@13853b20
Transmit Queue 0 Entry Count : 1 Tx descriptor 0x@11853b80
Receive Queue 8194 Entry Count : 1 Rx descriptor 0x@12853b20
Receive Queue 8195 Entry Count : 1 Rx descriptor 0x@13853b20
Receive Queue 1 Entry Count : 1 Rx descriptor 0x@11853b80
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@12853b50
Transmit Queue 8193 Entry Count : 1 Tx descriptor 0x@13853b50
Transmit Queue 0 Entry Count : 1 Tx descriptor 0x@11853bb0
Receive Queue 8194 Entry Count : 1 Rx descriptor 0x@12853b50
Receive Queue 8195 Entry Count : 1 Rx descriptor 0x@13853b50
Receive Queue 1 Entry Count : 1 Rx descriptor 0x@11853bb0
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@12853b80
Transmit Queue 8193 Entry Count : 1 Tx descriptor 0x@13853b80
Transmit Queue 0 Entry Count : 1 Tx descriptor 0x@11853be0
Receive Queue 8194 Entry Count : 1 Rx descriptor 0x@12853b80
Receive Queue 8195 Entry Count : 1 Rx descriptor 0x@13853b80
Receive Queue 1 Entry Count : 1 Rx descriptor 0x@11853be0
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@12853bb0
Transmit Queue 8193 Entry Count : 1 Tx descriptor 0x@13853bb0
Transmit Queue 0 Entry Count : 1 Tx descriptor 0x@11853c10
Receive Queue 8194 Entry Count : 1 Rx descriptor 0x@12853bb0
Receive Queue 8195 Entry Count : 1 Rx descriptor 0x@13853bb0
Receive Queue 1 Entry Count : 1 Rx descriptor 0x@11853c10
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@12853be0
Transmit Queue 8193 Entry Count : 1 Tx descriptor 0x@13853be0
Transmit Queue 0 Entry Count : 1 Tx descriptor 0x@11853c40
Receive Queue 8194 Entry Count : 1 Rx descriptor 0x@12853be0
Receive Queue 8195 Entry Count : 1 Rx descriptor 0x@13853be0
Receive Queue 1 Entry Count : 1 Rx descriptor 0x@11853c40
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@12853c10
Transmit Queue 8193 Entry Count : 1 Tx descriptor 0x@13853c10
Transmit Queue 0 Entry Count : 1 Tx descriptor 0x@11853c70
Receive Queue 8194 Entry Count : 1 Rx descriptor 0x@12853c10
Receive Queue 8195 Entry Count : 1 Rx descriptor 0x@13853c10
Receive Queue 1 Entry Count : 1 Rx descriptor 0x@11853c70
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@12853c40
Transmit Queue 8193 Entry Count : 1 Tx descriptor 0x@13853c40
Core 1 : Received host descriptor from Queue 896 Sucessfully
Receive Queue 8194 Entry Count : 1 Rx descriptor 0x@12853c40
Receive Queue 8195 Entry Count : 1 Rx descriptor 0x@13853c40
Core 1 : Tx Channel closed successfully. Ref count :0
Transmit Queue 8192 Entry Count : 1 Tx descriptor 0x@12853c70
Transmit Queue 8193 Entry Count : 1 Tx descriptor 0x@13853c70
Core 1 : Rx Channel closed successfully. Ref count :0
Receive Queue 8194 Entry Count : 1 Rx descriptor 0x@12853c70
Receive Queue 8195 Entry Count : 1 Rx descriptor 0x@13853c70
Core 1 : Rx queue closed successfully. Ref count :0
Core 2 : Received host descriptor from Queue 9026 Sucessfully
Core 3 : Received host descriptor from Queue 898 Sucessfully
Core 1 : Tx queue closed successfully. Ref count :0
Core 2 : Tx Channel closed successfully. Ref count :0
Core 3 : Tx Channel closed successfully. Ref count :0
Core 1 : Free queue closed successfully. Ref count :0
Core 2 : Rx Channel closed successfully. Ref count :0
Core 3 : Rx Channel closed successfully. Ref count :0
Core 1 : Closing CPPI CPDMA Ref count : 2
Core 2 : Rx queue closed successfully. Ref count :0
Core 3 : Rx queue closed successfully. Ref count :0
Core 1 : CPPI CPDMA closed successfully
Core 2 : Tx queue closed successfully. Ref count :0
Core 3 : Tx queue closed successfully. Ref count :0
Core 2 : Free queue closed successfully. Ref count :0
Core 3 : Free queue closed successfully. Ref count :0
Core 2 : Closing CPPI CPDMA Ref count : 1
Core 3 : CPPI CPDMA closed successfully
Core 2 : CPPI CPDMA closed successfully
Core 2 : CPPI exit successful
*******************************************************
*************** CPPI LLD usage example Done ***********
*******************************************************
Core 1 : CPPI exit successful
Core 3 : CPPI exit successful
*******************************************************
*******************************************************
*************** CPPI LLD usage example Done ***********
*************** CPPI LLD usage example Done ***********
*******************************************************
*******************************************************
Core 0 : CPPI exit successful
Core 0: exit QMSS
Instance name: RM_Server
Handle: 0x00849ee8
Type:   Server

Resource Status:

Core 0 : All resources freed successfully
*******************************************************
*************** CPPI LLD usage example Done ***********
*******************************************************
</pre></div>
</div>
<p class="rubric" id="id122">Debug FAQ</p>
<ol class="arabic simple">
<li><p>CPPI Lockup</p>
<ol class="arabic simple">
<li><p>CPPI can lock up if any pointer or length, including hint bits,
are wrong. Use the User Guide (TRM) referenced below to verify
every pointer and length in the descriptor. Also verify the hint
bits (low 4 bits of each descriptor) which represents size of
descriptor (not data) in 16-byte units. When using CPPI it should
be at least 1 (32 bytes) if no extensions are used, or 2 (48
bytes) if some extensions are used. 0 (16 bytes) is likely to
cause lock up!!</p></li>
</ol>
</li>
<li><p>See <a class="reference external" href="index_device_drv.html#qmss">QMSS Debug FAQ</a> for more.</p></li>
</ol>
</div>
</div>
<div class="section" id="id123">
<h2>6.15.4. Additional References<a class="headerlink" href="#id123" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)/packages/ti
/drv/CPPI/docs/doxygen/html/index
.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)/packages/ti
/drv/CPPI/docs/<a href="#id292"><span class="problematic" id="id293">ReleaseNotes_CPPI_</span></a>
LLD.pdf</p></td>
</tr>
<tr class="row-even"><td><p>Hardware Userguide/TRM</p></td>
<td><p><a class="reference external" href="http://www.ti.com/lit/sprugr9">UG TRM
PDF</a></p></td>
</tr>
<tr class="row-odd"><td><p>QMSS LLD (Navigator/Queueing HW
component)</p></td>
<td><p><a class="reference external" href="index_device_drv.html#qmss">QMSS LLD</a></p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="pa">
<h1>6.16. PA<a class="headerlink" href="#pa" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id124">
<h2>6.16.1. Overview<a class="headerlink" href="#id124" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id125">
<h3>6.16.1.1. Introduction<a class="headerlink" href="#id125" title="Permalink to this headline">¶</a></h3>
<p>The packet accelerator (PA) is one of the main components of the network
coprocessor (NETCP) peripheral in KeyStone devices, including C6678,
K2H/K/E/L. The PA works together with the security accelerator (SA) and
the gigabit Ethernet switch subsystem to form a network processing
solution. The purpose of PA in the NETCP is to perform packet processing
operations such as packet header classification, checksum generation,
and multi-queue routing.</p>
</div>
<hr class="docutils" />
<div class="section" id="id126">
<h3>6.16.1.2. Driver Configuration<a class="headerlink" href="#id126" title="Permalink to this headline">¶</a></h3>
<p>The driver configures the PASS subsystem using Pa_config_t structure.
This structure must be initialized before the Pa_create() function is
called and cannot be changed afterwards. Also, there are bunch of
system/global configurations and per entry configurations for PA. For
details about individual fields of this structure and other
configuration API structures, see the Doxygen help by opening
PDK_INSTALL_DIR\packages\ti\drv\PA\docs\doxygen\html\index.html.</p>
</div>
<div class="section" id="id127">
<h3>6.16.1.3. APIs<a class="headerlink" href="#id127" title="Permalink to this headline">¶</a></h3>
<p>API reference for application can be found in below file:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/PA/PA.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id128">
<h2>6.16.2. Application<a class="headerlink" href="#id128" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id129">
<h3>6.16.2.1. Examples<a class="headerlink" href="#id129" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PA_Example
application</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
<em>simple emac
loopback</em> use case.
Reference example
for developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">User observes the
output printed over
the CCS console</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>PA_UnitTestApplicatio
n</p></td>
<td><div class="line-block">
<div class="line">Unit Test
application to test
all APIs</div>
</div>
</td>
<td><div class="line-block">
<div class="line">User observes the
output printed over
the CCS console</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>PA_PktCapTestApplicat
ion</p></td>
<td><div class="line-block">
<div class="line">Packet Capture Unit
Test application.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">User observes the
output printed over
the CCS console</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id130">
<h2>6.16.3. FAQ<a class="headerlink" href="#id130" title="Permalink to this headline">¶</a></h2>
<p class="rubric" id="what-is-the-difference-between-internal-loopback-and-external-loopback">What is the difference between internal loopback and
external loopback?</p>
<ul class="simple">
<li><p>CPSW_LOOPBACK_INTERNAL (default): The transmitted packet is
loopbacked at the SGMII through SGMII internal loopback</p></li>
<li><p>CPSW_LOOPBACK_EXTERNAL: The transmitted packet should be loopbacked
by an application outside of the SOC, e.g., PC, PHY.</p></li>
</ul>
<p class="rubric" id="how-to-test-pa-emac-example-with-a-pc">How to test PA EMAC example with a PC?</p>
<p>The EVM has to be connected to PC via RJ-45 port. By default, the PA
example uses the internal loopback mode, please change code: int
cpswLpbkMode = CPSW_LOOPBACK_INTERNAL to CPSW_LOOPBACK_EXTERNAL.</p>
<p>To test the egress path (from SOC to PC):</p>
<ul class="simple">
<li><p>Rebuilt the CCS project, load and run.</p></li>
<li><p>The PC should receive 10 identical UDP packets sending out by the PA
example, the packet is defined by an array pktMatch[] in the code.</p></li>
</ul>
<p>To test the ingress direction (from PC to SOC): The PC needs a tool to
send out packets with controlled MAC address, IP address and UDP port
matching the PA layer 2, 3 and 4 classifications, defined by the
following functions:</p>
<ul class="simple">
<li><p>Add_MACAddress(): ethInfo.dst</p></li>
<li><p>Add_IPAddress(): ipInfo.dst</p></li>
<li><p>Add_Port (): ports</p></li>
</ul>
<p class="rubric" id="how-to-use-pa-emac-example-to-test-other-ethernet-ports-than-default">How to use PA EMAC example to test other Ethernet ports than
default?</p>
<p>The Keystone devices may have multiple Ethernet ports, connected through
an internal GbE switch with a host port. There is a pre-defined symbol
“NUM_PORTS” in the text file when creating the PA project. This controls
how many ports used in loopback mode test. In non-loopback case, the
port number may be hardcoded by gNum_Mac_Ports. This has to be changed
for the test. On EVMs, those additional Ethernet ports may be accessed
by various ways: Rear-Transition Module – Breakout Card (RTM-BOC) or
Advanced Mezzanine Card – Breakout Card (AMC-BOC), or AMC backplane,
they are EVM hardware dependent. For example, K2E has 8 SGMII ports. In
the K2E EVM, two Ethernet PHYs (PHY1 and PHY2) are connected to SoC
SGMII 0 and 1 respectively, to provide a copper interface and routed to
a Gigabit RJ-45 connector. The SGMII 2 and 3 of SoC are routed to Port 0
and 1 of the AMC edge connector backplane interface. The SGMII 4 to 7
are routed to RTM connector which can be accessed by RTM BOC. The PA
EMAC example by default tests all 8 ports in loopback. To test
additional ports in non-loopback, check/modify the gNum_Mac_Ports
defined to include the SGMII testing port.</p>
<p class="rubric" id="can-pa-be-used-to-forward-all-incoming-packets-to-host">Can PA be used to forward all incoming packets to host?</p>
<p>The design of PA is to use firmware to offload host for classifying
packets, the PA has layer 2, 3 and 4 classifications. PA LLD supports
two APIs to add MAC LUT1 classification and routing. The application can
call either the first generation API Pa_addMac() or the second
generation Pa_addMac2() APIs. When using the first API, initialize all
the elements of paEthInfo_t with zero and update the routing info
paRouteInfo_t with pa_DEST_HOST. When using the second generation API,
paEthInfo2_t with validBitMap = 0 and paRouteInfo2_t (in paParamDesc)
with pa_DEST_HOST can be passed. Please refer to Pa_addMac and
Pa_addMac2() API explanations as provided under the doxygen folder of PA
(Or refer to Pa.h interface header file).</p>
<p class="rubric" id="what-are-the-right-pa-netcp-ethernet-user-guides-to-use-for-different-keystone-devices">What are the right PA/NETCP/Ethernet user guides to use for different keystone devices?</p>
<ul class="simple">
<li><p>All Keystone I (C665x, C667x) devices use the same Serdes and documented in respective datasheets (See Device State Control Registers)</p></li>
<li><p>All Keystone II (K2H, K2K, K2G, K2E, K2L) device use the same Serdes and documented in <a class="reference external" href="http://www.ti.com/lit/pdf/SPRUHO3">http://www.ti.com/lit/pdf/SPRUHO3</a></p></li>
<li><p>For Keystone I, C667x has PA and NETCP GEN1, C665x has neither</p></li>
<li><p>For Keystone II, K2H/K2K use the same PA and NETCP GEN1 as C667x, K2E/K2L uses a different PA2 and NETCP GEN2</p></li>
<li><p>For Keystone II, K2G has neither PA nor NETCP</p></li>
</ul>
<p>To summarize:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 6%" />
<col style="width: 15%" />
<col style="width: 26%" />
<col style="width: 26%" />
<col style="width: 26%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>SOC</p></td>
<td><p>Serdes</p></td>
<td><p>Ethernet</p></td>
<td><p>PA</p></td>
<td><p>Netcp</p></td>
</tr>
<tr class="row-even"><td><p>C665x</p></td>
<td><p>See datasheet</p></td>
<td><p><a class="reference external" href="http://www.ti.com/lit/pdf/SPRUHH1">http://www.ti.com/lit/pdf/SPRUHH1</a></p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-odd"><td><p>C667x</p></td>
<td><p>See datasheet</p></td>
<td><p><a class="reference external" href="http://www.ti.com/lit/pdf/SPRUGV9">http://www.ti.com/lit/pdf/SPRUGV9</a></p></td>
<td><p><a class="reference external" href="http://www.ti.com/lit/pdf/SPRUGS4">http://www.ti.com/lit/pdf/SPRUGS4</a>
Driver: lib&lt;CPU&gt;ti.drv.pa</p></td>
<td><p><a class="reference external" href="http://www.ti.com/lit/pdf/SPRUGZ6">http://www.ti.com/lit/pdf/SPRUGZ6</a></p></td>
</tr>
<tr class="row-even"><td><p>K2H/K2K</p></td>
<td><p><a class="reference external" href="http://www.ti.com/">http://www.ti.com/</a>
lit/pdf/SPRUHO3</p></td>
<td><p>Same as C667x</p></td>
<td><p>Same as C667x</p></td>
<td><p>Same as C667x</p></td>
</tr>
<tr class="row-odd"><td><p>K2G</p></td>
<td><p>Same as K2H/K2K</p></td>
<td><p><a class="reference external" href="http://www.ti.com/lit/pdf/SPRUHY8">http://www.ti.com/lit/pdf/SPRUHY8</a></p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>K2E/K2L</p></td>
<td><p>Same as K2H/K2K</p></td>
<td><p><a class="reference external" href="http://www.ti.com/lit/pdf/SPRUHZ3">http://www.ti.com/lit/pdf/SPRUHZ3</a></p></td>
<td><p><a class="reference external" href="http://www.ti.com/lit/pdf/SPRUHZ2">http://www.ti.com/lit/pdf/SPRUHZ2</a>
Driver: lib&lt;CPU&gt;ti.drv.pa2</p></td>
<td><p><a class="reference external" href="http://www.ti.com/lit/pdf/SPRUHZ0">http://www.ti.com/lit/pdf/SPRUHZ0</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id131">
<h2>6.16.4. Additional References<a class="headerlink" href="#id131" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\PA\docs\doxygen\html\index.h
tml</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\PA\docs\ReleaseNotes_PA_LLD.
pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="sa">
<h1>6.17. SA<a class="headerlink" href="#sa" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id132">
<h2>6.17.1. Overview<a class="headerlink" href="#id132" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id133">
<h3>6.17.1.1. Introduction<a class="headerlink" href="#id133" title="Permalink to this headline">¶</a></h3>
<p>The Security Accelerator (SA) also known as cp_ace (Adaptive
Cryptographic Engine) is designed to provide packet security as part of
IPSEC, SRTP, and 3GPP industry standards. The security accelerator low
level driver (referred to as the module) provides APIs for the
configuration and control of the security accelerator sub-system. The SA
low level driver provides an abstraction layer between the application
and the Security Accelerator Sub System (SASS). It provides both the
system level interface and the channel-level interface with a set of
APIs in the driver.</p>
<p class="rubric" id="id134">Modes of Operation</p>
<p>Security accelerator library (ti.drv.sa) supports below modes</p>
<p><strong>Protocol Specific Mode</strong>: In this mode, standards such as Ipv4/Ipv6
and 3gpp protocols are supported, where command labels are created based
on the protocols.</p>
<p><strong>Data Mode</strong>: In this mode, user can implement a custom/proprietary
protocol mode with the help of APIs provided by SA LLD</p>
</div>
</div>
<div class="section" id="id135">
<h2>6.17.2. User Interface<a class="headerlink" href="#id135" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id136">
<h3>6.17.2.1. Driver Configuration<a class="headerlink" href="#id136" title="Permalink to this headline">¶</a></h3>
<p>The driver configures the SASS subsystem using SA_config_t (system
configuration) and Channel Configuration (Sa_ChanConfig_t) structure.</p>
<p>For details about individual fields of this structure and other APIs,
see the Doxygen help by opening
PDK_INSTALL_DIR\packages\ti\drv\SA\docs\doxygen\html\index.html.</p>
</div>
<div class="section" id="id137">
<h3>6.17.2.2. APIs<a class="headerlink" href="#id137" title="Permalink to this headline">¶</a></h3>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/SA/Salld.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id138">
<h2>6.17.3. Application<a class="headerlink" href="#id138" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id139">
<h3>6.17.3.1. Examples<a class="headerlink" href="#id139" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Expected Results</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">List of SOCs with</div>
</div>
<p>Application Build Support as CCS</p>
</th>
<th class="head"><div class="line-block">
<div class="line">List of SOCs with</div>
</div>
<p>Applications Build Support Make</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SA_Example
application</p></td>
<td><div class="line-block">
<div class="line">CCS Project Example
demonstrating
<em>simple IPSec</em> use
case. Reference
example for
developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">User observes the
output printed over
the CCS console</div>
</div>
</td>
<td><div class="line-block">
<div class="line">K2HK, K2L, K2E, C6678</div>
</div>
</td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>SA_UnitTestApplication</p></td>
<td><div class="line-block">
<div class="line">Unit Test
application to test
all APIs</div>
</div>
</td>
<td><div class="line-block">
<div class="line">User observes the
output printed over
the CCS console</div>
</div>
</td>
<td><div class="line-block">
<div class="line">K2HK, K2L, K2E, C6678, K2G</div>
</div>
</td>
<td><p>AM65XX</p></td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>
: SA Unit Test applications are makefile based for AM65XX. Note that the application built, can be loaded on to CCS.</p>
</div>
<div class="section" id="building-sa-examples-unit-test">
<h3>6.17.3.2. Building SA Examples/Unit Test<a class="headerlink" href="#building-sa-examples-unit-test" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Setup the build environment <a class="reference external" href="http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_overview.html#setup-environment">SetupBuildEnvironment</a></p></li>
<li><p>Follow the steps <a class="reference external" href="http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_overview.html#pdk-example-and-test-project-creation">SDK example and test CCS Project Creation</a>  for creating the CCS based example and test projects creation</p></li>
<li><dl class="simple">
<dt>Create make based test application executables following the link <a class="reference external" href="http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_overview.html#rebuilding-components">Building the component and make based test application</a>. Once the build environment is set, issue the following commands:</dt><dd><ul>
<li><p>cd &lt;pdk&gt;/packages/</p></li>
<li><p>To build: make sa</p></li>
<li><p>To clean: make sa_clean</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="id140">
<h2>6.17.4. Additional References<a class="headerlink" href="#id140" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\sa\docs\doxygen\html\index.h
tml</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\sa\docs\ReleaseNotes_SA_LLD.
pdf</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although SASS supports 3GPP specific Ciphering and
Authentication algorithms such as Kasumi F8/F9 and Snow3G F8, those
algorithms are locked out in this standard SA LLD distribution. In order
to access 3GPP specific functionalities, one must obtain ETSI licensing
as described at
<a class="reference external" href="http://www.etsi.org/services/security-algorithms/cellular-algorithms">http://www.etsi.org/services/security-algorithms/cellular-algorithms</a> and
then download the SASS 3GPP Enabler package from TI from the link
<a class="reference external" href="http://software-dl.ti.com/libs/sa_3gpp_enabler/latest/index_FDS.html">http://software-dl.ti.com/libs/sa_3gpp_enabler/latest/index_FDS.html</a></p>
</div>
<p>Due to export control restrictions, the SA 3GPP Enabler is a seperate
download from the rest of the PROCESSOR-SDK.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="srio">
<h1>6.18. SRIO<a class="headerlink" href="#srio" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id141">
<h2>6.18.1. Overview<a class="headerlink" href="#id141" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id142">
<h3>6.18.1.1. Introduction<a class="headerlink" href="#id142" title="Permalink to this headline">¶</a></h3>
<p>Driver enables the high-bandwidth system level interconnects. It is
intended to offer Gigabyte per second performance levels for
chip-to-chip and board-to-board communication.</p>
<p class="rubric" id="id143">Modes of Operation</p>
<p>Following modes of operations are supported</p>
<p><strong>Direct I/O</strong>: The SRIO packet contains the specific address where the
data should be stored or read in the destination device. This means that
the source device must have detailed knowledge of the available memory
space within the destination device.</p>
<p><strong>Type 9</strong>: A destination address is not specified. Instead the Stream
ID is used to map the request to a specific memory region by the local
(destination) device. TI IP additionally uses Class of Service (COS) as
well to further classify the mapping of a request to a memory region.</p>
<p><strong>Type 11</strong>: A destination address is not specified, instead, a
mailbox identifier is used within the SRIO packet. The mailbox is
controlled and mapped to memory by the local (destination) device.</p>
</div>
</div>
<div class="section" id="id144">
<h2>6.18.2. User Interface<a class="headerlink" href="#id144" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id145">
<h3>6.18.2.1. Driver Configuration<a class="headerlink" href="#id145" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="id146"><strong>Board Specific Configuration</strong></p>
<p>All board specific configurations eg:enabling and configuring the SRIO
SERDES registers and SRIO lane configurations (communication rates,
device IDs, etc) are required before calling any driver APIs. Template
functions for configuring the SRIO IP and SERDES registers are provided
in PDK_INSTALL_DIR\packages\ti\drv\srio\device\&lt;device&gt;\src. A template
function is provided for each soc that supports SRIO.</p>
</div>
<div class="section" id="id147">
<h3>6.18.2.2. APIs<a class="headerlink" href="#id147" title="Permalink to this headline">¶</a></h3>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/srio/srio_drv.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>OSAL API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/srio/srio_osal.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p class="rubric" id="init-srio">Init SRIO</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Initialize</span> <span class="n">QMSS</span> <span class="n">and</span> <span class="n">CPPI</span> <span class="n">modules</span><span class="p">...</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">SrioDevice_init</span><span class="p">();</span>
<span class="n">Srio_init</span> <span class="p">();</span>
<span class="p">...</span>
<span class="cm">/* Start the application Managed SRIO Driver. Refer example/test for appCfg fields */</span>
<span class="n">hAppManagedSrioDrv</span> <span class="o">=</span> <span class="n">Srio_start</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">appCfg</span><span class="p">);</span>
</pre></div>
</div>
<p>At this point SRIO driver is ready for data transfer on specific
instance identified by handle.</p>
<p class="rubric" id="sendreceive-apis">Send/Receive APIs</p>
<p><strong>Direct IO</strong>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Srio_sockSend_DIO</span><span class="p">(</span><span class="n">Srio_SockHandle</span> <span class="n">srioSock</span><span class="p">,</span> <span class="n">Srio_DrvBuffer</span> <span class="n">hBuffer</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">Srio_SockAddrInfo</span><span class="o">*</span> <span class="n">to</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Type 9</strong>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Srio_sockSend_TYPE9</span>   <span class="p">(</span><span class="n">Srio_SockHandle</span> <span class="n">srioSock</span><span class="p">,</span> <span class="n">Srio_DrvBuffer</span> <span class="n">hBuffer</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">Srio_SockAddrInfo</span><span class="o">*</span> <span class="n">to</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Type 11</strong>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Srio_sockSend_TYPE11</span>  <span class="p">(</span><span class="n">Srio_SockHandle</span> <span class="n">srioSock</span><span class="p">,</span> <span class="n">Srio_DrvBuffer</span> <span class="n">hBuffer</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">Srio_SockAddrInfo</span><span class="o">*</span> <span class="n">to</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Receive</strong>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Srio_sockRecv</span>         <span class="p">(</span><span class="n">Srio_SockHandle</span> <span class="n">srioSock</span><span class="p">,</span> <span class="n">Srio_DrvBuffer</span><span class="o">*</span> <span class="n">hDrvBuffer</span><span class="p">,</span><span class="n">Srio_SockAddrInfo</span><span class="o">*</span> <span class="n">from</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id148">
<h2>6.18.3. Application<a class="headerlink" href="#id148" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id149">
<h3>6.18.3.1. Examples<a class="headerlink" href="#id149" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><p>Expected Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Loopback DIO ISR
Example Project</p></td>
<td><div class="line-block">
<div class="line">The example is a
demonstration of the
SRIO driver running
the SRIO IP Block in
loopback mode. The
example showcases the
use of SRIO DIO
sockets using LSU
interrupts to
indicate the
completion of packet
transfer.</div>
</div>
<div class="line-block">
<div class="line">It is shown how
multiple sockets
with different
Source IDs can post
transactions and
process the pending
interrupt raised by
SRIO device.</div>
</div>
</td>
<td><p>The application
will run through a
set of DIO tests.
Upon successful
completion the
following string
will be printed
“DIO with
Interrupts example
completed
successfully.”</p></td>
</tr>
<tr class="row-odd"><td><p>Multicore Loopback
Example Project</p></td>
<td><div class="line-block">
<div class="line">The example is a
demonstration of the
SRIO driver while
operating in a
Multicore environment
by running the SRIO
IP Block in loopback
mode. The test case
here showcases the
SRIO Driver API being
multicore safe and
using the SRIO IP
peripheral to
exchange messages
between different
cores running on the
same device.</div>
</div>
<div class="line-block">
<div class="line">In this test case
each core performs
the role of a
producer and
consumer. The test
starts with Core 1
sending data to
Core 2. Core 2
receives and
validates the data
and sends another
data message to
Core3; which
receives and
validates the data
and sends another
different data
message to Core 0.
Core 0 then sends a
message to Core 1
which is received
and validated.</div>
</div>
</td>
<td><p>The application
will run through a
set of tests
sending and
receiving data
between two cores
over SRIO. Upon
successful
completion the
following string
will be printed
“Multicore Test
Passed” from each
DSP core.</p></td>
</tr>
<tr class="row-even"><td><p>Loopback Test</p></td>
<td><div class="line-block">
<div class="line">Unit Test
application to test
all APIs</div>
</div>
</td>
<td><p>The application
will run through a
set of tests to
verify all SRIO LLD
APIS. Upon
successful
completion the
following string
will be printed
“Unit Testing
completed
successfully.” from
each DSP core.</p></td>
</tr>
<tr class="row-odd"><td><p>SRIO Benchmarking
Test</p></td>
<td><div class="line-block">
<div class="line">The SRIO benchmarking
example code is
created to allow
customers to run
benchmarks on their
own TI EVMs with code
that utilizes the
SRIO LLD APIs. The
benchmarking example
code allows the user
to run core to core
in loopback mode
(internal or
external) on a single
EVM, or board to
board using the
external interface
between two EVMs.
This document’s
purpose is to explain
how measurements are
obtained and how to
configure the example
code for different
test scenarios. SRIO
physical connectivity
or external SRIO
switch configuration
is beyond the scope
of this document.</div>
</div>
</td>
<td><p>Review the SRIO
Benchmarking Example
documentation located
in
PDK_INSTALL_DIR\packa
ges\ti\drv\srio\test\
tput_benchmarking\doc
s\SRIO_Benchmarking_E
xample_Code_Guide.doc
for more information
on the tests
pass/fail criteria.</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id150">
<h2>6.18.4. Additional References<a class="headerlink" href="#id150" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\srio\docs\doxygen\html\index
.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\srio\docs\ReleaseNotes_SRIOD
river.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="hyplnk">
<h1>6.19. HYPLNK<a class="headerlink" href="#hyplnk" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id151">
<h2>6.19.1. Overview<a class="headerlink" href="#id151" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id152">
<h3>6.19.1.1. Introduction<a class="headerlink" href="#id152" title="Permalink to this headline">¶</a></h3>
<p>Hyperlink is a point-to-point peripheral. Each device has equal
capability to operate on the address space of the other device. This
also means that there is no complex enumeration in order to get started.</p>
<p class="rubric" id="id153">Modes of Operation</p>
<p>The LLD is intended to bring up the Hyperlink peripheral and open memory
mappings.</p>
<p class="rubric" id="id154">Interrupts</p>
<p>There is an interrupt generation example (in
PDK_INSTALL_DIR/packages/ti/drv/hyplnk/example/cicInterruptExample)
which maps and pokes the other device’s CIC (Chip/SOC level interrupt
controller) to generate interrupts for data transfers.</p>
<p>The PDK_INSTALL_DIR/packages/ti/drv/hyplnk/example/common/hyplnkIsr.c
monitors local interrupts to detect fatal errors. It can also be used
for IO interrupts, but there is only one output event that has to be
demuxed. Thus for multicore orthogonality, the cicInterruptExample is
often better example (because each destination core can have completely
independent interrupts).</p>
</div>
</div>
<div class="section" id="id155">
<h2>6.19.2. User Interface<a class="headerlink" href="#id155" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id156">
<h3>6.19.2.1. Driver Configuration<a class="headerlink" href="#id156" title="Permalink to this headline">¶</a></h3>
<p>The driver itself is entirely configured via API at runtime. However,
the examples are configured using compiler flags that are in
hyplnkPlatCfg.h and hyplnkLLDCfg.h.</p>
<p class="rubric" id="hyperlink-configuration-structure">Hyperlink configuration structure</p>
<p>The hyplnk_device.c binds the driver to the hardware on the board. It is
passed into the driver via the call to Hyplnk_init().</p>
</div>
<div class="section" id="id157">
<h3>6.19.2.2. APIs<a class="headerlink" href="#id157" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="id158">API Call Flow</p>
<p>The API call flow is covered in
examplememoryMappedExamplesrchyplnkExample.</p>
<p>They key parts are:</p>
<ol class="arabic simple">
<li><p>Initialize the LLD via Hyplnk_init().</p></li>
<li><p>Configure PLL, PSC and memories via hyplnkExampleSysSetup() which is
all example code</p></li>
<li><p>Install ISR(s)</p></li>
<li><p>Enable the peripheral using sequence in hyplnkExamplePeriphSetup()</p></li>
<li><p>Open memory maps using hyplnkExampleAddrMap() as a guide</p></li>
<li><p>Exchange data with memcpy or EDMA using mapped address (returned from
hyplnkExampleAddrMap).</p></li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id159">
<h2>6.19.3. Application<a class="headerlink" href="#id159" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id160">
<h3>6.19.3.1. Examples<a class="headerlink" href="#id160" title="Permalink to this headline">¶</a></h3>
<p>Hyperlink/hyplnk is supported only on Keystone devices. It is available
on 6678, 6657, K2H, K2K, K2E. All examples can be used in either
loopback (on any EVM without any special cables or breakout cards) or
with two boards. For 6678 or 6657, the required cable is
<a class="reference external" href="https://store.ti.com/HL5CABLE-Hyperlink-Cable-P2888.aspx">HL5CABLE</a>.
For K2H/K2K/K2E, the breakout card is
<a class="reference external" href="http://www.ti.com/devnet/docs/catalog/endequipmentproductfolder.tsp?actionPerformed=productFolder&amp;productId=17440">RTM-BOCRT</a>,
and the cable is also required. Below is a picture showing how a K2H EVM
is connected to a 6678 EVM via breakout card and cable.</p>
<img alt="../_images/K2-k1-hyplnk.jpg" src="../_images/K2-k1-hyplnk.jpg" />
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>EVM
Configuration</p></th>
<th class="head"><p>Expected
Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>memoryMappedExa
mple</p></td>
<td><p>Memory mapped
data exchange
with loopback
or 2 devices</p></td>
<td><p>Loopback runs
without any
extra hardware.
See below for
details on
configuring
board-to-board.</p></td>
<td><p>Link is
established and
data is
exchanged.</p></td>
</tr>
<tr class="row-odd"><td><p>cicInterruptExa
mple</p></td>
<td><p>CIC-based
interrupt
exchange.</p></td>
<td><p>Loopback runs
without any
extra hardware.
See below for
details on
configuring
board-to-board.</p></td>
<td><p>Interrupts are
sent between
ARM Linux
Userspace and
DSPs.</p></td>
</tr>
</tbody>
</table>
<p class="rubric" id="setup-of-multiple-evms-with-one-instance-of-ccs">Setup of multiple EVMs with one instance of CCS</p>
<p>This is only needed for 2 board use cases. See
<a class="reference external" href="http://processors.wiki.ti.com/index.php/Multi-Emulator_Debug_with_CCS">Multi-Emulator_Debug_with_CCS</a>
for general configuration of multiple EVMs/emulators within one instance
of CCS.</p>
<p class="rubric" id="detailed-instructions-to-run-memorymappedexample">Detailed instructions to run memoryMappedExample</p>
<p>If running with one board, enable loopback via uncommenting
hyplnk_EXAMPLE_LOOPBACK in
PDK_INSTALL_DIR/packages/ti/drv/hyplnk/example/common/hyplnkLLDCfg.h.</p>
<p>Compile the project for the specific device/evm in use.</p>
<p>For loopback: Load the example with hyplnk_EXAMPLE_LOOPBACK definined
onto one board and run. The results should be as below.</p>
<p>For 2 board: Make sure the both boards configuration match each other by
checking
PDK_INSTALL_DIR/packages/ti/drv/hyplnk/example/common/hyplnkLLDCfg.h:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">hyplnk_EXAMPLE_PORT</span> <span class="o">--&gt;</span> <span class="n">which</span> <span class="n">port</span> <span class="n">to</span> <span class="n">use</span> <span class="k">for</span> <span class="n">K2H</span><span class="o">/</span><span class="n">K2K</span><span class="o">/</span><span class="n">K2E</span>
<span class="n">hyplnk_EXAMPLE_ALLOW_x_LANES</span> <span class="o">--&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="n">or</span> <span class="mi">4</span> <span class="n">lanes</span>
<span class="n">hyplnk_EXAMPLE_SERRATE_xxpxxx</span> <span class="o">--&gt;</span> <span class="n">serdes</span> <span class="n">rate</span> <span class="n">setup</span>
</pre></div>
</div>
<p>Load the same example on both boards. It is fulling symmetric. No
special configuration is needed to distinguish side A and side B. Each
side should generate output similar to below.</p>
<p class="rubric" id="detailed-instructions-to-run-cicinterruptexample">Detailed instructions to run cicInterruptExample</p>
<p>This only works on devices with A15 running Linux (K2H, K2K, K2E). See
PDK_INSTALL_DIR/packages/ti/drv/hyplnk/example/cicInterruptExample/Readme.txt
for instructions.</p>
<p class="rubric" id="id161">Sample example output</p>
<p>This came from k2h device running in loopback.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>Version #: 0x02010005; string HYPLNK LLD Revision: 02.01.00.05:Dec 24 2015:17:48:28
About to do system setup (PLL, PSC, and DDR)
Power domain is already enabled.  You probably re-ran without device reset (which is OK)
Constructed SERDES configs: PLL=0x00000228; RX=0x0046c495; TX=0x000ccf95
system setup worked
About to set up HyperLink Peripheral
============================Hyperlink Testing Port 0
========================================== begin registers before initialization ===========
Revision register contents:
  Raw    = 0x4e902101
Status register contents:
  Raw        = 0x00003004
Link status register contents:
  Raw       = 0x00000000
Control register contents:
  Raw             = 0x00000000
Control register contents:
  Raw        = 0x00000000
============== end registers before initialization ===========
Hyperlink Serdes Common Init Complete
Hyperlink Serdes Lane 0 Init Complete
Hyperlink Serdes Lane 1 Init Complete
Hyperlink Serdes Lane 2 Init Complete
Hyperlink Serdes Lane 3 Init Complete
============== begin registers after initialization ===========
Status register contents:
  Raw        = 0x04402005
Link status register contents:
  Raw       = 0xfdf0bdf0
Control register contents:
  Raw             = 0x00006206
============== end registers after initialization ===========
Waiting 5 seconds to check link stability
Precursors 1
Postcursors: 19
Link seems stable
About to try to read remote registers
============== begin REMOTE registers after initialization ===========
Status register contents:
  Raw        = 0x0440080f
Link status register contents:
  Raw       = 0xfdf0bdf0
Control register contents:
  Raw             = 0x00006202
============== end REMOTE registers after initialization ===========
Peripheral setup worked
About to read/write once
Single write test passed
About to pass 65536 tokens; iteration = 0
=== this is not an optimized example ===
Link Speed is 4 * 3.125 Gbps
Passed 65536 tokens round trip (read+write through hyplnk) in 16829 Mcycles
Approximately 256799 cycles per round-trip
=== this is not an optimized example ===
Checking statistics
About to pass 65536 tokens; iteration = 1
=== this is not an optimized example ===
Link Speed is 4 * 3.125 Gbps
Passed 65536 tokens round trip (read+write through hyplnk) in 16829 Mcycles
Approximately 256799 cycles per round-trip
=== this is not an optimized example ===
Checking statistics
About to pass 65536 tokens; iteration = 2
.
.
.
</pre></div>
</div>
</div>
</div>
<div class="section" id="id162">
<h2>6.19.4. Debug FAQ<a class="headerlink" href="#id162" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>If it seems to not work, check for lError and rError in the status
register (hyplnkStatusReg_s). If these appear, it means double ecc
error occurred and the link is non functional. This is fatal error.
Next look at hyplnkECCErrorReg_s for single (corrected) bit errors.
After startup these should increment slowly (order of minutes, hours,
days, not seconds or less). If they are incrementing quickly (several
times per minute or second), then it means the SERDES coefficients
should be calibrated by following the Keystone SERDES UG. See
references section.</p></li>
<li><p>Note that if the link goes down (uncorrectable ECC error) it is
possible for the entire interconnect to lock up. If this occurs, it
will not be possible to access any memory even through the JTAG
interface (CCS will return errors instead of reading memory, and
often disconnect the target). Thus the primary cause of this lockup
should be avoided by carefully following the shutdown/reset
requirement in section 2.9 of the Hyperlink UG (which is to invoke
serial stop, and wait for it to take effect before resetting either
endpoint).</p></li>
<li><p>Another workaround for ECC single errors is to lower link rate and/or
reduce to 1 lane. This can be done by adjusting the commented defines
in
PDK_INSTALL_DIR/packages/ti/drv/hyplnk/example/common/hyplnkLLDCfg.h.</p></li>
</ol>
</div>
<div class="section" id="id163">
<h2>6.19.5. Additional References<a class="headerlink" href="#id163" title="Permalink to this headline">¶</a></h2>
<p>Additional documentation can be found in:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>Hardware Peripheral Hyperlink
Users Guide</p></td>
<td><p><a class="reference external" href="http://www.ti.com/lit/sprugw8">User
Guide</a></p></td>
</tr>
<tr class="row-odd"><td><p>Serdes Users Guide</p></td>
<td><p><a class="reference external" href="http://www.ti.com/lit/spruho3">User
Guide</a></p></td>
</tr>
<tr class="row-even"><td><p>CIC Peripheral Users Guide</p></td>
<td><p><a class="reference external" href="http://www.ti.com/lit/sprugw4">CIC User
Guide</a></p></td>
</tr>
<tr class="row-odd"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\hyplnk\docs\doxygen\html\ind
ex.html</p></td>
</tr>
<tr class="row-even"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\hyplnk\docs\ReleaseNotes_HYP
LNK_LLD.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="tsip">
<h1>6.20. TSIP<a class="headerlink" href="#tsip" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id164">
<h2>6.20.1. Overview<a class="headerlink" href="#id164" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id165">
<h3>6.20.1.1. Introduction<a class="headerlink" href="#id165" title="Permalink to this headline">¶</a></h3>
<p>The TSIP is a multi-link serial interface consisting of a maximum of
eight transmit data signals (or links), eight receive data signals (or
links), two frame sync input signals, and two serial clock inputs.
Internally the TSIP offers multiple channels of timeslot data management
and multi-channel DMA capability that allow individual timeslots to be
selectively processed.</p>
<p>The module can be configured to use the frame sync signals and the
serial clocks as redundant sources for all transmit and receive data
signals, or one frame sync and serial clock for transmit and the second
frame sync and clock for receive. The standard serial data rate for each
TSIP transmit and receive data signal is 8.192 Mbps. The standard frame
sync is a one or more bit wide pulse that occurs once every 125 µs or a
minimum of one serial clock period every 1024 serial clocks.</p>
<p>At the standard rate and default configuration there are eight transmit
and eight receive links that are active. Each serial interface link
supports up to 128 8-bit timeslots. This corresponds to an H-MVIP or
H.110 serial data rate interface. The serial interface clock frequency
can be either 16.384 MHz (default) or 8.192 MHz. The data rate for the
serial interface links can also be set to 16.384 Mbps or 32.768 Mbps.
The maximum number of active serial links is reduced to four and two,
respectively, in these configurations. The serial interface clock
frequency can be either 32.768 MHz or 16.384 MHz for 16.384 Mbps serial
links, and 65.536 MHz or 32.768 MHz for 32.768 Mbps serial links.
Maximum occupation of the serial interface links for the entire TSIP is
1024 transmit and receive timeslots in all configurations.</p>
</div>
</div>
<div class="section" id="id166">
<h2>6.20.2. User Interface<a class="headerlink" href="#id166" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id167">
<h3>6.20.2.1. Driver Configuration<a class="headerlink" href="#id167" title="Permalink to this headline">¶</a></h3>
<p>TSIP configuration involves configurations for desired stagger phase of
a TSIP timeout, using Tsip_configPhase() API. For details about
individual fields of this structure, see the Doxygen help by opening
PDK_INSTALL_DIR\Packages\ti\drv\TSIP\docs\doxygen\html\index.html.</p>
</div>
<div class="section" id="id168">
<h3>6.20.2.2. APIs<a class="headerlink" href="#id168" title="Permalink to this headline">¶</a></h3>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/tsip/tsip.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id169">
<h2>6.20.3. Application<a class="headerlink" href="#id169" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id170">
<h3>6.20.3.1. Examples<a class="headerlink" href="#id170" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>tsip_Example
application</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
<em>sample tsip</em> test.
Reference example
for developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">User observes the
output printed over
the CCS console</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>tsip_UnitTestApplicat
ion</p></td>
<td><div class="line-block">
<div class="line">Unit Test
application to test
all APIs</div>
</div>
</td>
<td><div class="line-block">
<div class="line">User observes the
output printed over
the CCS console</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id171">
<h2>6.20.4. Additional References<a class="headerlink" href="#id171" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\TSIP\docs\doxygen\html\index
.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\TSIP\docsReleaseNotes_TSIP.
pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="mcbsp">
<h1>6.21. MCBSP<a class="headerlink" href="#mcbsp" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id172">
<h2>6.21.1. Overview<a class="headerlink" href="#id172" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id173">
<h3>6.21.1.1. Introduction<a class="headerlink" href="#id173" title="Permalink to this headline">¶</a></h3>
<p>The multichannel buffered serial port (MCBSP) peripheral allows direct
interface to other TI DSPs, codecs, and other devices in a system. The
primary use for the MCBSP is for audio interface purposes. The following
sub sections explain the hardware (MCBSP peripheral) and software
context of the MCBSP LLD.</p>
<p>The device driver exposes a set of well-defined APIs which are used by
the application layer to send and receive data via the MCBSP peripheral.
The driver also exposes a set of well-defined OS abstraction APIs which
are used to ensure that the driver is OS independent and portable. The
MCBSP driver uses the CSL MCBSP register layer for all MCBSP MMR access.
The MCBSP driver also interfaces with the EDMA3 library to be able to
transfer data to and from MCBSP peripheral and data memory.</p>
</div>
</div>
<div class="section" id="id174">
<h2>6.21.2. User Interface<a class="headerlink" href="#id174" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id175">
<h3>6.21.2.1. Driver Configuration<a class="headerlink" href="#id175" title="Permalink to this headline">¶</a></h3>
<p>The MCBSP Driver initialization API needs to be called only once and it
initializes the internal driver data structures like device objects.
Application developers need to ensure that they call the MCBSP Driver
Init API before they call the MCBSP Device Initialization. Following API
is used to initialize the MCBSP Driver</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int32_t</span> <span class="n">mcbspInit</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</pre></div>
</div>
<p>MCBSP Peripheral Configuration
The MCBSP driver provides a sample implementation sequence which
initializes the MCBSP IP block. The MCBSP Device initialization API is
implemented as a sample prototype:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">McbspDevice_init</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</pre></div>
</div>
<p>For details about individual fields of this structure, see the Doxygen
help by opening
PDK_INSTALL_DIRPackagestidrvMCBSPdocsdoxygenhtmlindex.html.</p>
</div>
<div class="section" id="id176">
<h3>6.21.2.2. APIs<a class="headerlink" href="#id176" title="Permalink to this headline">¶</a></h3>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/MCBSP/mcbsp_drv.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id177">
<h2>6.21.3. Application<a class="headerlink" href="#id177" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id178">
<h3>6.21.3.1. Examples<a class="headerlink" href="#id178" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MCBSP_Example
application</p></td>
<td><p>Example
demonstrating
<em>sample MCBSP
loopback</em> test.
Reference example
for developers</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id179">
<h2>6.21.4. Additional References<a class="headerlink" href="#id179" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\MCBSP\docs\doxygen\html\inde
x.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\MCBSP\docs\ReleaseNotes_MCBS
P.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="emac">
<h1>6.22. EMAC<a class="headerlink" href="#emac" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id180">
<h2>6.22.1. Introduction<a class="headerlink" href="#id180" title="Permalink to this headline">¶</a></h2>
<p>EMAC driver provides a well defined API layer which allows
applications to use the EMAC peripheral to control the flow of packet
data from the processor to the PHY and the MDIO module to control PHY
configuration and status monitoring. EMAC driver is a common driver for
supporting all 1 Gigabit Network interfaces including CPSW and ICSSG
for applicable SOC’s.</p>
</div>
<div class="section" id="id181">
<h2>6.22.2. Driver Configuration<a class="headerlink" href="#id181" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id182">
<h3>6.22.2.1. Board Specific Configuration<a class="headerlink" href="#id182" title="Permalink to this headline">¶</a></h3>
<p>All the board specific configurations eg:enabling and pin-mux of
RGMII/MDIO pins should be performed before calling any driver APIs. By
default Board_Init() API supports all initialization sequence for TI
supported EVMs.Refer <a class="reference external" href="index_board.html#board-support">Processor SDK RTOS Board
Support</a> for additional
details.</p>
<p>Once the board specific configuration is complete driver API emac_open()
can be called to initialize driver</p>
<p class="rubric" id="emac-configuration-structure"><strong>EMAC Configuration Structure</strong></p>
<p>The emac_soc.c file binds driver with hardware attributes on the board
through EMAC_Cfg structure. This structure must be provided to EMAC
driver. It must be initialized before the emac_open() function is
called.</p>
<p>For details about individual fields of this structure, see the Doxygen
help by opening
PDK_INSTALL_DIR\packages\ti\drv\emac\docs\doxygen\html\index.html.</p>
</div>
</div>
<div class="section" id="id183">
<h2>6.22.3. APIs<a class="headerlink" href="#id183" title="Permalink to this headline">¶</a></h2>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/emac/emac_drv.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p class="rubric" id="id184">API Call Flow</p>
<p>The below sequence indicates the calling sequence of EMAC driver
APIs for a use case of an EMAC example which implements a single
Ethernet MAC port. This example call flow is illustrated using port
number 0.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">port_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="n">Board_initCfg</span> <span class="n">cfg</span> <span class="o">=</span> <span class="n">BOARD_INIT_UART_STDIO</span> <span class="o">|</span> <span class="n">BOARD_INIT_PINMUX_CONFIG</span> <span class="o">|</span> <span class="n">BOARD_INIT_MODULE_CLOCK</span>  <span class="o">|</span> <span class="n">BOARD_INIT_ETH_PHY</span><span class="p">;</span>

<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>

<span class="cm">/* Update emac_cfg with SOC specific config required by the driver */</span>
<span class="cm">/* Do a socGet, update emac_cfg as required and followed by socSet */</span>
<span class="n">EMAC_socGetInitCfg</span><span class="p">(</span><span class="n">port_num</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">emac_cfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">EMAC_socSetInitCfg</span><span class="p">(</span><span class="n">port_num</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">emac_cfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="cm">/* For UDMA based DMA interface, init the UDMA driver */</span>
<span class="n">retVal</span> <span class="o">=</span> <span class="n">Udma_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gUdmaDrvObj</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">initPrms</span><span class="p">);</span>
<span class="p">....</span>
<span class="cm">/* Populate open_cfg structure with application specific configuration */</span>
<span class="n">retVal</span> <span class="o">=</span> <span class="n">emac_open</span><span class="p">(</span><span class="n">port_num</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">open_cfg</span><span class="p">)</span>
<span class="p">....</span>
<span class="cm">/* Provide RX filter configuration (currently</span>
<span class="cm">   only applicable for C6657 &amp; OMAPL13x SOCs */</span>
<span class="n">retVal</span> <span class="o">=</span> <span class="n">emac_config</span><span class="p">(</span><span class="n">port_num</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cfg_info</span><span class="p">);</span>
<span class="p">....</span>
<span class="cm">/* For SOCs with CPSW ports, query driver for CPSW statistics */</span>
<span class="n">retVal</span> <span class="o">=</span> <span class="n">emac_get_statistics</span><span class="p">(</span><span class="n">port_num</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stats</span><span class="p">);</span>
<span class="p">....</span>
<span class="cm">/* For SOCs with ICSSG ports, query driver for ICSSG hardware statistics */</span>
<span class="n">retVal</span> <span class="o">=</span> <span class="n">emac_get_statistics_icssg</span><span class="p">(</span><span class="n">port_num</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stats</span><span class="p">,</span> <span class="n">clear</span><span class="p">);</span>
</pre></div>
</div>
<p>At this point EMAC driver is ready to send and receive packets.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Provide a context to poll the driver for received packets, showing RTOS use case */</span>
<span class="n">Task_create</span><span class="p">(</span><span class="n">app_test_task_poll_pkt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">taskParams</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="cm">/* Sample implementation of task context */</span>
<span class="n">app_test_task_pol_pkt</span><span class="p">(</span><span class="n">UArg</span> <span class="n">arg0</span><span class="p">,</span> <span class="n">UArg</span> <span class="n">arg1</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="cm">/* AM65xx supports optional mode of direct polling of RX queue for packets which can be</span>
<span class="cm">           configured at time of emac_open.  This mode of operation does not use</span>
<span class="cm">           interrupts. Note that default mode is via use of interrupts*/</span>
        <span class="n">emac_poll_pkt</span><span class="p">(</span><span class="n">port_num</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Provide a context to poll the driver for link status, showing RTOS use case */</span>
<span class="n">Task_create</span><span class="p">(</span><span class="n">app_test_task_poll_link</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">taskParams</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="cm">/* Sample implementation of task context */</span>
<span class="n">app_test_task_pol_link</span><span class="p">(</span><span class="n">UArg</span> <span class="n">arg0</span><span class="p">,</span> <span class="n">UArg</span> <span class="n">arg1</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">EMAC_LINK_INFO_T</span> <span class="n">linkInfo</span><span class="p">;</span>
    <span class="k">do</span>
    <span class="p">{</span>
        <span class="n">emac_poll</span><span class="p">(</span><span class="n">port_num</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">linkInfo</span><span class="p">);</span>
        <span class="n">Osal_delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
        <span class="n">UART_printf</span><span class="p">(</span><span class="s">&quot;Link for port %d is DOWN</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">port_num</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">linkInfo</span><span class="p">.</span><span class="n">link_status</span> <span class="o">==</span> <span class="n">EMAC_LINKSTATUS_NOLINK</span><span class="p">);</span>

    <span class="n">UART_printf</span><span class="p">(</span><span class="s">&quot;Link for port %d is UP</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">port_num</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Close port and release all resources allocated at time of emac_open */</span>
<span class="n">retVal</span> <span class="o">=</span> <span class="n">emac_close</span><span class="p">(</span><span class="n">port_num</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="interposer-card-support">
<h2>6.22.4. Interposer Card Support<a class="headerlink" href="#interposer-card-support" title="Permalink to this headline">¶</a></h2>
<p>Interposer card is an ethernet wiring adapter to let 2 ICSSG subsystems drive 2 ethernet ports with DUAL MAC or SWITCH firmware.
So that each direction (TX/RX) can be handled by one pair of PRU cores.
The interposer card permits the power of two ICSSG instances to be used on a two port switch or dual EMAC as opposed to the two-port, single ICSSG configuration.
The following diagrams show the PRU-ICSSG RGMII TX/RX mapping to the physical ports for Maxwell and then for Maxwell with interposer card configured.
Interposer card functionality can be verified by running the icssg-emac DIAG test( Refer <a class="reference external" href="index_board.html#board-support">Processor SDK RTOS Board
Support</a> for additional details ) or the emac LLD test
application (Emac_Icssg_TestApp described below).
Note that prior to running these tests on Maxwell with interposer card, please hook up an ethernet cable between PHY0 and PHY1.</p>
<p class="rubric" id="interposer-layout">Interposer Layout</p>
<img alt="../_images/Interposer.png" src="../_images/Interposer.png" />
</div>
<div class="section" id="example-and-test-applications">
<h2>6.22.5. Example and Test Applications<a class="headerlink" href="#example-and-test-applications" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
<th class="head"><p>SOC Suppported</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>EMAC_BasicExample</p></td>
<td><p>EMAC Loopback test
at CPSW switch
interface.
Reference example
for developers</p>
<p>Example demonstrates
loopback capability
by sending dummy
broadcast packet to
CPSW switch. Unit
test registers
receive packet
callback routine with
LLD to be called for
RX packet. Call back
routine will extract
packet received,
perform simple memory
comparison against
packet sent for
integrity check. Unit
test will iterate
over configured
packet count for
packet transmission
and reception check.</p>
</td>
<td><p>Unit Test will
print “All tests
have passed” via
UART console.</p></td>
<td><p>AM335x,
AM437x,
AM572x,
AM571x,
AM574x,
K2G</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-odd"><td><p>EMAC_SMP_BasicExample</p></td>
<td><p>EMAC Loopback test
at CPSW switch
interface with SMP
enabled.
(A15 core only)</p></td>
<td><p>Unit Test will
print “All tests
have passed” via
UART console.</p></td>
<td><p>AM572x-EVM</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-even"><td><p>EMACLoopback_testProj
ect</p></td>
<td><p>EMAC Loopback test
at CPSW switch
interface.
Reference example
for developers</p>
<p>Example demonstrates
loopback capability
by sending dummy
broadcast packet to
CPSW switch. Unit
test registers
receive packet
callback routine with
LLD to be called for
RX packet. Call back
routine will extract
packet received,
perform simple memory
comparison against
packet sent for
integrity check. Unit
test will iterate
over configured
packet count for
packet transmission
and reception check.</p>
<p>This example needs to
be run on the
OMAPL137 and OMAPL138
platforms using
external loopback
cable. OMAPL137 EVM
is having two
Ethernet ports.
Connect the loopback
cable to the port 1
(ENET-P1) while
running the loopback
example.</p>
</td>
<td><p>Unit Test will
print “Loopback
Test completed
successfully on
core 0” via CCS
console for C6657
and on UART serial
console for
OMAPL13x.</p></td>
<td><p>C6657,
DRA7xx,
OMAPL137,
OMAPL138</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-odd"><td><p>EMAC_PktInspectionExa
mple</p></td>
<td><p>This demonstrates how
to write an
application to filter
Ethernet packets
based on IP address</p>
<p>Prerequisites:</p>
<ul>
<li><p>Install the
packETH utility (v
1.8.1) on a Linux
PC. The packETH
tool is available
for Windows as
well, but not all
features are
supported</p></li>
<li><p>Download the test
PCAP <a class="reference external" href=":download:`&lt;../images/Pcap.zip&gt;`">files</a></p>
<p>and update the
source and dest
MAC address of the
PC and EVM to be
used in the test.
The tcprewrite
utility can be
used to set the
new MAC addresses
(i.e. tcprewrite
–enet-smac=&lt;PC-MA</p>
</li>
</ul>
<dl class="simple">
<dt>C-address&gt;</dt><dd><p>–enet-dmac=&lt;EVM-M</p>
</dd>
<dt>AC-address&gt;</dt><dd><p>-i ./ip1_test.pcap
-o
./ip1_test.pcap)</p>
</dd>
</dl>
<p>Steps:</p>
<ul class="simple">
<li><p>Launch the packETH
utility on the
Linux PC with root
permissions</p></li>
<li><p>Go to the “Gen-S”
tab of the packETH
utility and select
the PCAP files to
be used</p></li>
<li><p>Set the transfer
rate for each PCAP
file (i.e. 200
Mbit/s and 150
Mbit/s)</p></li>
<li><p>Set the total
packets to
transfer to 500000</p></li>
<li><p>Load and run the
EMAC packet
inspection
application to the
IPU1 core</p></li>
<li><p>Hit the “Send”
button on the
packETH utility to
start streaming</p></li>
<li><p>The packet
streaming should
last for few
seconds</p></li>
</ul>
</td>
<td><p>Pass criteria:</p>
<ul>
<li><p>The total packet
sent for each
stream is shown at
the bottom of the</p>
<p>packETH widow. The
packet stream
statistics must
match the packet
statistics printed
by the DUT via
serial port</p>
</li>
<li><p>The packet
inspection utility
periodically
prints the EMAC
statistics, which
include DMA
overruns,
underruns and
other error. No
errors should be
seen during the
transfer.</p></li>
</ul>
<p>Fail criteria:</p>
<ul class="simple">
<li><p>Packet count
mismatch between
packETH utility
and counters from
the IPU1
application</p></li>
<li><p>Any EMAC errors
reported by the
IPU1 application</p></li>
</ul>
</td>
<td><p>DRA7xx</p></td>
<td><p>CCS project</p></td>
</tr>
<tr class="row-even"><td><p>Emac_Cpsw_TestApp</p></td>
<td><p>EMAC Loopback test
at CPSW switch
interface.
Reference application
for developers</p>
<p>TestApp demonstrates
loopback capability
by sending packets to
CPSW switch. Unit
test registers
receive packet
callback routine with
LLD to be called for
RX packet. Call back
routine will extract
packet received,
perform simple memory
comparison against
packet sent for
integrity check. Unit
test will iterate
over configured
packet count for
packet transmission
and reception check.</p>
</td>
<td><p>Unit Test will
print “All tests
have passed” via
UART console.</p></td>
<td><p>AM65xx,
J721E</p></td>
<td><p>makefile</p></td>
</tr>
<tr class="row-odd"><td><p>Emac_Cpsw_SMP_TestApp</p></td>
<td><p>EMAC Loopback test
at CPSW switch
interface with SMP
enabled
(A53 core only)</p></td>
<td><p>Unit Test will
print “All tests
have passed” via
UART console.</p></td>
<td><p>AM65xx</p></td>
<td><p>makefile</p></td>
</tr>
<tr class="row-even"><td><p>Emac_Icssg_TestApp</p></td>
<td><p>EMAC port 2 port test
between ICSSG ports.
Reference application
for developers</p>
<p>Prior to running this
test, please connect
the ICSSG ports as
follows with
ethernet cables:</p>
<p>PHY0 to PHY1</p>
<p>PHY2 to PHY3</p>
<p>PHY4 to PHY5</p>
<p>Test app demonstrates
packet TX/RX between
2 ICSSG ports. All 6
ICSSG ports will be
tested for am65xx-idk.
PRU2 ports will be
tested for am65xx-evm.
Unit test registers
receive packet
callback routine with
LLD to be called for
RX packet. Call back
routine will extract
packet received,
perform simple memory
comparison against
packet sent for
integrity check. Unit
test will iterate
over configured
packet count for
packet transmission
and reception check.</p>
</td>
<td><p>Unit Test will
print “All tests
have passed” via
UART console</p></td>
<td><p>AM65xx</p></td>
<td><p>makefile</p></td>
</tr>
<tr class="row-odd"><td><p>Emac_Icssg_Switch_TestApp</p></td>
<td><p>Switch port 2 port
test between ICSSG
ports.
Reference application
for developers</p>
<p>Prior to running this
test, please connect
the ICSSG ports as
follows with
ethernet cables:</p>
<p>PHY0 to PHY1</p>
<p>Test app demonstrates
packet TX/RX between
2 ICSSG Switch ports.
Unit test registers
receive packet
callback routine with
LLD to be called for
RX packet. Call back
routine will extract
packet received,
perform simple memory
comparison against
packet sent for
integrity check. Unit
test will iterate
over configured
packet count for
packet transmission
and reception check.</p>
</td>
<td><p>Unit Test will
print “All tests</p>
<p>have passed” via
UART console</p>
</td>
<td><p>AM65xx</p></td>
<td><p>makefile</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id185">
<h2>6.22.6. Support for Benchmark Testing<a class="headerlink" href="#id185" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
<th class="head"><p>SOC Suppported</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Emac_Icssg_TestApp</p></td>
<td><p>Test application with
modifications can
used for performance
benchmarking</p>
<p>In order to run the
test application in
benchamrk mode you
need to update
ti/drv/emac/test/
EmacLoopbackTest/
test_loc.h to enable
EMAC_BENCHMARK macro</p>
<p>Connect external
packet generator to
PHY4.</p>
<p>The unit test will
poll the RX packet
channel/ring for the
port being testing and
will loop the packet
back to the external
traffic generator with
“no touch” to the
packet</p>
</td>
<td><p>Test applicaiton
will print “polling
rx packets on port 4”
via the UART console</p>
<p>Every 60 seconds,
a sub-set of hardware
statistics will be
displayed via UART
console</p>
</td>
<td><p>am65xx</p></td>
<td><p>make</p></td>
</tr>
<tr class="row-odd"><td><p>Emac_Cpsw_TestApp</p></td>
<td><p>Test application with
modifications can
used for performance
benchmarking</p>
<p>In order to run the
test application in
benchamrk mode you
need to update
ti/drv/emac/test/
EmacLoopbackTest/
test_loc.h to enable
EMAC_BENCHMARK macro</p>
<p>To benchmark ICSSG
connect external
packet generator to
PHY4.</p>
<p>To benchmark CPSW
connect external
packet generator to
CPSW port</p>
<p>The unit test will
poll the RX packet
channel/ring for the
port being testing and
will loop the packet
back to the external
traffic generator with
“no touch” to the
packet</p>
</td>
<td><p>Test application
will print “polling
rx packets on port 6”
via the UART console</p>
<p>Every 60 seconds,
a sub-set of hardware
statistics will be
displayed via UART
console</p>
</td>
<td><p>am65xx</p></td>
<td><p>make</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="building-emac-test-applications-via-makefiles">
<h2>6.22.7. Building EMAC Test applications via makefiles<a class="headerlink" href="#building-emac-test-applications-via-makefiles" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>EMAC Test applications and dependent libraries are built from the top level emac
makefile</p></li>
<li><p>Refer to the <a class="reference external" href="index_overview.html#setup-environment">Processor SDK RTOS Getting Started Guide</a>  for details
of how to setup the build environment. Once you have setup the build environment, issue the following commands:</p>
<blockquote>
<div><ul class="simple">
<li><p>cd &lt;pdk&gt;/packages/</p></li>
<li><p>To build: make emac</p></li>
<li><p>To clean: make emac_clean</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Similarly, to build at the module level, issue the following commands for rebuilding :</p>
<blockquote>
<div><ul class="simple">
<li><p>cd &lt;pdk&gt;/packages/ti/drv/emac</p></li>
<li><p>To build: make all</p></li>
<li><p>To clean: make clean</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="running-emac-examples-and-test-applications">
<h2>6.22.8. Running EMAC Examples and Test applications<a class="headerlink" href="#running-emac-examples-and-test-applications" title="Permalink to this headline">¶</a></h2>
<p class="rubric" id="description"><em>Description</em></p>
<p>EMAC Test applications demonstrates the key features of the driver.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="running-the-emac-test-applications"><strong>Running the EMAC Test applications</strong></p>
<p><strong>Via CCS connection</strong>:</p>
<ul class="simple">
<li><p>Load the System firmware as specified in SCICLIENT documentation for AM65xx SOC</p></li>
<li><p>Load the generated executable file in CCS</p></li>
<li><p>Run the application.</p></li>
<li><p>The application print will be displayed on the CCS and UART console. The UART console used depends on the core in which the application is run.</p></li>
</ul>
<p><strong>Via Secondary Bootloader (SBL)</strong>:</p>
<p>EMAC Test applications can also be run via SBL. To run via SBL, please following the instructions as specified in the following link:
<a class="reference external" href="http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_Foundational_Components.html#am655x-compiling-apps-for-sbl">SBL User Guide</a></p>
</div>
<div class="section" id="id186">
<h2>6.22.9. Additional References<a class="headerlink" href="#id186" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\emac\docs\doxygen\html\index
.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\emac\docs\ReleaseNotes_EMAC_
LLD.pdf</p></td>
</tr>
<tr class="row-even"><td><p>Software Design</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\emac\docs\EMAC_LLD_SD.pdf</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mcasp">
<h1>6.23. MCASP<a class="headerlink" href="#mcasp" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id187">
<h2>6.23.1. Overview<a class="headerlink" href="#id187" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id188">
<h3>6.23.1.1. Introduction<a class="headerlink" href="#id188" title="Permalink to this headline">¶</a></h3>
<p>The multichannel audio serial port (McASP) functions as a
general-purpose audio serial port optimized for the needs of
multichannel audio applications. The McASP is useful for time-division
multiplexed (TDM) stream, Inter-Integrated Sound (I2S) protocols, and
intercomponent digital audio interface transmission (DIT).The
multichannel buffered serial port (McASP) peripheral allows direct
interface to other TI DSPs, codecs, and other devices in a system. The
following sub sections explain the hardware (McASP peripheral) and
software context of the McASP LLD.</p>
<p>The device driver exposes a set of well-defined APIs which are used by
the application layer to send and receive data via the McASP peripheral.
The driver also exposes a set of well-defined OS abstraction APIs which
are used to ensure that the driver is OS independent and portable. The
McASP driver uses the CSL McASP register layer for all McASP MMR access.
The McASP driver also interfaces with the EDMA3/UDMA library to be able to
transfer data to and from McASP peripheral and data memory.</p>
</div>
</div>
<div class="section" id="id189">
<h2>6.23.2. User Interface<a class="headerlink" href="#id189" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id190">
<h3>6.23.2.1. Driver Configuration<a class="headerlink" href="#id190" title="Permalink to this headline">¶</a></h3>
<p>The McASP driver provides a sample implementation sequence which
initializes the MCASP IP block. The McASP Device initialization API is
implemented as a sample prototype:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">McaspDevice_init</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</pre></div>
</div>
<p>The function initializes all the instance specific information like base
address of instance CFG registers, FIFO address for the instance, TX and
RX CPU event numbers, TX and RX EDMA event numbers etc.</p>
<p>For details about individual fields of this structure, see the Doxygen
help by opening
PDK_INSTALL_DIRPackagestidrvmcaspdocsdoxygenhtmlindex.html.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int32_t</span> <span class="n">Mcasp_socGetInitCfg</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">index</span><span class="p">,</span> <span class="n">Mcasp_HwInfo</span> <span class="o">*</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>
</div>
<p>The function obtains the soc configuration parameters such as interrupt
numbers, mux configuration parameters etc.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int32_t</span> <span class="n">Mcasp_socSetInitCfg</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">index</span><span class="p">,</span> <span class="k">const</span> <span class="n">Mcasp_HwInfo</span> <span class="o">*</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>
</div>
<p>The function set the soc configuration parameters such as interrupt
numbers, mux configuration parameters etc.</p>
</div>
<div class="section" id="id191">
<h3>6.23.2.2. APIs<a class="headerlink" href="#id191" title="Permalink to this headline">¶</a></h3>
<p>Refer to below API files:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/mcasp/mcasp_drv.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ti/drv/mcasp/soc/mcasp_soc.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p class="rubric" id="mcasp-buffer-formats">McASP Buffer formats</p>
<p>The McASP driver provides various buffer formats for sending the data
to/from the audio device. The differences between these formats arise
from the way the audio samples are collected from various serializers
and their timeslots and arranged in the system’s memory. This way the
application can choose to run audio processing algorithms over the data
without the need for re-arranging those data every frame. The buffer
format is provided in the <strong>Mcasp_ChanParams.dataFormat</strong> in the form of
<strong>Mcasp_BufferFormat</strong> defined in mcasp_drv.h The below section provides
an overview of the various formats. In the explanatory diagrams in each
section, McASP controller recieves samples in frame intervals denoted by
t1,t2..tn. The McASP driver collects these and arranges those samples in
the memory in various formats in to the host’s System memory. We have
chosen 32 bit samples and 32-bit word addresses throughout for
simplicity.</p>
<p class="rubric" id="mcasp-bufferformat-1ser-1slot">Mcasp_BufferFormat_1SER_1SLOT</p>
<p>This is applicable if only one serializer and one timeslot is used. The
samples are ordered in the order they received or sent.</p>
<img alt="../_images/1SLOT_1SER.PNG" src="../_images/1SLOT_1SER.PNG" />
<p class="rubric" id="mcasp-bufferformat-1ser-multislot-interleaved">Mcasp_BufferFormat_1SER_MULTISLOT_INTERLEAVED</p>
<p>This is applicable if multiple slots are used with one serializer. The
samples from the different timeslots are stored interleaved in the
memory as below. Different timeslots’ samples are denoted by different
colors and are labelled t1,t2..tn according to the time they arrive at
the serializer.</p>
<img alt="../_images/1SER_MULTISLOT_INTERLEAVED.PNG" src="../_images/1SER_MULTISLOT_INTERLEAVED.PNG" />
<p class="rubric" id="mcasp-bufferformat-1ser-multislot-non-interleaved">Mcasp_BufferFormat_1SER_MULTISLOT_NON_INTERLEAVED</p>
<p>This is applicable if multiple slots are used with one serializer. The
samples from the different timeslots are grouped together on the basis
of the timeslot and stored in the memory as shown below. Different
timeslots’ samples are denoted by different colors and are labelled
t1,t2..tn according to the time they arrive at the serializer.</p>
<img alt="../_images/1SER_MULTISLOT_NON_INTERLEAVED.PNG" src="../_images/1SER_MULTISLOT_NON_INTERLEAVED.PNG" />
<p>NOTE: if the non-interleaved format is used, the Mcasp_ChanParams-&gt;
hwFifoEventDMARatio must be set to 1.</p>
<p class="rubric" id="mcasp-bufferformat-multiser-1slot-ser-interleaved">Mcasp_BufferFormat_MULTISER_1SLOT_SER_INTERLEAVED</p>
<p>This is applicable if multiple serializers are used with one time slot
is used for each of the serializers. The samples from the different
serializers are stored in the memory in interleaved fashion as shown
below Different serializers’ samples are denoted by different colors and
are labelled S1,S2..Sn according to the time they arrive at the
serializer.</p>
<img alt="../_images/1SER_MULTISER_1SLOT_SER_INTERLEAVED_2.PNG" src="../_images/1SER_MULTISER_1SLOT_SER_INTERLEAVED_2.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="mcasp-bufferformat-multiser-1slot-ser-non-interleaved">Mcasp_BufferFormat_MULTISER_1SLOT_SER_NON_INTERLEAVED</p>
<p>This is applicable if multiple serializers are used with one timeslots
each per serializer. The samples from the different timeslots are
grouped together on the basis of the serializer and stored in the memory
as shown below Different serializers’ samples are denoted by different
colors and are labelled S1,S2..Sn according to the time they arrive at
the serializer.</p>
<img alt="../_images/1SER_MULTISER_1SLOT_SER_NON_INTERLEAVED.PNG" src="../_images/1SER_MULTISER_1SLOT_SER_NON_INTERLEAVED.PNG" />
<p class="rubric" id="mcasp-bufferformat-multiser-multislot-semi-interleaved-1">Mcasp_BufferFormat_MULTISER_MULTISLOT_SEMI_INTERLEAVED_1</p>
<p>This is applicable if multiple serializers are used and each serializer
containing multiple timeslots. The samples are stored in the memory
interleaved based on serializer and timeslots as shown below. In this
example, there are 3 serializers and 2 timeslots per serializers whose
samples are noted by Ln (left) and Rn (right). Different serializers’
samples are denoted by different colors.</p>
<img alt="../_images/1SER_MULTISER_MULTISLOT_SEMI_INTERLEAVED_1_UPDATED.PNG" src="../_images/1SER_MULTISER_MULTISLOT_SEMI_INTERLEAVED_1_UPDATED.PNG" />
<p class="rubric" id="mcasp-bufferformat-multiser-multislot-semi-interleaved-2">Mcasp_BufferFormat_MULTISER_MULTISLOT_SEMI_INTERLEAVED_2</p>
<p>This is applicable if multiple serializers are used and each serializer
containing multiple timeslots. The samples are grouped based on the
serializer and within one serializer, the timeslots are interleaved as
shown below. In this example, there are 3 serializers and 2 timeslots
per serializers whose samples are noted by Ln (left) and Rn
(right).Different serializers’ samples are denoted by different colors.</p>
<img alt="../_images/1SER_MULTISER_MULTISLOT_SEMI_INTERLEAVED_2.PNG" src="../_images/1SER_MULTISER_MULTISLOT_SEMI_INTERLEAVED_2.PNG" />
<p>NOTE: if the non-interleaved format is used, the Mcasp_ChanParams-&gt;
hwFifoEventDMARatio must be set to 1.</p>
<p class="rubric" id="mcasp-wordbits-selection">Mcasp WordBits Selection</p>
<p>With all the frame formats explained above, there is an option to choose
which bits to pack from the 32-bit serializer data obtained from/to the
McASP serializer, when the word size is less than the slot size. This
option is exercised by setting the Mcasp_chanParams-&gt;wordBitsSelect to
Mcasp_wordBitsSelect_LSB/Mcasp_wordBitsSelect_MSB.</p>
<p>If the default Mcasp_wordBitsSelect_LSB option is selected, the LSBs are
packed in to the system memory.</p>
<p>Below is an example of word size = 16bits and slot size = 32 bits and
the Mcasp_wordBitsSelect_LSB option is used. On the receiving side, the
serializer holds the 32 bit data whose LSB 16 bits are picked up and
packed in to the system memory. The MSB 16 bits are ignored.</p>
<img alt="../_images/WordSelect_LSB.PNG" src="../_images/WordSelect_LSB.PNG" />
<p>If the Mcasp_wordBitsSelect_MSB option is used, the serializer’s
MSB-16bits are packed in to the system memory. The LSBs are ignored.</p>
<img alt="../_images/WordSelect_MSB.PNG" src="../_images/WordSelect_MSB.PNG" />
<p class="rubric" id="priming">Priming</p>
<p>Applications using McASP driver often might send/receive one or two
transfers via McASP before sending the application data in/out of McASP
through the driver. This would internally set up transfer request queues
so that the application can seamlessly send/receive data without the
possibility of underrun. This process, a.k.a priming is used in the
example application provided with the Processor SDK. In this example two
frames are sent/received prior to submitting the application’s audio
data to the McASP driver. The number of transfer requests to prime is
application dependent and some applications where there may be a lot of
delay between transfer requests, enough to cause an underrun, the
priming factor could be higher.</p>
</div>
</div>
<div class="section" id="id192">
<h2>6.23.3. Application<a class="headerlink" href="#id192" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id193">
<h3>6.23.3.1. Examples &amp; Unit tests<a class="headerlink" href="#id193" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 25%" />
<col style="width: 21%" />
<col style="width: 9%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Expected Results</div>
</div>
</th>
<th class="head"><p>SOCs</p></th>
<th class="head"><p>Build type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Audio_ExampleProject</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
sample McASP
loopback using AIC31
codec. Reference example
for developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Audio sent in to
the EVM being
played out via the
stereo output of
the EVM</div>
</div>
</td>
<td><p>AM335X
AM437x
AM572x
K2G
OMAPL137
OMAPL138</p></td>
<td><p>CCS Project</p></td>
</tr>
<tr class="row-odd"><td><p>Audio_SMP_ExampleProject</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
sample McASP
loopback using AIC31
codec. Reference example
for developers with SMP
enabled.(A15 core only)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Audio sent in to
the EVM being
played out via the
stereo output of
the EVM</div>
</div>
</td>
<td><p>AM572x-
EVM</p></td>
<td><p>CCS Project</p></td>
</tr>
<tr class="row-even"><td><p>DeviceLoopback_ExampleProject</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
sample McASP device
loopback .
Reference example
for developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Digital ramp
pattern sent to
McASP and getting
looped back
internally using
device loopback</div>
</div>
</td>
<td><p>AM335X
AM437x
AM571x
AM572x
AM574x
K2G</p></td>
<td><p>CCS Project</p></td>
</tr>
<tr class="row-odd"><td><p>AudioEQ_ExampleProject</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
stereo audio
using biquad
filters . Reference
design for
developers. <strong>TI
Design Guide</strong>:
<a class="reference external" href="http://www.ti.com/lit/ug/tidubq2/tidubq2.pdf">TIDEP0069</a></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Three band
Equalization of
stereo channel
filters with gain
control using
serial console
inputs</div>
</div>
</td>
<td><p>AM572x
K2G</p></td>
<td><p>CCS Project</p></td>
</tr>
<tr class="row-even"><td><p>DeviceLoopback_TestApp</p></td>
<td><div class="line-block">
<div class="line">Unit test
demonstrating
sample McASP device
loopback .</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Digital ramp
pattern sent to
McASP and getting
looped back</div>
</div>
</td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
<tr class="row-odd"><td><p>DeviceLoopback_SMP_TestApp</p></td>
<td><div class="line-block">
<div class="line">Unit test
demonstrating
sample McASP device
loopback with SMP
enabled (A53 core only).</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Digital ramp
pattern sent to
McASP and getting
looped back</div>
</div>
</td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
<tr class="row-even"><td><p>DeviceLoopback_Regression_TestApp</p></td>
<td><div class="line-block">
<div class="line">Regression unit test
which tests various
features/configurations
of the MCASP driver
This is a menu based
test application</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Menu Driven test
sending digital ramp
and getting looped
back in various
configurations</div>
</div>
</td>
<td><p>AM65x</p></td>
<td><p>Makefile</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id194">
<h2>6.23.4. Building CCS projects based examples<a class="headerlink" href="#id194" title="Permalink to this headline">¶</a></h2>
<p>CCS Projects mentioned in the above table are built using pdkProjectCreate.bat/sh as explained in
<a class="reference external" href="index_overview.html#pdk-example-and-test-project-creation">PDK Example and Test Project Creation</a></p>
</div>
<div class="section" id="building-mcasp-test-applications-via-makefiles">
<h2>6.23.5. Building MCASP Test applications via makefiles<a class="headerlink" href="#building-mcasp-test-applications-via-makefiles" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>MCASP Test applications and dependent libraries are built from the top level mcasp makefile</p></li>
<li><p>Refer to the <a class="reference external" href="index_overview.html#setup-environment">Processor SDK RTOS Getting Started Guide</a>  for details
of how to setup the build environment. Once you have setup the build environment, issue the following commands:</p>
<blockquote>
<div><ul class="simple">
<li><p>cd &lt;pdk&gt;/packages/</p></li>
<li><p>To build: make mcasp</p></li>
<li><p>To clean: make mcasp_clean</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Similarly, to build at the module level, issue the following commands for rebuilding :</p>
<blockquote>
<div><ul class="simple">
<li><p>cd &lt;pdk&gt;/packages/ti/drv/mcasp</p></li>
<li><p>To build: make all</p></li>
<li><p>To clean: make clean</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p class="rubric" id="introduction-1">Introduction</p>
<p>The sample application demonstrates the use of the MCASP driver for
audio playback. The application uses McASP LLD, and programs the AIC
codec on the EVM to send and receive the audio input. The audio received
from the AIC codec is loop back-ed at the application and sent back to
the AIC codec via MCASP LLD.</p>
<p class="rubric" id="audio-test-setup">Audio test setup</p>
<p>Please ensure the below before running the demo</p>
<ol class="arabic simple">
<li><p>Connect the EVM’s stereo audio input to the PC’s stereo audio output</p></li>
<li><p>Connect the EVM’s stereo audio output to powered speakers. Please
make sure the amplification on the speakers is high enough for the
audio output to be heard</p></li>
</ol>
<p class="rubric" id="building-and-running-the-example">Building and running the Example</p>
<ol class="arabic simple">
<li><p>Run pdkProjectCreate to create the
MCASP_Audio_&lt;evm&gt;_&lt;device&gt;ExampleProject</p></li>
<li><p>Load the project on to CCS and build the same.</p></li>
<li><p>Build the example</p></li>
<li><p>Load the MCASP_Audio_&lt;evm&gt;_&lt;device&gt;ExampleProject</p></li>
<li><p>Run the example</p></li>
</ol>
<p class="rubric" id="testing-the-example">Testing the example</p>
<ol class="arabic simple">
<li><p>Play an audio file on the PC.</p></li>
<li><p>You should be able to hear the same audio on the speakers connected
to the EVM. It is the PC’s audio output which is loop backed at the
EVM’s MCASP example outputted to the speakers.</p></li>
</ol>
<p>NOTE: Please make sure the speakers’ output volume is high enough for
the audio to be audible.</p>
</div>
<div class="section" id="id195">
<h2>6.23.6. Additional References<a class="headerlink" href="#id195" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\mcasp\docs\doxygen\html\inde
x.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\mcasp\docs\ReleaseNotes_MCAS
P_LLD.pdf</p></td>
</tr>
<tr class="row-even"><td><p>Software design Specification</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\mcasp\docs\MCASP_LLD_SDS.pdf</p></td>
</tr>
</tbody>
</table>
<p>Templates used on this page:</p>
<p>Return to Processor SDK RTOS MCASP.</p>
<p>Navigation menu Log inRequest accountPageDiscussionReadView sourceView
history</p>
<p>Search Go Main Page All pages All categories Recent changes Random page
Help Toolbox What links here Related changes Special pages Page
information This page has been accessed 927 times. Privacy policyAbout
Texas Instruments WikiDisclaimersTerms of UseCreative Commons
Attribution-ShareAlike Powered by MediaWiki</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="dss">
<h1>6.24. DSS<a class="headerlink" href="#dss" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id196">
<h2>6.24.1. Overview<a class="headerlink" href="#id196" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id197">
<h3>6.24.1.1. Introduction<a class="headerlink" href="#id197" title="Permalink to this headline">¶</a></h3>
<p>The Display Subsystem (DSS) is a flexible, multi-pipeline subsystem that
supports high-resolution display outputs. DSS includes input pipelines
providing multi-layer blending with transparency to enable on-the-fly
composition. Various pixel processing capabilities are supported,
such as color space conversion and scaling, among others. DSS
includes a DMA engine, which allows direct access to the frame buffer
(device system memory). Display outputs can connect seamlessly to an
Open LVDS Display Interface transmitter (OLDITX), or can directly drive
device pads as a parallel video output interface.
This document has detailed API description that user can use
to make use of the DSS driver.</p>
</div>
</div>
<div class="section" id="id198">
<h2>6.24.2. User Interface<a class="headerlink" href="#id198" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id199">
<h3>6.24.2.1. Driver Configuration<a class="headerlink" href="#id199" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="dss-configuration-structure"><strong>DSS Configuration Structure</strong></p>
<p>For details about individual fields of DSS library structure, see the
Doxygen help by opening
PDK_INSTALL_DIR\packages\ti\drv\dss\docs\doxygen\html\index.html.</p>
</div>
<div class="section" id="id200">
<h3>6.24.2.2. APIs<a class="headerlink" href="#id200" title="Permalink to this headline">¶</a></h3>
<p>The DSS driver API can be broadly divided into the following categories</p>
<ul class="simple">
<li><p>DSS Display API - API for video display drivers</p></li>
<li><p>DSS Display Controller API - API for controlling and configuring
Video Ports in the display subsystem</p></li>
</ul>
<p>In addition to above drivers the DSS package also includes many sample
examples which show how to use the drivers in different ways. Many of
these sample examples use a common set of APIs which a user may find
useful to refer to for use in their final application.</p>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/dss/include/dss_&lt;func&gt;.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id201">
<h2>6.24.3. Application<a class="headerlink" href="#id201" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id202">
<h3>6.24.3.1. Examples<a class="headerlink" href="#id202" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Expected Results</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Display Dss
application</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
<em>simple</em> display
bgra frames
to the OLDI use
case. Reference
example for
developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application shows
two different
buffer on OLDI panel
and success messages
on CCS console.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>Display Dss
application (Bare
metal)</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
<em>simple</em> display
bgra frames
to the OLDI use
case. Reference
example for
developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application shows
two different
buffer on OLDI panel
and success messages
on CCS console.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Display Dss Colorbar
application</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
internal colorbar
to the OLDI panel.
Reference example
for developers.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application shows
internal colorbar
on OLDI panel
and success messages
on CCS console.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id203">
<h2>6.24.4. Additional References<a class="headerlink" href="#id203" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\dss\docs\doxygen\html\index.
html</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="building-dss-examples">
<h2>6.24.5. Building DSS examples<a class="headerlink" href="#building-dss-examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>DSS examples and dependent libraries are built from the top level dss
makefile</p></li>
<li><p>cd &lt;pdk&gt;/packages/ti/drv/dss</p></li>
<li><p>To build: make -s PDK_INSTALL_PATH=&lt;pdk&gt;/packages</p></li>
<li><p>To clean: make -s clean PDK_INSTALL_PATH=&lt;pdk&gt;/packages</p></li>
</ul>
</div>
<div class="section" id="dss-examples">
<h2>6.24.6. DSS examples<a class="headerlink" href="#dss-examples" title="Permalink to this headline">¶</a></h2>
<p class="rubric" id="id204"><em>Description</em></p>
<p>DSS examples exploits the DISPC (Display Controller) and OLDI output
available in the SoC. The example works on outputing pre-loaded
video frames of BGRA8888 formats to OLDI interface. The example also
demonstrates displaying videos combined from VID1 and VIDL1 pipelines
to OLDI panel. The example is also enhanced to show the display controller
scaling features.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="running-the-display-examples"><strong>Running the Display examples</strong></p>
<p><strong>Configuring Display</strong>:</p>
<ul class="simple">
<li><p>Make sure the OLDI panel is connected to the base EVM before running
the example binary.</p></li>
</ul>
<p><strong>CCS connection</strong>:</p>
<ul class="simple">
<li><p>Load the System firmware as specified in SCICLIENT documentation</p></li>
<li><p>Load the generated executable file in CCS</p></li>
<li><p>Run the application.</p></li>
<li><p>Content will be displayed on the OLDI panel connected to EVM</p></li>
</ul>
</div>
</div>
<div class="section" id="cal">
<h1>6.25. CAL<a class="headerlink" href="#cal" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id205">
<h2>6.25.1. Overview<a class="headerlink" href="#id205" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id206">
<h3>6.25.1.1. Introduction<a class="headerlink" href="#id206" title="Permalink to this headline">¶</a></h3>
<p>Camera Adapter Layer (CAL) is a very flexible subsystem that enables connection
to multiple cameras supporting MIPI CSI-2 over D-PHY serial interface,
a LVDS serial interface, and a traditional parallel interface.
It also includes an internal write DMA engine connected to VBUSM interface.
This document has detailed API description that user can use
to make use of the CAL driver.</p>
</div>
</div>
<div class="section" id="id207">
<h2>6.25.2. User Interface<a class="headerlink" href="#id207" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id208">
<h3>6.25.2.1. Driver Configuration<a class="headerlink" href="#id208" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="cal-configuration-structure"><strong>CAL Configuration Structure</strong></p>
<p>For details about individual fields of CAL library structure, see the
Doxygen help by opening
PDK_INSTALL_DIR\packages\ti\drv\cal\docs\doxygen\html\index.html.</p>
</div>
<div class="section" id="id209">
<h3>6.25.2.2. APIs<a class="headerlink" href="#id209" title="Permalink to this headline">¶</a></h3>
<p>The CAL driver API can be broadly divided into the following categories</p>
<ul class="simple">
<li><p>Complex IO configuration APIs</p></li>
<li><p>Capture DMA configuration APIs.</p></li>
</ul>
<p>In addition to above the CAL package also includes many sample
examples which show how to use the drivers in different ways. Many of
these sample examples use a common set of APIs which a user may find
useful to refer to for use in their final application.</p>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/cal/include/cal_drv.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id210">
<h2>6.25.3. Application<a class="headerlink" href="#id210" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id211">
<h3>6.25.3.1. Examples<a class="headerlink" href="#id211" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 32%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Expected Results</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Capture Color Bar
from UB954</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
Capture from UB954
This captures a
Fixed pattern.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Example captures
required frames from
UB954 and runs till
completion.
The Captured buffers
can be saved on PC
using the load raw
commands.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>Capture image from
UB964 + SAT88 &amp;
OV10635 sensors.</p></td>
<td><div class="line-block">
<div class="line">Example demonstrates
capturing the image
from the sensor.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Example captures
required frames from
the 4 Ov10635 sensors
and runs till
completion.
The captured buffers
can be saved on PC
using the load raw
commands.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id212">
<h2>6.25.4. Additional References<a class="headerlink" href="#id212" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\cal\docs\doxygen\html\index.
html</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="building-cal-examples">
<h2>6.25.5. Building CAL examples<a class="headerlink" href="#building-cal-examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>CAL examples and dependent libraries are built from the top level cal
makefile</p></li>
<li><p>cd &lt;pdk&gt;/packages/ti/drv/cal</p></li>
<li><p>To build: make -s PDK_INSTALL_PATH=&lt;pdk&gt;/packages</p></li>
<li><p>To clean: make -s clean PDK_INSTALL_PATH=&lt;pdk&gt;/packages</p></li>
</ul>
</div>
<div class="section" id="cal-examples">
<h2>6.25.6. CAL examples<a class="headerlink" href="#cal-examples" title="Permalink to this headline">¶</a></h2>
<p class="rubric" id="id213"><em>Description</em></p>
<p>CAL examples uses the CSI2 Capture port present on the EVM which is
connected to CAL. The sensors are connected to the CSI2 capture port.
The examples supports capturing from either UB954 or
UB964 + SAT88 + 4 OV10635 sensors connected over the FPD link.
The Example captures the input frame data coming from CSI2 port and
writes back to the memory.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="running-the-cal-examples"><strong>Running the Cal examples</strong></p>
<p><strong>Configuring Sensor</strong>:</p>
<ul class="simple">
<li><p>Make sure the UB954 Evm is connected to the CSI2 capture port and it is
powered on before running the example for option 0.</p></li>
<li><p>Make sure the UB964 Evm is connected to the CSI2 capture port along with
4 OV10635x cameras over the FPD link to the RIN0 to RIN3 ports and
the EVM is powered on before running the example for option 1.</p></li>
</ul>
<p><strong>CCS connection</strong>:</p>
<ul class="simple">
<li><p>Load the System firmware as specified in SCICLIENT documentation</p></li>
<li><p>Load the generated executable file in CCS</p></li>
<li><p>Run the application.</p></li>
<li><p>select the input based on the sensor connected.</p></li>
<li><p>Example will run till completion after capturing the frames.</p></li>
<li><p>Dump the buffers scripting console using the loadraw command specified.</p></li>
<li><p>Verify the output by viewing the captured image on PC.</p></li>
</ul>
</div>
</div>
<div class="section" id="udma">
<h1>6.26. UDMA<a class="headerlink" href="#udma" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id214">
<h2>6.26.1. Overview<a class="headerlink" href="#id214" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id215">
<h3>6.26.1.1. Introduction<a class="headerlink" href="#id215" title="Permalink to this headline">¶</a></h3>
<p>The DMA architecture specifies the data structures used by standard communications
modules to facilitate direct memory access (DMA) and to provide a consistent application programming
interface (API) to the host software in multi-core devices. The data structures and the API used to
manipulate them will be jointly referred to as NAVSS.
For more information on NAVSS DMA architecture, refer to the device Technical Reference Manual</p>
<p>The UDMA driver provides API to program the DMA portion of the NAVSS subsystem
to setup and initiate transfers. Below are the high level features supported by the driver</p>
<ul class="simple">
<li><p>Both Main and MCU NAVSS instances</p></li>
<li><p>Supports all DMA operations from both instances from all the cores in the SOC</p></li>
<li><p>UDMAP block copy using native NAVSS channels</p></li>
<li><p>DRU block copy using direct TR submission to DRU register</p></li>
<li><p>DRU block copy using indirect (PSIL) TR submission to UDMA external channels</p></li>
<li><p>PDMA module to initiate transfers to/from PDMA peripherals like UART, McASP, McSPI, ADC, MCAN</p></li>
<li><p>DMA transfer to/from from native PSIL peripherals like EMAC, CPSW, SA2UL</p></li>
<li><p>Event and interrupt management like DMA completion, channel chaining, interrupt sharing using IA</p></li>
<li><p>Resources management across instances and cores for UDMAP DMA channels,RX flow, External UTC channel (DRU), interrupt aggregators (IA), interrupt routers (IR),global events, ring accelerators (RA)</p></li>
<li><p>Interaction with DMSC RM module via SCICLIENT for all non-RealTime (NRT) configuration</p></li>
<li><p>Supports both TI-RTOS and baremetal</p></li>
</ul>
<p><strong>Notes</strong></p>
<ul class="simple">
<li><p>UDMA driver doesn’t manage/allocate the descriptor and RA memory.The caller need to allocate and provide the required memory.</p></li>
<li><p>UDMA driver doesn’t use any global variables. All the required object memory like channel, driver instance, event etc should be allocated by the caller</p></li>
</ul>
<p>This document has detailed API description that user can use
to make use of the UDMA driver.</p>
</div>
</div>
<div class="section" id="id216">
<h2>6.26.2. User Interface<a class="headerlink" href="#id216" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id217">
<h3>6.26.2.1. Driver Configuration<a class="headerlink" href="#id217" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="udma-configuration-structure"><strong>UDMA Configuration Structure</strong></p>
<p>For details about individual fields of UDMA library structure, see the
Doxygen help by opening
PDK_INSTALL_DIR\packages\ti\drv\udma\docs\doxygen\html\index.html.</p>
</div>
<div class="section" id="id218">
<h3>6.26.2.2. APIs<a class="headerlink" href="#id218" title="Permalink to this headline">¶</a></h3>
<p>The UDMA driver API can be broadly divided into the following categories</p>
<ul class="simple">
<li><p>UDMAP native channel API</p></li>
<li><p>DRU (External UTC) channel API</p></li>
<li><p>PDMA channel operations</p></li>
<li><p>Event and interrupt API</p></li>
<li><p>Ring API</p></li>
</ul>
<p>In addition to above drivers the UDMA package also includes many sample
examples which show how to use the drivers in different ways. Many of
these sample examples use a common set of APIs which a user may find
useful to refer to for use in their final application.</p>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/udma/udma.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id219">
<h2>6.26.3. Application<a class="headerlink" href="#id219" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id220">
<h3>6.26.3.1. Examples<a class="headerlink" href="#id220" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Expected Results</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>UDMA ADC RX
application</p></td>
<td><div class="line-block">
<div class="line">This performs PDMA
RX data capture
from ADC. ADC is
configured in
single shot mode
and captures
APP_ADC_NUM_CH
channel of ADC
data. The FIFO is
configured to
generate a DMA
trigger after
all channel data
is captured</div>
</div>
</td>
<td><div class="line-block">
<div class="line">The application
checks the ADC
channel ID and
prints pass on
successful
completion</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>UDMA Chaining
application</p></td>
<td><div class="line-block">
<div class="line">UDMA chaining
sample application
performing a chain
of block copy using
channel global
trigger: CH0 -&gt; CH1
-&gt; … -&gt; CHx.
The first channel
doesn’t user a
global trigger and
each channel
triggers the next
channel’s global
trigger through
the channel’s TR
event register.
A channel’s source
buffer is previous
channel destination
buffer. This
ensures that
chaining trigger
worked in a
synchronized manner
when the memory
compare matches</div>
</div>
</td>
<td><div class="line-block">
<div class="line">The application
checks the
destination buffer
with source buffer
and prints pass on
successful
completion</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>UDMA CRC
application</p></td>
<td><div class="line-block">
<div class="line">This performs
UDMA CRC operation</div>
</div>
</td>
<td><div class="line-block">
<div class="line">The application
checks the
calculated CRC
value with
pre-calculated CRC
value and prints
pass on successful
completion</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>UDMA Direct TR DRU
application</p></td>
<td><div class="line-block">
<div class="line">UDMA DRU memcpy
sample application
performing block
copy using direct
TR submission via
DRU registers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">The application
checks the
destination buffer
with source buffer
and prints pass on
successful
completion</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>UDMA In-Direct TR DRU
application</p></td>
<td><div class="line-block">
<div class="line">UDMA DRU memory
copy sample
application
performing block
copy using Type 15
Transfer Record
(TR15) using
Transfer Record
Packet Descriptor
(TRPD)
for developers.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">The application
checks the
destination buffer
with source buffer
and prints pass on
successful
completion</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>UDMA Blockcopy
application</p></td>
<td><div class="line-block">
<div class="line">UDMA memory copy
sample
application
performing block
copy using Type 15
Transfer Record
(TR15) using
Transfer Record
Packet Descriptor
(TRPD)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">The application
checks the
destination buffer
with source buffer
and prints pass on
successful
completion</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id221">
<h2>6.26.4. Additional References<a class="headerlink" href="#id221" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 63%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\udma\docs\doxygen\html\
index.html</p></td>
</tr>
<tr class="row-odd"><td><p>Migration Guide: EDMA to UDMA</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti\drv\udma\docs\
Migrating_Applications_from_EDMA_to_UDMA_using_TI-RTOS.pdf</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="building-udma-examples">
<h2>6.26.5. Building UDMA examples<a class="headerlink" href="#building-udma-examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>UDMA examples and dependent libraries are built from the top level udma
makefile</p></li>
<li><p>cd &lt;pdk&gt;/packages/ti/drv/udma</p></li>
<li><p>To build: make -s PDK_INSTALL_PATH=&lt;pdk&gt;/packages</p></li>
<li><p>To clean: make -s clean PDK_INSTALL_PATH=&lt;pdk&gt;/packages</p></li>
</ul>
</div>
<div class="section" id="udma-examples">
<h2>6.26.6. UDMA examples<a class="headerlink" href="#udma-examples" title="Permalink to this headline">¶</a></h2>
<p class="rubric" id="id222"><em>Description</em></p>
<p>UDMA examples demonstrates the key features of the driver.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="running-the-udma-examples"><strong>Running the UDMA examples</strong></p>
<p><strong>CCS connection</strong>:</p>
<ul class="simple">
<li><p>Load the System firmware as specified in SCICLIENT documentation</p></li>
<li><p>Load the generated executable file in CCS</p></li>
<li><p>Run the application.</p></li>
<li><p>The application print will be displayed on the CCS and UART console. The UART console used depends on the core in which the application is run.</p></li>
</ul>
</div>
</div>
<div class="section" id="pm">
<h1>6.27. PM<a class="headerlink" href="#pm" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id223">
<h2>6.27.1. Overview<a class="headerlink" href="#id223" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id224">
<h3>6.27.1.1. Introduction<a class="headerlink" href="#id224" title="Permalink to this headline">¶</a></h3>
<p>The Power Management (PM) low level driver provide power and thermal
management capabilities for RTOS applications.</p>
<p class="rubric" id="supported-devices"><strong>Supported Devices</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 12%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 10%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 29%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Device</strong></p></td>
<td><p><strong>A53</strong></p></td>
<td><p><strong>A15</strong></p></td>
<td><p><strong>A8</strong></p></td>
<td><p><strong>A9</strong></p></td>
<td><p><strong>C66x</strong></p></td>
<td><p><strong>M4</strong></p></td>
<td><p><strong>R5F</strong></p></td>
<td><p><strong>Tested On</strong></p></td>
</tr>
<tr class="row-even"><td><p>AM65xx</p></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>X</p></td>
<td><p>AM65x EVM, AM65x IDK</p></td>
</tr>
<tr class="row-odd"><td><p>AM57xx</p></td>
<td></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td></td>
<td><p>AM572x GP EVM, AM571x GP EVM</p></td>
</tr>
<tr class="row-even"><td><p>AM335x</p></td>
<td></td>
<td></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>AM335x GP EVM</p></td>
</tr>
<tr class="row-odd"><td><p>AM437x</p></td>
<td></td>
<td></td>
<td></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td></td>
<td><p>AM437x GP EVM</p></td>
</tr>
<tr class="row-even"><td><p>K2G</p></td>
<td></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td><p>K2G EVM</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>PM on AM335x and AM437x devices supports only OPP modifications.  CPU idle
and other PM modes on these devices are only for reference and are not
validated on the EVM every release.</p>
</div>
</div>
</div>
<div class="section" id="id225">
<h2>6.27.2. User Interface<a class="headerlink" href="#id225" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id226">
<h3>6.27.2.1. Driver Configuration<a class="headerlink" href="#id226" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="id227"><strong>Board Specific Configuration</strong></p>
<p>The following board-specific actions must take place prior to calling
any PM Power APIs:</p>
<ul class="simple">
<li><p>A board-specific I2C implementation must be registered with the PM
HAL layer</p></li>
<li><p>The PMIC Ops structure matching the executing device’s PMIC must be
registered with PM HAL layer</p></li>
<li><p>Device clock rates must be initialized through the PM LIB layer</p></li>
</ul>
<p>For working examples of how to implement the listed items, see the
“main” functions of any PM example in
<code class="docutils literal notranslate"><span class="pre">[PDK_INSTALL_DIR]\packages\ti\drv\pm\examples</span></code>.</p>
<p class="rubric" id="pm-configuration-structure"><strong>PM Configuration Structure</strong></p>
<p>The pmsrcpmrtosprcmPowerDevice.c file configures the PM driver
through the PowerDevice_config structure. This structure must be
provided to PM driver. The structure is a global defined within
PowerDevice.c and must be initialized prior to calling Power_init(). The
structure cannot be changed after calling Power_init(). For details
about individual fields of this structure, see the Doxygen help by
opening
<code class="docutils literal notranslate"><span class="pre">[PDK_INSTALL_DIR]\packages\ti\drv\pm\docs\doxygen\html\index.html</span></code>.</p>
</div>
<div class="section" id="id228">
<h3>6.27.2.2. APIs<a class="headerlink" href="#id228" title="Permalink to this headline">¶</a></h3>
<p>The following lists the main application interfaces; see the end of this
page for a link to the API Reference Manual with full details.</p>
<p>PM TI RTOS base API reference for applications can be found in below
file:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/pm/Power.h&gt;  /* Contains the core TI RTOS Power implementation APIs */</span><span class="cp"></span>
</pre></div>
</div>
<p>PM TI RTOS extended API reference for applications can be found in the
below file:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/pm/PowerExtended.h&gt;  /* Contains TI RTOS Power API extensions such as thermal management */</span><span class="cp"></span>
</pre></div>
</div>
<p>PM TI RTOS device-specific API reference for applications can be found
in the below file:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/pm/PowerDevice.h&gt;  /* Contains device-specific TI RTOS Power API definitions and structures */</span><span class="cp"></span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id229">
<h2>6.27.3. Application<a class="headerlink" href="#id229" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id230">
<h3>6.27.3.1. Examples<a class="headerlink" href="#id230" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 25%" />
<col style="width: 58%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PM RTOS Application</p></td>
<td><p>Example demonstarting power management use cases. Reference example for developers</p></td>
<td><p>Application cycles the processor running the application through various power states using the PM APIs. User observes the output printed over the device’s UART connection. <strong>Note:</strong> The example should be run in <em>Free Run</em> mode when loaded and executed in Code Composer Studio in order to prevent sleep API testing interruptions from the JTAG.  Use the following  steps to execute the application on the    AM57xx’s M4 and C66 processors in Code Composer Studio:  -  Connect to CortexA15_0 waiting until the GEL file initialization completes -  Run the GEL: Scripts–&gt;AM572x MULTICORE  Initialization–&gt;AM572x_MULTICORE_EnableAllCores -  Connect to M4_IPU1_C0 or the C66xx_DSP1  -  Load the PM RTOS application’s M4 or c66 executable -  Free run the M4_IPU1_C0 or the C66xx_DSP1</p></td>
</tr>
<tr class="row-odd"><td><p>PM RTOS Thermal Application</p></td>
<td><p>Example demonstrating thermal management use case. Reference example for developers</p></td>
<td><p>Application sets high and low thermal set points using the PM APIs.The set points are triggered by     internally heating up the processor.User observes the output printed over the device’s UART connection. Use the following steps to execute the application on the AM57xx’s M4 and C66 processors in Code Composer Studio:   -  Connect to CortexA15_0 waiting until the GEL file initialization completes -  Run the GEL:Scripts–&gt;AM572x MULTICORE Initialization–&gt;AM572x_MULTICORE_EnableAllCores -  Connect to M4_IPU1_C0 or the C66xx_DSP1 -     Load the PM RTOS Thermal application’s M4 or c66 executable -  Run the M4_IPU1_C0 or the C66xx_DSP1</p></td>
</tr>
<tr class="row-even"><td><p>PM Measurement Application</p></td>
<td><p>Menu-based application allowing selection of processor OPPs and benchmark tests.</p></td>
<td><p>Application allows the user to control the processor’s OPP settings via the PM driver. The application  also allows the user to select execution of the Dhrystone benchmark for performance and power profiling under different OPP settings. The application’s menu is printed over the device’s UART connection. <strong>Note:</strong> The     measurement application is only supported on the AM335x device at the moment.</p></td>
</tr>
<tr class="row-odd"><td><p>PM System Configuration Test</p></td>
<td><p>Example demonstrating system configuration use-case</p></td>
<td><p>This example is available at ‘&lt;install_path&gt;/packages /ti/drv/pm/examples/systemconfig’. The PM System Configuration test is an  example running on tda2xx A15 core, tda2xx M4 core,tda3xx IPU (M4) core and AM65xx(A53 and R5). This example demonstrates the ability to configure the desired power state for a given module based on the entries in the   power spread sheet.The example loops through the different modules and power states and tries to program the same for each module using PM LIB sysconfig APIs before declaring pass or fail.The example illustrates the   use of Power Management LIB which allows system configuration.</p></td>
</tr>
<tr class="row-even"><td><p>PM CLock Rate Configuration Test</p></td>
<td><p>Example demonstrating clockrate configuration use-case</p></td>
<td><p>This example is available at ‘&lt;install_path&gt;/packages/ti/drv/pm/ examples/clkrate_manager’ The Clock Rate Configuration test is an example running on A15 core and IPU (M4) Core for tda2xx/tda2ex/tda2px ,IPU (M4) core for tda3xx ,A53(MPU) and R5(MCU) for AM65xx. This example demonstrates the ability to read the clock rate for different clocks for a given CPU (MPU/IPU/DSP/GPU/IVA/EVE). The example first reads the current clock configuration and then checks for OPP_NOM, OPP_OD and OPP_HIGH frequencies along with voltage changes by using the PMLIB clock rate APIs before declaring pass or fail. The example illustrates the use of Power Management LIB which allows changing the CPU OPP. For AM65xx, this example first loops through all modules and gets the clockrate for all of their clocks.Then, it tries to set the frequencies for some clocks of different modules.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id231">
<h2>6.27.4. Additional References<a class="headerlink" href="#id231" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\pm\docs\doxygen\html\index.h
tml</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\pm\docs\ReleaseNotes_PM_LLD.
pdf</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="rm">
<h1>6.28. RM<a class="headerlink" href="#rm" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id232">
<h2>6.28.1. Overview<a class="headerlink" href="#id232" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id233">
<h3>6.28.1.1. Introduction<a class="headerlink" href="#id233" title="Permalink to this headline">¶</a></h3>
<p>The Resource Manager (RM) is delivered as part of Processor-SDK as a
means for managing system resource contentions. RM has the ability to
allocate system resources within a software architecture based on sets
of allocation rules. Resources can be allocated to anything from a
device core, to an OS task or process, to a specific software module.
RM’s resource management is defined by the RM configuration parameters
and how RM is integrated within a software framework. The RM source code
is device agnostic. The RM configuration parameters are device specific
allowing RM to function on any processor capable of compiling and
executing a C binary.</p>
<p class="rubric" id="rm-instance-types">RM Instance Types</p>
<p>Resource Manager is an instance-based architecture. Integrating RM into
a system consists of creating a set of RM instances, connecting these
instances via message-passing mechanisms, and then using the instances
to request resources for cores, processes, tasks, modules, etc. There
are no restrictions on where a RM instance can be created as long as the
means exist to connect the instance to other RM instances within the
system.</p>
<p>There are five instance types</p>
<ol class="arabic simple">
<li><p><strong>Server</strong>: Manages all defined system resources. Services resource
requests received from connected Client Delegates and Clients.</p></li>
<li><p><strong>Client Delegate (CD)</strong>: Acts as a low-request-latency proxy for the
RM Server, managing resources provided by the RM Server. Services
resource requests received from connected Clients.</p></li>
<li><p><strong>Client</strong>: Front-end for receiving/responding to resource requests
from application. Forwards resource requests to Server, or CD, for
servicing. Returns allocated resources to application once response
is received from Server or CD.</p></li>
<li><p><strong>Shared Server</strong>: Same as the standard Server except all resource
data structures are stored in shared memory allowing direct access
from Shared Client instances.</p></li>
<li><p><strong>Shared Client</strong>: Same as Client except has direct access to the
Server resource data structures via shared memory. Useful for low
latency requests but not as robust from a software architecture
perspective given shared memory MUST be available and used in order
for Shared Server-Clients to function.</p></li>
</ol>
</div>
</div>
<div class="section" id="id234">
<h2>6.28.2. User Interface<a class="headerlink" href="#id234" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id235">
<h3>6.28.2.1. Driver Configuration<a class="headerlink" href="#id235" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="resource-configuration"><strong>Resource Configuration</strong></p>
<p>The RM Server instance must be provided a resource list and allocation
policy at initialization time. The resource list and allocation policy
are specified in the open source flattened device tree format. Device
specific resource list and allocation policy files are provided in
<code class="docutils literal notranslate"><span class="pre">[PDK_INSTALL_PATH]/packages/ti/drv/rm/device/[SoC]/</span></code>.</p>
<p>The Client Delegate and Client instances do not require a resource list
and allocation policy at initialization.</p>
<p class="rubric" id="transport-configuration"><strong>Transport Configuration</strong></p>
<p>RM instances must be attached to one another using a message passing
mechanism. This mechanism can be shared memory, software/hardware
queues, sockets or any other method capable of sending and receiving
data packets between endpoints on the SoC.</p>
<p>An example transport implementation used by many PDK test applications
is available in
<code class="docutils literal notranslate"><span class="pre">[PDK_INSTALL_PATH]/packages/ti/drv/rm/test/rm_transport_setup.c</span></code>. The
implementation uses an IPC shared memory transport to connect an RM
Server to RM Clients on multiple DSP cores.</p>
</div>
<div class="section" id="id236">
<h3>6.28.2.2. APIs<a class="headerlink" href="#id236" title="Permalink to this headline">¶</a></h3>
<p>RM instance init/delete/status API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/rm/rm.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>RM instance transport API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/rm/rm_transport.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>RM instance service request/response API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/rm/rm_services.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>RM Server interface API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/rm/rm_server_if.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id237">
<h2>6.28.3. Application<a class="headerlink" href="#id237" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id238">
<h3>6.28.3.1. Examples<a class="headerlink" href="#id238" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Expected Results</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>RM DSP BIOS Test
application</p></td>
<td><div class="line-block">
<div class="line">Unit Test
application
exercising APIs and
the different
service
request/response
mechanisms across
the Server, Client
Delegate, and
Client instances.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application
successfully
completes on two
DSP cores.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>RM Memory DSP BIOS
Test application</p></td>
<td><div class="line-block">
<div class="line">Unit Test
application to test
for memory leaks
during resource
request/free
operations.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application
successfully
completes with no
memory leaks on two
DSP cores.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>RM Shared DSP BIOS
Test application</p></td>
<td><div class="line-block">
<div class="line">Unit Test
application
exercising Shared
Server/Client APIs
and resource
allocation in a
Shared
Server/Client
architecture.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application
successfully
completes with no
memory leaks on two
DSP cores.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>RM DSP BIOS
Multi-Threaded Test
application</p></td>
<td><div class="line-block">
<div class="line">Unit Test
application
verifying service
request/response
mechanism in a
multi-threaded
architecture.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application
successfully
completes with no
memory leaks on a
single DSP core.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>RM ARM Linux Test
application</p></td>
<td><div class="line-block">
<div class="line">Unit Test
application
exercising APIs and
the different
service
request/response
mechanisms across
the Server, Client
Delegate, and
Client instances.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application
successfully
completes when run
from Linux
user-space.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>RM ARM Linux
Multi-Threaded Test
application</p></td>
<td><div class="line-block">
<div class="line">Unit Test
application
verifying service
request/response
mechanism in a
multi-threaded
architecture.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application
successfully
completes when run
from Linux
user-space.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Combined DSP BIOS &amp;
ARM Linux Test
application</p></td>
<td><div class="line-block">
<div class="line">Unit Test
application
verifying service
request/response
mechanism over a
heterogeneous
processor boundary.
RM Clients on two
DSP cores request
resources from an
RM Server running
in Linux
user-space.</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application
successfully
completes with no
memory leaks on two
DSP cores.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id239">
<h2>6.28.4. Additional References<a class="headerlink" href="#id239" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\rm\docs\doxygen\html\index.h
tml</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\rm\docs\ReleaseNotes_RM.pdf</p></td>
</tr>
<tr class="row-even"><td><p>Resource Manager User Guide</p></td>
<td><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/Processor_SDK_Resource_Manager">Processor SDK Resource Manager</a></p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="gpmc">
<h1>6.29. GPMC<a class="headerlink" href="#gpmc" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id240">
<h2>6.29.1. Overview<a class="headerlink" href="#id240" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id241">
<h3>6.29.1.1. Introduction<a class="headerlink" href="#id241" title="Permalink to this headline">¶</a></h3>
<p>The general-purpose memory controller (GPMC) is an unified memory
controller dedicated to interfacing external memory devices:</p>
<ul class="simple">
<li><p>Asynchronous SRAM-like memories and application-specific integrated
circuit (ASIC) devices</p></li>
<li><p>Asynchronous, synchronous, and page mode (only available in
non-multiplexed mode) burst NOR flash devices</p></li>
<li><p>NAND Flash</p></li>
</ul>
<p>Driver supports two types of transfers with data path to external memory
device configured to be 16- or 8-bit:</p>
<ul class="simple">
<li><p>Read</p></li>
<li><p>Write</p></li>
</ul>
<div class="line-block">
<div class="line">In addition driver supports following modes of operation:</div>
</div>
<ul class="simple">
<li><p><strong>GPMC_MODE_BLOCKING:</strong> By default, driver operates in blocking mode.
In blocking mode, a Task’s code execution is blocked until
transaction is complete. This ensures only one transaction operates
at a given time. Driver supports both interrupt or non-interrupt
based blocking modes.</p></li>
<li><p><strong>GPMC_MODE_CALLBACK</strong> In callback mode, an GPMC transaction
functions asynchronously, which means that it does not block a Task’s
code execution. After an GPMC transaction is complete, GPMC driver
calls a user-provided hook function. Only interrupt based callback is
supported.</p></li>
</ul>
<p>In NAND flash mode, driver supports following ECC algorithms:</p>
<ul class="simple">
<li><p>BCH code 8-bit</p></li>
<li><p>HAMMING code 1-bit</p></li>
</ul>
</div>
</div>
<div class="section" id="id242">
<h2>6.29.2. User Interface<a class="headerlink" href="#id242" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id243">
<h3>6.29.2.1. Driver Configuration<a class="headerlink" href="#id243" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="id244"><strong>Board Specific Configuration</strong></p>
<p>All the board specific configurations eg:enabling and pin-mux of GPMC
pins should be performed before calling any driver APIs.By default
Board_Init() API supports all initialization sequence for TI supported
EVMs.Refer <a class="reference external" href="index_board.html#board-support">Processor SDK RTOS Board Support</a>
for additional details.</p>
<p>Once the board specific configuration is complete driver API GPMC_init()
can be called to initialize driver</p>
<p class="rubric" id="gpmc-configuration-structure"><strong>GPMC Configuration Structure</strong></p>
<p>GPMC_soc.c file binds driver with hardware attributes on the board
through GPMC_config structure. This structure must be provided to GPMC
driver. It must be initialized before the GPMC_init() function is called
and cannot be changed afterwards. For details about the individual
fields of this structure, see the Doxygen help by opening
PDK_INSTALL_DIR\packages\ti\drv\gpmc\docs\doxygen\html\index.html.</p>
</div>
<div class="section" id="id245">
<h3>6.29.2.2. APIs<a class="headerlink" href="#id245" title="Permalink to this headline">¶</a></h3>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/gpmc/GPMC.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p> Sample code for initiating GPMC transaction:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="p">...</span>
<span class="n">gpmc</span> <span class="o">=</span> <span class="n">GPMC_open</span><span class="p">(</span><span class="n">peripheralNum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gpmcParams</span><span class="p">);</span>
<span class="p">...</span>
<span class="p">...</span>

<span class="cm">/* Initiate GPMC transfers. Refer Example for details</span>
<span class="cm">*/</span>
<span class="n">transferOK</span> <span class="o">=</span> <span class="n">GPMC_transfer</span><span class="p">(</span><span class="n">gpmc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gpmcTransaction</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">transferOK</span><span class="p">)</span> <span class="p">{</span>
<span class="cm">/* GPMC transaction failed */</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id246">
<h2>6.29.3. Application<a class="headerlink" href="#id246" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id247">
<h3>6.29.3.1. Examples<a class="headerlink" href="#id247" title="Permalink to this headline">¶</a></h3>
<p>Refer Release Note for GPMC support across different EVMs</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><p>Expected Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GPMC NOR/NAND Read
Example Application</p></td>
<td><div class="line-block">
<div class="line">Simple example to
read data from GPMC
NOR/NAND flash on
board.</div>
</div>
</td>
<td><p>Following prints will
come on console based
on pass/fail
criteria:</p>
<p><strong>Pass criteria:</strong></p>
<p>GPMC flash device ID:
0x##, manufacturer
ID: 0x##</p>
<p>GPMC flash read test
passed.</p>
<p>All tests have
passed.</p>
</td>
</tr>
<tr class="row-odd"><td><p>GPMC NOR/NAND test
application</p></td>
<td><div class="line-block">
<div class="line">Driver Unit Test
application to test
GPMC NOR/NAND flash
read/erase/write</div>
</div>
</td>
<td><p>Following prints will
come on console based
on pass/fail
criteria:</p>
<p><strong>Pass criteria:</strong></p>
<p>GPMC flash device ID:
0x##, manufacturer
ID: 0x##</p>
<p>GPMC flash block
erase test passed.</p>
<p>GPMC flash write test
passed.</p>
<p>GPMC flash read test
passed.</p>
<p>All tests have
passed.</p>
</td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>GPMC Test Application supports write test, by default write test is
disabled, user can enable the write test by defining
TEST_GPMC_FLASH_WRITE in test/src/GPMC_board.h.</p></li>
<li><p>In GPMC_Test_icev2AM335x, J5 pin2 &amp; 3 should be shorted on
iceV2AM335x board in order to test GPMC NOR flash.</p></li>
</ol>
<p>3. In GPMC_Test_evmAM437x, J2 pin1 &amp; 2 should NOT be shorted on
evmAM437x board in order to test GPMC NAND flash.</p>
</div>
</div>
</div>
<div class="section" id="id248">
<h2>6.29.4. Additional References<a class="headerlink" href="#id248" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\gpmc\docs\doxygen\html\index
.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\gpmc\docs\ReleaseNotes_GPMC_
LLD.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="sciclient">
<h1>6.30. SCICLIENT<a class="headerlink" href="#sciclient" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id249">
<h2>6.30.1. Overview<a class="headerlink" href="#id249" title="Permalink to this headline">¶</a></h2>
<p>Traditional Texas Instruments SoCs implement system control functions such as power management within operating systems on each of the processing units (ARM/DSP etc). However the traditional approach has had tremendous challenges to ensure system stability. Few of the challenges include:</p>
<ul class="simple">
<li><p>Complex interactions between Operating Systems on heterogeneous SoCs for generic features.</p></li>
<li><p>Lack of centralized knowledge of system state.</p></li>
<li><p>Complex implementation challenges when implementing workarounds for SoC errata.</p></li>
<li><p>Equivalent SoC power or device management entitlement on all variations of Operating Systems.</p></li>
</ul>
<p>DMSC controls the power management of the device, hence is responsible for bringing the device out of
reset, enforce clock and reset rules. DMSC power management functions are critical to bring device to low
power modes, for example DeepSleep, and sense wake-up events to bring device back online to active
state.
There is one instance of DMSC in this family of devices - WKUP_DMSC0.</p>
<p>Texas Instruments’ System Control Interface defines the communication protocol between various processing entities to the System Control Entity on TI SoCs. This is a set of message formats and sequence of operations required to communicate and get system services processed from System Control entity in the SoC.</p>
<p>More information regarding the TI-SCI is given <a class="reference external" href="http://downloads.ti.com/tisci/esd/18_08_00/">here</a> .</p>
<p>The SCIClient is an interface to the TI-SCI protocol for RTOS and non-OS based applications. It exposes the core message details, valid module/clock IDs to the higher level software and abstracts the communication with SYSFW based on the TI-SCI protocol. These APIs can be called by power, resource and security RTOS drivers or any other non-OS or RTOS based higher level software to be able to communicate with DMSC for its services. The higher level software is expected to populate the necessary message core parameters.</p>
<p>The firmware which runs on DMSC is called system-firmware(SYSFW) .The documentation for SYSFW can be found at docs/system-firmware-public-documentation/ .</p>
</div>
<div class="section" id="terms-and-abbreviation">
<h2>6.30.2. Terms and Abbreviation<a class="headerlink" href="#terms-and-abbreviation" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>term</p></th>
<th class="head"><p>definition or explanation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>DMSC</p></td>
<td><p>Device Management and Security Controller</p></td>
</tr>
<tr class="row-odd"><td><p>SCI</p></td>
<td><p>System Control Interface</p></td>
</tr>
<tr class="row-even"><td><p>SYSFW</p></td>
<td><p>System Firmware</p></td>
</tr>
<tr class="row-odd"><td><p>PM</p></td>
<td><p>Power Management</p></td>
</tr>
<tr class="row-even"><td><p>RM</p></td>
<td><p>Resource Management</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="directory-structure">
<h2>6.30.3. Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h2>
<p>The directory structure of SCIClient is as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 87%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>docs/</p></td>
<td><p>Contains SCIClient design documentation and System Firmware public documentation.</p></td>
</tr>
<tr class="row-even"><td><p>include/</p></td>
<td><p>This folder contains the files user needs to refer in order to communicate with SYSFW using <a class="reference internal" href="#sciclient-service">Sciclient_service</a> . The files in this folder define the request and response structures for communicating with SYSFW .</p></td>
</tr>
<tr class="row-odd"><td><p>src/</p></td>
<td><p>Contains source(.c) files for the driver.</p></td>
</tr>
<tr class="row-even"><td><p>soc/</p></td>
<td><p>Contains SoC specific header files and firmware binary image. Refer to this folder for SoC sepcific parameters and board configuration. V0 - AM65xx, V1 - J721E.</p></td>
</tr>
<tr class="row-odd"><td><p>examples</p></td>
<td><p>Contains examples for utilizing sciclient interfaces. For Sciclient shim layer examples kindly refer the PM, UDMA driver code.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="build-and-run">
<h2>6.30.4. Build and Run<a class="headerlink" href="#build-and-run" title="Permalink to this headline">¶</a></h2>
<p>This section assumes that you have PDK at PDK_INSTALL_DIR .</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">PDK_ROOT_PATH</span> <span class="o">=</span> <span class="n">PDK_INSTALL_DIR</span><span class="o">/</span><span class="n">packages</span>
<span class="n">PDK_BUILD_PATH</span> <span class="o">=</span> <span class="n">PDK_INSTALL_DIR</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">build</span>
<span class="n">SCICLIENT_PATH</span> <span class="o">=</span> <span class="n">PDK_INSTALL_DIR</span><span class="o">/</span><span class="n">drv</span><span class="o">/</span><span class="n">sciclient</span>
</pre></div>
</div>
<div class="section" id="build-targets">
<h3>6.30.4.1. Build targets<a class="headerlink" href="#build-targets" title="Permalink to this headline">¶</a></h3>
<p>The driver provides targets for building library, unit tests and docs .
The library and unit tests can be built from PDK_BUILD_PATH or SCICLIENT_PATH . The docs can only be built from SCICLIENT_PATH .</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 51%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Target</p></th>
<th class="head"><p>Command</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Library</p></td>
<td><p>make PDK_INSTALL_PATH=&lt;your PDK_ROOT_PATH&gt; BOARD=am65xx_evm  CORE=&lt;mcu1_0(R5F) or mpu1_0(A53)&gt; sciclient</p></td>
<td><p>SCIClient library</p></td>
</tr>
<tr class="row-odd"><td><p>sciclient_ccs_init</p></td>
<td><p>make PDK_INSTALL_PATH=&lt;your PDK_ROOT_PATH&gt;  BOARD=am65xx_evm  CORE=&lt;mcu1_0(R5F) or mpu1_0(A53)&gt;  sciclient_ccs_init</p></td>
<td><p>SCIClient application that loads the firmware during ccs load.(No need to build this normally.)</p></td>
</tr>
<tr class="row-even"><td><p>sciclient_firmware_boot</p></td>
<td><p>make PDK_INSTALL_PATH=&lt;your PDK_ROOT_PATH&gt;  BOARD=am65xx_evm  CORE=&lt;mcu1_0(R5F) or mpu1_0(A53)&gt;  sciclient_firmware_boot</p></td>
<td><p>SCIClient example application</p></td>
</tr>
<tr class="row-odd"><td><p>Design Doc</p></td>
<td><p>make PDK_INSTALL_PATH=&lt;your PDK_ROOT_PATH&gt; designdoc</p></td>
<td><p>SCIClient design documentation</p></td>
</tr>
</tbody>
</table>
<p>Note</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">For</span> <span class="n">building</span> <span class="n">the</span> <span class="n">example</span> <span class="s">&quot;sciclient_firmware_boot&quot;</span> <span class="n">or</span> <span class="s">&quot;your application&quot;</span> <span class="k">using</span> <span class="n">SCIClient</span> <span class="n">lib</span><span class="p">,</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">you</span> <span class="n">have</span> <span class="n">a</span> <span class="n">section</span> <span class="s">&quot;boardcfg_data&quot;</span> <span class="n">defined</span> <span class="n">in</span> <span class="n">your</span> <span class="n">linker</span> <span class="n">cmd</span> <span class="n">file</span> <span class="n">which</span> <span class="n">resides</span> <span class="n">in</span> <span class="n">OC</span><span class="o">-</span><span class="n">MSRAM</span> <span class="p">.</span>
</pre></div>
</div>
<p>The next sections will explain how to load the system firmware using sciclient.</p>
</div>
<div class="section" id="load-using-a-boot-media">
<h3>6.30.4.2. Load using a boot-media<a class="headerlink" href="#load-using-a-boot-media" title="Permalink to this headline">¶</a></h3>
<p>Follow these steps to load the <strong>sciclient_firmware_boot</strong> application through a boot media:</p>
<ul class="simple">
<li><p>Build the example: sciclient_firmware_boot_TestApp</p></li>
<li><p>The test case works with MMCSD boot mode where it loads the sysfw.bin file from the mmcsd card. Ensure to create a tiboot3.bin file from the sciclient application. Copy the SoC specific sysfw.bin in the SD card along with the tiboot3.bin file.</p></li>
<li><p>Refer the section <a class="reference external" href="index_Foundational_Components.html#boot-modes">Boot-Modes</a> for details on how to use a bootmedia.</p></li>
<li><p>You can also use the SBL to load the system firmware and initialize the SoC. Refer to the SBL user guide for more details.</p></li>
</ul>
</div>
<div class="section" id="load-using-ccs">
<h3>6.30.4.3. Load using CCS<a class="headerlink" href="#load-using-ccs" title="Permalink to this headline">¶</a></h3>
<p>Follow these steps to load the <strong>sciclient_ccs_init</strong> application through CCS</p>
<ul class="simple">
<li><p>Update the File SCICLIENT_PATH/sciclient/tools/ccsLoadDmsc/&lt;soc&gt;/launch.js for the following variables to your PC location .</p></li>
</ul>
<p>Modify for AM65xx:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>//Path to GEL files
gelFilePath = &quot;&lt;Your CCS Path&gt;/ccs_base/emulation/gel/AM65xEVM/&quot;; → GEL path location
// Path to the directory in which this file would be residing. CCS expects
// absolute paths to load the binaries.
thisJsFileDirectory = &quot;PDK_INSTALL_DIR/packages/ti/drv/sciclient/tools/ccsLoadDmsc&quot;;
</pre></div>
</div>
<p>Modify for J721E:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//PDK path. Edit this</span>
<span class="n">pdkPath</span> <span class="o">=</span> <span class="s">&quot;PDK_INSTALL_DIR&quot;</span><span class="p">;</span>
</pre></div>
</div>
<ul>
<li><p>Connect the Javascript to the CCXML file with the steps shown below: (Note: this step needs to be repeated if you switch workspaces or clean your workspace).The Javascript is run on re-launch of the ccxml. If you would like to run the Javascript without relaunch then you can look ahead to the section: “Re-running the script once ccxml is already launched.” Click on Debug Configurations from the button as follows:</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/sciclient_ccsLoad1.png"><img alt="../_images/sciclient_ccsLoad1.png" src="../_images/sciclient_ccsLoad1.png" style="width: 600px; height: 300px;" /></a>
</div></blockquote>
</li>
<li><p>Select the CCXML file from the left-hand side and populate the path to the launch_am65xx.js file in the “Initialization Script” free form field and click on “Apply”.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/sciclient_ccsLoad2.png"><img alt="../_images/sciclient_ccsLoad2.png" src="../_images/sciclient_ccsLoad2.png" style="width: 600px; height: 300px;" /></a>
</div></blockquote>
</li>
<li><p>Once you Launch the ccxml the java script would automatically run and connect to R5F.</p></li>
</ul>
<p class="rubric"><strong>Re-running the script once ccxml is already launched</strong></p>
<p>In the CCS window open the “View → Scripting Console..”
In the CCS Scripting Console type:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="p">(</span><span class="s">&quot;SCICLIENT_PATH</span><span class="se">\\</span><span class="s">tools</span><span class="se">\\</span><span class="s">ccsLoadDmsc</span><span class="se">\\</span><span class="s">am65xx</span><span class="se">\\</span><span class="s">launch.js&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="or">
<h4>6.30.4.3.1. or<a class="headerlink" href="#or" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>load(“SCICLIENT_PATH\tools\ccsLoadDmsc\j721e\launch.js”)</p>
</div></blockquote>
<p>This would give the following output on the scripting console</p>
<p>For AM65xx:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="nl">js</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">load</span><span class="p">(</span><span class="s">&quot;SCICLIENT_PATH</span><span class="se">\\</span><span class="s">tools</span><span class="se">\\</span><span class="s">ccsLoadDmsc</span><span class="se">\\</span><span class="s">am65xx</span><span class="se">\\</span><span class="s">launch.js&quot;</span><span class="p">)</span>
<span class="n">Connecting</span> <span class="n">to</span> <span class="n">DMSC_Cortex_M3_0</span><span class="o">!</span>
<span class="n">Loading</span> <span class="n">DMSC</span> <span class="n">Firmware</span><span class="p">...</span>
<span class="n">DMSC</span> <span class="n">Firmware</span> <span class="n">Load</span> <span class="n">Done</span><span class="p">...</span>
<span class="n">DMSC</span> <span class="n">Firmware</span> <span class="n">run</span> <span class="n">starting</span> <span class="n">now</span><span class="p">...</span>
<span class="n">Connecting</span> <span class="n">to</span> <span class="n">MCU</span> <span class="n">Cortex_R5_0</span><span class="o">!</span>
</pre></div>
</div>
<p>For J721E:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="nl">js</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">load</span><span class="p">(</span><span class="s">&quot;SCICLIENT_PATH</span><span class="se">\\</span><span class="s">tools</span><span class="se">\\</span><span class="s">ccsLoadDmsc</span><span class="se">\\</span><span class="s">j721e</span><span class="se">\\</span><span class="s">launch.js&quot;</span><span class="p">)</span>
<span class="n">Connecting</span> <span class="n">to</span> <span class="n">DMSC_Cortex_M3_0</span><span class="o">!</span>
<span class="n">Loading</span> <span class="n">DMSC</span> <span class="n">Firmware</span><span class="p">...</span>
<span class="n">DMSC</span> <span class="n">Firmware</span> <span class="n">Load</span> <span class="n">Done</span><span class="p">...</span>
<span class="n">DMSC</span> <span class="n">Firmware</span> <span class="n">run</span> <span class="n">starting</span> <span class="n">now</span><span class="p">...</span>
<span class="n">Connecting</span> <span class="n">to</span> <span class="n">MCU</span> <span class="n">Cortex_R5_0</span><span class="o">!</span>
<span class="n">Running</span> <span class="n">the</span> <span class="n">board</span> <span class="n">configuration</span> <span class="n">initialization</span> <span class="n">from</span> <span class="n">R5</span><span class="o">!</span>
<span class="n">Running</span> <span class="n">the</span> <span class="n">DDR</span> <span class="n">configuration</span><span class="p">...</span> <span class="n">Wait</span> <span class="n">till</span> <span class="n">it</span> <span class="n">completes</span><span class="o">!</span>
<span class="n">Okay</span> <span class="n">you</span> <span class="n">are</span> <span class="n">good</span> <span class="n">to</span> <span class="n">go</span><span class="p">..</span> <span class="n">Happy</span> <span class="n">Debugging</span><span class="o">!</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="handling-two-or-more-ccxml-files">
<h3>6.30.4.4. Handling Two or more ccxml files<a class="headerlink" href="#handling-two-or-more-ccxml-files" title="Permalink to this headline">¶</a></h3>
<p>In case you need to connect two or more board to the same CCS session and use the launch script, please follow the steps below:</p>
<ul class="simple">
<li><p>When you use 2 or more CCXML files with similar debugger (e.g. connect 2 boards XDS110 on-board debugger to the PC), CCS would enumerate the debuggers as below:</p></li>
</ul>
<dl class="simple">
<dt>::</dt><dd><p>Texas Instruments XDS110 USB Debug Probe_0
Texas Instruments XDS110 USB Debug Probe_1</p>
</dd>
</dl>
<p>Notice the suffix “_0” and “_1”.
- In order to use the same launch.js file with this, please create a second copy of the launch.js file. Update the first launch.js files as below:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">updateScriptVars</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//Open a debug session</span>
    <span class="n">dsMCU1_0</span> <span class="o">=</span> <span class="n">debugServer</span><span class="p">.</span><span class="n">openSession</span><span class="p">(</span> <span class="s">&quot;*_0.*MCU_PULSAR_Cortex_R5_0&quot;</span> <span class="p">);</span>
    <span class="n">dsDMSC_0</span> <span class="o">=</span> <span class="n">debugServer</span><span class="p">.</span><span class="n">openSession</span><span class="p">(</span> <span class="s">&quot;*_0.*DMSC_Cortex_M3_0&quot;</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Update the second launch.js as below:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">updateScriptVars</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//Open a debug session</span>
    <span class="n">dsMCU1_0</span> <span class="o">=</span> <span class="n">debugServer</span><span class="p">.</span><span class="n">openSession</span><span class="p">(</span> <span class="s">&quot;*_1.*MCU_PULSAR_Cortex_R5_0&quot;</span> <span class="p">);</span>
    <span class="n">dsDMSC_0</span> <span class="o">=</span> <span class="n">debugServer</span><span class="p">.</span><span class="n">openSession</span><span class="p">(</span> <span class="s">&quot;*_1.*DMSC_Cortex_M3_0&quot;</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Notice the addition of “<a href="#id250"><span class="problematic" id="id251">*</span></a>_0” and “<a href="#id252"><span class="problematic" id="id253">*</span></a>_1”</p>
</div>
</div>
<div class="section" id="system-firmware-logs-parse">
<h2>6.30.5. System Firmware Logs Parse<a class="headerlink" href="#system-firmware-logs-parse" title="Permalink to this headline">¶</a></h2>
<p>In many cases you may need to understand and debug if a System Firmware API fails due to incorrect parameters or some genuine issue in the firmware. In order to debug when the API is failing, you need to follow the steps below:</p>
<ul class="simple">
<li><p>Enable logs in the system firmware by modifying the below structure:</p></li>
</ul>
<p>File: sciclientsocVxsciclient_defaultBoardcfg.c
Structure: const struct tisci_boardcfg gBoardConfigLow
Update the structure to have trace enabled:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* This enables the trace for DMSC logging. Should be used only for</span>
<span class="cm"> * debug.</span>
<span class="cm"> */</span>
<span class="p">.</span><span class="n">trace_dst_enables</span> <span class="o">=</span> <span class="p">(</span><span class="n">TISCI_BOARDCFG_TRACE_DST_UART0</span> <span class="o">|</span>
                      <span class="n">TISCI_BOARDCFG_TRACE_DST_ITM</span> <span class="o">|</span>
                      <span class="n">TISCI_BOARDCFG_TRACE_DST_MEM</span><span class="p">),</span>
<span class="p">.</span><span class="n">trace_src_enables</span> <span class="o">=</span> <span class="p">(</span><span class="n">TISCI_BOARDCFG_TRACE_SRC_PM</span> <span class="o">|</span>
                      <span class="n">TISCI_BOARDCFG_TRACE_SRC_RM</span> <span class="o">|</span>
                      <span class="n">TISCI_BOARDCFG_TRACE_SRC_SEC</span> <span class="o">|</span>
                      <span class="n">TISCI_BOARDCFG_TRACE_SRC_BASE</span> <span class="o">|</span>
                      <span class="n">TISCI_BOARDCFG_TRACE_SRC_USER</span> <span class="o">|</span>
                      <span class="n">TISCI_BOARDCFG_TRACE_SRC_SUPR</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Capture the System firmware logs from the WKUP_USART0.</p></li>
<li><p>Get the parsed logs from <strong>sciclienttoolssysfw_trace_parsersysfw_trace_parser.py</strong></p></li>
</ul>
<dl>
<dt>::</dt><dd><dl class="simple">
<dt>usage: python ./sysfw_trace_parser.py [-h] (-l LOG_FILE | -d SERIAL_PORT)</dt><dd><p>(-o OUTPUT_FILE | -O) [-t] [-r RULES_FILE]
[-Pm]</p>
</dd>
</dl>
<p>System Firmware Log Parse utility URL: <a class="reference external" href="http://software">http://software</a>-
dl.ti.com/tisci/esd/latest/4_trace/trace.html</p>
<p>Required arguments - Choose one of the inputs:
-l LOG_FILE, –log_file LOG_FILE</p>
<blockquote>
<div><p>Log File provided as input (default: None)</p>
</div></blockquote>
<dl class="option-list">
<dt><kbd><span class="option">-d <var>SERIAL_PORT</var></span>, <span class="option">--serial_port <var>SERIAL_PORT</var></span></kbd></dt>
<dd><p>Provide Device as input: Requires pyserial package
installed: See <a class="reference external" href="https://pyserial.readthedocs.io/">https://pyserial.readthedocs.io/</a>
(default: None)</p>
</dd>
</dl>
<p>Required arguments - Choose one of the outputs:
-o OUTPUT_FILE, –output_file OUTPUT_FILE</p>
<blockquote>
<div><p>Parse out the output to a file (default: None)</p>
</div></blockquote>
<dl class="option-list">
<dt><kbd><span class="option">-O</span>, <span class="option">--output_console</span></kbd></dt>
<dd><p>Log File to parse and report results to console
(default: False)</p>
</dd>
</dl>
<p>optional arguments:
-h, –help            show this help message and exit
-t, –time_stamp_relative</p>
<blockquote>
<div><p>Add TimeStamp to output in relative milliseconds(this
is approximation ONLY) (default: False)</p>
</div></blockquote>
<dl class="option-list">
<dt><kbd><span class="option">-r <var>RULES_FILE</var></span>, <span class="option">--rules_file <var>RULES_FILE</var></span></kbd></dt>
<dd><p>Alternate Rules file (default: ./sysfw_trace_rules.json)</p>
</dd>
<dt><kbd><span class="option">-P<var>m</var></span>, <span class="option">--print_match_only</span></kbd></dt>
<dd><p>Print just decoded data, (default: False)</p>
</dd>
</dl>
</dd>
</dl>
</div>
<div class="section" id="api-descriptions">
<h2>6.30.6. API descriptions<a class="headerlink" href="#api-descriptions" title="Permalink to this headline">¶</a></h2>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/sciclient/sciclient.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>The driver is split into 2 parts :</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sciclient-core">SCIClient Core</a> : This has APIs for loading SYSFW ,initialization, de-initialization and SYSFW communication .These are defined in sciclient.h .</p></li>
<li><p><a class="reference internal" href="#sciclient-shim-layer">SCIClient Shim Layer</a> : This thin layer abstracts the message requests and responses sent to SYSW for <a class="reference internal" href="#power-management">Power_management</a>  ,  <a class="reference internal" href="#resource-management">Resource_management</a> and <a class="reference internal" href="#processor-boot-api-interface">Processor_BOOT_API_Interface</a> which the user can use without worrying about the request and response structures used .</p></li>
</ul>
<div class="section" id="sciclient-core">
<h3>6.30.6.1. SCIClient Core<a class="headerlink" href="#sciclient-core" title="Permalink to this headline">¶</a></h3>
<p>The following core APIs for SCIClient are declared in sciclient.h.</p>
<p class="rubric">Firmware Load</p>
<p id="sciclient-loadfirmware">This API loads SYSFW.The image must be loaded through a boot media for this API to succeed (Refer <a class="reference internal" href="#build-and-run">Build and Run</a>). Hence, this is typically called by SBL. Load
firmware call does not require <a class="reference internal" href="#sciclient-init">Sciclient_init</a> to be done before.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Defined</span> <span class="n">in</span> <span class="n">sciclient</span><span class="p">.</span><span class="n">h</span> <span class="n">as</span> <span class="n">Sciclient_loadFirmware</span><span class="p">.</span>
</pre></div>
</div>
<p>Typical usage</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">gSciclient_firmware</span><span class="p">[</span><span class="n">BINARY_FILE_SIZE_IN_BYTES</span> <span class="o">/</span> <span class="mi">4U</span><span class="p">]</span> <span class="o">=</span><span class="n">SCICLIENT_FIRMWARE</span><span class="p">;</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="n">Sciclient_loadFirmware</span><span class="p">(</span><span class="n">gSciclient_firmware</span><span class="p">);</span>
</pre></div>
</div>
<p class="rubric">SCIClient initialization</p>
<p id="sciclient-init">This API is called once for registering interrupts and creating
semaphore handles to be able to talk to the firmware.
The application should assume that the firmware is pre-loaded while
calling this API.
The firmware should have been loaded either via GEL or via the SBL
(refer <a class="reference internal" href="#sciclient-loadfirmware">Sciclient_loadFirmware</a> ) prior to the application calling this.</p>
<p>The API <strong>Sciclient_init</strong> takes a pointer to <em>Sciclient_ConfigPrms_t</em> as input.</p>
<ul>
<li><p>The parameter <em>opModeFlag</em> allows 2 operation modes for <a class="reference internal" href="#sciclient-service">Sciclient_service</a> :</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>opModeFlag</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Polling based</p></td>
<td><p>Invoked using   SCICLIENT_SERVICE_OPERATION_MODE_POLLED</p></td>
</tr>
<tr class="row-odd"><td><p>Interrupt based</p></td>
<td><p>Invoked using   SCICLIENT_SERVICE_OPERATION_MODE_INTERRUPT</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ul>
<p>Definition</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Defined</span> <span class="n">in</span> <span class="n">sciclient</span><span class="p">.</span><span class="n">h</span> <span class="n">as</span> <span class="o">**</span><span class="n">Sciclient_init</span><span class="o">**</span><span class="p">.</span>
</pre></div>
</div>
<p>Note</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">This</span> <span class="n">API</span> <span class="n">provides</span> <span class="n">a</span> <span class="n">software</span> <span class="n">initialization</span> <span class="k">for</span> <span class="n">the</span> <span class="n">driver</span><span class="p">.</span> <span class="n">Any</span> <span class="n">application</span> <span class="k">using</span> <span class="n">SCIClient</span> <span class="n">must</span> <span class="n">call</span> <span class="k">this</span> <span class="n">API</span><span class="p">.</span>
<span class="o">-</span> <span class="n">SCICLIENT_SERVICE_OPERATION_MODE_INTERRUPT</span> <span class="n">is</span> <span class="n">not</span> <span class="n">supported</span> <span class="n">as</span> <span class="n">of</span> <span class="n">now</span><span class="p">.</span>
</pre></div>
</div>
<p>Typical usage</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Sciclient_ConfigPrms_t</span>        <span class="n">config</span> <span class="o">=</span>
<span class="p">{</span>
    <span class="n">SCICLIENT_SERVICE_OPERATION_MODE_POLLED</span><span class="p">,</span>
    <span class="nb">NULL</span>
<span class="p">};</span>
<span class="n">Sciclient_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">);</span>
</pre></div>
</div>
<p class="rubric">SYSFW communication</p>
<p id="sciclient-service">This API allows communicating with the System firmware which can be
called to perform various functions in the system.
Core SCIClient function for transmitting payload and recieving
the response.
The caller is expected to allocate memory for the input request
parameter <strong>Sciclient_ReqPrm_t</strong> . This involves setting the
message type being communicated to the firmware, the response flags,
populate the payload of the message based on the inputs in the
files located at include/tisci/ .
Since the payload in considered a stream of bytes in this API,
the caller should also populate the size of this stream in
reqPayloadSize. The timeout is used to determine for what amount
of iterations the API would wait for their operation to complete.</p>
<p>To make sure the response is captured correctly the caller should
also allocate the space for <strong>Sciclient_RespPrm_t</strong> parameters. The
caller should populate the pointer to the pRespPayload and the size
respPayloadSize. The API would populate the response flags to
indicate any firmware specific errors and also populate the memory
pointed by pRespPayload till the size given in respPayloadSize.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Defined</span> <span class="n">in</span> <span class="n">sciclient</span><span class="p">.</span><span class="n">h</span> <span class="n">as</span> <span class="o">**</span><span class="n">Sciclient_service</span><span class="o">**</span> <span class="p">.</span>
</pre></div>
</div>
<p>Typical usage</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="n">Sciclient_ReqPrm_t</span>      <span class="n">reqPrm</span> <span class="o">=</span>
<span class="p">{</span>
    <span class="n">TISCI_MSG_VERSION</span><span class="p">,</span>
    <span class="n">TISCI_MSG_FLAG_AOP</span><span class="p">,</span>
    <span class="nb">NULL</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="n">SCICLIENT_SERVICE_WAIT_FOREVER</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">tisci_msg_version_resp</span> <span class="n">response</span><span class="p">;</span>
<span class="n">Sciclient_RespPrm_t</span>           <span class="n">respPrm</span> <span class="o">=</span>
<span class="p">{</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">response</span><span class="p">,</span>
    <span class="k">sizeof</span> <span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="p">};</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">Sciclient_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">);</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">Sciclient_service</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reqPrm</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">respPrm</span><span class="p">);</span>
</pre></div>
</div>
<p class="rubric">SCIClient de-initialization</p>
<p id="sciclient-deinit">De-initialization of sciclient. This de-initialization is specific
to the application. It only de-initializes the semaphores,
interrupts etc. which are initialized using <a class="reference internal" href="#sciclient-init">Sciclient_init</a> . It does
not de-initialize the system firmware.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Defined</span> <span class="n">in</span> <span class="n">sciclient</span><span class="p">.</span><span class="n">h</span> <span class="n">as</span> <span class="o">**</span><span class="n">Sciclient_deinit</span><span class="o">**</span> <span class="p">.</span>
</pre></div>
</div>
<p>Typical usage</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Sciclient_deinit</span><span class="p">();</span>
</pre></div>
</div>
<p class="rubric">Board configuration</p>
<p>One time board configuration needs to be done from R5 for rm,pm and
security to communicate with SYSFW. It is normally done by SBL, so user doesn’t need to call these APIs.</p>
<p>User needs to define a section “.boardcfg_data” in the
linker file for the default configuration (NULL pointer to <em>Sciclient_BoardCfgPrms_t</em> is passed to the APIs), which needs to be present
in OCMRAM . If user provides custom board_cfg, then the data must
be present on OCMRAM.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Board</span> <span class="n">configuration</span> <span class="n">structure</span> <span class="n">is</span> <span class="n">defined</span> <span class="n">in</span> <span class="n">include</span><span class="o">/</span><span class="n">V0</span><span class="o">/</span><span class="n">sciclient_boardcfg</span><span class="p">.</span><span class="n">h</span> <span class="n">as</span> <span class="n">Sciclient_BoardCfgPrms_t</span><span class="p">.</span>
</pre></div>
</div>
<p>Typical usage</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">status</span> <span class="o">=</span> <span class="n">Sciclient_boardCfg</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">CSL_PASS</span> <span class="o">==</span> <span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">Sciclient_boardCfgPm</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">Sciclient_boardCfgRm</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">Sciclient_boardCfgSec</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span> <span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="sciclient-shim-layer">
<h3>6.30.6.2. SCIClient Shim Layer<a class="headerlink" href="#sciclient-shim-layer" title="Permalink to this headline">¶</a></h3>
<p class="rubric">Power management</p>
<p id="power-management">The APIs in include/sciclient_pm.h provide declarations of SCIClient APIs for power management of the SOC .</p>
<p class="rubric">Resource management</p>
<p id="resource-management">The APIs in include/sciclient_rm.h provide declarations of SCIClient APIs for resource management of the SOC .</p>
<p class="rubric">Processor BOOT API Interface</p>
<p id="processor-boot-api-interface">The APIs in include/sciclient_procboot.h provide declarations of SCIClient APIs for processor boot and control.</p>
<p>APIs are divided into the following two sets</p>
<ul class="simple">
<li><p>Book keeping APIs - Meant to control access to allow a reasonable usage scenario of processors.</p></li>
<li><p>Processor Control APIs - Meant to be the actual Processor Corecontrols.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="ipclld">
<h1>6.31. IPCLLD<a class="headerlink" href="#ipclld" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id254">
<h2>6.31.1. Overview<a class="headerlink" href="#id254" title="Permalink to this headline">¶</a></h2>
<p>TI Jacinto7/AM65XX family of devices consists of many cores - ARM53/72, R5Fs (MCU or Main Domain) and/or DSPs (C66x / C7x). The actual cores varies with actual device. Refer to datasheet of the device for actual cores present on soc. Inter-Processor Communication (IPC) provides communication channel between various cores. IPCLLD is low-level driver for IPC which provides core-agnostic and OS-agnostic framework for communication.</p>
<p>More information regarding the <a class="reference external" href="http://www.ti.com/processors/automotive-processors/overview.html">TI multicore processors</a> is available .</p>
</div>
<div class="section" id="id255">
<h2>6.31.2. Terms and Abbreviation<a class="headerlink" href="#id255" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 91%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Term</p></th>
<th class="head"><p>Definition or Explanation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>IPC</p></td>
<td><p>Inter-Processor Communication</p></td>
</tr>
<tr class="row-odd"><td><p>RirtIO</p></td>
<td><p>Virtual I/O driver</p></td>
</tr>
<tr class="row-even"><td><p>MailBox</p></td>
<td><p>IP which provides queued interrupt mechanism  for communication channel</p></td>
</tr>
<tr class="row-odd"><td><p>RA</p></td>
<td><p>Ring accelerator</p></td>
</tr>
<tr class="row-even"><td><p>VRing</p></td>
<td><p>Ring Buffer on shared memory</p></td>
</tr>
<tr class="row-odd"><td><p>RM</p></td>
<td><p>Resource Management</p></td>
</tr>
<tr class="row-even"><td><p>PDK</p></td>
<td><p>Platform Development Kit</p></td>
</tr>
<tr class="row-odd"><td><p>PSDKRA</p></td>
<td><p>Processor SDK RTOS Automotive</p></td>
</tr>
<tr class="row-even"><td><p>PSDKLA</p></td>
<td><p>Processor SDK Linux Automotive</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="references">
<h2>6.31.3. References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="http://www.ti.com/lit/gpn/am6548">Sitara Processor Datasheet</a></p></li>
<li><p>For J721e datasheet, please contact TI presentative</p></li>
</ul>
<div class="section" id="features">
<h3>6.31.3.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Provides ipc low-level driver which can be compiled for any cores on AM65xx or J721E devices</p></li>
<li><p>Supports Bios/Bios communication and Linux/Bios concurrently for all cores</p></li>
<li><p>Supports TI RTOS, Linux, QNX and baremetal use(No-OS).</p></li>
<li><p>It can be extended for any third-party RTOS by adding OS adaptation layer</p></li>
<li><p>IPCLLD also provides many examples for quick reference</p></li>
</ul>
</div>
<div class="section" id="installation">
<h3>6.31.3.2. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>IPCLLD is part of TI pdk (platform Development Kit) package. Once PSDKRA is installed, pdk and all dependent packages and tool-chains are installed automatically.
IPCLLD can also be located at &lt;PSDKRA_HOME&gt;/pdk/packages/ti/drv/ipc. IPCLLD is also available publically at <a class="reference external" href="http://git.ti.com/keystone-rtos/ipc-lld">http://git.ti.com/keystone-rtos/ipc-lld</a>.</p>
<p>It can also be cloned using following git command:</p>
<ul class="simple">
<li><p>git clone git://git.ti.com/keystone-rtos/ipc-lld.git</p></li>
<li><p>Provides many examples for quick reference</p></li>
</ul>
<p>The file  and directory oraganization are as below.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/ipclld_file_org.png"><img alt="../_images/ipclld_file_org.png" src="../_images/ipclld_file_org.png" style="width: 435px; height: 944px;" /></a>
</div></blockquote>
</div>
<div class="section" id="build">
<h3>6.31.3.3. Build<a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h3>
<p>IPCLLD uses pdk build systems to build IPCLLD library and example applications.</p>
</div>
</div>
<div class="section" id="compilers-and-tool-chains-required">
<h2>6.31.4. Compilers and Tool-chains Required:<a class="headerlink" href="#compilers-and-tool-chains-required" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 12%" />
<col style="width: 88%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Compiler/Tool-Chain</p></th>
<th class="head"><p>Tool Version and Download Links</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SysBios</p></td>
<td><p><a class="reference external" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/sysbios/6_76_02_02/exports/bios_6_76_02_02.run">Bios 6.76.02.02</a></p></td>
</tr>
<tr class="row-odd"><td><p>XDC tool</p></td>
<td><p><a class="reference external" href="http://downloads.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/rtsc/3_55_02_22/exports/xdccore/xdctools_3_55_02_22_core_linux.zip">XDCtools 3.55.02.22</a></p></td>
</tr>
<tr class="row-even"><td><p>XDAIS tool</p></td>
<td><p><a class="reference external" href="http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/xdais/7_24_00_04/index_FDS.html">XDAIS 7.24.00.04</a></p></td>
</tr>
<tr class="row-odd"><td><p>TI Code-Gen tool for ARM</p></td>
<td><p><a class="reference external" href="http://software-dl.ti.com/codegen/esd/cgt_public_sw/TMS470/18.12.1.LTS/ti_cgt_tms470_18.12.1.LTS_linux_installer_x86.bin">TI Arm CGT 18.2.1.LTS</a></p></td>
</tr>
<tr class="row-even"><td><p>Linaro Tools</p></td>
<td><ul class="simple">
<li><p><a class="reference external" href="https://releases.linaro.org/components/toolchain/binaries/7.2-2017.11/aarch64-elf/gcc-linaro-7.2.1-2017.11-x86_64_aarch64-elf.tar.xz">aarch64-elf</a></p></li>
<li><p><a class="reference external" href="https://releases.linaro.org/components/toolchain/binaries/7.2-2017.11/aarch64-linux-gnu/gcc-linaro-7.2.1-2017.11-x86_64_aarch64-linux-gnu.tar.xz">aarch64-linux-gnu</a></p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dependency-of-external-pdk-components">
<h2>6.31.5. Dependency of External PDK Components<a class="headerlink" href="#dependency-of-external-pdk-components" title="Permalink to this headline">¶</a></h2>
<p>IPCLLD does access any hardware diretly. It uses pdk/csl component to configure Mailbox registers. It uses sciclient to set/release Mailbox interrupt. Also it uses pdk/osal to congire OS related steps like Semaphore etc.</p>
<ul class="simple">
<li><p>pdk/csl : Configures Mailbox registers</p></li>
<li><p>pdk/sciclient : Set Mailbox interrupts</p></li>
<li><p>pdk/osal : To register for HWI and other kernel stuffs.</p></li>
</ul>
</div>
<div class="section" id="command-to-build-ipclld">
<h2>6.31.6. Command to build IPCLLD:<a class="headerlink" href="#command-to-build-ipclld" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Build IPCLLD library</p>
<blockquote>
<div><p>make -C ./ti/drv/ipc lib</p>
</div></blockquote>
</li>
<li><p>Build IPCLLD examples</p>
<blockquote>
<div><p>make -C ./ti/drv/ipc examples</p>
</div></blockquote>
</li>
<li><p>Clean IPCLLD library and examples</p>
<blockquote>
<div><p>make -C ./ti/drv/ipc clean</p>
</div></blockquote>
</li>
<li><p>Build IPCLLD and examples</p>
<blockquote>
<div><p>make -C ./ti/drv/ipc all</p>
</div></blockquote>
</li>
</ul>
<p>Following environment variables must be defined.</p>
<ul class="simple">
<li><p>SDK_INSTALL_PATH: Installation root for sdk</p></li>
<li><p>TOOLS_INSTALL_PATH: where all the tool chains are installed</p></li>
<li><p>PDK_INSTALL_PATH: Installtion root for pdk</p></li>
</ul>
<p>If pdk build system is used to build, then use following steps to build</p>
<ul>
<li><p>Go to &lt;pdk_root&gt;/package/ti/build</p></li>
<li><p>To build the IPCLLD library, run command</p>
<blockquote>
<div><p>make -s -j BUILD_PROFILE=&lt;debug/release&gt; BOARD=&lt;am65xx/j721e-evm&gt; CORE=&lt;core_name&gt; ipc</p>
</div></blockquote>
</li>
<li><p>To build the IPCLLD examples, run command</p>
<blockquote>
<div><p>make -s -j BUILD_PROFILE=&lt;debug/release&gt; BOARD=&lt;am65xx/j721e-evm&gt; CORE=&lt;core_name&gt; ipc_echo_test</p>
</div></blockquote>
</li>
<li><p>To clean IPCLLD examples, run command</p>
<blockquote>
<div><p>make -s -j BUILD_PROFILE=&lt;debug/release&gt; BOARD=&lt;am65xx/j721e-evm&gt; CORE=&lt;core_name&gt; ipc_echo_test_clean</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="core-names">
<h2>6.31.7. Core names:<a class="headerlink" href="#core-names" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p>mpu1_0: available on AM65xx and J721E device</p></li>
<li><p>mcu1_0: available on AM65xx and J721E device</p></li>
<li><p>mcu1_1: available on AM65xx and J721E device</p></li>
<li><p>mcu2_0: available on J721E device</p></li>
<li><p>mcu2_1: available on J721E device</p></li>
<li><p>mcu3_0: available on J721E device</p></li>
<li><p>mcu3_1: available on J721E device</p></li>
<li><p>c66xdsp_1: available on J721E device</p></li>
<li><p>c66xdsp_2: available on J721E device</p></li>
<li><p>c7x_1: available on J721E device</p></li>
</ul>
</div></blockquote>
<div class="section" id="running-the-ipclld-examples">
<h3>6.31.7.1. Running the IPCLLD examples<a class="headerlink" href="#running-the-ipclld-examples" title="Permalink to this headline">¶</a></h3>
<p>IPCLLD comes with four examples.</p>
</div>
</div>
<div class="section" id="example-details">
<h2>6.31.8. Example Details:<a class="headerlink" href="#example-details" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>ipc_echo_test:</strong> This is most generic example application where A72 is running Linux, and all other cores running bios. All cores talk to each other bi-diectionally. It is send ping message and remote end responds pong message. There are 10 ping/pong messages exchanged between each core-pair.</p></li>
<li><p><strong>ex01_bios_2core_echo_test:</strong> This is the simplistic ping/pong application between any two cores running BIOS</p></li>
<li><p><strong>ex02_bios_multicore_echo_test:</strong> All cores running Bios, mani-to-many communication, each sending ping/pong with each other. A72 is also running Bios.</p></li>
<li><p><strong>ex03_linux_bios_2core_echo_test:</strong> THis is simplistic ping/pong application where A72 running Linux and any other core is running Bios.</p></li>
</ul>
</div>
<div class="section" id="loading-remote-firmware">
<h2>6.31.9. Loading Remote Firmware<a class="headerlink" href="#loading-remote-firmware" title="Permalink to this headline">¶</a></h2>
<p>Remote firmware can be loading using ccs or using uBoot SPL.</p>
<ol class="arabic">
<li><p><strong>Loading using CCS</strong> :</p>
<blockquote>
<div><p>Sciclient module contains default system firmware and ccs script to load the system firmware. THe load scripts should be modified to reflect the correct full-path of the scipt location. Once the script is updated,</p>
<ul>
<li><p>start TI CCS 9.1</p></li>
<li><p>open ccs script console using menu <strong>View –&gt; Scripting Console</strong></p></li>
<li><dl class="simple">
<dt>Run the script using following command</dt><dd><ul class="simple">
<li><p>loadJSFile(“&lt;pdk_root&gt;/packages/ti/drv/sciclient/tools/ccsLoadDmsc/j721e/launch.js”)</p></li>
</ul>
</dd>
</dl>
<a class="reference internal image-reference" href="../_images/ipclld_LoadingSysFw_sciclient.png"><img alt="../_images/ipclld_LoadingSysFw_sciclient.png" src="../_images/ipclld_LoadingSysFw_sciclient.png" style="width: 941px; height: 160px;" /></a>
</li>
<li><dl class="simple">
<dt>Connect the cores</dt><dd><ul class="simple">
<li><p>select the core</p></li>
<li><p>right-click and connect</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Load the remote binaries</dt><dd><ul class="simple">
<li><p>Menu <strong>Run –&gt; Load Program</strong></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Run the cores.</p></li>
<li><p>After running the cores, the sample output should look something like below.</p>
<a class="reference internal image-reference" href="../_images/ipclld_Sample_output_mpu.png"><img alt="../_images/ipclld_Sample_output_mpu.png" src="../_images/ipclld_Sample_output_mpu.png" style="width: 672px; height: 377px;" /></a>
</li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Loading using SPL/uBoot</strong></p></li>
</ol>
<blockquote>
<div><p>Run following steps to configure remote firmware for SPL loading</p>
<ol class="arabic simple">
<li><p>Copy the remote firmware to rootfs at /lib/firmware/pdk-ipc folder</p></li>
<li><p>cd /lib/firmware</p></li>
<li><p>Remove old soft link for remote cores</p>
<ul class="simple">
<li><p>rm j7*</p></li>
</ul>
</li>
<li><p>Create new soft links</p>
<ul class="simple">
<li><p>ln -s /lib/firmware/pdk-ipc/ipc_echo_test_c66xdsp_1_release.xe66 j7-c66_0-fw</p></li>
<li><p>ln -s /lib/firmware/pdk-ipc/ipc_echo_test_c66xdsp_2_release.xe66 j7-c66_1-fw</p></li>
<li><p>ln -s /lib/firmware/pdk-ipc/ipc_echo_test_c7x_1_release.xe71     j7-c71_0-fw</p></li>
<li><p>ln -s /lib/firmware/pdk-ipc/ipc_echo_test_mcu2_0_release.xer5f   j7-main-r5f0_0-fw</p></li>
<li><p>ln -s /lib/firmware/pdk-ipc/ipc_echo_test_mcu2_1_release.xer5f   j7-main-r5f0_1-fw</p></li>
<li><p>ln -s /lib/firmware/pdk-ipc/ipc_echo_test_mcu3_0_release.xer5f   j7-main-r5f1_0-fw</p></li>
<li><p>ln -s /lib/firmware/pdk-ipc/ipc_echo_test_mcu3_1_release.xer5f   j7-main-r5f1_1-fw</p></li>
<li><p>ln -s /lib/firmware/pdk-ipc/ipc_echo_testb_mcu1_0_release.xer5f  j7-mcu-r5f0_0-fw</p></li>
<li><p>ln -s /lib/firmware/pdk-ipc/ipc_echo_test_mcu1_1_release.xer5f   j7-mcu-r5f0_1-fw</p></li>
</ul>
</li>
<li><p>sync : write the changes to filesystem</p></li>
<li><p>Reboot the system</p></li>
</ol>
</div></blockquote>
</div>
<div class="section" id="running-the-ipc-echo-test">
<h2>6.31.10. Running the ipc_echo_test<a class="headerlink" href="#running-the-ipc-echo-test" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ol class="arabic">
<li><p>Login as root</p></li>
<li><p>Start sample app as below</p>
<ul class="simple">
<li><p>modprobe rpmsg_client_sample count=5</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/ipclld_Linux_Start.png"><img alt="../_images/ipclld_Linux_Start.png" src="../_images/ipclld_Linux_Start.png" style="width: 581px; height: 270px;" /></a>
</li>
</ol>
<blockquote>
<div><ol class="arabic simple" start="3">
<li><p>After running the sample app, it should display something below</p></li>
</ol>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/ipclld_linux_output.png"><img alt="../_images/ipclld_linux_output.png" src="../_images/ipclld_linux_output.png" style="width: 983px; height: 796px;" /></a>
</div></blockquote>
</div></blockquote>
</div></blockquote>
<div class="section" id="ipclld-design-details">
<h3>6.31.10.1. IPCLLD Design Details<a class="headerlink" href="#ipclld-design-details" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Ring Buffer is used as shared memory to transfer the data. It must be reserved system wide. The base-address and size of ring Buffer must be provided to IPCLLD. It must be same for all core applications. the invidual memory-range for Ring Buffer between core combinations are calculated internally inside the library. The default base-address is 0xAA000000 and size is 0x1C00000</p></li>
<li><p>For each RPmessage object, the memory must be provided to library from local heap. All subsequent send/recv API is using rpmessage buffer provided during the create function.</p></li>
<li><p>RPMessage can transfer maximum of 512 bytes of data.</p></li>
</ul>
</div>
<div class="section" id="typical-data-flow-in-ipclld-communication-between-two-cores">
<h3>6.31.10.2. Typical Data-Flow in IPCLLD communication between two cores<a class="headerlink" href="#typical-data-flow-in-ipclld-communication-between-two-cores" title="Permalink to this headline">¶</a></h3>
<p>Following picture illustrates the data flow between two cres using mailbox IP as transport.</p>
<a class="reference internal image-reference" href="../_images/ipclld_data_flow.png"><img alt="../_images/ipclld_data_flow.png" src="../_images/ipclld_data_flow.png" style="width: 687px; height: 470px;" /></a>
</div>
<div class="section" id="writing-helloworld-app-using-ipclld">
<h3>6.31.10.3. Writing HelloWorld App using IPCLLD<a class="headerlink" href="#writing-helloworld-app-using-ipclld" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt><strong>Step1: Initialize MultiProc ? SelfId, how many remote cores?</strong></dt><dd><p>Ipc_mpSetConfig(selfProcId, numProc, remoteProc);</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Step2: Initialize VirtIO ? Base Address for Shared Memory used for RingBuffer</strong></dt><dd><p>vqParam.vqObjBaseAddr = (void*)sysVqBuf;
vqParam.vqBufSize     = numProc * Ipc_getVqObjMemoryRequiredPerCore();
vqParam.vringBaseAddr = (void*)VRING_BASE_ADDRESS;
vqParam.vringBufSize  = VRING_BUFFER_SIZE;
Ipc_initVirtIO(&amp;vqParam);</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Step3: Initialize RPMessage</strong></dt><dd><p>RPMessage_init(&amp;cntrlParam);</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Step4: Send Message</strong></dt><dd><p>RPMessage_send(handle, dstProc, ENDPT1, myEndPt, (Ptr)buf, len);</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Step5: Receive Message</strong></dt><dd><dl class="simple">
<dt>RPMessage_recv(handle, (Ptr)buf, &amp;len, &amp;remoteEndPt,</dt><dd><p>&amp;remoteProcId, timeout);</p>
</dd>
</dl>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="vps-drivers">
<h1>6.32. VPS Drivers<a class="headerlink" href="#vps-drivers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id256">
<h2>6.32.1. Overview<a class="headerlink" href="#id256" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id257">
<h3>6.32.1.1. Introduction<a class="headerlink" href="#id257" title="Permalink to this headline">¶</a></h3>
<p>VPS (Video Processing SubSystem) video Drivers allow users to make use
of all video hardware features like 1080P capture, HDMI/LCD/SDTV
display, deinterlacing, scaling. A user can use the drivers in many
different ways like multi-channel capture, memory to memory processing,
display and so on. This document has detailed API description that
user’s can use to make use of the VPS drivers.</p>
<p>VPS consists of following modules</p>
<ul class="simple">
<li><p>Video Input Port (VIP) - for video capture functions for the device</p></li>
<li><p>Video Processing Engine (VPE)- for video operations such as color
space convertion, deinterlacing, scaling and chroma upsampling
features.</p></li>
<li><p>Display SubSystem (DSS) - for LCD outputs on three parallel
interfaces (DPI1, DPI2, and DPI3) and HDMI</p></li>
</ul>
</div>
</div>
<div class="section" id="id258">
<h2>6.32.2. User Interface<a class="headerlink" href="#id258" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id259">
<h3>6.32.2.1. Driver Configuration<a class="headerlink" href="#id259" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="id260"><strong>Board Specific Configuration</strong></p>
<p>All board specific configurations eg:enabling clock and pin-mux for
UART/display/vip pins are required before calling any driver APIs. The
board specific configurations are implemented under
&lt;pdk&gt;/ti/drv/vps/src/boards/src folder.</p>
<p class="rubric" id="vps-configuration-structure"><strong>VPS Configuration Structure</strong></p>
<p>For details about individual fields of VPS library structure, see the
Doxygen help by opening
PDK_INSTALL_DIR\packages\ti\drv\vps\docs\doxygen\html\index.html.</p>
</div>
<div class="section" id="id261">
<h3>6.32.2.2. APIs<a class="headerlink" href="#id261" title="Permalink to this headline">¶</a></h3>
<p>The VPS driver API can be broadly divided into the following categories</p>
<ul class="simple">
<li><p>FVID2 API - API used to create, control and use the different VPS
drivers</p></li>
<li><p>VPS (Video Processing Sub-system) API - API for all video drivers</p></li>
<li><p>VPS Control Driver API</p></li>
<li><p>VPS Capture API - API for video capture drivers</p></li>
<li><p>VPS VIP Capture API - API specific to VIP capture driver</p></li>
<li><p>VPS DSSWB Capture API - API specific to DSS WB capture driver</p></li>
<li><p>VPS Display API - API for video display drivers</p></li>
<li><p>VPS Display Controller API - API for controlling and configuring
VENCs in the display subsystem</p></li>
<li><p>VPS Memory to Memory (M2M) API - API for memory to memory drivers</p></li>
<li><p>M2M VPE API - API specific to VPE M2M driver</p></li>
<li><p>External Device API - API for controlling external video devices like
video decoders, video encoders, video filters, IO expanders,
Ultra-sonic sensors</p></li>
<li><p>Platform Specific API - API for platform/board specific control, like
setting pin muxes, clocks etc</p></li>
<li><p>Board Specific API - API for board specific features.</p></li>
</ul>
<p>In addition to above drivers the VPS package also includes many sample
examples which show how to use the drivers in different ways. Many of
these sample examples use a common set of APIs which a user may find
useful to refer to for use in their final application.</p>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/vps/include/vps_&lt;func&gt;.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id262">
<h2>6.32.3. Application<a class="headerlink" href="#id262" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id263">
<h3>6.32.3.1. Examples<a class="headerlink" href="#id263" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Expected Results</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Display Dss
application</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
<em>simple</em> display
yuyv or bgr frames
to the LCD use
case. Reference
example for
developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application prompts
user to select the
test case input in
CCS console.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>Display Dss
application (Bare
Metal)</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
<em>simple</em> display
yuyv or bgr frames
to the LCD use case
for bare metal use
cases. Reference
bare metal example
for developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application prompts
user to select the
test case input in
CCS console.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Display Dss WB
application</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
<em>simple</em> display
Write Back (WB)
yuyv or bgr frames
to the LCD use
case. Reference
example for
developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application prompts
user to select the
test case input in
CCS console.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>Loopback application
(Capture and Display
application)</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
<em>simple</em> capture
and display yuyv
frames from camera
to the LCD use
case. Reference
example for
developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application prompts
user to select the
test case input in
CCS console, please
select ov2659
camera for idkAM57x
and OV1063x for
evmAM572x test
cases.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Loopback application
Bare metal(Capture
and Display
application)</p></td>
<td><div class="line-block">
<div class="line">Example
demonstrating
<em>simple</em> capture
and display yuyv
frames from camera
to the LCD use case
for bare metal.
Bare Metal
reference example
for developers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Application prompts
user to select the
test case input in
CCS console, please
select ov2659
camera for idkAM57x
and OV1063x for
evmAM572x test
cases.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">Starting</span> <span class="n">from</span> <span class="n">Processor</span> <span class="n">SDK</span> <span class="mf">4.2</span> <span class="n">release</span><span class="p">,</span> <span class="n">idkAM574x</span> <span class="n">support</span> <span class="n">is</span> <span class="n">added</span> <span class="k">for</span> <span class="n">VPS</span><span class="p">.</span>
<span class="o">*</span> <span class="n">Starting</span> <span class="n">from</span> <span class="n">Processor</span> <span class="n">SDK</span> <span class="mf">4.2</span> <span class="n">release</span><span class="p">,</span> <span class="n">oV1063x</span> <span class="n">camera</span> <span class="n">part</span> <span class="n">support</span> <span class="n">is</span> <span class="n">added</span> <span class="k">for</span> <span class="n">AM572x</span> <span class="o">-</span> <span class="n">GP</span> <span class="n">evm</span> <span class="p">(</span><span class="n">older</span> <span class="n">Aptina</span> <span class="n">MT9T11</span> <span class="n">camera</span> <span class="n">is</span> <span class="n">never</span> <span class="n">supported</span><span class="p">).</span>
<span class="o">*</span> <span class="n">Starting</span> <span class="n">from</span> <span class="n">Processor</span> <span class="n">SDK</span> <span class="mf">3.2</span> <span class="n">release</span><span class="p">,</span> <span class="n">osd101t2587</span> <span class="n">lcd</span> <span class="n">panel</span> <span class="n">is</span> <span class="n">supported</span> <span class="p">(</span><span class="k">new</span> <span class="n">part</span><span class="p">)</span> <span class="n">along</span> <span class="n">with</span> <span class="n">osd101t2045</span> <span class="n">lcd</span> <span class="n">panel</span> <span class="p">(</span><span class="n">old</span> <span class="n">part</span><span class="p">)</span> <span class="n">on</span> <span class="n">idkAM572x</span>
  <span class="n">and</span> <span class="n">idkAM571x</span> <span class="n">boards</span> <span class="k">for</span> <span class="n">all</span> <span class="n">display</span> <span class="n">subsystem</span> <span class="n">examples</span><span class="p">.</span>
<span class="o">*</span> <span class="n">The</span> <span class="n">bare</span> <span class="n">metal</span> <span class="n">examples</span> <span class="n">are</span> <span class="n">added</span> <span class="n">starting</span> <span class="n">from</span> <span class="n">Processor</span> <span class="n">SDK</span> <span class="mf">4.0</span> <span class="n">release</span>
<span class="o">*</span> <span class="n">Some</span> <span class="n">of</span> <span class="n">the</span> <span class="n">clocks</span> <span class="n">such</span> <span class="n">as</span> <span class="mi">32</span><span class="n">KHz</span> <span class="n">Sync</span> <span class="n">clock</span> <span class="n">are</span> <span class="n">directly</span> <span class="n">tied</span> <span class="n">to</span> <span class="n">A15</span> <span class="n">core</span> <span class="n">and</span> <span class="n">need</span> <span class="n">that</span> <span class="n">core</span> <span class="n">to</span> <span class="n">be</span> <span class="n">running</span><span class="p">.</span> <span class="n">Hence</span> <span class="k">while</span> <span class="n">testing</span> <span class="n">the</span> <span class="n">code</span> <span class="n">on</span> <span class="n">other</span> <span class="n">cores</span>
  <span class="n">such</span> <span class="n">as</span> <span class="n">DSP</span><span class="o">/</span><span class="n">IPU</span><span class="p">,</span> <span class="n">please</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">to</span> <span class="n">disconnect</span> <span class="n">the</span> <span class="n">ARM</span> <span class="n">core</span> <span class="n">after</span> <span class="n">connecting</span> <span class="n">the</span> <span class="n">ARM</span> <span class="n">core</span> <span class="o">&amp;</span> <span class="n">running</span> <span class="n">the</span> <span class="n">GEL</span> <span class="n">files</span> <span class="n">to</span> <span class="n">enable</span> <span class="n">the</span> <span class="n">other</span> <span class="n">cores</span> <span class="n">and</span> <span class="n">before</span>
  <span class="n">loading</span> <span class="n">the</span> <span class="n">executable</span> <span class="n">on</span> <span class="n">that</span> <span class="n">core</span><span class="p">.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id264">
<h2>6.32.4. Additional References<a class="headerlink" href="#id264" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\vps\docs\doxygen\html\index.
html</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="building-vps-examples">
<h2>6.32.5. Building VPS examples<a class="headerlink" href="#building-vps-examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>VPS examples and dependent libraries are built from the top level pdk
makefile after the environment setup is done using the
pdksetupenv.sh(bat) file.</p></li>
<li><p>cd &lt;pdk&gt;/packages</p></li>
<li><p>pdksetupenv.bat (sh)</p></li>
<li><p>make vps  : to build vps examples under <strong>&lt;pdk&gt;/ti/packages/binary</strong>
folder</p></li>
<li><p>make vps_clean : to clean the vps and vps examples.</p></li>
</ul>
</div>
<div class="section" id="vps-examples">
<h2>6.32.6. VPS examples<a class="headerlink" href="#vps-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="display-dss-example">
<h3>6.32.6.1. Display DSS Example<a class="headerlink" href="#display-dss-example" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="id265"><em>Description</em></p>
<p>The example exploits the DISPC (Display Controller) and LCD/HDMI outputs
available in the SoC. When run, the test outputs multiple options to
select between to demonstrate the various capacity of the display
subsystem. There is also option to select “Auto Run”, when selected runs
all the tests in sequential manner. The example works on outputing a
pre-loaded video frames of YUV422I and BGR888 formats to DP1, DP2 and
DP3 parallel interfaces and also to HDMI output observed on TV set, from
VID1, VID2, VID3 and GFX pipelines. The example also demonstrates
displaying videos combined from GFX and other VID pipelines to DPI1 LCD
output. The example is also enhanced to show the display controler
scaling features. Test that exploits the scalar unit to show all
possible allowed scaling. Maximum scaling ratio supported is the ratio
of the dss functional clock / pixel clk. Please refer to section
“11.2.4.10.4.2 DISPC Scaling limitations” of AM57x Technical Reference
manual for minimum ratio allowed when using the scalar unit.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="running-the-display-dss-example"><strong>Running the Display DSS example</strong></p>
<p><strong>Configuring Display</strong>:</p>
<ul class="simple">
<li><p>Make sure the LCD panel is connected to the base EVM before running
the example binary.</p></li>
<li><p>Make sure the HDMI is connected to TV from the EVM for HDMI display
options.</p></li>
<li><p>For AM571x IDK EVM, installing a shunt on header J51 to short those
pins</p></li>
</ul>
<p><strong>CCS connection</strong>:</p>
<ul class="simple">
<li><p>Load the generated executable file in CCS</p></li>
<li><p>Run the application, Select any of the option and load the buffer as
suggested.</p></li>
<li><p>Content will be displayed on the LCD panel or HDMI TV connected to
EVM for test options</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Test Input files for Display Sample application will be in
“&lt;pdk&gt;drvvpsdocstest_inputsdss_input_files.rar”</p></li>
</ul>
</div>
<p>The rar file can be unrar-ed to get the test files using utilities such
as <a class="reference external" href="http://www.7-zip.org">http://www.7-zip.org</a> Please download the latest version of 7-zip from
this website. The command to unrar is: 7z x {file_to_unrar}</p>
<p>When the test program expects the yuyv422 file, please load
<strong>display_yuyv422_prog_packed_1920_1080.tigf</strong> file and when the test
program expects the bgr888 file, please load
<strong>display_gbr888_prog_packed_1920_1080.tigf</strong> file. Each video has 4
frames. Below shows the first frame. If GP EVM is used, only the left
upper corner of the video is displayed as it only has an 800x480 LCD.</p>
<img alt="../_images/488px-Yuyv422.png" src="../_images/488px-Yuyv422.png" />
<img alt="../_images/488px-Gbr888.png" src="../_images/488px-Gbr888.png" />
<p>The test runs bunch of test cases as shown in the test example menu.</p>
<p><strong>Warning</strong> : Due to A15 MMU protection, memory load while CPU is
running is not possible. Hence below workaround needs to be done for
loading the test files.</p>
<ol class="arabic simple">
<li><p>Power up the board</p></li>
<li><p>Connect to A15 Core</p></li>
<li><p>Load both tigf files into memory</p></li>
<li><p>Do a CPU reset on A15</p></li>
<li><p>Load example code for core type</p></li>
<li><p>Run example code</p></li>
</ol>
</div>
<div class="section" id="display-dss-wb-example">
<h3>6.32.6.2. Display DSS WB example<a class="headerlink" href="#display-dss-wb-example" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="description-1"><em>Description</em></p>
<p>The WB pipeline allows the use of the hardware processing available
inside the DISPC, such as color space conversion, rescaling, and
compositing to perform memory-to-memory transfer with data processing or
capturing a displayed frame.</p>
<p class="rubric" id="running-display-dss-wb-example"><em>Running Display DSS WB example</em></p>
<p>The test connection and procedure for this example is very much same as
the running the Display DSS example. In this example, the display output
that is sent to the output is captured and sent to the WriteBack
pipeline.</p>
<p class="rubric" id="loopback-capture-and-display-example"><strong>Loopback (Capture and Display) example</strong></p>
<p class="rubric" id="description-2"><em>Description</em></p>
<p>This is the capture and display example that demonstrates the VIP
captures functions for the devices. VIP incorporates a multi-channel raw
video parser, various video processing blocks, and a flexible Video Port
Direct Memory Access (VPDMA)engine to store incoming video in various
formats. This example demonstrates the video capture of 720P, YUY422
format from the camera sensor (OV2659 for idkAM57x and OV1063x for
evmAM572x) to DPI1 LCD output.</p>
<p class="rubric" id="running-loopback-example"><em>Running Loopback example</em></p>
<ul class="simple">
<li><p>Make sure OV sensor and LCD Panel is connected to to the board before
running the binary.</p></li>
</ul>
<p><strong>CCS connection</strong>:</p>
<ol class="arabic simple">
<li><p>Power up the board</p></li>
<li><p>Connect to the Core</p></li>
<li><p>Run the application, Select any of the option.</p></li>
<li><p>Captured Content will be displayed on the LCD panel connected to EVM</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The camera driver support is not added for
evmAM572x boards (GP AM572x EVM) - and hence all the tests related to
camera are skipped for evmAM572x board.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id266">
<h2>6.32.7. FAQ<a class="headerlink" href="#id266" title="Permalink to this headline">¶</a></h2>
<p class="rubric" id="how-to-reduce-the-vps-test-examples-build-time-using-makefile">How to reduce the VPS test examples build time using
makefile?</p>
<p>Please refer to <a class="reference external" href="index_how_to_guides.html#rebuild-drivers-from-pdk-directory">Rebuilding The PDK</a>
on how to invoke the build for specific core and specific platform, to save the
build time.</p>
<p class="rubric" id="how-to-create-a-ccs-project-other-than-vps-loopback-example">How to create a CCS project other than VPS loopback
example?</p>
<p>To create a CCS project for other VPS examples, please use the existing
text file under
PDK_INSTALL_PATHpackagestidrvvpsexamplesccsprojectsam57xxbios as
a template:</p>
<ul class="simple">
<li><p>Copy the .txt with desired processor then rename it to a new test
project name accord to CCS project create convention, see
<a class="reference external" href="index_how_to_guides.html#pdk-example-and-test-project-creation">PDK Example and Test Project Creation</a></p></li>
<li><p>Update the linked source files and include paths</p></li>
<li><p>The common configuration file and build options can be kept</p></li>
<li><p>Update pre-defined symbol -D&lt;soc_name&gt; to match your SOC, like
-DSOC_AM571x, -DSOC_AM572x or -DSOC_AM574x</p></li>
<li><p>Update the configuration .bld file “-b
${PDK_INSTALL_PATH}/ti/build/&lt;soc&gt;/config_&lt;soc&gt;_&lt;core&gt;.bld” to match
your soc</p></li>
<li><p>In rtsc.setConfiguroOptions, add -DBOARD=&lt;board_name&gt;, which can be
idkAM571x, idkAM572x, evmAM572x or idkAM574x</p></li>
<li><p>Save the file and re-run pdkProjectCreate to create the new added CCS
project</p></li>
</ul>
<p>Below is example for vps_dssExample_evmAM572x_armExampleProject.txt:</p>
<p><code class="docutils literal notranslate"><span class="pre">-ccs.linkFile</span> <span class="pre">&quot;PDK_INSTALL_PATH/ti/drv/vps/examples/dss/displayDss/src/DisplayDss_main.c&quot;</span></code></p>
<p>-ccs.linkFile
“PDK_INSTALL_PATH/ti/drv/vps/examples/ccsprojects/common/bios/utils/bspCommonBIOS_a15.cfg”</p>
<p>-ccs.setCompilerOptions “-c -mcpu=cortex-a15 -mtune=cortex-a15 -marm
-mfloat-abi=hard -DMAKEFILE_BUILD -DNDEBUG -DTRACE_ENABLE
-DASSERT_ENABLE -DVPS_VIP_BUILD -DVPS_VPE_BUILD -DVPS_DSS_BUILD
-UVPS_ISS_BUILD -UVPS_SIMCOP_BUILD -UVPS_ISS_ISP_DEF -DVPS_VIP1_BUILD
-DVPS_VIP2_BUILD -DVPS_VIP3_BUILD -DVPS_CAPT_BUILD -DVPS_DISP_BUILD
-DSOC_AM572x -Dxdc_target_types__=gnu/targets/arm/std.h
-Dxdc_target_name__=A15F -g -gstrict-dwarf -gdwarf-3 -Wimplicit -Wall
-Wunused -Wunknown-pragmas -ffunction-sections -fdata-sections -MMD -MP
-I${PDK_INSTALL_PATH}/ti/drv/vps
-I${PDK_INSTALL_PATH}/ti/drv/vps/examples/dss/displayDss/src”
-rtsc.enableRtsc</p>
<p>-ccs.setLinkerOptions ” -lrdimon -lgcc -lm -lnosys -nostartfiles -static
-Wl,–gc-sections
-L$(BIOS_INSTALL_PATH)/packages/gnu/targets/arm/libs/install-native/arm-none-eabi/lib/fpu
” -rtsc.setConfiguroOptions “-b
${PDK_INSTALL_PATH}/ti/build/am572x/config_am572x_a15.bld
-DBOARD=evmAM572x”</p>
<p class="rubric" id="can-i-load-any-jpeg-file-into-the-memory-to-display-through-dss">Can I load any jpeg file into the memory to display through
DSS?</p>
<p>The display uses video, not static image as input. There is no JPEG
decoder so it will not work.</p>
<p class="rubric" id="in-dss-example-two-input-video-files-are-loaded-for-testing-what-is-their-format-and-how-to-play-them">In DSS example, two input video files are loaded for
testing, what is their format and how to play them?</p>
<p>The two files are with .tigf extension. Tigf is a local convention that
TI development team followed. The file name (before the extension) shows
what you are attempting to decode: e.g., 24 bit RGB or yuyv422 video
file with 1920x1080 resolutions. To play them:</p>
<ul class="simple">
<li><p>In Linux, use avplay with syntax: avplay -video_size &lt;wxh&gt;
-pixel_format &lt;format&gt; -f rawvideo &lt;video file&gt;, where wxh is
1902x1080 and pixel_format is rgb24 or yuyv422</p></li>
<li><p>In Windows, use yuv player from:
<a class="reference external" href="https://sourceforge.net/projects/raw-yuvplayer/">https://sourceforge.net/projects/raw-yuvplayer/</a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="iolink">
<h1>6.33. IOLINK<a class="headerlink" href="#iolink" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id267">
<h2>6.33.1. Overview<a class="headerlink" href="#id267" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id268">
<h3>6.33.1.1. Introduction<a class="headerlink" href="#id268" title="Permalink to this headline">¶</a></h3>
<p>The IO-LINK Master driver provides an interface to any IO-Link devices
(sensors or actuators) accessible via a half-duplex UART serial bus on
SoC. It also provides a well-defined API layer which allows applications
(IO-Link master stack) to manage IO-Link devices via simple portable APIs.</p>
<p>The driver supports the following major functionalities:</p>
<ul class="simple">
<li><p>Standard APIs to initialize/de-initialize/control the common Software
IP driver</p></li>
<li><p>Configuration/Control of the PRU Frame Handler firmware to handle the
messages transferred between the IO-Link master and device</p></li>
<li><p>Timer/Interrupt driven IO-Link communication between IO-Link master and
device to meet the timing requirement of IO-Link master protocol</p></li>
</ul>
<p>In addition a sample IO-Link master stack interface layer is provided in
the IO-Link master demo application to provide an interface between the
IO-Link master stack and the driver.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The stack interface layer should be ported to integrate a new master
stack.</p>
</div>
<p class="rubric" id="id269">Firmware</p>
<p>TI PRU-ICSS cores (Programmable Real-Time Unit Industrial Communication
Subsystem) is firmware programmable and can take on various
personalities. Processor SDK package includes IOLINK Firmware support.
Refer <a class="reference external" href="index_pru_icss_fw.html#pru-icss-iolink">IOLINK Frame Handler FW</a> for
additional details.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id270">
<h2>6.33.2. User Interface<a class="headerlink" href="#id270" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id271">
<h3>6.33.2.1. Driver Configuration<a class="headerlink" href="#id271" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="id272"><strong>Board Specific Configuration</strong></p>
<p>All the board specific configurations eg:enabling and pin-mux of IO-Link
PRU pins should be performed before calling any driver APIs. By default
Board_Init() API supports all initialization sequence for TI supported
EVMs. Refer <a class="reference external" href="index_board.html#board-support">Processor SDK RTOS Board
Support</a> for additional
details.</p>
<p>Once the board specific configuration is complete driver API IOLINK_init()
can be called to initialize driver</p>
<p class="rubric" id="iolink-configuration-structure"><strong>IOLINK Configuration Structure</strong></p>
<p>IOLINK_soc.c file binds driver with hardware attributes on the board
through IOLINK_config structure. This structure must be provided to IOLINK
driver. It must be initialized before the IOLINK_init() function is called
and cannot be changed afterwards. For details about the individual
fields of this structure, see the Doxygen help by opening
PDK_INSTALL_DIR\packages\ti\drv\iolink\docs\doxygen\html\index.html.</p>
</div>
<div class="section" id="id273">
<h3>6.33.2.2. APIs<a class="headerlink" href="#id273" title="Permalink to this headline">¶</a></h3>
<p>API reference for application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/drv/iolink/IOLINK.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p> Sample code for IOLINK control operation:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">IOLINK_socGetFwCfg</span><span class="p">(</span><span class="n">peripheralNum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iolink_cfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">IOLINK_socSetFwCfg</span><span class="p">(</span><span class="n">peripheralNum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iolink_cfg</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">IOLINK_init</span><span class="p">();</span>
<span class="p">...</span>
<span class="n">iolinkHandle</span> <span class="o">=</span> <span class="n">IOLINK_open</span><span class="p">(</span><span class="n">peripheralNum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iolinkParams</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">IOLINK_control</span><span class="p">(</span><span class="n">iolinkHandle</span><span class="p">,</span> <span class="n">iolinkCmd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iolinkCmdArg</span><span class="p">);</span>
<span class="p">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id274">
<h2>6.33.3. Application<a class="headerlink" href="#id274" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id275">
<h3>6.33.3.1. Examples<a class="headerlink" href="#id275" title="Permalink to this headline">¶</a></h3>
<p>Refer Release Note for IOLINK support across different EVMs</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 40%" />
<col style="width: 12%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">Name</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Description</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Expected Results</div>
</div>
</th>
<th class="head"><p>SoC Supported</p></th>
<th class="head"><p>Build Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>IOLINK_Stack
Example application</p></td>
<td><div class="line-block">
<div class="line">Demo stack example
to control 4 Autosen
AO001 (sensor) and 4
AD003 (actuator)
devices</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Following prints will come on console
based on devices connected to the master:</div>
<div class="line">autosen gmbh device AO001 connected on port 0</div>
<div class="line">autosen gmbh device AO001 detected an object</div>
<div class="line">autosen gmbh device AD003 connected on port 1</div>
<div class="line">autosen gmbh device AD003 display turned on</div>
</div>
</td>
<td><p>AM437x
(TIDA-010016)</p></td>
<td><p>makefile</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>IOLINK demo example application uses 4 Autosen sensor devices and 4
Autosen actuator devices. It pairs one sensor with one actuator
when the devices are connected. If a sensor detects an object, it
controls the paired acutator to turn on the display on the actuator.
If the sensor does not detect an object, it controls the paired
actuator to turn off the display.</p>
</div>
</div>
</div>
<div class="section" id="building-iolink-example">
<h2>6.33.4. Building IOLINK example<a class="headerlink" href="#building-iolink-example" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Makefile based examples and dependent libraries can be built from
the top level or module level IOLINK makefile, refer to the
<a class="reference external" href="index_overview.html#setup-environment">Processor SDK RTOS Getting Started Guide</a>
for details of how to setup the build environment. Once you have
setup the build environment, issue the following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">To</span> <span class="n">build</span> <span class="n">and</span> <span class="n">clean</span> <span class="n">libs</span><span class="o">/</span><span class="n">apps</span> <span class="n">from</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="nl">makefile</span><span class="p">:</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span>
<span class="n">make</span> <span class="n">iolink</span>
<span class="n">make</span> <span class="n">iolink_clean</span>

<span class="n">To</span> <span class="n">build</span> <span class="n">and</span> <span class="n">clean</span> <span class="n">libs</span><span class="o">/</span><span class="n">apps</span> <span class="n">from</span> <span class="n">module</span><span class="o">-</span><span class="n">level</span> <span class="nl">makefile</span><span class="p">:</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">drv</span><span class="o">/</span><span class="n">iolink</span>
<span class="n">make</span> <span class="n">all</span>
<span class="n">make</span> <span class="n">clean</span>
</pre></div>
</div>
</div>
<div class="section" id="id276">
<h2>6.33.5. Additional References<a class="headerlink" href="#id276" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>API Reference Manual</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\iolink\docs\doxygen\html\index.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti
\drv\iolink\docs\ReleaseNotes_IOLINK_LLD.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="osal">
<h1>6.34. OSAL<a class="headerlink" href="#osal" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id277">
<h2>6.34.1. Overview<a class="headerlink" href="#id277" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id278">
<h3>6.34.1.1. Introduction<a class="headerlink" href="#id278" title="Permalink to this headline">¶</a></h3>
<p>The OSAL library provides operating system abstraction layer API sample
implementations that are required for processor SDK drivers. Scope of
APIs supported in the module is limited to support OS services required
for RTOS or bare metal drivers</p>
<ul class="simple">
<li><p>Supported Operating Systems</p>
<ul>
<li><p>TIRTOS</p></li>
<li><p>NONOS</p></li>
</ul>
</li>
<li><p>Supported SOCs</p>
<ul>
<li><p>Please refer to component release notes</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="operating-system-extension">
<h2>6.34.2. Operating System Extension<a class="headerlink" href="#operating-system-extension" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id279">
<h3>6.34.2.1. APIs<a class="headerlink" href="#id279" title="Permalink to this headline">¶</a></h3>
<p>Porting of OSAL component will enable extending PDK components to
additional OS environment. Reference top level API header file
includes:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/osal/osal.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="application-integration-details">
<h2>6.34.3. Application Integration Details<a class="headerlink" href="#application-integration-details" title="Permalink to this headline">¶</a></h2>
<p><strong>Baremetal or No-OS Use case</strong></p>
<p>Reference library path to be included in application build environment:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">ti</span><span class="o">/</span><span class="n">osal</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">nonos</span><span class="o">/</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="o">/</span><span class="p">[[</span><span class="n">cpu</span><span class="p">]</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p><strong>SysBIOS based application</strong></p>
<p>Any RTSC application that needs to use osal library, should have below
RTSC configuration lines before any other processor sdk components
(e.g., board, gpio, uart etc).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>/* set the operating system type,
 * supported types are &quot;tirtos&quot; and &quot;nonos&quot;
 */
var osType           = &quot;tirtos&quot;;

/* set the soc type
 * (applicable only when osTYpe
 *  is &quot;nonos&quot; only)
*/
var socType           = &quot;am572x&quot;;

/* Setup the OSAL Library */
var Osal = xdc.loadPackage(&#39;ti.osal&#39;);
Osal.Settings.osType  = osType;
Osal.Settings.socType = socType;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id280">
<h2>6.34.4. Application<a class="headerlink" href="#id280" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id281">
<h3>6.34.4.1. Examples<a class="headerlink" href="#id281" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="sysbios-example">Sysbios Example</p>
<p>This sysbios example OSAL_BasicExample_&lt;board&gt;_&lt;coretype&gt;TestProject
tests Hwi, Timer, Delay, Semaphores etc and prints output on UART
console.</p>
<p class="rubric" id="id282">Introduction</p>
<p>This sysbios based example tests Hwi, Timer, Semaphores etc.</p>
<p class="rubric" id="supported-platforms">Supported platforms</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">evmAM335x</span>
<span class="n">evmAM437x</span>
<span class="n">idkAM571x</span>
<span class="n">idkAM574x</span>
<span class="n">evmAM572x</span>
<span class="n">evmK2G</span>
<span class="n">evmK2H</span>
<span class="n">evmOMAPL137</span>
<span class="n">lcdkOMAPL138</span>
<span class="n">am65xx_evm</span>
<span class="n">am65xx_idk</span>
</pre></div>
</div>
<p class="rubric" id="build-instructions">Build instructions</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Run</span> <span class="n">pdkProjectCreate</span> <span class="n">to</span> <span class="n">create</span> <span class="n">the</span> <span class="n">OSAL_BasicExample_</span><span class="o">&lt;</span><span class="n">evm</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">device</span><span class="o">&gt;</span><span class="n">TestProject</span>
<span class="n">Load</span> <span class="n">the</span> <span class="n">project</span> <span class="n">on</span> <span class="n">to</span> <span class="n">CCS</span> <span class="n">and</span> <span class="n">build</span> <span class="n">the</span> <span class="n">same</span><span class="p">.</span>
<span class="n">Build</span> <span class="n">the</span> <span class="n">example</span>
<span class="n">Load</span> <span class="n">the</span> <span class="n">OSAL_BasicExample_</span><span class="o">&lt;</span><span class="n">evm</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">device</span><span class="o">&gt;</span><span class="n">TestProject</span>
<span class="n">Run</span> <span class="n">the</span> <span class="n">example</span>
</pre></div>
</div>
<p class="rubric" id="id283">Testing the example</p>
<p>The output for each of the tests (Hwi, Timer, Delay, Semaphores etc) can
be seen on the UART console. After a successful run, “All tests have
PASSED” will be displayed on the screen.</p>
<p class="rubric" id="baremetal-example">Baremetal Example</p>
<p class="rubric" id="id284">Introduction</p>
<p>This baremetal example ‘osal_baremetal_test’ tests Hwi, Timer,
Semaphores etc and prints output on UART console.</p>
<p class="rubric" id="supported-platforms-1">Supported platforms</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">evmAM572x</span>
<span class="n">evmAM335x</span>
<span class="n">evmAM437x</span>
<span class="n">evmDRA72x</span>
<span class="n">evmDRA75x</span>
<span class="n">evmDRA78x</span>
<span class="n">iceK2G</span>
<span class="n">idkAM574x</span>
<span class="n">idkAM572x</span>
<span class="n">idkAM571x</span>
<span class="n">idkAM437x</span>
<span class="n">am65xx_evm</span>
<span class="n">am65xx_idk</span>
</pre></div>
</div>
<p class="rubric" id="build-instructions-1">Build instructions</p>
<p>OSAL tests are built using makefiles. The below steps are used to build
the baremetal test binaries.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">pdk_</span><span class="o">&lt;</span><span class="n">ver</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span>
<span class="n">Run</span> <span class="n">pdksetupenv</span><span class="p">.</span><span class="n">bat</span>
<span class="n">Run</span> <span class="s">&quot;make osal&quot;</span>
<span class="n">Find</span> <span class="n">the</span> <span class="n">executable</span> <span class="n">at</span> <span class="n">ti</span><span class="o">/&lt;</span><span class="n">pdk</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">binary</span><span class="o">/</span><span class="n">osal_baremetal_test</span><span class="o">/</span><span class="n">bin</span>
<span class="n">Load</span> <span class="n">the</span> <span class="n">executable</span> <span class="n">on</span> <span class="n">the</span> <span class="n">board</span>
<span class="n">Before</span> <span class="n">running</span> <span class="n">the</span> <span class="n">executable</span><span class="p">,</span> <span class="n">please</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">you</span> <span class="n">have</span> <span class="n">the</span> <span class="n">UART</span> <span class="n">connected</span> <span class="n">and</span> <span class="n">notice</span> <span class="n">the</span> <span class="n">test</span> <span class="n">output</span> <span class="n">on</span> <span class="n">the</span> <span class="n">UART</span> <span class="n">console</span><span class="p">.</span> <span class="n">Osal</span> <span class="n">prints</span> <span class="n">out</span> <span class="n">the</span> <span class="n">results</span> <span class="n">there</span><span class="p">.</span>
</pre></div>
</div>
<p class="rubric" id="testing-the-example-1">Testing the example</p>
<p>The output for each of the tests (Hwi, Timer, Delay, Semaphores, etc)
can be seen on the UART console. After a successful run, “All tests have
passed” will be displayed on the screen.</p>
<p class="rubric" id="output">Output</p>
<p>The output of osal example looks like below. The below sample output is
from idkAM571x on the UART console.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">HWI</span> <span class="n">tests</span> <span class="n">have</span> <span class="n">passed</span><span class="p">.</span>
<span class="nl">TimerTestLog</span><span class="p">:</span> <span class="n">got</span> <span class="mi">100</span> <span class="n">ticks</span> <span class="n">from</span> <span class="n">timer</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nl">TimerTestLog</span><span class="p">:</span> <span class="n">got</span> <span class="mi">100</span> <span class="n">ticks</span> <span class="n">from</span> <span class="n">timer</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Timer</span> <span class="n">tests</span> <span class="n">have</span> <span class="n">passed</span><span class="p">.</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Running</span> <span class="n">Osal_Delay</span> <span class="nl">test</span><span class="p">:..........</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Osal_Delay</span> <span class="n">tests</span> <span class="n">have</span> <span class="n">passed</span><span class="p">.</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Clock</span> <span class="n">tests</span> <span class="n">have</span> <span class="n">passed</span><span class="p">.</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Semaphore</span> <span class="n">tests</span> <span class="n">have</span> <span class="n">passed</span><span class="p">.</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Semaphore</span> <span class="nl">Statistics</span><span class="p">:</span>
<span class="n">PeakSemObjs</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="n">numMaxSemObjs</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="n">numFreeSemObjs</span> <span class="o">=</span> <span class="mi">97</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Hwi</span> <span class="nl">Statistics</span><span class="p">:</span>
<span class="n">PeakHwiObjs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="n">numMaxHwiObjs</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="n">numFreeHwiObjs</span> <span class="o">=</span> <span class="mi">98</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Timer</span> <span class="nl">Statistics</span><span class="p">:</span>
<span class="n">PeakTimerObjs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="n">numMaxTimerObjs</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="n">numFreeTimerObjs</span> <span class="o">=</span> <span class="mi">99</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">All</span> <span class="n">tests</span> <span class="n">have</span> <span class="n">passed</span><span class="p">.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id285">
<h2>6.34.5. Additional References<a class="headerlink" href="#id285" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 79%" />
</colgroup>
<tbody>
<tr class="row-odd"><td colspan="2"><p><strong>Operating System Abstraction Layer Library Summary</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>Component Type</strong></p></td>
<td><p><strong>Library</strong></p></td>
</tr>
<tr class="row-odd"><td><p>Install Package</p></td>
<td><p>PDK</p></td>
</tr>
<tr class="row-even"><td><p>Install Directory</p></td>
<td><p>pdk_AMX_&lt;version&gt;\packages\ti\osal</p></td>
</tr>
<tr class="row-odd"><td><p>Project Type</p></td>
<td><p><a class="reference external" href="http://www.eclipse.org/rtsc/">Eclipse RTSC</a></p></td>
</tr>
<tr class="row-even"><td><p>Endian Support</p></td>
<td><p>Little</p></td>
</tr>
<tr class="row-odd"><td><p>Linker Path</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti\osal</p></td>
</tr>
<tr class="row-even"><td><p>Linker Sections</p></td>
<td><p>.vecs , .switch, .args, .cio</p></td>
</tr>
<tr class="row-odd"><td><p>Include Paths</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti\osal</p></td>
</tr>
<tr class="row-even"><td><p>Reference Guides</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti\osal\docs\doxygen\html\index.html</p></td>
</tr>
<tr class="row-odd"><td><p>Release Notes</p></td>
<td><p>$(TI_PDK_INSTALL_DIR)\packages\ti\osal\docs\ReleaseNotes_OSAL.pdf</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="profiling">
<h1>6.35. Profiling<a class="headerlink" href="#profiling" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id286">
<h2>6.35.1. Overview<a class="headerlink" href="#id286" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id287">
<h3>6.35.1.1. Introduction<a class="headerlink" href="#id287" title="Permalink to this headline">¶</a></h3>
<p>The profiling library can be used to profile any of the Platform
Development Kit components at the runtime. Feature enables reporting of
cpu cycles measurement for PDK driver components in order to analyze and
meet constraint requirement for a real time application. Profiling
module uses hardware clock of PMU to measure length of each task in
processor cycles with minimal overhead. It use standard C programming
hooks that may be adapted for any platform and/or processor
architecture.</p>
</div>
</div>
<div class="section" id="integration">
<h2>6.35.2. Integration<a class="headerlink" href="#integration" title="Permalink to this headline">¶</a></h2>
<p><strong>Baremetal or No-OS Use case</strong></p>
<p>Reference Utils library path to be included in application build
environment.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">l</span> <span class="o">&lt;</span><span class="n">ti</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">profiling</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>Reference lld library path to be included.(Replace profile suffix
library with original one)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">l</span> <span class="o">&lt;</span><span class="n">ti</span><span class="o">/</span><span class="n">drv</span><span class="o">/</span><span class="n">uart</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="o">/</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span><span class="o">/</span><span class="n">lld</span><span class="p">.</span><span class="n">profiling</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">l</span> <span class="s">&quot;ti/utils/profiling/lib/armv7/ti.utils.profiling.aa15fg&quot;</span> <span class="o">-</span><span class="n">l</span> <span class="s">&quot;ti/drv/uart/lib/armv7/ti.drv.uart.profiling.aa15fg&gt;</span>
</pre></div>
</div>
<p><strong>SysBIOS based application</strong></p>
<p>Refer *.cfg of Uart test application for sample implementation</p>
<ol class="arabic simple">
<li><p>Load utils package.</p></li>
</ol>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>var Utils = xdc.loadPackage(&#39;ti.utils.profiling&#39;);
</pre></div>
</div>
<p>2. Set the ‘enableProfiling’ attribute to ‘true’ into the .cfg file.
This will load library with profiling enabled</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>var Uart = xdc.loadPackage(&#39;ti.drv.uart’);
Uart.Settings.enableProfiling = true;
</pre></div>
</div>
<p>3. Enable DDR3 memory, if not already enabled in test/example
application</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Program</span><span class="p">.</span><span class="n">sectMap</span><span class="p">[</span><span class="s">&quot;.fardata:benchmarking&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;DDR3&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>4. Add following line in .cfg if it does not exist already. Enable the
Task hooks for Task switches.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>var Task = xdc.useModule(&#39;ti.sysbios.knl.Task&#39;);

Task.addHookSet({
registerFxn: &#39;&amp;TaskRegisterId&#39;,
switchFxn: &#39;&amp;mySwitch&#39;,
});
</pre></div>
</div>
<p><strong>Additional compiler flags</strong></p>
<ol class="arabic simple">
<li><p>For gcc compiler add</p></li>
</ol>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">gdwarf</span><span class="o">-</span><span class="mi">3</span> <span class="o">-</span><span class="n">finstrument</span><span class="o">-</span><span class="n">functions</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>For TI compiler add</p></li>
</ol>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">entry_parm</span><span class="o">=</span><span class="n">address</span> <span class="o">--</span><span class="n">exit_hook</span><span class="o">=</span><span class="n">ti_utils_exit</span> <span class="o">--</span><span class="n">exit_parm</span><span class="o">=</span><span class="n">address</span> <span class="o">--</span><span class="n">entry_hook</span><span class="o">=</span><span class="n">ti_utils_entry</span>
</pre></div>
</div>
<p>Reference: *project.txt inside UART test application</p>
</div>
<div class="section" id="rebuild-the-project">
<h2>6.35.3. Rebuild the project<a class="headerlink" href="#rebuild-the-project" title="Permalink to this headline">¶</a></h2>
<p class="rubric" id="profiling-processing">Profiling Processing</p>
<p>All LLD Test/DMATest projects located under “LLD/test/” has profiling
configuration enabled by default.</p>
<p>Load compiled program onto desired target and platform. Run program to a
desired logical point where profiling data needs to be collected</p>
<p>1. While program is at the break, open the Memory Browser (View &gt; Memory
Browser).</p>
<p>2. Save a memory snapshot by clicking “Save”, setting the start address
to “elemlog” and length to “log_idx*4”. (It is preferred to save it into
ti .dat format.)</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="profiling-post-processing">Profiling Post-processing</p>
<p><strong>Host Environment:Windows or Ubuntu</strong> <strong>Tools dependencies:</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Tools</p></th>
<th class="head"><p>Download</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>python 2.7</p></td>
<td><p><a class="reference external" href="https://www.python.org/downloads/">https://www.python.org/downloads/</a></p></td>
</tr>
<tr class="row-odd"><td><p>pyelftools</p></td>
<td><p><a class="reference external" href="https://github.com/eliben/pyelftools">https://github.com/eliben/pyelftools</a></p></td>
</tr>
<tr class="row-even"><td><p>tabulate</p></td>
<td><p><a class="reference external" href="https://pypi.python.org/pypi/tabulate">https://pypi.python.org/pypi/tabulate</a></p></td>
</tr>
<tr class="row-odd"><td><p>XlsxWriter</p></td>
<td><p><a class="reference external" href="https://pypi.python.org/pypi/XlsxWriter#downloads">https://pypi.python.org/pypi/XlsxWriter#downloads</a></p></td>
</tr>
</tbody>
</table>
<p>(Follow the standard instruction for installing the tools from their
websites.)</p>
<p><strong>Running the script</strong></p>
<p>Open a cmd/terminal &amp; set to the directory of the “decodeProfileDump.py”
Python script (typically under utils/profiling/scripts)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">decodeProfileDump</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">flags</span> <span class="p">[</span><span class="n">log</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">executable</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">decodeProfileDump</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">v</span> <span class="n">uart</span><span class="p">.</span><span class="n">dat</span> <span class="n">UART_BasicExample_k2h_armTestproject</span><span class="p">.</span><span class="n">out</span>
</pre></div>
</div>
<p><strong>Optional flags</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Flags</p></th>
<th class="head"><p>Response</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-v</p></td>
<td><p>Display verbose output</p></td>
</tr>
<tr class="row-odd"><td><p>–t</p></td>
<td><p>Breakdown function totals by
their reference sites</p></td>
</tr>
<tr class="row-even"><td><p>–x</p></td>
<td><p>Print the tabulated results into
a report.xlsx Excel file</p></td>
</tr>
<tr class="row-odd"><td><p>-csv</p></td>
<td><p>Print the tabulated results into
a report.csv file</p></td>
</tr>
<tr class="row-even"><td><p>-off N</p></td>
<td><p>Manual instrumentation offset of
N cycles, subtracted from each
function.</p></td>
</tr>
</tbody>
</table>
<p>(The instrumentation program already generates an offset from itself
that is subtracted from the function times. Use this flag only if there
is an additional offset you would like to subtract.)</p>
<p><strong>Report Fields</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Term</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Function</p></td>
<td><p>Name of instrumented function</p></td>
</tr>
<tr class="row-odd"><td><p>Referenced_By</p></td>
<td><p>Call site of instrumented
function</p></td>
</tr>
<tr class="row-even"><td><p>Total_Cycles</p></td>
<td><p>Inclusive/Exclusive processor
cycles elapsed for instrumented
function</p></td>
</tr>
<tr class="row-odd"><td><p>Average_Cycles</p></td>
<td><p>Processor cycles elapsed for
instrumented function per
reference</p></td>
</tr>
<tr class="row-even"><td><p>Total_Calls</p></td>
<td><p>Number of times instrumented
function is called</p></td>
</tr>
<tr class="row-odd"><td><p>Average_Calls</p></td>
<td><p>Number of times instrumented
function is called per reference</p></td>
</tr>
<tr class="row-even"><td><p>Iterations</p></td>
<td><p>Number of times instrumented
function was referenced</p></td>
</tr>
</tbody>
</table>
<p>(inclusive(inc): including the cycles of its child functions within,
exclusive(exc): excluding the cycles of its child functions.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remaining functions on the stack at last timestamp will be considered
closed.</p>
<p>BIOS functions are not accounted by instrumentation and will not appear
in the report.</p>
<p>Functions which are optimized out will not appear in the report eg.
empty/single-line functions, <a href="#id294"><span class="problematic" id="id295">ti_sysbios_</span></a>* functions etc.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="PRU_ICSS.html" class="btn btn-neutral float-right" title="7. PRU-ICSS Firmware" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Device_Drivers.html" class="btn btn-neutral" title="6. Device Drivers" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2019</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'06_01_00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>