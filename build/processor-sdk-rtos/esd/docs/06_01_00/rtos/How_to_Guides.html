

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10. How to Guides &mdash; Processor SDK RTOS Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Processor SDK RTOS Documentation" href="../index.html"/>
        <link rel="next" title="10.1. Target" href="index_how_to_guides.html"/>
        <link rel="prev" title="9.1. Template Application Workshop" href="index_examples_demos.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Processor SDK RTOS
          

          
          </a>

          
            
            
              <div class="version">
                06_01_00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Release_Specific.html">2. Release Specific</a></li>
<li class="toctree-l1"><a class="reference internal" href="Board_EVM_Abstration.html">3. Board/EVM Abstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Foundational_Components.html">4. Foundational Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="DSP_Software.html">5. DSP Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="Device_Drivers.html">6. Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="PRU_ICSS.html">7. PRU-ICSS Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="Compilers.html">8. Compilers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Examples_and_Demonstrations.html">9. Examples and Demonstrations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">10. How to Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html">10.1. Target</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#host">10.2. Host</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#evm-hardware-setup">10.3. EVM Hardware Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#taking-the-c66x-out-of-reset-with-linux-running-on-the-arm-a15">10.4. Taking the C66x Out Of Reset with Linux Running on the ARM A15</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-take-the-c66x-dsp-out-of-reset-with-linux-running-on-a15">10.4.1. How to take the C66x DSP out of reset with Linux running on A15</a></li>
<li class="toctree-l3"><a class="reference internal" href="#target-configuration">10.4.2. Target Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#host">10.4.2.1. Host</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setup">10.5. Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup-ccs-for-evm-and-processor-sdk-rtos">10.5.1. Setup CCS for EVM and Processor-SDK RTOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#update-environment-when-installing-to-a-custom-path">10.5.2. Update environment when installing to a custom path</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prevent-beaglebone-board-reset-on-jtag-connect">10.5.3. Prevent BeagleBone board reset on JTAG Connect</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rebuild-drivers-from-pdk-directory">10.5.4. Rebuild drivers from PDK directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#flashing-and-boot">10.6. Flashing and Boot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#flash-bootable-images-c66x-k2h-k2e-k2l-only">10.6.1. Flash bootable images (C66x, K2H/K2E/K2L only)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#porting">10.7. Porting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-custom-board-library-target-to-processor-sdk-rtos-makefiles">10.7.1. Adding Custom Board_Library Target to Processor SDK RTOS makefiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#processor-sdk-rtos-porting-guide-for-am571x-am570x-speed-grades">10.7.2. Processor SDK RTOS Porting Guide for AM571x/AM570x Speed Grades</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#system-integration">10.8. System Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-dsp-and-ipu-firmware-using-pdk-drivers-and-ipc-to-load-from-arm-linux-on-am57xx-devices">10.8.1. Create DSP and IPU firmware using PDK drivers and IPC to load from ARM Linux on AM57xx devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="#customizing-memory-map-for-creating-multicore-applications-on-am57xx-using-ipc">10.8.2. Customizing Memory map for creating Multicore Applications on AM57xx using IPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ipc-debugging-tools-and-techniques-on-am57xx">10.8.3. IPC Debugging Tools and Techniques on AM57xx</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">11. Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Documentation_Tarball.html">12. Documentation Tarball</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Processor SDK RTOS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>10. How to Guides</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-guides">
<h1>10. How to Guides<a class="headerlink" href="#how-to-guides" title="Permalink to this headline">Â¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="index_how_to_guides.html">10.1. Target</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#run-ipc-examples-on-am572x">10.1.1. Run IPC Examples on AM572x</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#dra7xx-am572xx-ipc-examples">10.1.1.1. DRA7xx/AM572xx IPC Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#run-ipc-examples-on-am65xx">10.1.2. Run IPC Examples on AM65XX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#am65xx-ipc-examples">10.1.2.1. AM65xx IPC Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#taking-the-c66x-out-of-reset-with-linux-running-on-the-arm-a15">10.1.3. Taking the C66x Out Of Reset with Linux Running on the ARM A15</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#how-to-take-the-c66x-dsp-out-of-reset-with-linux-running-on-a15">10.1.3.1. How to take the C66x DSP out of reset with Linux running on A15</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#target-configuration">10.1.3.2. Target Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#rtos-customization-using-an-external-input-to-trigger-an-interrupt-on-am57x">10.1.4. RTOS Customization: using an external input to trigger an interrupt on AM57x</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#hardware">10.1.4.1. Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#software">10.1.4.2. Software</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#application-software-development">10.1.4.3. Application software development</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#test">10.1.4.4. Test</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#run-applications-from-ddr-on-r5-cores">10.1.5. Run applications from DDR on R5 cores</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#run-bios-applications-from-ddr-on-r5">10.1.5.1. Run BIOS Applications from DDR on R5</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#run-baremetal-applications-from-ddr-on-r5">10.1.5.2. Run Baremetal Applications from DDR on R5</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index_how_to_guides.html#host">10.2. Host</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#setup">10.2.1. Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#setup-ccs-for-evm-and-processor-sdk-rtos">10.2.1.1. Setup CCS for EVM and Processor-SDK RTOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#update-environment-when-installing-to-a-custom-path">10.2.1.2. Update environment when installing to a custom path</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#prevent-beaglebone-board-reset-on-jtag-connect">10.2.1.3. Prevent BeagleBone board reset on JTAG Connect</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#rebuild-drivers-from-pdk-directory">10.2.1.4. Rebuild drivers from PDK directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#ti-rtos-basics">10.2.2. TI RTOS Basics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#ti-rtos-tips-tricks">10.2.2.1. TI RTOS Tips &amp; Tricks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#flashing-and-boot">10.2.3. Flashing and Boot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#flash-bootable-images-c66x-k2h-k2e-k2l-only">10.2.3.1. Flash bootable images (C66x, K2H/K2E/K2L only)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#porting">10.2.4. Porting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#adding-custom-board-library-target-to-processor-sdk-rtos-makefiles">10.2.4.1. Adding Custom Board_Library Target to Processor SDK RTOS makefiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#processor-sdk-rtos-porting-guide-for-am571x-am570x-speed-grades">10.2.4.2. Processor SDK RTOS Porting Guide for AM571x/AM570x Speed Grades</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#system-integration">10.2.5. System Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#create-dsp-and-ipu-firmware-using-pdk-drivers-and-ipc-to-load-from-arm-linux-on-am57xx-devices">10.2.5.1. Create DSP and IPU firmware using PDK drivers and IPC to load from ARM Linux on AM57xx devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#customizing-memory-map-for-creating-multicore-applications-on-am57xx-using-ipc">10.2.5.2. Customizing Memory map for creating Multicore Applications on AM57xx using IPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#ipc-debugging-tools-and-techniques-on-am57xx">10.2.5.3. IPC Debugging Tools and Techniques on AM57xx</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index_how_to_guides.html#evm-hardware-setup">10.3. EVM Hardware Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#am65x-evm">10.3.1. AM65x EVM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#evm-layout-and-key-components">10.3.1.1. EVM Layout and Key Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#minimum-hardware-setup-required-to-connect-to-evm">10.3.1.2. Minimum Hardware Setup Required to Connect to EVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#am65x-debug-software-setup">10.3.1.3. AM65x Debug Software Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#am572x-gp-evm-hardware-setup">10.3.2. AM572x GP EVM Hardware Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#tmdxidk5728-hardware-setup">10.3.3. TMDXIDK5728 Hardware Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#ak2gx-gp-evm-hardware-setup">10.3.4. 66AK2GX GP EVM Hardware Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#ak2g02-ice-evm-hardware-setup">10.3.5. 66AK2G02 ICE EVM Hardware Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id50">10.3.5.1. Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id51">10.3.5.2. EVM Layout and Key Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id52">10.3.5.3. Supported JTAG Debug Probes (Emulators)</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id53">10.3.5.4. Minimal EVM setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id57">10.3.5.5. CCS Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id60">10.3.5.6. Useful Resources and Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#evmk2e-hardware-setup-guide">10.3.6. EVMK2E Hardware Setup Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#hardware-setup">10.3.6.1. Hardware Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#dip-switch-and-bootmode-configurations">10.3.6.2. DIP Switch and Bootmode Configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#evm-k2e-how-to-guides">10.3.6.3. EVM K2E How To Guides</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#evmk2h-hardware-setup-guide">10.3.7. EVMK2H Hardware Setup Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id61">10.3.7.1. Hardware Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#bmc-in-field-update">10.3.7.2. BMC In-Field Update</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id67">10.3.7.3. DIP Switch and Bootmode Configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#connect-to-evmk2h-using-ccs">10.3.7.4. Connect to EVMK2H using CCS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#tmdsevm6657l-evm-hardware-setup-guide">10.3.8. TMDSEVM6657L EVM Hardware Setup Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#hardware-setup-overview">10.3.8.1. Hardware Setup Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#hardware-setup-steps">10.3.8.2. Hardware Setup Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#boot-mode-dip-switch-settings">10.3.8.3. Boot Mode Dip Switch Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#tmdxevm6670l-evm-hardware-setup">10.3.9. TMDXEVM6670L EVM Hardware Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id68">10.3.9.1. Hardware Setup Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id69">10.3.9.2. Hardware Setup Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id70">10.3.9.3. Boot Mode Dip Switch Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#tmdxevm6678l-evm-hardware-setup-guide">10.3.10. TMDXEVM6678L EVM Hardware Setup Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id71">10.3.10.1. Hardware Setup Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id72">10.3.10.2. Hardware Setup Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id73">10.3.10.3. Boot Mode Dip Switch Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#omap-l138-c6748-lcdk-hardware-setup">10.3.11. OMAP-L138/C6748 LCDK Hardware Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id74">10.3.11.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#linux-quick-start-guide">10.3.11.2. Linux Quick Start Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#connecting-the-lcdk-to-code-composer-studio">10.3.11.3. Connecting the LCDK to Code Composer Studio</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#omap-l137-c6747-evm-hardware-setup-guide">10.3.12. OMAP-L137/C6747 EVM Hardware Setup Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#setting-up-the-hardware">10.3.12.1. Setting up the Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#connecting-to-a-console-window">10.3.12.2. Connecting to a Console Window</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#connecting-to-ccs">10.3.12.3. Connecting to CCS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#am335x-ice-evm-hardware-setup">10.3.13. AM335x ICE EVM Hardware Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id79">10.3.13.1. Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id80">10.3.13.2. EVM Layout and Key Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id81">10.3.13.3. Quick Start Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#boot-configuration">10.3.13.4. Boot Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#connecting-the-am3359-ice-to-code-composer-studio">10.3.13.5. Connecting the AM3359 ICE to Code Composer Studio</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#running-board-diagnostics">10.3.13.6. Running Board Diagnostics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#amic110-ice-evm-hardware-setup">10.3.14. AMIC110 ICE EVM Hardware Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id82">10.3.14.1. Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id83">10.3.14.2. EVM Layout and Key Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id84">10.3.14.3. Quick Start Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id85">10.3.14.4. Boot Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#connecting-the-amic110-ice-to-code-composer-studio">10.3.14.5. Connecting the AMIC110 ICE to Code Composer Studio</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_how_to_guides.html#id86">10.3.14.6. Running Board Diagnostics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_how_to_guides.html#ak2g-audio-dc-addon">10.3.15. 66AK2G Audio DC AddOn</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="taking-the-c66x-out-of-reset-with-linux-running-on-the-arm-a15">
<h2>10.4. Taking the C66x Out Of Reset with Linux Running on the ARM A15<a class="headerlink" href="#taking-the-c66x-out-of-reset-with-linux-running-on-the-arm-a15" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="how-to-take-the-c66x-dsp-out-of-reset-with-linux-running-on-a15">
<h3>10.4.1. How to take the C66x DSP out of reset with Linux running on A15<a class="headerlink" href="#how-to-take-the-c66x-dsp-out-of-reset-with-linux-running-on-a15" title="Permalink to this headline">Â¶</a></h3>
<p>This document describes the procedure to bring the C66x core out of reset after
booting Linux, or at the u-boot prompt.These steps are necessary in to order to
load an application on the C66x core, without interfering with the operation of
Linux running on the A15.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to proceeding with the below instructions, please ensure that the latest <span class="xref std std-ref">Emulation Package</span>
is downloaded/installed through CCS. This will ensure the GEL files in your machine
has the reset routines described below.</p>
</div>
<ol class="arabic simple">
<li><p>Once Linux has booted, launch the target configuration.</p></li>
</ol>
<img alt="../_images/Outofreset_1_lali.JPG" src="../_images/Outofreset_1_lali.JPG" />
<ol class="arabic simple" start="2">
<li><p>With the target configuration launched, right click on K2x.ccxml and select
âShow all coresâ</p></li>
</ol>
<img alt="../_images/Outofreset_2_lali.JPG" src="../_images/Outofreset_2_lali.JPG" />
<ol class="arabic simple" start="3">
<li><p>This will bring up the Non-Debuggable Devices section.
Right click and connect the CS_DAP_Debug_SS core.</p></li>
</ol>
<img alt="../_images/Outofreset_3_lali.JPG" src="../_images/Outofreset_3_lali.JPG" />
<ol class="arabic simple" start="4">
<li><p>Go to Tools&gt;GEL files and load the evmk2x.gel file by right clicking on the GEL file window.
The Gel file would typically be located in the CCS installation under
\ccsv6\ccs_base\emulation\boards\evmk2x\gel\</p></li>
</ol>
<img alt="../_images/Outofreset_4_lali.png" src="../_images/Outofreset_4_lali.png" />
<ol class="arabic simple" start="5">
<li><p>Once the GEL has been successfully loaded, go to Scripts&gt;default and select K2x_TakeDSPOutofReset.</p></li>
</ol>
<img alt="../_images/Outofreset_5_lali.png" src="../_images/Outofreset_5_lali.png" />
<ol class="arabic simple" start="6">
<li><p>At this point the console would indicate that the DSP is out of reset.</p></li>
</ol>
<img alt="../_images/Outofreset_6_lali.png" src="../_images/Outofreset_6_lali.png" />
<ol class="arabic simple" start="7">
<li><p>Now the DSP cores can be right-clicked and connected successfully.</p></li>
</ol>
<img alt="../_images/Outofreset_7_lali.png" src="../_images/Outofreset_7_lali.png" />
</div>
<div class="section" id="target-configuration">
<h3>10.4.2. Target Configuration<a class="headerlink" href="#target-configuration" title="Permalink to this headline">Â¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Once the DSP core is connected following the above out of reset routine, the DDR and PLL settings
done by u-boot would be overwritten by whatâs in the GEL. In order to avoid this, please ensure that
the gel is NOT preloaded on the DSP core in the ccxml by leaving the initialization script blank.</p>
</div>
<img alt="../_images/Outofreset_8_lali.JPG" src="../_images/Outofreset_8_lali.JPG" />
<div class="section" id="host">
<h4>10.4.2.1. Host<a class="headerlink" href="#host" title="Permalink to this headline">Â¶</a></h4>
</div>
</div>
</div>
<div class="section" id="setup">
<h2>10.5. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="setup-ccs-for-evm-and-processor-sdk-rtos">
<span id="processor-sdk-rtos-setup-ccs-label"></span><h3>10.5.1. Setup CCS for EVM and Processor-SDK RTOS<a class="headerlink" href="#setup-ccs-for-evm-and-processor-sdk-rtos" title="Permalink to this headline">Â¶</a></h3>
<p>This page provides information on configuring CCS to work with both the
EVM and the Processor-SDK for RTOS.</p>
<p>After installing the Processor-SDK RTOS, start CCS and it will
automatically detect the newly installed components (<em>products</em>):</p>
<img alt="../_images/CCS-discovered-products.png" src="../_images/CCS-discovered-products.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>If you chose to install the SDK package in a different folder from where
CCS is installed (e.g. C:\TEMP\RTOS-SDK\am57x), then you will need to
add the path to the search path for CCS to locate the new packages. The
screenshots below demonstrate the process to setup the CCS environment;
the sequence for a Linux host is the same.</p>
<p>From CCS, select âWindow -&gt; Preferencesâ:</p>
<img alt="../_images/CCS-GP57x-EVM-Custom-Preferences.png" src="../_images/CCS-GP57x-EVM-Custom-Preferences.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In the Preferences window, select âCode Composer Studio -&gt; RTSC -&gt;
Productsâ in the panel on the left. Then, press the âAddâ button on the
panel on the right:</p>
<img alt="../_images/CCS-GP57x-EVM-Custom-Add.png" src="../_images/CCS-GP57x-EVM-Custom-Add.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Next, verify the newly discovered products. If everything is correct,
press the âFinishâ button on the bottom:</p>
<img alt="../_images/CCS-GP57x-EVM-Custom-Finish.png" src="../_images/CCS-GP57x-EVM-Custom-Finish.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>When prompted, restart CCS for changes to take effect. You will see
newly discovered products from the custom path.</p>
<img alt="../_images/CCS-GP57x-EVM-Custom-Confirm.png" src="../_images/CCS-GP57x-EVM-Custom-Confirm.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>1. In CCS, navigate to Help -&gt; Check for Updates and select âSitara device supportâ
and âTI Emulatorsâ and click Next.</p>
<blockquote>
<div><img alt="../_images/CCS_Check_for_Updates.PNG" src="../_images/CCS_Check_for_Updates.PNG" />
</div></blockquote>
<p>2. Click âNextâ again, select âI accept the terms of the license agreementsâ
and click Finish to begin the installation.</p>
<blockquote>
<div><img alt="../_images/CCS_Updating_Software.png" src="../_images/CCS_Updating_Software.png" />
</div></blockquote>
<p>3. You may be prompted to restart CCS for the updates to take effect. Click âRestart Nowâ when
prompted to complete the installation.</p>
<p>In CCS, you need to create a <em>Target Configuration</em> for your EVM to be
able to connect to the target. This configuration defines your:</p>
<ul class="simple">
<li><p>Connection to the target (XDS, FET, etc.)</p></li>
<li><p>Target device (AM437x GP EVM, AM57x GP EVM, etc.)</p></li>
<li><p>GEL file for hardware initialization. A GEL file is basically a
âbatch fileâ that sets up the CCS debug environment including memory
map, PLL, clock, etc.</p></li>
</ul>
<p>CCS comes with basic configuration that can be used to configure your
particular setup. In the example below, we provide details for a GP
AM437x EVM; configuration information for other supported EVMs are also
provided as needed.</p>
<p>For EVM specific instructions, refer to the <strong>Hardware Userâs Guide</strong>
for your <a class="reference external" href="index_release_specific.html#supported-platforms-and-versions">EVM</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Note for K2G devices:</strong> If using CCS v6.1.2 and Keystone2 device
support v1.1.7, 66AK2G02 would not show up in the list of devices when
creating the target configuration. This is due to an incompatibility in
the XML parser in CCS v6.1.2 with the K2G device xml. In order to
work-around this issue, make the change in 66AK2G02.xml as illustrated
below in order to have 66AK2G02 display in the device list. This problem
does not exist in CCS v6.1.3 onwards as the XML parser has been updated.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>C:\ti\ccsv6\ccs_base\common\targetdb\devices\66AK2G02.xml

Line #1

&lt;?xml version=&quot;1.1&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
to
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
</pre></div>
</div>
</div>
<p>From CCS, select âFile -&gt; New -&gt; Target Configuration Fileâ:</p>
<img alt="../_images/CCS-GP437x-EVM-New-Target.png" src="../_images/CCS-GP437x-EVM-New-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The AM437x GP EVM supports embedded XDS100V2 USB Emulation through the
MicroUSB AB connector. Select</p>
<ul class="simple">
<li><p><strong>Connection</strong>: Texas Instruments XDS100v2 USB Debug Probe</p></li>
<li><p><strong>Board or Device</strong>: EVMAM437X</p></li>
</ul>
<img alt="../_images/CCS-GP437x-EVM-Configure-Target.png" src="../_images/CCS-GP437x-EVM-Configure-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Useful Tip</strong></p>
<p>If you enter the starting numbers of your device in the <strong>Board or
Device</strong> field, the list will show the relevant subset.</p>
<p>Here is a table showing configuration information for all supported
EVMs in the Processor-SDK RTOS:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>EVM</p></th>
<th class="head"><p>Connection</p></th>
<th class="head"><p>Board</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>AM65x EVM</p></td>
<td><p>Texas Instruments
XDS110 USB Debug
Probe</p></td>
<td><p>GPEVM_AM65x</p></td>
</tr>
<tr class="row-odd"><td><p>AM65x IDK</p></td>
<td><p>Texas Instruments
XDS110 USB Debug
Probe</p></td>
<td><p>IDK_AM65x</p></td>
</tr>
<tr class="row-even"><td><p>GP335x</p></td>
<td><p>External Emulator
Supplied by User. EVM
includes a TI 20 pin
JTAG connector.</p></td>
<td><p>EVMAM3358</p></td>
</tr>
<tr class="row-odd"><td><p>ICE335x</p></td>
<td><p>Texas Instruments
XDS100v2 USB Debug
Probe</p></td>
<td><p>ICE_AM3359</p></td>
</tr>
<tr class="row-even"><td><p>SK335x</p></td>
<td><p>Texas Instruments
XDS100v2 USB Debug
Probe</p></td>
<td><p>SK_AM3358</p></td>
</tr>
<tr class="row-odd"><td><p>BBB</p></td>
<td><p>External Emulator
Supplied by User. EVM
includes a TI 20 pin
JTAG connector.</p></td>
<td><p>BeagleBone_Black</p></td>
</tr>
<tr class="row-even"><td><p>GP437x</p></td>
<td><p>Texas Instruments
XDS100v2 USB Debug
Probe</p></td>
<td><p>EVMAM437X</p></td>
</tr>
<tr class="row-odd"><td><p>IDK437x</p></td>
<td><p>Texas Instruments
XDS100v2 USB Debug
Probe</p></td>
<td><p>IDK_AM437X</p></td>
</tr>
<tr class="row-even"><td><p>GP572x</p></td>
<td><p>External Emulator
Supplied by User. EVM
includes a TI 20 pin
JTAG connector.</p></td>
<td><p>GPEVM_AM572X</p></td>
</tr>
<tr class="row-odd"><td><p>X15</p></td>
<td><p>External Emulator
Supplied by User. EVM
includes a TI 20 pin
JTAG connector.</p></td>
<td><p>GPEVM_AM572X</p></td>
</tr>
<tr class="row-even"><td><p>IDK572x/IDK574x</p></td>
<td><p>Texas Instruments
XDS100V2 USB Debug
Probe
External Emulator
Supplied by User. EVM
includes a 60-pin
MIPI JTAG connector</p></td>
<td><p>IDK_AM572X/IDK_AM574X</p></td>
</tr>
<tr class="row-odd"><td><p>C665x EVM</p></td>
<td><p>Texas Instruments
XDS2xx USB Onboard
Debug Probe</p></td>
<td><p>TMS320C6657</p></td>
</tr>
<tr class="row-even"><td><p>C667x EVM</p></td>
<td><p>L w/ XDC100: Texas
Instruments XDS100v1
USB Emulator
LE/LXE with XDS560:
Blackhawk
XDS560v2-USB
Mezzanine Emulator</p></td>
<td><p>TMS320C6678</p></td>
</tr>
<tr class="row-odd"><td><p>K2E EVM</p></td>
<td><p>Texas Instruments
XDS2xx USB Onboard
Debug Probe</p></td>
<td><p>66AK2E05</p></td>
</tr>
<tr class="row-even"><td><p>K2H EVM</p></td>
<td><p>Texas Instruments
XDS2xx USB Onboard
Debug Probe</p></td>
<td><p>66AK2H12</p></td>
</tr>
<tr class="row-odd"><td><p>K2L EVM</p></td>
<td><p>Texas Instruments
XDS2xx USB Onboard
Debug Probe</p></td>
<td><p>TCI6630K2L</p></td>
</tr>
<tr class="row-even"><td><p>K2G GP EVM</p></td>
<td><p>Texas Instruments
XDS2xx USB Onboard
Debug Probe</p></td>
<td><p>66AK2G02</p></td>
</tr>
<tr class="row-odd"><td><p>OMAPL137 EVM</p></td>
<td><p>Spectrum Digital
XDS510USB Emulator</p></td>
<td><p>OMAPL137SK</p></td>
</tr>
<tr class="row-even"><td><p>OMAPL138 LCDK</p></td>
<td><p>External Emulator
Supplied by User. EVM
includes a TI 14 pin
JTAG connector.</p></td>
<td><p>OMAPL138LCDK</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Next, save the target configuration by pressing the <strong>Save</strong> button:</p>
<img alt="../_images/CCS-GP437x-EVM-Save-Target.png" src="../_images/CCS-GP437x-EVM-Save-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Next, test the target configuration by pressing the <strong>Test Connection</strong>
button. This will confirm that you have successfully created an emulator
connection with your board.</p>
<img alt="../_images/AM4-GP-test-connection.png" src="../_images/AM4-GP-test-connection.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>From CCS, select âView -&gt; Target Configurationsâ:</p>
<img alt="../_images/CCS-GP437x-EVM-View-Target.png" src="../_images/CCS-GP437x-EVM-View-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Open âUser Definedâ list and right click on the target configuration
file that was just saved and select âLaunch Selected Configurationâ:</p>
<img alt="../_images/CCS-GP437x-EVM-Launch-Target.png" src="../_images/CCS-GP437x-EVM-Launch-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>After launch, you can connect to a core. For GP AM437x EVM, select
<strong>Cortex A9</strong> and select âConnect Targetâ:</p>
<img alt="../_images/CCS-GP437x-EVM-Connnect-Target.png" src="../_images/CCS-GP437x-EVM-Connnect-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>After connecting to target, check the console for status. Typically, the
end of the configuration will indicate success or failure. For GP AM437x
EVM, you will see the message âAM437x GP EVM Initialization is Doneâ:</p>
<img alt="../_images/CCS-GP437x-EVM-Run-Target.png" src="../_images/CCS-GP437x-EVM-Run-Target.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>After connecting to the boot master core â typically the ARM core â
you may need to connect to a slave core in order to run code. Depending
on your SOC, the slave core can be</p>
<ul class="simple">
<li><p>DSP C66x</p></li>
<li><p>ARM M4</p></li>
<li><p>PRUSS</p></li>
<li><p>IVAHD</p></li>
</ul>
<p>Typically the slave cores will wait in reset state until the master core
wakes up the slave core to run code. To connect to the slave core on
AM57x, go to <strong>Scripts</strong> menu in CCS Debug View and under <strong>AM572x
MULTICORE Initialization</strong> enable the corresponding sub system clock.
For example, enable <code class="docutils literal notranslate"><span class="pre">DSP11SSClkEnable_API</span></code> for the first DSP core.
After running the clock enable option, you can connect to the core.</p>
<img alt="../_images/Multicore-Enable.jpg" src="../_images/Multicore-Enable.jpg" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>On AM57xx devices, all the timers on the chip have their suspend control
signal routed to the A15 core. Which means that if any of the slave
cores are using these timers, the timers will continue to run even when
the slave core has been paused. The timer will only pause when the A15
core is halted.</p>
<p>This is confusing while debugging code on slave cores if you are relying
on timer for logging, inserting delays or if the timer keeps firing
interrupts even when the core is halted. One such scenario occurs with
<em>GPtimer5</em> when DSP developers are using SYS/BIOS. The OS uses
<em>GPtimer5</em> on the DSP and forces a frequency check to confirm the timer
configuration, however the OS canât gain access to the timer due to the
hook up of the suspend control signals.</p>
<p>Due to this issue the SYS/BIOS developers will need to configure an
additional CCS configuration check to connect the GPTimer suspend
control signal to the DSP as shown in the image below:</p>
<img alt="../_images/GPtimer5_DSPConnect.png" src="../_images/GPtimer5_DSPConnect.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>If you face any problems, first check these basic items:</p>
<ul class="simple">
<li><p><strong>Power cycle your target.</strong></p></li>
<li><p><strong>Check the USB cable.</strong> One simple way to do this is to connect
another device to the USB and ensure the cable works.</p></li>
<li><p><strong>Check host driver.</strong> Even with CCS turned off, your host should
list the TI XDS as a USB device. If this does not work, try a
different USB port.</p></li>
<li><p><strong>Latest emulation package.</strong> Ensure that you have the latest
emulation files as specified in the <a class="reference external" href="index_overview.html#emulator-support">Getting Started Guide</a>.</p></li>
</ul>
<p>If this does not resolve your problem, see these additional resources:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/Troubleshooting_CCSv6">Troubleshoot
CCS</a></p></li>
<li><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/XDS100#Troubleshooting">Troubleshoot
XDS100</a></p></li>
<li><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/XDS200#Troubleshooting">Troubleshoot
XDS200</a></p></li>
<li><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/XDS560#Frequently_Asked_Questions">Troubleshoot
XDS560</a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="update-environment-when-installing-to-a-custom-path">
<span id="processor-sdk-rtos-install-in-custom-path-label"></span><h3>10.5.2. Update environment when installing to a custom path<a class="headerlink" href="#update-environment-when-installing-to-a-custom-path" title="Permalink to this headline">Â¶</a></h3>
<p>This page will provide configuration information if the SDK is installed
in a custom path.</p>
<p><strong>Useful Tip</strong></p>
<p>To avoid changing environment variable for each new shell, modify
environment variable file directly. This file is the <em>setupenv</em> file
located in the SDK root directory.</p>
<p>Installing the SDK in a folder other than where CCS is installed will
require modifications to CCS to be able to discover the SDK. See the
<a class="reference external" href="/index.php/Processor_SDK_RTOS_Setup_CCS">Setup CCS</a> <strong>How To</strong> page
explaining how to update CCS configuration.</p>
<p>Installing the SDK in a folder other than the default (<code class="docutils literal notranslate"><span class="pre">C:\TI</span></code> for
Windows, <code class="docutils literal notranslate"><span class="pre">/home/[user]/ti</span></code> for Linux) requires modifications to SDK
RTOS scripts in order for recompilation and example/test creation to
work properly.</p>
<p>In all the commands below, replace <em>[version]</em> with the appropriate
version of the software/tool.</p>
<p>CCS installation and toolchain paths can be customized by setting the
TOOLS_INSTALL_PATH environment variable prior to running the SDK level
setupenv script. This feature is used if CCS and the toolchains are
installed somewhere other than the default C:\ti location.</p>
<p>For example, environment configuration assuming CCS is installed to
[os_base]\ti_temp and SDK RTOS has been installed to default path,
[os_base]\tiÂ :</p>
<ul class="simple">
<li><p>Windows</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>C:\&gt; set TOOLS_INSTALL_PATH=C:\ti_temp
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>C:\&gt; cd C:\ti\processor_sdk_rtos_[soc]_[version]
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>C:\ti\processor_sdk_rtos_[soc]_[version]&gt; setupenv.bat
</pre></div>
</div>
<p>Gives the output:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Optional</span> <span class="n">parameter</span> <span class="n">not</span> <span class="nl">configured</span>Â <span class="p">:</span> <span class="n">CG_XML_BIN_INSTALL_PATH</span>
<span class="n">REQUIRED</span> <span class="k">for</span> <span class="n">xdc</span> <span class="n">release</span> <span class="n">build</span>
<span class="nl">Example</span><span class="p">:</span> <span class="n">set</span> <span class="n">CG_XML_BIN_INSTALL_PATH</span><span class="o">=</span><span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">cg_xml</span><span class="o">/</span><span class="n">bin</span>
<span class="n">Optional</span> <span class="n">parameter</span> <span class="n">not</span> <span class="nl">configured</span>Â <span class="p">:</span> <span class="n">DOXYGEN_INSTALL_PATH</span>
<span class="n">REQUIRED</span> <span class="k">for</span> <span class="n">xdc</span> <span class="n">release</span> <span class="n">build</span>
<span class="nl">Example</span><span class="p">:</span> <span class="n">set</span> <span class="n">DOXYGEN_INSTALL_PATH</span><span class="o">=</span><span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">Doxygen</span><span class="o">/</span><span class="n">doxygen</span><span class="o">/</span><span class="mf">1.5.1</span><span class="o">-</span><span class="n">p1</span><span class="o">/</span><span class="n">bin</span>
<span class="o">**************************************************************************</span>
<span class="n">Environment</span> <span class="nl">Configuration</span><span class="p">:</span>
    <span class="n">PDK</span> <span class="nl">Directory</span>            Â <span class="p">:</span> <span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">PDK_AM</span><span class="o">~</span><span class="mi">3</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span>
    <span class="n">CGTOOL</span> <span class="n">INSTALL</span> <span class="nl">Directory</span> Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">ti</span><span class="o">-</span><span class="n">cgt</span><span class="o">-</span><span class="n">c6000_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A15</span> <span class="nl">Directory</span>  Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A8</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A9</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">M4</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">ti</span><span class="o">-</span><span class="n">cgt</span><span class="o">-</span><span class="n">arm_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">FPULIB_PATH</span>              Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">/</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">fpu</span>
    <span class="nl">CROSS_TOOL_PRFX</span>          Â <span class="p">:</span> <span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span>
    <span class="nl">XDC_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">xdctools_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="n">_core</span>
    <span class="nl">BIOS_INSTALL_PATH</span>        Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">bios_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">IPC_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ipc_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">EDMA3LLD_BIOS6_INSTALLDIR</span>Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">edma3_lld_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">NDK_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ndk_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">IMGLIB_INSTALL_PATH</span>      Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">imglib_c66x_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">UIA_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">uia_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">PROC_SDK_INSTALL_PATH</span>    Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
<span class="o">**************************************************************************</span>
<span class="n">Changing</span> <span class="n">to</span> <span class="kt">short</span> <span class="n">name</span> <span class="n">to</span> <span class="n">support</span> <span class="n">directory</span> <span class="n">names</span> <span class="n">containing</span> <span class="n">spaces</span>
<span class="n">current</span> <span class="nl">directory</span><span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
<span class="n">PROCESSOR</span> <span class="n">SDK</span> <span class="n">BUILD</span> <span class="n">ENVIRONMENT</span> <span class="n">CONFIGURED</span>
<span class="o">**************************************************************************</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Linux</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>$ export TOOLS_INSTALL_PATH=~/ti_temp
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>$ cd ~/ti/processor_sdk_rtos_[soc]_[version]/
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>~/ti/processor_sdk_rtos_[soc]_[version]$ source setupenv.sh
</pre></div>
</div>
<p>Gives the output:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Optional</span> <span class="n">parameter</span> <span class="n">not</span> <span class="nl">configured</span>Â <span class="p">:</span> <span class="n">CG_XML_BIN_INSTALL_PATH</span>
<span class="n">REQUIRED</span> <span class="k">for</span> <span class="n">xdc</span> <span class="n">release</span> <span class="n">build</span>
<span class="nl">Example</span><span class="p">:</span> <span class="k">export</span> <span class="n">CG_XML_BIN_INSTALL_PATH</span><span class="o">=</span><span class="s">&quot;~/ti/cg_xml/bin&quot;</span>
<span class="n">Optional</span> <span class="n">parameter</span> <span class="n">not</span> <span class="nl">configured</span>Â <span class="p">:</span> <span class="n">DOXYGEN_INSTALL_PATH</span>
<span class="n">REQUIRED</span> <span class="k">for</span> <span class="n">xdc</span> <span class="n">release</span> <span class="n">build</span>
<span class="nl">Example</span><span class="p">:</span> <span class="k">export</span> <span class="n">DOXYGEN_INSTALL_PATH</span><span class="o">=</span><span class="s">&quot;~/ti/Doxygen/doxygen/1.5.1-p1/bin&quot;</span>
<span class="o">**************************************************************************</span>
<span class="n">Environment</span> <span class="nl">Configuration</span><span class="p">:</span>
    <span class="n">PDK</span> <span class="nl">Directory</span>            Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">pdk_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span>
    <span class="n">CGTOOL</span> <span class="n">INSTALL</span> <span class="nl">Directory</span> Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">ti</span><span class="o">-</span><span class="n">cgt</span><span class="o">-</span><span class="n">c6000_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A15</span> <span class="nl">Directory</span>  Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A8</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A9</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">M4</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">ti</span><span class="o">-</span><span class="n">cgt</span><span class="o">-</span><span class="n">arm_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">FPULIB_PATH</span>              Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">/</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">fpu</span>
    <span class="nl">CROSS_TOOL_PRFX</span>          Â <span class="p">:</span> <span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span>
    <span class="nl">XDC_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">xdctools_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="n">_core</span>
    <span class="nl">BIOS_INSTALL_PATH</span>        Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">bios_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">IPC_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ipc_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">EDMA3LLD_BIOS6_INSTALLDIR</span>Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">edma3_lld_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">NDK_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ndk_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">IMGLIB_INSTALL_PATH</span>      Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">imglib_c66x_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">UIA_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">uia_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">PROC_SDK_INSTALL_PATH</span>    Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>

<span class="n">PROCESSOR</span> <span class="n">SDK</span> <span class="n">BUILD</span> <span class="n">ENVIRONMENT</span> <span class="n">CONFIGURED</span>
<span class="o">*******************************************************************************</span>
</pre></div>
</div>
<p>The <a class="reference external" href="index_overview.html#top-level-makefile">RTOS SDK top level
Makefile</a>
can now be used to rebuild SDK RTOS components with CCS and toolchains
installed in a custom installation path.</p>
<p>SDK RTOS component installation paths can be customized by setting the
SDK_INSTALL_PATH variable prior to running the SDK level setupenv
script. This feature is used if the SDK is installed somewhere other
than the default <code class="docutils literal notranslate"><span class="pre">C:\ti</span></code> location.</p>
<p>For example, environment configuration assuming CCS is installed to the
default path, <code class="docutils literal notranslate"><span class="pre">[os_base]\ti</span></code> and SDK RTOS has been installed to
<code class="docutils literal notranslate"><span class="pre">[os_base]\ti_temp</span></code>:</p>
<ul class="simple">
<li><p>Windows</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>C:\&gt; set SDK_INSTALL_PATH=C:/ti_temp
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>C:\&gt; cd C:\ti_temp\processor_sdk_rtos_[soc]_[version]
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>C:\ti_temp\processor_sdk_rtos_[soc]_[version]&gt; setupenv.bat
</pre></div>
</div>
<p>Gives the output:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Optional</span> <span class="n">parameter</span> <span class="n">not</span> <span class="nl">configured</span>Â <span class="p">:</span> <span class="n">CG_XML_BIN_INSTALL_PATH</span>
<span class="n">REQUIRED</span> <span class="k">for</span> <span class="n">xdc</span> <span class="n">release</span> <span class="n">build</span>
<span class="nl">Example</span><span class="p">:</span> <span class="n">set</span> <span class="n">CG_XML_BIN_INSTALL_PATH</span><span class="o">=</span><span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">cg_xml</span><span class="o">/</span><span class="n">bin</span>
<span class="n">Optional</span> <span class="n">parameter</span> <span class="n">not</span> <span class="nl">configured</span>Â <span class="p">:</span> <span class="n">DOXYGEN_INSTALL_PATH</span>
<span class="n">REQUIRED</span> <span class="k">for</span> <span class="n">xdc</span> <span class="n">release</span> <span class="n">build</span>
<span class="nl">Example</span><span class="p">:</span> <span class="n">set</span> <span class="n">DOXYGEN_INSTALL_PATH</span><span class="o">=</span><span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">Doxygen</span><span class="o">/</span><span class="n">doxygen</span><span class="o">/</span><span class="mf">1.5.1</span><span class="o">-</span><span class="n">p1</span><span class="o">/</span><span class="n">bin</span>
<span class="o">**************************************************************************</span>
<span class="n">Environment</span> <span class="nl">Configuration</span><span class="p">:</span>
    <span class="n">PDK</span> <span class="nl">Directory</span>            Â <span class="p">:</span> <span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">PDK_AM</span><span class="o">~</span><span class="mi">3</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span>
    <span class="n">CGTOOL</span> <span class="n">INSTALL</span> <span class="nl">Directory</span> Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">ti</span><span class="o">-</span><span class="n">cgt</span><span class="o">-</span><span class="n">c6000_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A15</span> <span class="nl">Directory</span>  Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A8</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A9</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">M4</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">ti</span><span class="o">-</span><span class="n">cgt</span><span class="o">-</span><span class="n">arm_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">FPULIB_PATH</span>              Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">/</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">fpu</span>
    <span class="nl">CROSS_TOOL_PRFX</span>          Â <span class="p">:</span> <span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span>
    <span class="nl">XDC_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">xdctools_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="n">_core</span>
    <span class="nl">BIOS_INSTALL_PATH</span>        Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">bios_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">IPC_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ipc_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">EDMA3LLD_BIOS6_INSTALLDIR</span>Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">edma3_lld_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">NDK_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ndk_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">IMGLIB_INSTALL_PATH</span>      Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">imglib_c66x_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">UIA_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">uia_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">PROC_SDK_INSTALL_PATH</span>    Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
<span class="o">**************************************************************************</span>
<span class="n">Changing</span> <span class="n">to</span> <span class="kt">short</span> <span class="n">name</span> <span class="n">to</span> <span class="n">support</span> <span class="n">directory</span> <span class="n">names</span> <span class="n">containing</span> <span class="n">spaces</span>
<span class="n">current</span> <span class="nl">directory</span><span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
<span class="n">PROCESSOR</span> <span class="n">SDK</span> <span class="n">BUILD</span> <span class="n">ENVIRONMENT</span> <span class="n">CONFIGURED</span>
<span class="o">**************************************************************************</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Linux</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>$ export SDK_INSTALL_PATH=~/ti_temp
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>$ cd ~/ti_temp/processor_sdk_rtos_[soc]_[version]/
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>~/ti_temp/processor_sdk_rtos_[soc]_[version]$ source setupenv.sh
</pre></div>
</div>
<p>Gives the output:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Optional</span> <span class="n">parameter</span> <span class="n">not</span> <span class="nl">configured</span>Â <span class="p">:</span> <span class="n">CG_XML_BIN_INSTALL_PATH</span>
<span class="n">REQUIRED</span> <span class="k">for</span> <span class="n">xdc</span> <span class="n">release</span> <span class="n">build</span>
<span class="nl">Example</span><span class="p">:</span> <span class="k">export</span> <span class="n">CG_XML_BIN_INSTALL_PATH</span><span class="o">=</span><span class="s">&quot;~/ti/cg_xml/bin&quot;</span>
<span class="n">Optional</span> <span class="n">parameter</span> <span class="n">not</span> <span class="nl">configured</span>Â <span class="p">:</span> <span class="n">DOXYGEN_INSTALL_PATH</span>
<span class="n">REQUIRED</span> <span class="k">for</span> <span class="n">xdc</span> <span class="n">release</span> <span class="n">build</span>
<span class="nl">Example</span><span class="p">:</span> <span class="k">export</span> <span class="n">DOXYGEN_INSTALL_PATH</span><span class="o">=</span><span class="s">&quot;~/ti/Doxygen/doxygen/1.5.1-p1/bin&quot;</span>
<span class="o">**************************************************************************</span>
<span class="n">Environment</span> <span class="nl">Configuration</span><span class="p">:</span>
    <span class="n">PDK</span> <span class="nl">Directory</span>            Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">pdk_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span>
    <span class="n">CGTOOL</span> <span class="n">INSTALL</span> <span class="nl">Directory</span> Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">ti</span><span class="o">-</span><span class="n">cgt</span><span class="o">-</span><span class="n">c6000_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A15</span> <span class="nl">Directory</span>  Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A8</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A9</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">M4</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">ti</span><span class="o">-</span><span class="n">cgt</span><span class="o">-</span><span class="n">arm_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">FPULIB_PATH</span>              Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">/</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">fpu</span>
    <span class="nl">CROSS_TOOL_PRFX</span>          Â <span class="p">:</span> <span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span>
    <span class="nl">XDC_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">xdctools_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="n">_core</span>
    <span class="nl">BIOS_INSTALL_PATH</span>        Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">bios_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">IPC_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ipc_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">EDMA3LLD_BIOS6_INSTALLDIR</span>Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">edma3_lld_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">NDK_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">ndk_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">IMGLIB_INSTALL_PATH</span>      Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">imglib_c66x_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">UIA_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">uia_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">PROC_SDK_INSTALL_PATH</span>    Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">ti_temp</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>

<span class="n">PROCESSOR</span> <span class="n">SDK</span> <span class="n">BUILD</span> <span class="n">ENVIRONMENT</span> <span class="n">CONFIGURED</span>
<span class="o">*******************************************************************************</span>
</pre></div>
</div>
<p>The <a class="reference external" href="index_overview.html#top-level-makefile">RTOS SDK top level
Makefile</a>
can now be used to rebuild SDK RTOS components installed in the custom
installation path.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following known issue impacts this step:
<strong>PRSDK-1263</strong>: PDK AM437x: Make fails on Windows if CCS is installed in
custom path. <strong>Workaround:</strong> Edit the UTILS_INSTALL_DIR variable in
&lt;pdk_root_dir&gt;/packages/ti/starterware/Rules.make to point to the CCS
installation on your Windows PC.</p>
</div>
<p>When CCS and the SDK RTOS are both installed to custom paths the SDK can
be rebuilt by setting the SDK_INSTALL_PATH and TOOLS_INSTALL_PATH
variables prior to running the SDK RTOS top level environment setup
script. The Windows and Linux environment setup scripts can be found in
the following locations, respectively:</p>
<ul class="simple">
<li><p>Windows -
C:\custom\install\path\processor_sdk_rtos_[soc]_[version]\setupenv.bat</p></li>
<li><p>Linux -
/home/[user]/custom/install/path/processor_sdk_rtos_[soc]_[version]/setupenv.sh</p></li>
</ul>
<p>The SDK_INSTALL_PATH and TOOLS_INSTALL_PATH environment variables must
be set to the custom install path <strong>prior to running</strong> the environment
setup script.</p>
<p>For example, environment configuration assuming CCS and the SDK have
been installed to [os_base]\new_sdk_release\Â :</p>
<ul class="simple">
<li><p>Windows</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>C:\&gt; set SDK_INSTALL_PATH=C:\new_sdk_release
C:\&gt; set TOOLS_INSTALL_PATH=C:\new_sdk_release
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>C:\&gt; cd C:\new_sdk_release\processor_sdk_rtos_[soc]_[version]
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>C:\new_sdk_release\processor_sdk_rtos_[soc]_[version]&gt; setupenv.bat
</pre></div>
</div>
<p>Gives the output:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Optional</span> <span class="n">parameter</span> <span class="n">not</span> <span class="nl">configured</span>Â <span class="p">:</span> <span class="n">CG_XML_BIN_INSTALL_PATH</span>
<span class="n">REQUIRED</span> <span class="k">for</span> <span class="n">xdc</span> <span class="n">release</span> <span class="n">build</span>
<span class="nl">Example</span><span class="p">:</span> <span class="n">set</span> <span class="n">CG_XML_BIN_INSTALL_PATH</span><span class="o">=</span><span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">cg_xml</span><span class="o">/</span><span class="n">bin</span>
<span class="n">Optional</span> <span class="n">parameter</span> <span class="n">not</span> <span class="nl">configured</span>Â <span class="p">:</span> <span class="n">DOXYGEN_INSTALL_PATH</span>
<span class="n">REQUIRED</span> <span class="k">for</span> <span class="n">xdc</span> <span class="n">release</span> <span class="n">build</span>
<span class="nl">Example</span><span class="p">:</span> <span class="n">set</span> <span class="n">DOXYGEN_INSTALL_PATH</span><span class="o">=</span><span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">Doxygen</span><span class="o">/</span><span class="n">doxygen</span><span class="o">/</span><span class="mf">1.5.1</span><span class="o">-</span><span class="n">p1</span><span class="o">/</span><span class="n">bin</span>
<span class="o">**************************************************************************</span>
<span class="n">Environment</span> <span class="nl">Configuration</span><span class="p">:</span>
    <span class="n">PDK</span> <span class="nl">Directory</span>            Â <span class="p">:</span> <span class="o">/</span><span class="n">NEW_SD</span><span class="o">~</span><span class="mi">1</span><span class="o">/</span><span class="n">PDK_AM</span><span class="o">~</span><span class="mi">1</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span>
    <span class="n">CGTOOL</span> <span class="n">INSTALL</span> <span class="nl">Directory</span> Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">ti</span><span class="o">-</span><span class="n">cgt</span><span class="o">-</span><span class="n">c6000_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A15</span> <span class="nl">Directory</span>  Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A8</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A9</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">M4</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">ti</span><span class="o">-</span><span class="n">cgt</span><span class="o">-</span><span class="n">arm_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">FPULIB_PATH</span>              Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">/</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">fpu</span>
    <span class="nl">CROSS_TOOL_PRFX</span>          Â <span class="p">:</span> <span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span>
    <span class="nl">XDC_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">xdctools_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="n">_core</span>
    <span class="nl">BIOS_INSTALL_PATH</span>        Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">bios_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">IPC_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ipc_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">EDMA3LLD_BIOS6_INSTALLDIR</span>Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">edma3_lld_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">NDK_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ndk_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">IMGLIB_INSTALL_PATH</span>      Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">imglib_c66x_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">UIA_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">uia_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">PROC_SDK_INSTALL_PATH</span>    Â <span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
<span class="o">**************************************************************************</span>
<span class="n">Changing</span> <span class="n">to</span> <span class="kt">short</span> <span class="n">name</span> <span class="n">to</span> <span class="n">support</span> <span class="n">directory</span> <span class="n">names</span> <span class="n">containing</span> <span class="n">spaces</span>
<span class="n">current</span> <span class="nl">directory</span><span class="p">:</span> <span class="nl">C</span><span class="p">:</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
<span class="n">PROCESSOR</span> <span class="n">SDK</span> <span class="n">BUILD</span> <span class="n">ENVIRONMENT</span> <span class="n">CONFIGURED</span>
<span class="o">**************************************************************************</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Linux</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>$ export SDK_INSTALL_PATH=~/new_sdk_release
$ export TOOLS_INSTALL_PATH=~/new_sdk_release
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>$ cd ~/new_sdk_release/processor_sdk_rtos_[soc]_[version]/
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>~/new_sdk_release/processor_sdk_rtos_[soc]_[version]$ source setupenv.sh
</pre></div>
</div>
<p>Gives the output:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Optional</span> <span class="n">parameter</span> <span class="n">not</span> <span class="nl">configured</span>Â <span class="p">:</span> <span class="n">CG_XML_BIN_INSTALL_PATH</span>
<span class="n">REQUIRED</span> <span class="k">for</span> <span class="n">xdc</span> <span class="n">release</span> <span class="n">build</span>
<span class="nl">Example</span><span class="p">:</span> <span class="k">export</span> <span class="n">CG_XML_BIN_INSTALL_PATH</span><span class="o">=</span><span class="s">&quot;~/ti/cg_xml/bin&quot;</span>
<span class="n">Optional</span> <span class="n">parameter</span> <span class="n">not</span> <span class="nl">configured</span>Â <span class="p">:</span> <span class="n">DOXYGEN_INSTALL_PATH</span>
<span class="n">REQUIRED</span> <span class="k">for</span> <span class="n">xdc</span> <span class="n">release</span> <span class="n">build</span>
<span class="nl">Example</span><span class="p">:</span> <span class="k">export</span> <span class="n">DOXYGEN_INSTALL_PATH</span><span class="o">=</span><span class="s">&quot;~/ti/Doxygen/doxygen/1.5.1-p1/bin&quot;</span>
<span class="o">**************************************************************************</span>
<span class="n">Environment</span> <span class="nl">Configuration</span><span class="p">:</span>
    <span class="n">PDK</span> <span class="nl">Directory</span>            Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">pdk_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span>
    <span class="n">CGTOOL</span> <span class="n">INSTALL</span> <span class="nl">Directory</span> Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">ti</span><span class="o">-</span><span class="n">cgt</span><span class="o">-</span><span class="n">c6000_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A15</span> <span class="nl">Directory</span>  Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A8</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">A9</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="n">TOOLCHAIN</span> <span class="n">M4</span> <span class="nl">Directory</span>   Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">ti</span><span class="o">-</span><span class="n">cgt</span><span class="o">-</span><span class="n">arm_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">FPULIB_PATH</span>              Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ccsv6</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">/</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">fpu</span>
    <span class="nl">CROSS_TOOL_PRFX</span>          Â <span class="p">:</span> <span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span>
    <span class="nl">XDC_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">xdctools_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="n">_core</span>
    <span class="nl">BIOS_INSTALL_PATH</span>        Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">bios_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">IPC_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ipc_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">EDMA3LLD_BIOS6_INSTALLDIR</span>Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">edma3_lld_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">NDK_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">ndk_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">IMGLIB_INSTALL_PATH</span>      Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">imglib_c66x_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">UIA_INSTALL_PATH</span>         Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">uia_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
    <span class="nl">PROC_SDK_INSTALL_PATH</span>    Â <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="n">new_sdk_release</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>

<span class="n">PROCESSOR</span> <span class="n">SDK</span> <span class="n">BUILD</span> <span class="n">ENVIRONMENT</span> <span class="n">CONFIGURED</span>
<span class="o">*******************************************************************************</span>
</pre></div>
</div>
<p>The <a class="reference external" href="index_overview.html#top-level-makefile">RTOS SDK top level Makefile</a>
can now be used to rebuild SDK RTOS components installed in the custom
installation path using CCS and toolchains installed in a custom path as
well.</p>
<p>Installing the PDK in a folder other than the default (C:TI for
Windows, /home/[user]/ti for Linux) requires modifications to PDK
scripts in order for recompilation and example/test creation to work
properly.</p>
<p>The instructions provided in the <a class="reference external" href="/index.php/Processor_SDK_RTOS_Install_In_Custom_Path#CCS_in_Custom_Path_and_SDK_RTOS_in_Default_Path">CCS in Custom Path and SDK RTOS in
Default
Path</a>
section can be used to rebuild components at the PDK level. The only
difference is the PDK level setup script should be used instead of the
SDK RTOS level setup script. The PDK level setup scripts are found in
the following locations on Windows and Linux, respectively:</p>
<ul class="simple">
<li><p>Windows -
C:\custom\install\path\pdk_[soc]_[version]\packages\pdksetupenv.bat</p></li>
<li><p>Linux -
/home/[user]/custom/install/path/pdk_[soc]_[version]/packages/pdksetupenv.sh</p></li>
</ul>
<p>The instructions provided in the <a class="reference external" href="/index.php/Processor_SDK_RTOS_Install_In_Custom_Path#CCS_in_Default_Path_and_SDK_RTOS_in_Custom_Path">CCS in Default Path and SDK RTOS in
Custom
Path</a>
section can be used to rebuild components at the PDK level. The only
difference is the PDK level setup script should be used instead of the
SDK RTOS level setup script. The PDK level setup scripts are found in
the following locations on Windows and Linux, respectively:</p>
<ul class="simple">
<li><p>Windows -
C:\custom\install\path\pdk_[soc]_[version]\packages\pdksetupenv.bat</p></li>
<li><p>Linux -
/home/[user]/custom/install/path/pdk_[soc]_[version]/packages/pdksetupenv.sh</p></li>
</ul>
<p>The instructions provided in the <a class="reference external" href="/index.php/Processor_SDK_RTOS_Install_In_Custom_Path#CCS_and_SDK_RTOS_in_Custom_Path">CCS and SDK RTOS in Custom
Path</a>
section can be used to rebuild components at the PDK level. The only
difference is the PDK level setup script should be used instead of the
SDK RTOS level setup script. The PDK level setup scripts are found in
the following locations on Windows and Linux, respectively:</p>
<ul class="simple">
<li><p>Windows -
C:\custom\install\path\pdk_[soc]_[version]\packages\pdksetupenv.bat</p></li>
<li><p>Linux -
/home/[user]/custom/install/path/pdk_[soc]_[version]/packages/pdksetupenv.sh</p></li>
</ul>
<p>The pdkProjectCreate scripts must be modified in order to build PDK
example and test projects only if CCS has been installed to a custom
path. The modification is the same for both Windows and Linux. Inside
the pdkProjectCreate scripts is a CCS_INSTALL_PATH variable which points
to the Code Composer Studio root directory. This variable must be
redefined to the new location of the CCS root directory if CCS is
installed to a custom path.</p>
<ul class="simple">
<li><p>Windows</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">REM</span> <span class="n">Install</span> <span class="n">Location</span> <span class="k">for</span> <span class="n">CCS</span>
<span class="n">set</span> <span class="n">CCS_INSTALL_PATH</span><span class="o">=</span><span class="s">&quot;C:</span><span class="se">\t</span><span class="s">i\ccsv6&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Linux</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp"># Install Location for CCS</span>
<span class="k">export</span> <span class="n">CCS_INSTALL_PATH</span><span class="o">=~/</span><span class="n">ti</span><span class="o">/</span><span class="n">ccsv6</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to invoking the pdkProjectCreate script, make sure to start CCS
and register the SDK RTOS components installed. Project creation will
fail if the RTOS SDK components installed to the custom path have not
been registered with CCS. Please see <a class="reference external" href="/index.php/Processor_SDK_RTOS_Setup_CCS#CCS_and_SDK_installed_in_different_directories">CCS and SDK installed in different
directories</a>
for instructions on how to register SDK RTOS components installed to a
custom path with CCS</p>
</div>
</div>
<div class="section" id="prevent-beaglebone-board-reset-on-jtag-connect">
<h3>10.5.3. Prevent BeagleBone board reset on JTAG Connect<a class="headerlink" href="#prevent-beaglebone-board-reset-on-jtag-connect" title="Permalink to this headline">Â¶</a></h3>
<p><a class="reference external" href="https://elinux.org/Beagleboard:BeagleBone#Board_Reset_on_JTAG_Connect.28A3.2CA4.2CA5.29">https://elinux.org/Beagleboard:BeagleBone#Board_Reset_on_JTAG_Connect.28A3.2CA4.2CA5.29</a></p>
</div>
<div class="section" id="rebuild-drivers-from-pdk-directory">
<h3>10.5.4. Rebuild drivers from PDK directory<a class="headerlink" href="#rebuild-drivers-from-pdk-directory" title="Permalink to this headline">Â¶</a></h3>
<p>Refer <a class="reference external" href="Overview.html#rebuild-pdk">Rebuilding the PDK</a> for details on rebuilding the PDK components.</p>
</div>
</div>
<div class="section" id="flashing-and-boot">
<h2>10.6. Flashing and Boot<a class="headerlink" href="#flashing-and-boot" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="flash-bootable-images-c66x-k2h-k2e-k2l-only">
<h3>10.6.1. Flash bootable images (C66x, K2H/K2E/K2L only)<a class="headerlink" href="#flash-bootable-images-c66x-k2h-k2e-k2l-only" title="Permalink to this headline">Â¶</a></h3>
<p>The Processor SDK RTOS for C6657, C6678, K2H, K2E, and K2L EVMs includes
a script in the directory</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="o">&lt;</span><span class="n">platform</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;/</span><span class="n">bin</span>
</pre></div>
</div>
<p>named <strong>program_evm.js</strong>. The purpose of this script is to automatically
flash bootable images onto your EVM.</p>
<p>The following sections will describe how to use this script and the
default flashable binaries in the Processor SDK RTOS.</p>
<ul class="simple">
<li><p>A Windows or Linux PC</p></li>
<li><p>Processor SDK RTOS installed on your PC. The version to install must
match the SOC you plan to use</p></li>
<li><p>Code Composer Studio installed on your PC</p></li>
<li><p>An USB connection to your EVM emulator</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Your board should be set to NO-BOOT mode. Please refer to the boot mode
dip switch settings for different boot modes on your EVM Hardware User
Guide. See <a class="reference external" href="index_release_specific.html#supported-platforms-and-versions">this page</a> for
a link to all supported EVM information.</p>
</div>
<p>The files used are in the Processor SDK RTOS directory. Expanded below
are the relevant files and directories for flashing the bootable images
for C667x, but a similar structure is used for C665x.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>âââ bin
â   âââ configs
â   â   âââ evm6678l
â   â       âââ evm6678l.ccxml
â   â       âââ evm6678le.ccxml
â   â       âââ evm6678le-linuxhost.ccxml
â   â       âââ evm6678l-linuxhost.ccxml
â   âââ logs
â   âââ program_evm.js
âââ prebuilt-images
    âââ eeprom50.bin
    âââ eeprom51.bin
    âââ eepromwriter_evm6678l.out
    âââ eepromwriter_input50.txt
    âââ eepromwriter_input51.txt
    âââ eepromwriter_input.txt
    âââ nandwriter_evm6678l.out
    âââ nand_writer_input.txt
    âââ norwriter_evm6678l.out
    âââ nor_writer_input.txt
</pre></div>
</div>
<p>Below is the expanded tree for K2H. Similarly, this also applies to K2E
and K2L EVMs.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>âââ bin
â   âââ configs
â   â   âââ evmk2h
â   â       âââ evmk2h.ccxml
â   â       âââ evmk2h-linuxhost.ccxml
â   â       âââ program_evm_config
â   âââ logs
â   âââ program_evm.js
âââ prebuilt-images
    âââ app
    âââ config
    âââ MLO
    âââ spi_flash_writer.out
</pre></div>
</div>
<p>Processor SDK RTOS provides the basic CCXML files to connect to your
SOC. There is a separate CCXML file for each SOC, emulator, and host OS
combination. These CCXML files are located in:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="o">&lt;</span><span class="n">platform</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;/</span><span class="n">bin</span><span class="o">/</span><span class="n">config</span><span class="o">/&lt;</span><span class="n">SOC</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Users can choose to use their own CCXML file by setting the environment
variable, <strong>PROGRAM_EVM_TARGET_CONFIG_FILE</strong>, to point to their CCXML
file in their terminal or command prompt.</p>
<p>You can create your own CCXML file by opening CCSv6 â&gt; View â&gt; Target
Configurations, and right-clicking on the Target Configuration pane to
select New Target Configuration. After selecting your SOC and emulator,
remember to set the appropriate GEL file in the advance options for Core
0. The GEL file is used to do basic SOC initialization upon connecting
to the core.</p>
<p>Processor SDK RTOS also provides the basic binaries needed to perform
flashing. These are separated into two categories - flashwriters and
flash images.</p>
<p>Flashwriters</p>
<ul class="simple">
<li><p>[C66x] eepromwriter_&lt;SOC&gt;.out - writes content to your EVM EEPROM
flash memory</p></li>
<li><p>[C66x] norwriter_&lt;SOC&gt;.out - writes content to your EVM NOR flash
memory</p></li>
<li><p>[C66x] nandwriter_&lt;SOC&gt;.out - writes content to your EVM NAND flash
memory</p></li>
<li><p>[K2H/E/L] spi_flash_writer.out - writes multiple images to your NOR
flash memory</p></li>
</ul>
<p>Flash images</p>
<ul class="simple">
<li><p>[C66x] eeprom50.bin - eeprom binary for address 0x50. The default for
C66x is the POST application.</p></li>
<li><p>[C66x] eeprom51.bin - eeprom binary for address 0x51. The default for
C66x is the Intermediate Boot Loader (IBL).</p></li>
<li><p>[C66x] nor.bin - nor binary to be used for NOR boot. May not be
provided for every EVM or release version.</p></li>
<li><p>[C66x] nand.bin - nand binary to be used for NAND boot. May not be
provided for every EVM or release version.</p></li>
<li><p>[K2H/K2E/K2L] app - NOR binary to be booted by Secondary Bootloader.
The default for Keystone 2 is the POST application</p></li>
<li><p>[K2H/K2E/K2L] MLO - Secondary Bootloader. The default flash location
is in SPI NOR flash memory at offset 0.</p></li>
</ul>
<p>For Windows users:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>&gt; cd [SDK Install Path]\processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;\bin
&gt; set DSS_SCRIPT_DIR=[CCS Install Path]\ccsv6\ccs_base\scripting\bin
&gt;Â %DSS_SCRIPT_DIR%\dss.bat program_evm.js [tmdx|tmds]evm(6678|6657|k2h|k2e|k2l)[l|le|ls][-le|-be]
</pre></div>
</div>
<p>For Linux users:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>&gt; cd [SDK Install Path]/processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;/bin
&gt; export DSS_SCRIPT_DIR=[CCS Install Path]/ccsv6/ccs_base/scripting/bin
&gt; $DSS_SCRIPT_DIR/dss.sh program_evm.js [tmdx|tmds]evm(6678|6657|k2h|k2e|k2l)[l|le|ls][-le|-be]
</pre></div>
</div>
<p>The last argument depends on the SOC that you have, concatenated with
the options to select emulator and endianness:</p>
<ul class="simple">
<li><p>l: EVM uses XDS100 on-board Emulator</p></li>
<li><p>le: EVM uses 560 Mezzanine Emulator daughter card</p></li>
<li><p>ls: EVM uses XDS200 Emulator card</p></li>
<li><p>-le: Little Endian</p></li>
<li><p>-be: Big Endian</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>By default, the images provided are little endian.</p></li>
<li><p>Also by default, Keystone 2 EVMs are expected to only use the XDS2xx
Emulator. You do not have to supply the emulator in the parameter for
K2H/K2E/K2L.</p></li>
</ul>
</div>
<p>Some examples are:</p>
<p>TMDXEVM6678LE little endian</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>&gt; $DSS_SCRIPT_DIR/dss.sh program_evm.js tmdxevm6678le-le
</pre></div>
</div>
<p>TMDSEVM6657LS little endian</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>&gt; $DSS_SCRIPT_DIR/dss.sh program_evm.js tmdxevm6657ls-le
</pre></div>
</div>
<p>EVMK2H little endian</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>&gt; $DSS_SCRIPT_DIR/dss.sh program_evm.js tmdsevmk2h
</pre></div>
</div>
<p>EVMK2E little endian</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>&gt; $DSS_SCRIPT_DIR/dss.sh program_evm.js tmdsevmk2e
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>C:\ti\processor_sdk_rtos_c665x_2_00_01_07\bin&gt;%DSS_SCRIPT_DIR%\dss.bat program_evm.js tmdxevm6657ls-le
board: evm6657l
endian: Little
emulation: XDS200 emulator
binaries: ../prebuilt-images/
ccxml: C:\ti\processor_sdk_rtos_c665x_2_00_01_07\bin/configs/evm6657l/evm6657ls.ccxml
C66xx_0: GEL Output:
Connecting Target...

C66xx_0: GEL Output: DSP core #0

C66xx_0: GEL Output: C6657L GEL file Ver is 1.006

C66xx_0: GEL Output: Global Default Setup...

C66xx_0: GEL Output: Setup Cache...

C66xx_0: GEL Output: L1P = 32K

C66xx_0: GEL Output: L1D = 32K

C66xx_0: GEL Output: L2 = ALL SRAM

C66xx_0: GEL Output: Setup Cache... Done.

C66xx_0: GEL Output: Main PLL (PLL1) Setup ...

C66xx_0: GEL Output: PLL in Bypass ...

C66xx_0: GEL Output: PLL1 Setup for DSP @ 1000.0 MHz.

C66xx_0: GEL Output:            SYSCLK2 = 333.3333 MHz, SYSCLK5 = 200.0 MHz.

C66xx_0: GEL Output:            SYSCLK8 = 15.625 MHz.

C66xx_0: GEL Output: PLL1 Setup... Done.

C66xx_0: GEL Output: Power on all PSC modules and DSP domains...

C66xx_0: GEL Output: Set_PSC_State... Timeout Error #03 pd=12, md=4!

C66xx_0: GEL Output: Power on all PSC modules and DSP domains... Done.

C66xx_0: GEL Output: DDR3 PLL (PLL2) Setup ...

C66xx_0: GEL Output: DDR3 PLL Setup... Done.

C66xx_0: GEL Output: DDR3 Init begin (1333 auto)

C66xx_0: GEL Output: XMC Setup ... Done

C66xx_0: GEL Output: IFRDY bit is SET: DDR3 Interface Ready

C66xx_0: GEL Output:
DDR3 initialization is complete.

C66xx_0: GEL Output: DDR3 Init done

C66xx_0: GEL Output: DDR3 memory test... Started

C66xx_0: GEL Output: DDR3 memory test... Passed

C66xx_0: GEL Output: PLL and DDR3 Initialization completed(0) ...

C66xx_0: GEL Output: configSGMIISerdes Setup... Begin

C66xx_0: GEL Output: SGMII SERDES has been configured.

C66xx_0: GEL Output: Enabling EDC ...

C66xx_0: GEL Output: L1P error detection logic is enabled.

C66xx_0: GEL Output: L2 error detection/correction logic is enabled.

C66xx_0: GEL Output: MSMC error detection/correction logic is enabled.

C66xx_0: GEL Output: Enabling EDC ...Done

C66xx_0: GEL Output: Global Default Setup... Done.

Start writing eeprom50
Writer:../prebuilt-images/eepromwriter_evm6657l.out

Image:../prebuilt-images/eeprom50.bin

C66xx_0: GEL Output: Invalidate All Cache...

C66xx_0: GEL Output: Invalidate All Cache... Done.

C66xx_0: GEL Output: GEL Reset...

C66xx_0: GEL Output: GEL Reset... Done.

C66xx_0: GEL Output: Disable all EDMA3 interrupts and events.

EEPROM Writer Utility Version 01.00.00.05

Writing 57432 bytes from DSP memory address 0x0c000000 to EEPROM bus address 0x0050 starting from device address 0x0000
...
Reading 57432 bytes from EEPROM bus address 0x0050 to DSP memory address 0x0c010000 starting from device address 0x0000
...
Verifying data read ...
EEPROM programming completed successfully
Start writing eeprom51
Writer:../prebuilt-images/eepromwriter_evm6657l.out

Image:../prebuilt-images/eeprom51.bin

C66xx_0: GEL Output: Invalidate All Cache...

C66xx_0: GEL Output: Invalidate All Cache... Done.

C66xx_0: GEL Output: GEL Reset...

C66xx_0: GEL Output: GEL Reset... Done.

C66xx_0: GEL Output: Disable all EDMA3 interrupts and events.

EEPROM Writer Utility Version 01.00.00.05

Writing 47888 bytes from DSP memory address 0x0c000000 to EEPROM bus address 0x0051 starting from device address 0x0000
...
Reading 47888 bytes from EEPROM bus address 0x0051 to DSP memory address 0x0c010000 starting from device address 0x0000
...
Verifying data read ...
EEPROM programming completed successfully
Writer:../prebuilt-images/nandwriter_evm6657l.out

NAND:../prebuilt-images/nand.bin

Required NAND files does not exist in ../prebuilt-images/

Writer:../prebuilt-images/norwriter_evm6657l.out

NOR:../prebuilt-images/nor.bin

Required NOR files does not exist in ../prebuilt-images/
</pre></div>
</div>
<p>In the above example, nothing was flashed to NAND or NOR since there
were no nand.bin or nor.bin binaries to flash.</p>
</div>
</div>
<div class="section" id="porting">
<h2>10.7. Porting<a class="headerlink" href="#porting" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="adding-custom-board-library-target-to-processor-sdk-rtos-makefiles">
<h3>10.7.1. Adding Custom Board_Library Target to Processor SDK RTOS makefiles<a class="headerlink" href="#adding-custom-board-library-target-to-processor-sdk-rtos-makefiles" title="Permalink to this headline">Â¶</a></h3>
<p>Refer <a class="reference external" href="Board_EVM_Abstration.html#creating-board-library-with-custom-name">Creating Board Library with Custom Name</a></p>
</div>
<div class="section" id="processor-sdk-rtos-porting-guide-for-am571x-am570x-speed-grades">
<h3>10.7.2. Processor SDK RTOS Porting Guide for AM571x/AM570x Speed Grades<a class="headerlink" href="#processor-sdk-rtos-porting-guide-for-am571x-am570x-speed-grades" title="Permalink to this headline">Â¶</a></h3>
<p>The AM57x Family of Processors includes a wide range of operating
performance to meet the needs of a number of broad applications. Among
these options are a variety of speed grades to meet different
performance points. These devices have a number of specialized cores to
provide applications specific computation capabilities. These cores can
be run at different speeds to fine tune the processor to the needs of
the application, power budget, thermal characteristics, etc.</p>
<p>The Processor SDK for RTOS is a software development package provided to
speed development by providing a software reference. This package now
includes support for then entire AM57x family of processors which can be
broken down into the AM572x, AM571x, and AM570x sets of devices or
sub-familes. Most of the devices in this family are supported by the
Processor SDK for RTOS right out of the box. This support is tested and
validated on TI designed EVMs. These EVMs use the highest performance
devices in the family in order to allow users to evaluate the entire
spectrum of performance.</p>
<p>The AM571X and AM570x supports several lower power speed grades. If one
of these devices is being used on the custom board, the GEL file and the
board library needs to be changed to account for this difference. If
this change is not made, the device could be running out of
specification. These changes may reach across other cores and clocks on
the device as well, depending on what speeds they need to operate at.
This document is not an exhaustive list of all the changes needed for a
proper board port as it focused on the changes needed to enable
different speed grades.</p>
<p><strong>Quick Feature Set comparison between devices in Sitara AM57xx
familyÂ :</strong></p>
<img alt="../_images/AM572x_AM571X_AM570x_Comparison.png" src="../_images/AM572x_AM571X_AM570x_Comparison.png" />
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><strong>Supported OPP on AM57xx devices:</strong></div>
</div>
<img alt="../_images/AM57xx_OPP.png" src="../_images/AM57xx_OPP.png" />
<p>TI Supports following evaluation platform for AM57xx class of devices:</p>
<ul class="simple">
<li><p><a class="reference external" href="index_release_specific.html#supported-platforms-and-versions">AM572x GP EVM</a></p></li>
<li><p><a class="reference external" href="index_release_specific.html#supported-platforms-and-versions">AM571x IDK</a></p></li>
<li><p><a class="reference external" href="index_release_specific.html#supported-platforms-and-versions">AM572x IDK</a></p></li>
</ul>
<p>When developer selects any of the above platforms in Code composer
Studio, the target configuration automatically brings in the required
initialization files and GEL files to configure the clocks, slave cores,
external memory.</p>
<p>If you are using a custom platform or AM5708 device that is not
available on a TI Evaluation platform, you can follow the steps provided
below to connect to the SOC by reusing the GEL files that are provided
for TI evaluation platforms. For example, here we demonstrate how you
can create a target configuration for AM570x and connect to the device
if your board design is based of one of TI evalauation platforms listed
below. The assumption here is that the custom board is based off AM571X
IDK platform</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Support for AM5708 was added to Sitara Chip Support Package 1.3.4
in Code composer Studio. If you don`t see the device definition in CCS,
then you can update the Sitara Chip Support package by going to
<a class="reference external" href="http://ap-fpdsp-swapps.dal.design.ti.com/index.php/File:Check_Updates.png">Help-&gt;Check
Updates</a></p>
</div>
<p><strong>Step 1: Select the AM570x part number that is populated on your custom
platform:</strong></p>
<img alt="../_images/AM5708_EVM_target_configurations.png" src="../_images/AM5708_EVM_target_configurations.png" />
<p><strong>Step 2: Setup the GEL files for the SOC</strong> Go to the Advanced Tab as
shown in the previous screenshot and update startup GEL file in the A15
Core as shown in the screenshot below</p>
<img alt="../_images/Advanced_settings_GEL_setup.png" src="../_images/Advanced_settings_GEL_setup.png" />
<p>The board library provides setting for OPP_NOM, OPP_OD and OPP_HIGH in
the PLL settings using 20 MHz input clock that has been used on the
AM572x GP EVM as well as the AM571x IDK platform. This allows customers
to setup the MPU to 1.5, 1.176 and 1GHz. For AM570x devices, we support
the âJâ and the âDâ variant which support the following max speeds on
the DPLLs:</p>
<img alt="../_images/AM5706_Speed_Grades.png" src="../_images/AM5706_Speed_Grades.png" />
<p>When using the âJâ speed grade, ensure that the DPLLs in the board set
the DPLL to OPP_NOM and not for OPP_OD or OPP_HIGH.</p>
<p>To do this, you can invoke the Board_Init from your application using
either</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Board_initCfg</span> <span class="n">boardCfg</span><span class="p">;</span>
<span class="n">boardCfg</span> <span class="o">=</span> <span class="n">BOARD_INIT_PLL_OPP_NOM</span><span class="p">;</span>
<span class="n">boardCfg</span> <span class="o">|=</span> <span class="n">BOARD_INIT_UNLOCK_MMR</span> <span class="o">|</span>
       <span class="n">BOARD_INIT_MODULE_CLOCK</span> <span class="o">|</span>
       <span class="n">BOARD_INIT_PINMUX_CONFIG</span> <span class="o">|</span>
       <span class="n">BOARD_INIT_DDR</span> <span class="o">|</span>
       <span class="n">BOARD_INIT_UART_STDIO</span> <span class="o">|</span>
       <span class="n">BOARD_INIT_WATCHDOG_DISABLE</span><span class="p">;</span>
<span class="cm">/* Board Library Init. */</span>
   <span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When bootloading direct from flash media, this change may also be
required in the SBL code</p>
</div>
<p>When using âDâ rated parts that run at 500 MHz, in addition to the
above configuration, you will also need to modify OPP_NOM settings in
the board library by updating the DPLL setting for MPU and DSP in the
file &lt;BoardName&gt;_pll.c as shown below:</p>
<p><strong>Step1Â : Update MPU, DSP, IVA and GPU DPLL setting</strong></p>
<ul class="simple">
<li><p><strong>MPU DPLL Changes:</strong></p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Default to OPP_NOM */</span>
     <span class="cm">/* 500MHz at 20MHz sys_clk */</span>
     <span class="n">mpuPllcParam</span><span class="p">.</span><span class="n">mult</span> <span class="o">=</span> <span class="mi">250U</span><span class="p">;</span>
     <span class="n">mpuPllcParam</span><span class="p">.</span><span class="n">div</span> <span class="o">=</span> <span class="mi">9U</span><span class="p">;</span>
     <span class="n">mpuPllcParam</span><span class="p">.</span><span class="n">dccEnable</span> <span class="o">=</span> <span class="mi">0U</span><span class="p">;</span>
     <span class="n">mpuPllcParam</span><span class="p">.</span><span class="n">divM2</span> <span class="o">=</span> <span class="mi">1U</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>DSP DPLL Changes:</strong></p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* 500MHz at 20MHz sys_clk */</span>
<span class="n">dspPllcParam</span><span class="p">.</span><span class="n">mult</span> <span class="o">=</span> <span class="mi">130U</span><span class="p">;</span>
<span class="n">dspPllcParam</span><span class="p">.</span><span class="n">div</span> <span class="o">=</span> <span class="mi">3U</span><span class="p">;</span>
<span class="n">dspPllcParam</span><span class="p">.</span><span class="n">divM2</span> <span class="o">=</span> <span class="mi">1U</span><span class="p">;</span>
<span class="n">dspPllcParam</span><span class="p">.</span><span class="n">divM3</span> <span class="o">=</span> <span class="mi">3U</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Remove IVA and GPU PLL settings</strong></p></li>
</ul>
<p>Since IVA and GPU modules are not available on the device, we recommend
removing the ivaPLL and gpuPLL settings in board.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>              <span class="cm">/* Default to OPP_NOM */</span>
              <span class="cm">/* 388.3MHz at 20MHz sys_clk */</span>
<span class="o">-</span>                <span class="n">ivaPllcParam</span><span class="p">.</span><span class="n">mult</span> <span class="o">=</span> <span class="mi">233U</span><span class="p">;</span>
<span class="o">-</span>                <span class="n">ivaPllcParam</span><span class="p">.</span><span class="n">div</span> <span class="o">=</span> <span class="mi">3U</span><span class="p">;</span>
<span class="o">-</span>                <span class="n">ivaPllcParam</span><span class="p">.</span><span class="n">divM2</span> <span class="o">=</span> <span class="mi">3U</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>             <span class="cm">/* Default to OPP_NOM */</span>
             <span class="cm">/* 425MHz at 20MHz sys_clk */</span>
<span class="o">-</span>                <span class="n">gpuPllcParam</span><span class="p">.</span><span class="n">mult</span> <span class="o">=</span> <span class="mi">170U</span><span class="p">;</span>
<span class="o">-</span>                <span class="n">gpuPllcParam</span><span class="p">.</span><span class="n">div</span> <span class="o">=</span> <span class="mi">3U</span><span class="p">;</span>
<span class="o">-</span>                <span class="n">gpuPllcParam</span><span class="p">.</span><span class="n">divM2</span> <span class="o">=</span> <span class="mi">2U</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Step 2Â : Disable clocks configuration and wakeup for IVA in PRCM</strong></p>
<ul class="simple">
<li><p><strong>Remove IVA wakeup and Module configuration</strong></p></li>
</ul>
<p>The following updates need to be made in the file &lt;BoardName&gt;_clock.c to
remove IVA wakeup and clock configuration</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">-</span>        <span class="n">CSL_FINST</span><span class="p">(</span><span class="n">ivaCmReg</span><span class="o">-&gt;</span><span class="n">CM_IVA_CLKSTCTRL_REG</span><span class="p">,</span>
<span class="o">-</span>        <span class="n">IVA_CM_CORE_CM_IVA_CLKSTCTRL_REG_CLKTRCTRL</span><span class="p">,</span> <span class="n">SW_WKUP</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>   <span class="cm">/* PRCM Specialized module mode setting functions */</span>
<span class="o">-</span>   <span class="n">CSL_FINST</span><span class="p">(</span><span class="n">ivaCmReg</span><span class="o">-&gt;</span><span class="n">CM_IVA_SL2_CLKCTRL_REG</span><span class="p">,</span>
<span class="o">-</span>       <span class="n">IVA_CM_CORE_CM_IVA_SL2_CLKCTRL_REG_MODULEMODE</span><span class="p">,</span> <span class="n">AUTO</span><span class="p">);</span>
<span class="o">-</span>  <span class="k">while</span><span class="p">(</span><span class="n">CSL_IVA_CM_CORE_CM_IVA_SL2_CLKCTRL_REG_IDLEST_DISABLE</span> <span class="o">==</span>
<span class="o">-</span>      <span class="n">CSL_FEXT</span><span class="p">(</span><span class="n">ivaCmReg</span><span class="o">-&gt;</span><span class="n">CM_IVA_SL2_CLKCTRL_REG</span><span class="p">,</span>
<span class="o">-</span>       <span class="n">IVA_CM_CORE_CM_IVA_SL2_CLKCTRL_REG_IDLEST</span><span class="p">));</span>
<span class="o">-</span>   <span class="n">CSL_FINST</span><span class="p">(</span><span class="n">ivaCmReg</span><span class="o">-&gt;</span><span class="n">CM_IVA_IVA_CLKCTRL_REG</span><span class="p">,</span>
<span class="o">-</span>       <span class="n">IVA_CM_CORE_CM_IVA_IVA_CLKCTRL_REG_MODULEMODE</span><span class="p">,</span> <span class="n">AUTO</span><span class="p">);</span>
<span class="o">-</span>   <span class="k">while</span><span class="p">(</span><span class="n">CSL_IVA_CM_CORE_CM_IVA_IVA_CLKCTRL_REG_IDLEST_DISABLE</span> <span class="o">==</span>
<span class="o">-</span>      <span class="n">CSL_FEXT</span><span class="p">(</span><span class="n">ivaCmReg</span><span class="o">-&gt;</span><span class="n">CM_IVA_IVA_CLKCTRL_REG</span><span class="p">,</span>
<span class="o">-</span>       <span class="n">IVA_CM_CORE_CM_IVA_IVA_CLKCTRL_REG_IDLEST</span><span class="p">));</span>
</pre></div>
</div>
<p>An important one to consider is the speed of the DDR memory. The clock
for the DDR is selected using the same dplls structure. Some higher
speed grade parts support a 667 MHz DDR clock, but some of the lower
speed grade parts only support a 533 MHz DDR3 clock. Make sure to choose
the appropriate DDR clock for the device on the custom board.</p>
<p>Over in the board/src/&lt;BoardName&gt;/&lt;BoardName_ddr&gt;.c file, make sure that
the EMIF is being configured correctly for the appropriate speed, and
that the appropriate number of EMIFs is being selected to match the part
being used. AM572x part has 2 DDR interfaces running at 533 MHz and the
AM571x (and AM570x) only have one running at 667 MHz. This code can be
kept or removed by the board port. As changes are made, the code must
make sure to configure the new board correctly, with the appropriate
number of DDR interfaces and speed configuration.</p>
<p>For AM571x and AM570x, make sure to use the code for the AM571x IDK in
board/src/&lt;BoardName&gt;/&lt;BoardName_ddr&gt;.c to select 1 EMIF:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* MA_LISA_MAP_i */</span>
<span class="n">hMampuLsm</span><span class="o">-&gt;</span><span class="n">MAP_0</span> <span class="o">=</span> <span class="mh">0x80600100U</span><span class="p">;</span>
<span class="cm">/* DMM_LISA_MAP_i */</span>
<span class="n">hDmmCfg</span><span class="o">-&gt;</span><span class="n">LISA_MAP</span><span class="p">[</span><span class="mi">0U</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x80600100U</span><span class="p">;</span>
</pre></div>
</div>
<p>For AM572x, this is mapped as following</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* MA_LISA_MAP_i */</span>
<span class="n">hMampuLsm</span><span class="o">-&gt;</span><span class="n">MAP_0</span> <span class="o">=</span> <span class="mh">0x80740300</span><span class="p">;</span>
<span class="n">hMampuLsm</span><span class="o">-&gt;</span><span class="n">MAP_1</span> <span class="o">=</span> <span class="mh">0x80740300</span><span class="p">;</span>
<span class="cm">/* DMM_LISA_MAP_i */</span>
<span class="n">hDmmCfg</span><span class="o">-&gt;</span><span class="n">LISA_MAP</span><span class="p">[</span><span class="mi">0U</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x80740300</span><span class="p">;</span>
<span class="n">hDmmCfg</span><span class="o">-&gt;</span><span class="n">LISA_MAP</span><span class="p">[</span><span class="mi">1U</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x80740300</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Processor SDK RTOS provides am570x_ddr.c file in the idkAM571x board
library for reference for configuring DDR on AM570x parts</p>
</div>
<ul class="simple">
<li><p>For part number where the Display subsystem or SATA is not available,
the pins can be configured to any other pin functionality that may be
required in the system. If you don`t need to use these pins, we
recommend that you leave these pins in default MUXMODE and terminate
the pinmux as recommended in the <a class="reference external" href="http://processors.wiki.ti.com/index.php/AM57xx_Schematic_Checklist">Schematics
Checklist</a>.</p></li>
<li><p>There is no pinmux setting for CSI2 module so you can leave the
MUXMODE=0 on those pins if there is no instance of the peripheral</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Processor SDK RTOS provides board/src/idkAM571x/include/am570x_pinmux.h
file in the idkAM571x board library for reference for configuring pinmux
on AM570x based hardware platform</p>
</div>
<p>Some control drivers use default Module input clock frequency settings
in &lt;module&gt;_soc.c file that gets used by the Low level drivers to
configure the peripheral clocks. The default module input clock
frequency is set to the OPP_NOM values that are available on the
superset variant of the device so if you are using lower speed grades.
Ensure you change the default to match the module clock on the 500 MHz
settings or you can use the following sequence to update the settings.
Code below describes how the SPI driver module input clock frequency can
be modified</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">SPI_v1_HWAttrs</span> <span class="n">spi_cfg</span><span class="p">;</span>
<span class="cm">/* Get the default SPI init configurations */</span>
<span class="n">SPI_socGetInitCfg</span><span class="p">(</span><span class="n">TEST_SPI_PORT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spi_cfg</span><span class="p">);</span>
<span class="cm">/* Modify the default SPI configurations if necessary */</span>
<span class="n">spi_cfg</span><span class="p">.</span><span class="n">inputClkFreq</span> <span class="o">=</span> <span class="mi">24000000</span><span class="p">;</span>
<span class="cm">/* Set the default SPI init configurations */</span>
<span class="n">SPI_socSetInitCfg</span><span class="p">(</span><span class="n">TEST_SPI_PORT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spi_cfg</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/Linux_Porting_Guide_for_AM571x/AM570x_Speed_Grades">Linux_Porting_Guide_for_AM571x/AM570x_Speed_Grades</a></p></li>
</ul>
<p class="rubric" id="useful-utilities">Useful Utilities</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.ti.com/tool/clockTreeTool">Clock Tree Tool</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/tool/PinMuxTool">Pin Mux tool</a></p></li>
</ul>
<p>For any questions related Usage of AM572x, AM571x and AM570x devices,
please post your question on TI E2E Forums</p>
<ul class="simple">
<li><p><a class="reference external" href="https://e2e.ti.com/support/arm/sitara_arm/">TI E2E Forums for Sitara
Processors</a></p></li>
</ul>
</div>
</div>
<div class="section" id="system-integration">
<h2>10.8. System Integration<a class="headerlink" href="#system-integration" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="create-dsp-and-ipu-firmware-using-pdk-drivers-and-ipc-to-load-from-arm-linux-on-am57xx-devices">
<h3>10.8.1. Create DSP and IPU firmware using PDK drivers and IPC to load from ARM Linux on AM57xx devices<a class="headerlink" href="#create-dsp-and-ipu-firmware-using-pdk-drivers-and-ipc-to-load-from-arm-linux-on-am57xx-devices" title="Permalink to this headline">Â¶</a></h3>
<p>This article is geared toward AM57xx users that are running Linux on the
Cortex A15. The goal is to help users understand how to gain entitlement
to the DSP (c66x) and IPU (Cortex M4) subsystems of the AM57xx.</p>
<p>AM572x device has two IPU subsystems (IPUSS), each of which has 2 cores.
IPU2 is used as a controller in multi-media applications, so if you have
Processor SDK Linux running, chances are that IPU2 already has firmware
loaded. However, IPU1 is open for general purpose programming to offload
the ARM tasks.</p>
<p>There are many facets to this task: building, loading, debugging, MMUs,
memory sharing, etc. This article intends to take incremental steps
toward understanding all of those pieces.</p>
<p class="rubric" id="software-dependencies-to-get-started">Software Dependencies to Get Started</p>
<p>Prerequisites</p>
<ul class="simple">
<li><p><a class="reference external" href="http://software-dl.ti.com/processor-sdk-linux/esd/AM57X/latest/index_FDS.html">Processor SDK Linux for
AM57xx</a>
(Version 3.01 or newer needed)</p></li>
<li><p><a class="reference external" href="http://software-dl.ti.com/processor-sdk-rtos/esd/AM57X/latest/index_FDS.html">Processor SDK RTOS for
AM57xx</a></p></li>
<li><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/Download_CCS">Code Composer
Studio</a>
(choose version as specified on Proc SDK download page)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please be sure that you have the same version number
for both Processor SDK RTOS and Linux.</p>
</div>
<p>For reference within the context of this wiki page, the Linux SDK is
installed at the following location:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>/mnt/data/user/ti-processor-sdk-linux-am57xx-evm-xx.xx.xx.xx
âââ bin
âââ board-support
âââ docs
âââ example-applications
âââ filesystem
âââ ipc-build.txt
âââ linux-devkit
âââ Makefile
âââ Rules.make
âââ setup.sh
</pre></div>
</div>
<p>The RTOS SDK is installed at:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>/mnt/data/user/my_custom_install_sdk_rtos_am57xx_xx.xx
âââ bios_6_xx_xx_xx
âââ cg_xml
âââ ctoolslib_x_x_x_x
âââ dsplib_c66x_x_x_x_x
âââ edma3_lld_2_xx_xx_xx
âââ framework_components_x_xx_xx_xx
âââ imglib_c66x_x_x_x_x
âââ ipc_3_xx_xx_xx
âââ mathlib_c66x_3_x_x_x
âââ ndk_2_xx_xx_xx
âââ opencl_rtos_am57xx_01_01_xx_xx
âââ openmp_dsp_am57xx_2_04_xx_xx
âââ pdk_am57xx_x_x_x
âââ processor_sdk_rtos_am57xx_x_xx_xx_xx
âââ uia_2_xx_xx_xx
âââ xdais_7_xx_xx_xx
</pre></div>
</div>
<p>CCS is installed at:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>/mnt/data/user/ti/my_custom_ccs_x.x.x_install
âââ ccsvX
âÂ Â  âââ ccs_base
âÂ Â  âââ doc
âÂ Â  âââ eclipse
âÂ Â  âââ install_info
âÂ Â  âââ install_logs
âÂ Â  âââ install_scripts
âÂ Â  âââ tools
âÂ Â  âââ uninstall_ccs
âÂ Â  âââ uninstall_ccs.dat
âÂ Â  âââ uninstallers
âÂ Â  âââ utils
âââ Code Composer Studio x.x.x.desktop
âââ xdctools_x_xx_xx_xx_core
    âââ bin
    âââ config.jar
    âââ docs
    âââ eclipse
    âââ etc
    âââ gmake
    âââ include
    âââ package
    âââ packages
    âââ package.xdc
    âââ tconfini.tcf
    âââ xdc
    âââ xdctools_3_xx_xx_xx_manifest.html
    âââ xdctools_3_xx_xx_xx_release_notes.html
    âââ xs
    âââ xs.x86U
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="typical-boot-flow-on-am572x-for-arm-linux-users">Typical Boot Flow on AM572x for ARM Linux users</p>
<p>AM57xx SOCâs have multiple processor cores - Cortex A15, C66x DSPâs and
ARM M4 cores. The A15 typically runs a HLOS like Linux/QNX/Android and
the remotecores(DSPâs and M4âs) run a RTOS. In the normal operation,
boot loader(U-Boot/SPL) boots and loads the A15 with the HLOS. The A15
boots the DSP and the M4 cores.</p>
<img alt="../_images/Normal-boot.png" src="../_images/Normal-boot.png" />
<p>In this sequence, the interval between the Power on Reset and the
remotecores (i.e. the DSPâs and the M4âs) executing is dependent on the
HLOS initialization time.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The figure below illustrates how remoteproc/rpmsg driver from ARM Linux
kernel communicates with IPC driver on slave processor (e.g. DSP, IPU,
etc) running RTOS.</p>
<img alt="../_images/LinuxIPC_with_RTOS_Slave.png" src="../_images/LinuxIPC_with_RTOS_Slave.png" />
<p>In order to setup IPC on slave cores, we provide some pre-built examples
in IPC package that can be run from ARM Linux. The subsequent sections
describe how to build and run this examples and use that as a starting
point for this effort.</p>
<p class="rubric" id="building-the-bundled-ipc-examples">Building the Bundled IPC Examples</p>
<p>The instructions to build IPC examples found under
ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf have been provided in the
<strong>`Processor_SDK IPC Quick Start
Guide &lt;http://processors.wiki.ti.com/index.php/Processor_SDK_IPC_Quick_Start_Guide#Build_IPC_Linux_examples&gt;`__.</strong></p>
<p>Letâs focus on one example in particular, ex02_messageq, which is
located at
<strong>&lt;rtos-sdk-install-dir&gt;/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq</strong>.
Here are the key files that you should see after a successful build:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>âââ dsp1
âÂ Â  âââ bin
âÂ Â   Â Â  âââ debug
âÂ Â   Â Â  âÂ Â  âââ server_dsp1.xe66
âÂ Â   Â Â  âââ release
âÂ Â   Â Â      âââ server_dsp1.xe66
âââ dsp2
âÂ Â  âââ bin
âÂ Â   Â Â  âââ debug
âÂ Â   Â Â  âÂ Â  âââ server_dsp2.xe66
âÂ Â   Â Â  âââ release
âÂ Â   Â Â      âââ server_dsp2.xe66
âââ host
âÂ Â   Â Â  âââ debug
âÂ Â   Â Â  âÂ Â  âââ app_host
âÂ Â   Â Â  âââ release
âÂ Â   Â Â      âââ app_host
âââ ipu1
âÂ Â  âââ bin
âÂ Â   Â Â  âââ debug
âÂ Â   Â Â  âÂ Â  âââ server_ipu1.xem4
âÂ Â   Â Â  âââ release
âÂ Â   Â Â      âââ server_ipu1.xem4
âââ ipu2
 Â Â  âââ bin
 Â Â   Â Â  âââ debug
 Â Â   Â Â  âÂ Â  âââ server_ipu2.xem4
 Â Â   Â Â  âââ release
 Â Â   Â Â      âââ server_ipu2.xem4
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="running-the-bundled-ipc-examples">Running the Bundled IPC Examples</p>
<p>On the target, letâs create a directory called ipc-starter:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# mkdir -p /home/root/ipc-starter
root@am57xx-evm:~# cd /home/root/ipc-starter/
</pre></div>
</div>
<p>You will need to copy the ex02_messageq directory of your host PC to
that directory on the target (through SD card, NFS export, SCP, etc.).
You can copy the entire directory, though weâre primarily interested in
these files:</p>
<ul class="simple">
<li><p>dsp1/bin/debug/server_dsp1.xe66</p></li>
<li><p>dsp2/bin/debug/server_dsp2.xe66</p></li>
<li><p>host/bin/debug/app_host</p></li>
<li><p>ipu1/bin/debug/server_ipu1.xem4</p></li>
<li><p>ipu2/bin/debug/server_ipu2.xem4</p></li>
</ul>
<p>The remoteproc driver is hard-coded to look for specific files when
loading the DSP/M4. Here are the files it looks for:</p>
<ul class="simple">
<li><p>/lib/firmware/dra7-dsp1-fw.xe66</p></li>
<li><p>/lib/firmware/dra7-dsp2-fw.xe66</p></li>
<li><p>/lib/firmware/dra7-ipu1-fw.xem4</p></li>
<li><p>/lib/firmware/dra7-ipu2-fw.xem4</p></li>
</ul>
<p>These are generally a soft link to the intended executable. So for
example, letâs update the DSP1 executable on the target:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# cd /lib/firmware/
root@am57xx-evm:/lib/firmware# rm dra7-dsp1-fw.xe66
root@am57xx-evm:/lib/firmware# ln -s /home/root/ipc-starter/ex02_messageq/dsp1/bin/debug/server_dsp1.xe66 dra7-dsp1-fw.xe66
</pre></div>
</div>
<p>To reload DSP1 with this new executable, we perform the following steps:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:/lib/firmware# cd /sys/bus/platform/drivers/omap-rproc/
root@am57xx-evm:/sys/bus/platform/drivers/omap-rproc# echo 40800000.dsp &gt; unbind
[27639.985631] omap_hwmod: mmu0_dsp1: _wait_target_disable failed
[27639.991534] omap-iommu 40d01000.mmu: 40d01000.mmu: version 3.0
[27639.997610] omap-iommu 40d02000.mmu: 40d02000.mmu: version 3.0
[27640.017557] omap_hwmod: mmu1_dsp1: _wait_target_disable failed
[27640.030571] omap_hwmod: mmu0_dsp1: _wait_target_disable failed
[27640.036605]  remoteproc2: stopped remote processor 40800000.dsp
[27640.042805]  remoteproc2: releasing 40800000.dsp
root@am57xx-evm:/sys/bus/platform/drivers/omap-rproc# echo 40800000.dsp &gt; bind
[27645.958613] omap-rproc 40800000.dsp: assigned reserved memory node dsp1_cma@99000000
[27645.966452]  remoteproc2: 40800000.dsp is available
[27645.971410]  remoteproc2: Note: remoteproc is still under development and considered experimental.
[27645.980536]  remoteproc2: THE BINARY FORMAT IS NOT YET FINALIZED, and backward compatibility isn&#39;t yet guaranteed.
root@am57xx-evm:/sys/bus/platform/drivers/omap-rproc# [27646.008171]  remoteproc2: powering up 40800000.dsp
[27646.013038]  remoteproc2: Booting fw image dra7-dsp1-fw.xe66, size 4706800
[27646.028920] omap_hwmod: mmu0_dsp1: _wait_target_disable failed
[27646.034819] omap-iommu 40d01000.mmu: 40d01000.mmu: version 3.0
[27646.040772] omap-iommu 40d02000.mmu: 40d02000.mmu: version 3.0
[27646.058323]  remoteproc2: remote processor 40800000.dsp is now up
[27646.064772] virtio_rpmsg_bus virtio2: rpmsg host is online
[27646.072271]  remoteproc2: registered virtio2 (type 7)
[27646.078026] virtio_rpmsg_bus virtio2: creating channel rpmsg-proto addr 0x3d
</pre></div>
</div>
<p>More info related to loading firmware to the various cores can be found
<a class="reference external" href="/index.php/Processor_Training:_Multimedia#Firmware_Loading_and_Unloading">here</a>.</p>
<p>Finally, we can run the example on DSP1:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:/sys/bus/platform/drivers/omap-rproc# cd /home/root/ipc-starter/ex02_messageq/host/bin/debug
root@am57xx-evm:~/ipc-starter/ex02_messageq/host/bin/debug# ./app_host DSP1
--&gt; main:
[33590.700700] omap_hwmod: mmu0_dsp2: _wait_target_disable failed
[33590.706609] omap-iommu 41501000.mmu: 41501000.mmu: version 3.0
[33590.718798] omap-iommu 41502000.mmu: 41502000.mmu: version 3.0
--&gt; Main_main:
--&gt; App_create:
App_create: Host is ready
&lt;-- App_create:
--&gt; App_exec:
App_exec: sending message 1
App_exec: sending message 2
App_exec: sending message 3
App_exec: message received, sending message 4
App_exec: message received, sending message 5
App_exec: message received, sending message 6
App_exec: message received, sending message 7
App_exec: message received, sending message 8
App_exec: message received, sending message 9
App_exec: message received, sending message 10
App_exec: message received, sending message 11
App_exec: message received, sending message 12
App_exec: message received, sending message 13
App_exec: message received, sending message 14
App_exec: message received, sending message 15
App_exec: message received
App_exec: message received
App_exec: message received
&lt;-- App_exec: 0
--&gt; App_delete:
&lt;-- App_delete:
&lt;-- Main_main:
&lt;-- main:
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The similar procedure can be used for DSP2/IPU1/IPU2 also to update
the soft link of the firmware, reload the firmware at run-time, and
run the host binary from A15.</p>
<p class="rubric" id="overall-linux-memory-map">Overall Linux Memory Map</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# cat /proc/iomem
[snip...]
58060000-58078fffÂ : core
58820000-5882ffffÂ : l2ram
58882000-588820ffÂ : /ocp/mmu@58882000
80000000-9fffffffÂ : System RAM
80008000-808d204bÂ : Kernel code
80926000-809c96bfÂ : Kernel data
a0000000-abffffffÂ : CMEM
ac000000-ffcfffffÂ : System RAM
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="cma-carveouts">CMA Carveouts</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# dmesg | grep -i cma
[    0.000000] Reserved memory: created CMA memory pool at 0x0000000095800000, size 56 MiB
[    0.000000] Reserved memory: initialized node ipu2_cma@95800000, compatible id shared-dma-pool
[    0.000000] Reserved memory: created CMA memory pool at 0x0000000099000000, size 64 MiB
[    0.000000] Reserved memory: initialized node dsp1_cma@99000000, compatible id shared-dma-pool
[    0.000000] Reserved memory: created CMA memory pool at 0x000000009d000000, size 32 MiB
[    0.000000] Reserved memory: initialized node ipu1_cma@9d000000, compatible id shared-dma-pool
[    0.000000] Reserved memory: created CMA memory pool at 0x000000009f000000, size 8 MiB
[    0.000000] Reserved memory: initialized node dsp2_cma@9f000000, compatible id shared-dma-pool
[    0.000000] cma: Reserved 24 MiB at 0x00000000fe400000
[    0.000000] Memory: 1713468K/1897472K available (6535K kernel code, 358K rwdata, 2464K rodata, 332K init, 289K bss, 28356K reserved, 155648K  cma-reserved, 1283072K highmem)
[    5.492945] omap-rproc 58820000.ipu: assigned reserved memory node ipu1_cma@9d000000
[    5.603289] omap-rproc 55020000.ipu: assigned reserved memory node ipu2_cma@95800000
[    5.713411] omap-rproc 40800000.dsp: assigned reserved memory node dsp1_cma@9b000000
[    5.771990] omap-rproc 41000000.dsp: assigned reserved memory node dsp2_cma@9f000000
</pre></div>
</div>
<p>From the output above, we can derive the location and size of each CMA
carveout:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 44%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Memory Section</p></th>
<th class="head"><p>Physical Address</p></th>
<th class="head"><p>Size</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>IPU2 CMA</p></td>
<td><p>0x95800000</p></td>
<td><p>56 MB</p></td>
</tr>
<tr class="row-odd"><td><p>DSP1 CMA</p></td>
<td><p>0x99000000</p></td>
<td><p>64 MB</p></td>
</tr>
<tr class="row-even"><td><p>IPU1 CMA</p></td>
<td><p>0x9d000000</p></td>
<td><p>32 MB</p></td>
</tr>
<tr class="row-odd"><td><p>DSP2 CMA</p></td>
<td><p>0x9f000000</p></td>
<td><p>8 MB</p></td>
</tr>
<tr class="row-even"><td><p>Default CMA</p></td>
<td><p>0xfe400000</p></td>
<td><p>24 MB</p></td>
</tr>
</tbody>
</table>
<p>For details on how to adjust the sizes and locations of the DSP/IPU CMA
carveouts, please see the corresponding section for changing the DSP or
IPU memory map.</p>
<p>To adjust the size of the âDefault CMAâ section, this is done as part of
the Linux config:</p>
<p>linux/arch/arm/configs/tisdk_am57xx-evm_defconfig</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#</span>
<span class="cp"># Default contiguous memory area size:</span>
<span class="cp">#</span>
<span class="n">CONFIG_CMA_SIZE_MBYTES</span><span class="o">=</span><span class="mi">24</span>
<span class="n">CONFIG_CMA_SIZE_SEL_MBYTES</span><span class="o">=</span><span class="n">y</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="cmem">CMEM</p>
<p>To view the allocation at run-time:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# cat /proc/cmem

Block 0: Pool 0: 1 bufs size 0xc000000 (0xc000000 requested)

Pool 0 busy bufs:

Pool 0 free bufs:
id 0: phys addr 0xa0000000
</pre></div>
</div>
<p>This shows that we have defined a CMEM block at physical base address of
0xA0000000 with total size 0xc000000 (192 MB). This block contains a
buffer pool consisting of 1 buffer. Each buffer in the pool (only one in
this case) is defined to have a size of 0xc000000 (192 MB).</p>
<p>Here is where those sizes/addresses were defined for the AM57xx EVM:</p>
<p>linux/arch/arm/boot/dts/am57xx-evm-cmem.dtsi</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>{
       reserved-memory {
               #address-cells = &lt;2&gt;;
               #size-cells = &lt;2&gt;;
               ranges;

               cmem_block_mem_0: cmem_block_mem@a0000000 {
                       reg = &lt;0x0 0xa0000000 0x0 0x0c000000&gt;;
                       no-map;
                       status = &quot;okay&quot;;
               };

               cmem_block_mem_1_ocmc3: cmem_block_mem@40500000 {
                       reg = &lt;0x0 0x40500000 0x0 0x100000&gt;;
                       no-map;
                       status = &quot;okay&quot;;
               };
       };

       cmem {
               compatible = &quot;ti,cmem&quot;;
               #address-cells = &lt;1&gt;;
               #size-cells = &lt;0&gt;;

               #pool-size-cells = &lt;2&gt;;

               status = &quot;okay&quot;;

               cmem_block_0: cmem_block@0 {
                       reg = &lt;0&gt;;
                       memory-region = &lt;&amp;cmem_block_mem_0&gt;;
                       cmem-buf-pools = &lt;1 0x0 0x0c000000&gt;;
               };

               cmem_block_1: cmem_block@1 {
                       reg = &lt;1&gt;;
                       memory-region = &lt;&amp;cmem_block_mem_1_ocmc3&gt;;
               };
       };
};
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="changing-the-dsp-memory-map">Changing the DSP Memory Map</p>
<p>First, it is important to understand that there are a pair of Memory
Management Units (MMUs) that sit between the DSP subsystems and the L3
interconnect. One of these MMUs is for the DSP core and the other is for
its local EDMA. They both serve the same purpose of translating virtual
addresses (i.e. the addresses as viewed by the DSP subsystem) into
physical addresses (i.e. addresses as viewed from the L3 interconnect).</p>
<img alt="../_images/LinuxIpcDspMmu.png" src="../_images/LinuxIpcDspMmu.png" />
<p class="rubric" id="dsp-physical-addresses">DSP Physical Addresses</p>
<p>The physical location where the DSP code/data will actually reside is
defined by the CMA carveout. To change this location, you must change
the definition of the carveout. <strong>The DSP carveouts are defined in the
Linux dts file.</strong> For example for the AM57xx EVM:</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>linux/arch/arm/boot/dts/am57xx-beagle-x15-common.dtsi</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>{
        dsp1_cma_pool: dsp1_cma@99000000 {
                compatible = &quot;shared-dma-pool&quot;;
                reg = &lt;0x0 0x99000000 0x0 0x4000000&gt;;
                reusable;
                status = &quot;okay&quot;;
        };

        dsp2_cma_pool: dsp2_cma@9f000000 {
                compatible = &quot;shared-dma-pool&quot;;
                reg = &lt;0x0 0x9f000000 0x0 0x800000&gt;;
                reusable;
                status = &quot;okay&quot;;
        };
};
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>You are able to change both the size and location. <strong>Be careful not to
overlap any other carveouts!</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <strong>two</strong> location entries for a given DSP must be
identical!</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Additionally, when you change the carveout location, there is a
corresponding change that must be made to the resource table. For
starters, if youâre making a memory change you will need a <strong>custom</strong>
resource table. The resource table is a large structure that is the
âbridgeâ between physical memory and virtual memory. This structure is
utilized for configuring the MMUs that sit in front of the DSP
subsystem. There is detailed information available in the article <a class="reference external" href="index_Foundational_Components.html#resource-custom-table">IPC
Resource customTable</a>.</p>
<p>Once youâve created your custom resource table, you must update the
address of PHYS_MEM_IPC_VRING to be the same base address as your
corresponding CMA.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined (VAYU_DSP_1)</span>
<span class="cp">#define PHYS_MEM_IPC_VRING      0x99000000</span>
<span class="cp">#elif defined (VAYU_DSP_2)</span>
<span class="cp">#define PHYS_MEM_IPC_VRING      0x9F000000</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The PHYS_MEM_IPC_VRING definition from the resource
table must match the address of the associated CMA carveout!</p>
</div>
<p class="rubric" id="dsp-virtual-addresses">DSP Virtual Addresses</p>
<p>These addresses are the ones seen by the DSP subsystem, i.e. these will
be the addresses in your linker command files, etc.</p>
<p>You must ensure that the sizes of your sections are consistent with the
corresponding definitions in the resource table. You should create your
own resource table in order to modify the memory map. This is describe
in the wiki page <a class="reference external" href="index_Foundational_Components.html#resource-custom-table">IPC Resource
customTable</a>. You can look at an
existing resource table inside IPC:</p>
<p>ipc/packages/ti/ipc/remoteproc/rsc_table_vayu_dsp.h</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">DSP_MEM_TEXT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">DSP_MEM_TEXT_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_MEM_TEXT&quot;</span><span class="p">,</span>
<span class="p">},</span>

<span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">DSP_MEM_DATA</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">DSP_MEM_DATA_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_MEM_DATA&quot;</span><span class="p">,</span>
<span class="p">},</span>

<span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">DSP_MEM_HEAP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">DSP_MEM_HEAP_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_MEM_HEAP&quot;</span><span class="p">,</span>
<span class="p">},</span>

<span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">DSP_MEM_IPC_DATA</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">DSP_MEM_IPC_DATA_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_MEM_IPC_DATA&quot;</span><span class="p">,</span>
<span class="p">},</span>

<span class="p">{</span>
    <span class="n">TYPE_TRACE</span><span class="p">,</span> <span class="n">TRACEBUFADDR</span><span class="p">,</span> <span class="mh">0x8000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;trace:dsp&quot;</span><span class="p">,</span>
<span class="p">},</span>


<span class="p">{</span>
    <span class="n">TYPE_DEVMEM</span><span class="p">,</span>
    <span class="n">DSP_MEM_IPC_VRING</span><span class="p">,</span> <span class="n">PHYS_MEM_IPC_VRING</span><span class="p">,</span>
    <span class="n">DSP_MEM_IPC_VRING_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_MEM_IPC_VRING&quot;</span><span class="p">,</span>
<span class="p">},</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Letâs have a look at some of these to understand them better. For
example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">DSP_MEM_TEXT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">DSP_MEM_TEXT_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_MEM_TEXT&quot;</span><span class="p">,</span>
<span class="p">},</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Key points to note are:</p>
<ol class="arabic simple">
<li><p>The âTYPE_CARVEOUTâ indicates that the physical memory backing this
entry will come from the associated CMA pool.</p></li>
<li><p>DSP_MEM_TEXT is a #define earlier in the code providing the address
for the code section. It is 0x95000000 by default. <strong>This must
correspond to a section from your DSP linker command file, i.e.
EXT_CODE (or whatever name you choose to give it) must be linked to
the same address.</strong></p></li>
<li><p>DSP_MEM_TEXT_SIZE is the size of the MMU pagetable entry being
created (1MB in this particular instance). <strong>The actual amount of
linked code in the corresponding section of your executable must be
less than or equal to this size.</strong></p></li>
</ol>
<p>Letâs take another:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">TYPE_TRACE</span><span class="p">,</span> <span class="n">TRACEBUFADDR</span><span class="p">,</span> <span class="mh">0x8000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;trace:dsp&quot;</span><span class="p">,</span>
<span class="p">},</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Key points are:</p>
<ol class="arabic simple">
<li><p>The âTYPE_TRACEâ indicates this is for trace info.</p></li>
<li><p>The TRACEBUFADDR is defined earlier in the file as
&amp;ti_trace_SysMin_Module_State_0_outbuf__A. That corresponds to the
symbol used in TI-RTOS for the trace buffer.</p></li>
<li><p>The â0x8000â is the size of the MMU mapping. The corresponding size
in the cfg file should be the same (or less). It looks like this:
<code class="docutils literal notranslate"><span class="pre">SysMin.bufSize</span>&#160; <span class="pre">=</span> <span class="pre">0x8000;</span></code></p></li>
</ol>
<p>Finally, letâs look at a TYPE_DEVMEM example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">TYPE_DEVMEM</span><span class="p">,</span>
    <span class="n">DSP_PERIPHERAL_L4CFG</span><span class="p">,</span> <span class="n">L4_PERIPHERAL_L4CFG</span><span class="p">,</span>
    <span class="n">SZ_16M</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DSP_PERIPHERAL_L4CFG&quot;</span><span class="p">,</span>
<span class="p">},</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Key points:</p>
<ol class="arabic simple">
<li><p>The âTYPE_DEVMEMâ indicates that we are making an MMU mapping, but
this <em>does not come from the CMA pool</em>. This is intended for mapping
peripherals, etc. that already exist in the device memory map.</p></li>
<li><p>DSP_PERIPHERAL_L4CFG (0x4A000000) is the virtual address while
L4_PERIPHERAL_L4CFG (0x4A000000) is the physical address. <strong>This is
an identity mapping, meaning that peripherals can be referenced by
the DSP using their physical address.</strong></p></li>
</ol>
<p class="rubric" id="dsp-access-to-peripherals">DSP Access to Peripherals</p>
<p>The default resource table creates the following mappings:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 30%" />
<col style="width: 11%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Virtual Address</p></th>
<th class="head"><p>Physical Address</p></th>
<th class="head"><p>Size</p></th>
<th class="head"><p>Comment</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x4A000000</p></td>
<td><p>0x4A000000</p></td>
<td><p>16 MB</p></td>
<td><p>L4CFG + L4WKUP</p></td>
</tr>
<tr class="row-odd"><td><p>0x48000000</p></td>
<td><p>0x48000000</p></td>
<td><p>2 MB</p></td>
<td><p>L4PER1</p></td>
</tr>
<tr class="row-even"><td><p>0x48400000</p></td>
<td><p>0x48400000</p></td>
<td><p>4 MB</p></td>
<td><p>L4PER2</p></td>
</tr>
<tr class="row-odd"><td><p>0x48800000</p></td>
<td><p>0x48800000</p></td>
<td><p>8 MB</p></td>
<td><p>L4PER3</p></td>
</tr>
<tr class="row-even"><td><p>0x54000000</p></td>
<td><p>0x54000000</p></td>
<td><p>16 MB</p></td>
<td><p>L3_INSTR + CT_TBR</p></td>
</tr>
<tr class="row-odd"><td><p>0x4E000000</p></td>
<td><p>0x4E000000</p></td>
<td><p>1 MB</p></td>
<td><p>DMM config</p></td>
</tr>
</tbody>
</table>
<p>In other words, the peripherals can be accessed at their physical
addresses since we use an identity mapping.</p>
<p class="rubric" id="inspecting-the-dsp-iommu-page-tables-at-run-time">Inspecting the DSP IOMMU Page Tables at Run-Time</p>
<p>You can dump the DSP IOMMU page tables with the following commands:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>DSP</p></th>
<th class="head"><p>MMU</p></th>
<th class="head"><p>Command</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>DSP1</p></td>
<td><p>MMU0</p></td>
<td><p>cat /sys/kernel/debug/omap_iommu/40d01000.mmu/pagetable</p></td>
</tr>
<tr class="row-odd"><td><p>DSP1</p></td>
<td><p>MMU1</p></td>
<td><p>cat /sys/kernel/debug/omap_iommu/40d02000.mmu/pagetable</p></td>
</tr>
<tr class="row-even"><td><p>DSP2</p></td>
<td><p>MMU0</p></td>
<td><p>cat /sys/kernel/debug/omap_iommu/41501000.mmu/pagetable</p></td>
</tr>
<tr class="row-odd"><td><p>DSP2</p></td>
<td><p>MMU1</p></td>
<td><p>cat /sys/kernel/debug/omap_iommu/41502000.mmu/pagetable</p></td>
</tr>
</tbody>
</table>
<p>In general, MMU0 and MMU1 are being programmed identically so you really
only need to take a look at one or the other to understand the mapping
for a given DSP.</p>
<p>For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# cat /sys/kernel/debug/omap_iommu/40d01000.mmu/pagetable
L:      da:     pte:
--------------------------
1: 0x48000000 0x48000002
1: 0x48100000 0x48100002
1: 0x48400000 0x48400002
1: 0x48500000 0x48500002
1: 0x48600000 0x48600002
1: 0x48700000 0x48700002
1: 0x48800000 0x48800002
1: 0x48900000 0x48900002
1: 0x48a00000 0x48a00002
1: 0x48b00000 0x48b00002
1: 0x48c00000 0x48c00002
1: 0x48d00000 0x48d00002
1: 0x48e00000 0x48e00002
1: 0x48f00000 0x48f00002
1: 0x4a000000 0x4a040002
1: 0x4a100000 0x4a040002
1: 0x4a200000 0x4a040002
1: 0x4a300000 0x4a040002
1: 0x4a400000 0x4a040002
1: 0x4a500000 0x4a040002
1: 0x4a600000 0x4a040002
1: 0x4a700000 0x4a040002
1: 0x4a800000 0x4a040002
1: 0x4a900000 0x4a040002
1: 0x4aa00000 0x4a040002
1: 0x4ab00000 0x4a040002
1: 0x4ac00000 0x4a040002
1: 0x4ad00000 0x4a040002
1: 0x4ae00000 0x4a040002
1: 0x4af00000 0x4a040002
</pre></div>
</div>
<p>The first column tells us whether the mapping is a Level 1 or Level 2
descriptor. All the lines above are a first level descriptor, so we look
at the associated format from the TRM:</p>
<img alt="../_images/LinuxIpcPageTableDescriptor1.png" src="../_images/LinuxIpcPageTableDescriptor1.png" />
<p>The âdaâ (âdevice addressâ) column reflects the virtual address. It is
<em>derived</em> from the index into the table, i.e. there does not exist a
âdaâ register or field in the page table. Each MB of the address space
maps to an entry in the table. The âdaâ column is displayed to make it
easy to find the virtual address of interest.</p>
<p>The âpteâ (âpage table entryâ) column can be decoded according to Table
20-4 shown above. For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="o">:</span> <span class="mh">0x4a000000</span> <span class="mh">0x4a040002</span>
</pre></div>
</div>
<p>The 0x4a040002 shows us that it is a Supersection with base address
0x4A000000. This gives us a 16 MB memory page. Note the repeated entries
afterward. Thatâs a requirement of the MMU. Hereâs an excerpt from the
TRM:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Supersection descriptors must be repeated 16 times,
because each descriptor in the first level translation table describes 1
MiB of memory. If an access points to a descriptor that is not
initialized, the MMU will behave in an unpredictable way.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="changing-cortex-m4-ipu-memory-map">Changing Cortex M4 IPU Memory Map</p>
<p>In order to fully understand the memory mapping of the Cortex M4 IPU
Subsystems, itâs helpful to recognize that there are two
distinct/independent levels of memory translation. Hereâs a snippet from
the TRM to illustrate:</p>
<img alt="../_images/LinuxIpcIpuMmu.png" src="../_images/LinuxIpcIpuMmu.png" />
<p class="rubric" id="cortex-m4-ipu-physical-addresses">Cortex M4 IPU Physical Addresses</p>
<p>The physical location where the M4 code/data will actually reside is
defined by the CMA carveout. To change this location, you must change
the definition of the carveout. <strong>The M4 carveouts are defined in the
Linux dts file.</strong> For example for the AM57xx EVM:</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p>linux/arch/arm/boot/dts/am57xx-beagle-x15-common.dtsi</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>{
        ipu2_cma_pool: ipu2_cma@95800000 {
                compatible = &quot;shared-dma-pool&quot;;
                reg = &lt;0x0 95800000 0x0 0x3800000&gt;;
                reusable;
                status = &quot;okay&quot;;
        };

        ipu1_cma_pool: ipu1_cma@9d000000 {
                compatible = &quot;shared-dma-pool&quot;;
                reg = &lt;0x0 9d000000 0x0 0x2000000&gt;;
                reusable;
                status = &quot;okay&quot;;
        };
};
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>You are able to change both the size and location. <strong>Be careful not to
overlap any other carveouts!</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <strong>two</strong> location entries for a given carveout
must be identical!</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Additionally, when you change the carveout location, there is a
corresponding change that must be made to the resource table. For
starters, if youâre making a memory change you will need a <strong>custom</strong>
resource table. The resource table is a large structure that is the
âbridgeâ between physical memory and virtual memory. This structure is
utilized for configuring the IPUx_MMU (not the Unicache MMU). There is
detailed information available in the article <a class="reference external" href="index_Foundational_Components.html#resource-custom-table">IPC Resource
customTable</a>.</p>
<p>Once youâve created your custom resource table, you must update the
address of PHYS_MEM_IPC_VRING to be the same base address as your
corresponding CMA.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(VAYU_IPU_1)</span>
<span class="cp">#define PHYS_MEM_IPC_VRING      0x9D000000</span>
<span class="cp">#elif defined (VAYU_IPU_2)</span>
<span class="cp">#define PHYS_MEM_IPC_VRING      0x95800000</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The PHYS_MEM_IPC_VRING definition from the resource
table must match the address of the associated CMA carveout!</p>
</div>
<p class="rubric" id="cortex-m4-ipu-virtual-addresses">Cortex M4 IPU Virtual Addresses</p>
<p class="rubric" id="unicache-mmu">Unicache MMU</p>
<p>The Unicache MMU sits closest to the Cortex M4. It provides the first
level of address translation. The Unicache MMU is actually âself
programmedâ by the Cortex M4. The Unicache MMU is also referred to as
the Attribute MMU (AMMU). There are a fixed number of small, medium and
large pages. Hereâs a snippet showing some of the key mappings:</p>
<p>ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/ipu1/IpuAmmu.cfg</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*********************** Large Pages *************************/</span>
<span class="cm">/* Instruction Code: Large page  (512M); cacheable */</span>
<span class="cm">/* config large page[0] to map 512MB VA 0x0 to L3 0x0 */</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pageEnabled</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Enable_YES</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">logicalAddress</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">translationEnabled</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Enable_NO</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">size</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Large_512M</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">L1_cacheable</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">CachePolicy_CACHEABLE</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">L1_posted</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">PostedPolicy_POSTED</span><span class="p">;</span>

<span class="cm">/* Peripheral regions: Large Page (512M); non-cacheable */</span>
<span class="cm">/* config large page[1] to map 512MB VA 0x60000000 to L3 0x60000000 */</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">pageEnabled</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Enable_YES</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">logicalAddress</span> <span class="o">=</span> <span class="mh">0x60000000</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">translationEnabled</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Enable_NO</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">size</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Large_512M</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">L1_cacheable</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">CachePolicy_NON_CACHEABLE</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">L1_posted</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">PostedPolicy_POSTED</span><span class="p">;</span>

<span class="cm">/* Private, Shared and IPC Data regions: Large page (512M); cacheable */</span>
<span class="cm">/* config large page[2] to map 512MB VA 0x80000000 to L3 0x80000000 */</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">pageEnabled</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Enable_YES</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">logicalAddress</span> <span class="o">=</span> <span class="mh">0x80000000</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">translationEnabled</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Enable_NO</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">size</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">Large_512M</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">L1_cacheable</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">CachePolicy_CACHEABLE</span><span class="p">;</span>
<span class="n">AMMU</span><span class="p">.</span><span class="n">largePages</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">L1_posted</span> <span class="o">=</span> <span class="n">AMMU</span><span class="p">.</span><span class="n">PostedPolicy_POSTED</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<hr class="docutils" />
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 28%" />
<col style="width: 28%" />
<col style="width: 10%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Page</p></th>
<th class="head"><p>Cortex M4 Address</p></th>
<th class="head"><p>Intermediate Address</p></th>
<th class="head"><p>Size</p></th>
<th class="head"><p>Comment</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Large Page 0</p></td>
<td><p>0x00000000-0x1fffffff</p></td>
<td><p>0x00000000-0x1fffffff</p></td>
<td><p>512 MB</p></td>
<td><p>Code</p></td>
</tr>
<tr class="row-odd"><td><p>Large Page 1</p></td>
<td><p>0x60000000-0x7fffffff</p></td>
<td><p>0x60000000-0x7fffffff</p></td>
<td><p>512 MB</p></td>
<td><p>Peripherals</p></td>
</tr>
<tr class="row-even"><td><p>Large Page 2</p></td>
<td><p>0x80000000-0x9fffffff</p></td>
<td><p>0x80000000-0x9fffffff</p></td>
<td><p>512 MB</p></td>
<td><p>Data</p></td>
</tr>
</tbody>
</table>
<p>These 3 pages are âidentityâ mappings, performing a passthrough of
requests to the associated address ranges. These intermediate addresses
get mapped to their physical addresses in the next level of translation
(IOMMU).</p>
<p>The AMMU ranges for code and data <em>need</em> to be identity mappings because
otherwise the remoteproc loader wouldnât be able to match up the
sections from the ELF file with the associated IOMMU mapping. These
mappings should suffice for any application, i.e. no need to adjust
these. The more likely area for modification is the resource table in
the next section. The AMMU mappings are needed mainly to understand the
full picture with respect to the Cortex M4 memory map.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="iommu">IOMMU</p>
<p>The IOMMU sits closest to the L3 interconnect. It takes the intermediate
address output from the AMMU and translates it to the physical address
used by the L3 interconnect. The IOMMU is programmed by the ARM based on
the associated resource table. If youâre planning any memory changes
then youâll want to make a custom resource table as described in the
wiki page <a class="reference external" href="index_Foundational_Components.html#resource-custom-table">IPC Resource
customTable</a>.</p>
<p>The default resource table (which can be adapted to make a custom table)
can be found at this location:</p>
<p>ipc/packages/ti/ipc/remoteproc/rsc_table_vayu_ipu.h</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define IPU_MEM_TEXT            0x0</span>
<span class="cp">#define IPU_MEM_DATA            0x80000000</span>

<span class="cp">#define IPU_MEM_IOBUFS          0x90000000</span>

<span class="cp">#define IPU_MEM_IPC_DATA        0x9F000000</span>
<span class="cp">#define IPU_MEM_IPC_VRING       0x60000000</span>
<span class="cp">#define IPU_MEM_RPMSG_VRING0    0x60000000</span>
<span class="cp">#define IPU_MEM_RPMSG_VRING1    0x60004000</span>
<span class="cp">#define IPU_MEM_VRING_BUFS0     0x60040000</span>
<span class="cp">#define IPU_MEM_VRING_BUFS1     0x60080000</span>

<span class="cp">#define IPU_MEM_IPC_VRING_SIZE  SZ_1M</span>
<span class="cp">#define IPU_MEM_IPC_DATA_SIZE   SZ_1M</span>

<span class="cp">#if defined(VAYU_IPU_1)</span>
<span class="cp">#define IPU_MEM_TEXT_SIZE       (SZ_1M)</span>
<span class="cp">#elif defined(VAYU_IPU_2)</span>
<span class="cp">#define IPU_MEM_TEXT_SIZE       (SZ_1M * 6)</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(VAYU_IPU_1)</span>
<span class="cp">#define IPU_MEM_DATA_SIZE       (SZ_1M * 5)</span>
<span class="cp">#elif defined(VAYU_IPU_2)</span>
<span class="cp">#define IPU_MEM_DATA_SIZE       (SZ_1M * 48)</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>&lt;snipâ¦&gt;</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">IPU_MEM_TEXT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">IPU_MEM_TEXT_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;IPU_MEM_TEXT&quot;</span><span class="p">,</span>
<span class="p">},</span>

<span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">IPU_MEM_DATA</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">IPU_MEM_DATA_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;IPU_MEM_DATA&quot;</span><span class="p">,</span>
<span class="p">},</span>

<span class="p">{</span>
    <span class="n">TYPE_CARVEOUT</span><span class="p">,</span>
    <span class="n">IPU_MEM_IPC_DATA</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">IPU_MEM_IPC_DATA_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;IPU_MEM_IPC_DATA&quot;</span><span class="p">,</span>
<span class="p">},</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The 3 entries above from the resource table all come from the associated
IPU CMA pool (i.e. as dictated by the TYPE_CARVEOUT). The second
parameter represents the virtual address (i.e. input address to the
IOMMU). <strong>These addresses must be consistent with both the AMMU mapping
as well as the linker command file.</strong> The ex02_messageq example from ipc
defines these memory sections in the file
examples/DRA7XX_linux_elf/ex02_messageq/shared/config.bld.</p>
<p>You can dump the IPU IOMMU page tables with the following commands:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>IPU</p></th>
<th class="head"><p>Command</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>IPU1</p></td>
<td><p>cat /sys/kernel/debug/omap_iommu/58882000.mmu/pagetable</p></td>
</tr>
<tr class="row-odd"><td><p>IPU2</p></td>
<td><p>cat /sys/kernel/debug/omap_iommu/55082000.mmu/pagetable</p></td>
</tr>
</tbody>
</table>
<p>Please see the <a class="reference external" href="/index.php/Linux_IPC_on_AM57xx#Inspecting_the_DSP_IOMMU_Page_Tables_at_Run-Time">corresponding DSP
documentation</a>
for more details on interpreting the output.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="cortex-m4-ipu-access-to-peripherals">Cortex M4 IPU Access to Peripherals</p>
<p>The default resource table creates the following mappings:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Virtual
Address
used by
Cortex M4</p></th>
<th class="head"><p>Address at
output of
Unicache
MMU</p></th>
<th class="head"><p>Address at
output of
IOMMU</p></th>
<th class="head"><p>Size</p></th>
<th class="head"><p>Comment</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x6A000000</p></td>
<td><p>0x6A000000</p></td>
<td><p>0x4A000000</p></td>
<td><p>16 MB</p></td>
<td><p>L4CFG +
L4WKUP</p></td>
</tr>
<tr class="row-odd"><td><p>0x68000000</p></td>
<td><p>0x68000000</p></td>
<td><p>0x48000000</p></td>
<td><p>2 MB</p></td>
<td><p>L4PER1</p></td>
</tr>
<tr class="row-even"><td><p>0x68400000</p></td>
<td><p>0x68400000</p></td>
<td><p>0x48400000</p></td>
<td><p>4 MB</p></td>
<td><p>L4PER2</p></td>
</tr>
<tr class="row-odd"><td><p>0x68800000</p></td>
<td><p>0x68800000</p></td>
<td><p>0x48800000</p></td>
<td><p>8 MB</p></td>
<td><p>L4PER3</p></td>
</tr>
<tr class="row-even"><td><p>0x74000000</p></td>
<td><p>0x74000000</p></td>
<td><p>0x54000000</p></td>
<td><p>16 MB</p></td>
<td><p>L3_INSTR +
CT_TBR</p></td>
</tr>
</tbody>
</table>
<p>Example: Accessing UART5 from IPU</p>
<ol class="arabic simple">
<li><p>For this example, itâs assumed the pin-muxing was already setup in
the bootloader. If thatâs not the case, you would need to do that
here.</p></li>
<li><p>The UART5 module needs to be enabled via the CM_L4PER_UART5_CLKCTRL
register. This is located at physical address 0x4A009870. So from the
M4 we would program this register at virtual address 0x6A009870.
Writing a value of 2 to this register will enable the peripheral.</p></li>
<li><p>After completing the previous step, the UART5 registers will become
accessible. Normally UART5 is accessible at physical base address
0x48066000. This would correspondingly be accessed from the IPU at
0x68066000.</p></li>
</ol>
<p>The IPUs and DSPs auto-idle by default. This can prevent you from being
able to connect to the device using JTAG or from accessing local memory
via devmem2. There are some options sprinkled throughout sysfs that are
needed in order to force these subsystems on, as is sometimes needed for
development and debug purposes.</p>
<p>There are some hard-coded device names that originate in the device tree
(dra7.dtsi) that are needed for these operations:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 46%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Remote Core</p></th>
<th class="head"><p>Definition in dra7.dtsi</p></th>
<th class="head"><p>System FS Name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>IPU1</p></td>
<td><p><a class="reference external" href="mailto:ipu&#37;&#52;&#48;58820000">ipu<span>&#64;</span>58820000</a></p></td>
<td><p>58820000.ipu</p></td>
</tr>
<tr class="row-odd"><td><p>IPU2</p></td>
<td><p><a class="reference external" href="mailto:ipu&#37;&#52;&#48;55020000">ipu<span>&#64;</span>55020000</a></p></td>
<td><p>55020000.ipu</p></td>
</tr>
<tr class="row-even"><td><p>DSP1</p></td>
<td><p><a class="reference external" href="mailto:dsp&#37;&#52;&#48;40800000">dsp<span>&#64;</span>40800000</a></p></td>
<td><p>40800000.dsp</p></td>
</tr>
<tr class="row-odd"><td><p>DSP2</p></td>
<td><p><a class="reference external" href="mailto:dsp&#37;&#52;&#48;41000000">dsp<span>&#64;</span>41000000</a></p></td>
<td><p>41000000.dsp</p></td>
</tr>
<tr class="row-even"><td><p>ICSS1-PRU0</p></td>
<td><p><a class="reference external" href="mailto:pru&#37;&#52;&#48;4b234000">pru<span>&#64;</span>4b234000</a></p></td>
<td><p>4b234000.pru0</p></td>
</tr>
<tr class="row-odd"><td><p>ICSS1-PRU1</p></td>
<td><p><a class="reference external" href="mailto:pru&#37;&#52;&#48;4b238000">pru<span>&#64;</span>4b238000</a></p></td>
<td><p>4b238000.pru1</p></td>
</tr>
<tr class="row-even"><td><p>ICSS2-PRU0</p></td>
<td><p><a class="reference external" href="mailto:pru&#37;&#52;&#48;4b2b4000">pru<span>&#64;</span>4b2b4000</a></p></td>
<td><p>4b2b4000.pru0</p></td>
</tr>
<tr class="row-odd"><td><p>ICSS2-PRU1</p></td>
<td><p><a class="reference external" href="mailto:pru&#37;&#52;&#48;4b2b8000">pru<span>&#64;</span>4b2b8000</a></p></td>
<td><p>4b2b8000.pru1</p></td>
</tr>
</tbody>
</table>
<p>To map these System FS names to the associated remoteproc entry, you can
run the following commands:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# ls -l /sys/kernel/debug/remoteproc/
root@am57xx-evm:~# cat /sys/kernel/debug/remoteproc/remoteproc*/name
</pre></div>
</div>
<p>The results of the commands will be a one-to-one mapping. For example,
58820000.ipu corresponds with remoteproc0.</p>
<p>Similarly, to see the power state of each of the cores:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# cat /sys/class/remoteproc/remoteproc*/state
</pre></div>
</div>
<p>The state can be suspended, running, offline, etc. You can only attach
JTAG if the state is ârunningâ. If it shows as âsuspendedâ then you must
force it to run. For example, letâs say DSP0 is âsuspendedâ. You can run
the following command to force it on:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# echo on &gt; /sys/bus/platform/devices/40800000.dsp/power/control
</pre></div>
</div>
<p>The same is true for any of the cores, but replace 40800000.dsp with the
associated System FS name from the chart above.</p>
<p class="rubric" id="adding-ipc-to-an-existing-ti-rtos-application-on-the-dsp">Adding IPC to an existing TI RTOS application on the DSP</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>A common thing people want to do is take an existing DSP application
and add IPC to it. This is common when migrating from a DSP only
solution to a heterogeneous SoC with an Arm plus a DSP. This is the
focus of this section.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In order to describe this process, we need an example test case to
work with. For this purpose, weâll be using the
GPIO_LedBlink_evmAM572x_c66xExampleProject example thatâs part of the
PDK (installed as part of the Processor SDK RTOS). You can find it at
c:/ti/pdk_am57xx_1_0_4/packages/MyExampleProjects/GPIO_LedBlink_evmAM572x_c66xExampleProject.
This example uses SYS/BIOS and blinks the USER0 LED on the AM572x GP
EVM, itâs labeled D4 on the EVM silkscreen just to the right of the
blue reset button.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>There were several steps taken to make this whole process work, each of
which will be described in following sections</p>
<ol class="arabic simple">
<li><p>Build and run the out-of-box LED blink example on the EVM using Code
Composer Studio (CCS)</p></li>
<li><p>Take the ex02_message example from the IPC software bundle and turn
it into a CCS project. Build it and modify the Linux startup code to
use this new image. This is just a sanity check step to make sure we
can build the IPC examples in CCS and have them run at boot up on the
EVM.</p></li>
<li><p>In CCS, make a clone of the out-of-box LED example and rename it to
denote itâs the IPC version of the example. Then using the
ex02_messageq example as a reference, add in the IPC pieces to the
LED example. Build from CCS then add it to the Linux firmware folder.</p></li>
</ol>
<p class="rubric" id="running-led-blink-pdk-example-from-ccs">Running LED Blink PDK Example from CCS</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>TODO - Fill this section in with instructions on how to run the LED
blink example using JTAG and CCS after the board has booted Linux.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some edits were made to the LED blink example to allow it to run</p>
</div>
<p>in a Linux environment, specifically, removed the GPIO interrupts and
then added a Clock object to call the LED GPIO toggle function on a
periodic bases.</p>
<p class="rubric" id="make-ccs-project-out-of-ex02-messageq-ipc-example">Make CCS project out of ex02_messageq IPC example</p>
<p>TODO - fill this section in with instructions on how to make a CCS
project out of the IPC example source files.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="add-ipc-to-the-led-blink-example">Add IPC to the LED Blink Example</p>
<p>The first step is to clone our out-of-box LED blink CCS project and
rename it to denote itâs using IPC. The easiest way to do this is using
CCS. Here are the stepsâ¦</p>
<ul class="simple">
<li><p>In the <em>Edit</em> perspective, go into your <em>Project Explorer</em> window and
right click on your GPIO_LedBlink_evmAM572x+c66xExampleProject
project and select <em>copy</em> from the pop-up menu. Maske sure the
project is not is a closed state.</p></li>
<li><p>Rick click in and empty area of the project explorer window and
select past.</p></li>
<li><p>A dialog box pops up, modify the name to denote itâs using IPC. A
good name is GPIO_LedBlink_evmAM572x+c66xExampleProjec_with_ipc.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>This is the project weâll be working with from here on. The next thing
we want to do is select the proper RTSC platform and other components.
To do this, follow these steps.</p>
<ul class="simple">
<li><p>Right click on the GPIO_LedBlink_evmAM572x+c66xExampleProjec_with_ipc
project and select <em>Properties</em></p></li>
<li><p>In the left hand pane, click on <em>CCS General</em>.</p></li>
<li><p>On the right hand side, click on the <em>RTSC</em> tab</p></li>
<li><p>For <em>XDCtools version:</em> select 3.32.0.06_core</p></li>
<li><p>In the list of <em>Products and Repositories</em>, <em>check</em> the followingâ¦</p>
<ul>
<li><p>IPC 3.43.2.04</p></li>
<li><p>SYS/BIOS 6.45.1.29</p></li>
<li><p>am57xx PDK 1.0.4</p></li>
</ul>
</li>
<li><p>For <em>Target</em>, select ti.targets.elf.C66</p></li>
<li><p>For <em>Platform</em>, select ti.platforms.evmDRA7XX</p></li>
<li><p>Once the platform is selected, edit its name buy hand and
appendÂ :dsp1 to the end. After this it should be
ti.platforms.evmDRA7XX:dsp1</p></li>
<li><p>Go ahead and leave the <em>Build-profile</em> set to debug.</p></li>
<li><p>Hit the OK button.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Now we want to copy configuration and source files from the
ex02_messageq IPC example into our project. The IPC example is located
at <em>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq</em>. To
copy files into your CCS project, you can simply select the files you
want in Windows explorer then drag and drop them into your project in
CCS.</p>
<p>Copy these files into your CCS projectâ¦</p>
<ul class="simple">
<li><p>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/shared/AppCommon.h</p></li>
<li><p>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/shared/config.bld</p></li>
<li><p>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/shared/ipc.cfg.xs</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Now copy these files into your CCS projectâ¦</p>
<ul class="simple">
<li><p>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/dsp1/Dsp1.cfg</p></li>
<li><p>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/dsp1/MainDsp1.c</p></li>
<li><p>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/dsp1/Server.c</p></li>
<li><p>C:/ti/ipc_3_43_02_04/examples/DRA7XX_linux_elf/ex02_messageq/dsp1/Server.h</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you copy Dsp1.cfg into your CCS project, it
should show up greyed out. This is because the LED blink example
already has a cfg file (gpio_test_evmAM572x.cfg). The Dsp1.cfg will be
used for copying and pasting. When itâs all done, you can delete it
from your project.</p>
</div>
<p>Finally, you will likely want to use a custom resource table so copy
these files into your CCS projectâ¦</p>
<ul class="simple">
<li><p>C:/ti/ipc_3_43_02_04/packages/ti/ipc/remoteproc/rsc_table_vayu_dsp.h</p></li>
<li><p>C:/ti/ipc_3_43_02_04/packages/ti/ipc/remoteproc/rsc_types.h</p></li>
</ul>
<p>The rsc_table_vayu_dsp.h file defines an initialized structure so letâs
make a <em>.c</em> source file.</p>
<ul class="simple">
<li><p>In your CCS project, rename rsc_table_vayu_dsp.h to
rsc_table_vayu_dsp.c</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">Now we want to <em>merge</em> the IPC example configuration file with the LED
blink example configuration file. Follow these stepsâ¦</div>
</div>
<ul class="simple">
<li><p>Open up <em>Dsp1.cfg</em> using a text editor (donât open it using the GUI).
Right click on it and select <em>Open With -&gt; XDCscript Editor</em></p></li>
<li><p>We want to copy the entire contents into the clipboard. Select all
and copy.</p></li>
<li><p>Now just like above, open the gpio_test_evmAM572x.cfg config file in
the text editor. Go to the very bottom and <em>paste</em> in the contents
from the Dsp1.cfg file. Basically weâve appended the contents of
Dsp1.cfg into gpio_test_evmAM572x.cfg.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Weâve now added in all the necessary configuration and source files
into our project. Donât expect it to build at this point, we have to
make edits first. These edits are listed below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can download the full CCS project with source files to use as a reference.
See link towards the end of this section.</p>
</div>
<ul class="simple">
<li><p>Edit <strong>gpio_test_evmAM572x.cfg</strong></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add the following to the beginning of your configuration file</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>var Program = xdc.useModule(&#39;xdc.cfg.Program&#39;);
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the Memory sections configuration as shown below</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* ================ Memory sections configuration ================ */</span>
<span class="c1">//Program.sectMap[&quot;.text&quot;] = &quot;EXT_RAM&quot;;</span>
<span class="c1">//Program.sectMap[&quot;.const&quot;] = &quot;EXT_RAM&quot;;</span>
<span class="c1">//Program.sectMap[&quot;.plt&quot;] = &quot;EXT_RAM&quot;;</span>
<span class="cm">/* Program.sectMap[&quot;BOARD_IO_DELAY_DATA&quot;] = &quot;OCMC_RAM1&quot;; */</span>
<span class="cm">/* Program.sectMap[&quot;BOARD_IO_DELAY_CODE&quot;] = &quot;OCMC_RAM1&quot;; */</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Since we are no longer using a shared folder, make the following change</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//var ipc_cfg = xdc.loadCapsule(&quot;../shared/ipc.cfg.xs&quot;);</span>
<span class="n">var</span> <span class="n">ipc_cfg</span> <span class="o">=</span> <span class="n">xdc</span><span class="p">.</span><span class="n">loadCapsule</span><span class="p">(</span><span class="s">&quot;../ipc.cfg.xs&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the following. Weâll be calling this function directly from
main.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//BIOS.addUserStartupFunction(&#39;&amp;IpcMgr_ipcStartup&#39;);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Increase the system stack size</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Program.stack = 0x1000;</span>
<span class="n">Program</span><span class="p">.</span><span class="n">stack</span> <span class="o">=</span> <span class="mh">0x8000</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the entire TICK section</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* --------------------------- TICK --------------------------------------*/</span>
<span class="c1">// var Clock = xdc.useModule(&#39;ti.sysbios.knl.Clock&#39;);</span>
<span class="c1">// Clock.tickSource = Clock.TickSource_NULL;</span>
<span class="c1">// //Clock.tickSource = Clock.TickSource_USER;</span>
<span class="c1">// /* Configure BIOS clock source as GPTimer5 */</span>
<span class="c1">// //Clock.timerId = 0;</span>
<span class="c1">//</span>
<span class="c1">// var Timer = xdc.useModule(&#39;ti.sysbios.timers.dmtimer.Timer&#39;);</span>
<span class="c1">//</span>
<span class="c1">// /* Skip the Timer frequency verification check. Need to remove this later */</span>
<span class="c1">// Timer.checkFrequency = false;</span>
<span class="c1">//</span>
<span class="c1">// /* Match this to the SYS_CLK frequency sourcing the dmTimers.</span>
<span class="c1">//  * Not needed once the SYS/BIOS family settings is updated. */</span>
<span class="c1">// Timer.intFreq.hi = 0;</span>
<span class="c1">// Timer.intFreq.lo = 19200000;</span>
<span class="c1">//</span>
<span class="c1">// //var timerParams = new Timer.Params();</span>
<span class="c1">// //timerParams.period = Clock.tickPeriod;</span>
<span class="c1">// //timerParams.periodType = Timer.PeriodType_MICROSECS;</span>
<span class="c1">// /* Switch off Software Reset to make the below settings effective */</span>
<span class="c1">// //timerParams.tiocpCfg.softreset = 0x0;</span>
<span class="c1">// /* Smart-idle wake-up-capable mode */</span>
<span class="c1">// //timerParams.tiocpCfg.idlemode = 0x3;</span>
<span class="c1">// /* Wake-up generation for Overflow */</span>
<span class="c1">// //timerParams.twer.ovf_wup_ena = 0x1;</span>
<span class="c1">// //Timer.create(Clock.timerId, Clock.doTick, timerParams);</span>
<span class="c1">//</span>
<span class="c1">// var Idle = xdc.useModule(&#39;ti.sysbios.knl.Idle&#39;);</span>
<span class="c1">// var Deh = xdc.useModule(&#39;ti.deh.Deh&#39;);</span>
<span class="c1">//</span>
<span class="c1">// /* Must be placed before pwr mgmt */</span>
<span class="c1">// Idle.addFunc(&#39;&amp;ti_deh_Deh_idleBegin&#39;);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Make configuration change to use custom resource table. Add to the end
of the file.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>/* Override the default resource table with my own */
var Resource = xdc.useModule(&#39;ti.ipc.remoteproc.Resource&#39;);
Resource.customTable = true;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p>Edit <strong>main_led_blink.c</strong></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add the following external declarations</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span> <span class="n">Int</span> <span class="nf">ipc_main</span><span class="p">();</span>
<span class="k">extern</span> <span class="n">Void</span> <span class="nf">IpcMgr_ipcStartup</span><span class="p">(</span><span class="n">Void</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In main(), add a call to ipc_main() and IpcMgr_ipcStartup() just before
BIOS_start()</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ipc_main</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="n">callIpcStartup</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">IpcMgr_ipcStartup</span><span class="p">();</span>
<span class="p">}</span>

<span class="cm">/* Start BIOS */</span>
<span class="n">BIOS_start</span><span class="p">();</span>
<span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the line that calls Board_init(boardCfg). This call is in
the original example because it assumes TI-RTOS is running on the Arm
but in our case here, we are running Linux and this call is
destructive so we comment it out.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(EVM_K2E) || defined(EVM_C6678)</span>
    <span class="n">boardCfg</span> <span class="o">=</span> <span class="n">BOARD_INIT_MODULE_CLOCK</span> <span class="o">|</span>
    <span class="n">BOARD_INIT_UART_STDIO</span><span class="p">;</span>
<span class="cp">#else</span>
    <span class="n">boardCfg</span> <span class="o">=</span> <span class="n">BOARD_INIT_PINMUX_CONFIG</span> <span class="o">|</span>
    <span class="n">BOARD_INIT_MODULE_CLOCK</span> <span class="o">|</span>
    <span class="n">BOARD_INIT_UART_STDIO</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="c1">//Board_init(boardCfg);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p>Edit <strong>MainDsp1.c</strong></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The app now has itâs own main(), so rename this one and get rid of args</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Int main(Int argc, Char* argv[])</span>
<span class="n">Int</span> <span class="nf">ipc_main</span><span class="p">()</span>
<span class="p">{</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>No longer using args so comment these lines</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//taskParams.arg0 = (UArg)argc;</span>
<span class="c1">//taskParams.arg1 = (UArg)argv;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>BIOS_start() is done in the app main() so comment it out here</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* start scheduler, this never returns */</span>
<span class="c1">//BIOS_start();</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment this out</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Log_print0(Diags_EXIT, &quot;&lt;-- main:&quot;);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p>Edit <strong>rsc_table_vayu_dsp.c</strong></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Set this #define before itâs used to select PHYS_MEM_IPC_VRING value</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define VAYU_DSP_1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add this extern declaration prior to the symbol being used</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span> <span class="kt">char</span> <span class="n">ti_trace_SysMin_Module_State_0_outbuf__A</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p>Edit <strong>Server.c</strong></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>No longer have shared folder so change include path</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* local header files */</span>
<span class="c1">//#include &quot;../shared/AppCommon.h&quot;</span>
<span class="cp">#include</span> <span class="cpf">&quot;../AppCommon.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="download-the-full-ccs-project">Download the Full CCS Project</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><a class="reference external" href="http://processors.wiki.ti.com/images/c/c9/GPIO_LedBlink_evmAM572x_c66xExampleProject_with_ipc.zip">GPIO_LedBlink_evmAM572x_c66xExampleProject_with_ipc.zip</a></p>
<p class="rubric" id="adding-ipc-to-an-existing-ti-rtos-application-on-the-ipu">Adding IPC to an existing TI RTOS application on the IPU</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>A common thing people want to do is take an existing IPU application
that may be controlling serial or control interfaces and add IPC to it
so that the firmware can be loaded from the ARM. This is common when
migrating from a IPU only solution to a heterogeneous SoC with an
MPUSS (ARM) and IPUSS. This is the focus of this section.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In order to describe this process, we need an example TI RTOS test
case to work with. For this purpose, weâll be using the
UART_BasicExample_evmAM572x_m4ExampleProject example thatâs part of
the PDK (installed as part of the Processor SDK RTOS). This example
uses TI RTOS and does serial IO using UART3 port on the AM572x GP EVM,
itâs labeled Serial Debug on the EVM silkscreen.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>There were several steps taken to make this whole process work, each of
which will be described in following sections</p>
<ol class="arabic simple">
<li><p>Build and run the out-of-box UART M4 example on the EVM using Code
Composer Studio (CCS)</p></li>
<li><p>Build and run the ex02_messageQ example from the IPC software bundle
and turn it into a CCS project. Build it and modify the Linux startup
code to use this new image. This is just a sanity check step to make
sure we can build the IPC examples in CCS and have them run at boot
up on the EVM.</p></li>
<li><p>In CCS, make a clone of the out-of-box UART M4 example and rename it
to denote itâs the IPC version of the example. Then using the
ex02_messageq example as a reference, add in the IPC pieces to the
UART example code. Build from CCS then add it to the Linux firmware
folder.</p></li>
</ol>
<p class="rubric" id="running-uart-readwrite-pdk-example-from-ccs">Running UART Read/Write PDK Example from CCS</p>
<p>Developers are required to run pdkProjectCreate script to generate this
example as described in the <a class="reference external" href="index_how_to_guides.html#rebuild-drivers-from-pdk-directory">Processor SDK RTOS wiki
article</a>.</p>
<p>For the UART M4 example run the script with the following arguments:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">pdkProjectCreate</span><span class="p">.</span><span class="n">bat</span> <span class="n">AM572x</span> <span class="n">evmAM572x</span> <span class="n">little</span> <span class="n">uart</span> <span class="n">m4</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p>After you run the script, you can find the UART M4 example project at
&lt;SDK_INSTALL_PATH&gt;/pdk_am57xx_1_0_4/packages/MyExampleProjects/UART_BasicExample_evmAM572x_m4ExampleProject.</p>
<p>Import the project in CCS and build the example. You can now connect to
the EVM using an emulator and CCS using the instructions provided here:
<a class="reference external" href="http://processors.wiki.ti.com/index.php/AM572x_GP_EVM_Hardware_Setup">http://processors.wiki.ti.com/index.php/AM572x_GP_EVM_Hardware_Setup</a></p>
<p>Connect to the ARM core and make sure GEL runs multicore initialization
and brings the IPUSS out of reset. Connect to IPU2 core0 and load and
run the M4 UART example. When you run the code you should see the
following log on the serial IO console:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">uart</span> <span class="n">driver</span> <span class="n">and</span> <span class="n">utils</span> <span class="n">example</span> <span class="n">test</span> <span class="nl">cases</span>Â <span class="p">:</span>
<span class="n">Enter</span> <span class="mi">16</span> <span class="n">characters</span> <span class="n">or</span> <span class="n">press</span> <span class="n">Esc</span>
<span class="mi">1234567890123456</span>  <span class="o">&lt;-</span> <span class="n">user</span> <span class="n">input</span>
<span class="n">Data</span> <span class="n">received</span> <span class="n">is</span>
<span class="mi">1234567890123456</span>  <span class="o">&lt;-</span> <span class="n">loopback</span> <span class="n">from</span> <span class="n">user</span> <span class="n">input</span>
<span class="n">uart</span> <span class="n">driver</span> <span class="n">and</span> <span class="n">utils</span> <span class="n">example</span> <span class="n">test</span> <span class="nl">cases</span>Â <span class="p">:</span>
<span class="n">Enter</span> <span class="mi">16</span> <span class="n">characters</span> <span class="n">or</span> <span class="n">press</span> <span class="n">Esc</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="build-and-run-ex02-messageq-ipc-example">Build and Run ex02_messageq IPC example</p>
<p>Follow instructions described in Article <a class="reference external" href="http://processors.wiki.ti.com/index.php/Processor_SDK_IPC_Quick_Start_Guide#Run_IPC_Linux_examples">Run IPC Linux
Examples</a></p>
<p class="rubric" id="update-linux-kernel-device-tree-to-remove-uart-that-will-be-controlled-by-m4">Update Linux Kernel device tree to remove UART that will be
controlled by M4</p>
<p>Linux kernel enables all SOC HW modules which are required for its
configuration. Appropriate drivers configure required clocks and
initialize HW registers. For all unused IPs clocks are not configured.</p>
<p>The uart3 node is disabled in kernel using device tree. Also this
restricts kernel to put those IPs to sleep mode.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">uart3</span> <span class="p">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;disabled&quot;</span><span class="p">;</span>
    <span class="n">ti</span><span class="p">,</span><span class="n">no</span><span class="o">-</span><span class="n">idle</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p class="rubric" id="add-ipc-to-the-uart-example">Add IPC to the UART Example</p>
<p>The first step is to clone our out-of-box UART example CCS project and
rename it to denote itâs using IPC. The easiest way to do this is using
CCS. Here are the stepsâ¦</p>
<ul class="simple">
<li><p>In the <em>Edit</em> perspective, go into your <em>Project Explorer</em> window and
right click on your UART_BasicExample_evmAM572x_m4ExampleProject
project and select <em>copy</em> from the pop-up menu. Maske sure the
project is not is a closed state.</p></li>
<li><p>Rick click in and empty area of the project explorer window and
select past.</p></li>
<li><p>A dialog box pops up, modify the name to denote itâs using IPC. A
good name is UART_BasicExample_evmAM572x_m4ExampleProject_with_ipc.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>This is the project weâll be working with from here on. The next thing
we want to do is select the proper RTSC platform and other components.
To do this, follow these steps.</p>
<ul class="simple">
<li><p>Right click on the
UART_BasicExample_evmAM572x_m4ExampleProject_with_ipc project and
select <em>Properties</em></p></li>
<li><p>In the left hand pane, click on <em>CCS General</em>.</p></li>
<li><p>On the right hand side, click on the <em>RTSC</em> tab</p></li>
<li><p>For <em>XDCtools version:</em> select 3.xx.x.xx_core</p></li>
<li><p>In the list of <em>Products and Repositories</em>, <em>check</em> the followingâ¦</p>
<ul>
<li><p>IPC 3.xx.x.xx</p></li>
<li><p>SYS/BIOS 6.4x.x.xx</p></li>
<li><p>am57xx PDK x.x.x</p></li>
</ul>
</li>
<li><p>For <em>Target</em>, select <strong>ti.targets.arm.elf.M4</strong></p></li>
<li><p>For <em>Platform</em>, select <strong>ti.platforms.evmDRA7XX</strong></p></li>
<li><p>Once the platform is selected, edit its name buy hand and
appendÂ :ipu2 to the end. After this it should be
ti.platforms.evmDRA7XX:ipu2</p></li>
<li><p>Go ahead and leave the <em>Build-profile</em> set to debug.</p></li>
<li><p>Hit the OK button.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Now we want to copy configuration and source files from the
ex02_messageq IPC example into our project. The IPC example is located
at <em>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq</em>. To
copy files into your CCS project, you can simply select the files you
want in Windows explorer then drag and drop them into your project in
CCS.</p>
<p>Copy these files into your CCS projectâ¦</p>
<ul class="simple">
<li><p>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/shared/AppCommon.h</p></li>
<li><p>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/shared/config.bld</p></li>
<li><p>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/shared/ipc.cfg.xs</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Now copy these files into your CCS projectâ¦</p>
<ul class="simple">
<li><p>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/ipu2/Ipu2.cfg</p></li>
<li><p>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/ipu2/MainIpu2.c</p></li>
<li><p>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/ipu2/Server.c</p></li>
<li><p>C:/ti/ipc_3_xx_xx_xx/examples/DRA7XX_linux_elf/ex02_messageq/ipu2/Server.h</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you copy Ipu2.cfg into your CCS project, it
should show up greyed out. If not, right click and exclude it from
build. This is because the UART example already has a cfg file
(uart_m4_evmAM572x.cfg). The Ipu2.cfg will be used for copying and
pasting. When itâs all done, you can delete it from your project.</p>
</div>
<p>Finally, you will likely want to use a custom resource table so copy
these files into your CCS projectâ¦</p>
<ul class="simple">
<li><p>C:/ti/ipc_3_xx_xx_xx/packages/ti/ipc/remoteproc/rsc_table_vayu_ipu.h</p></li>
<li><p>C:/ti/ipc_3_xx_xx_xx/packages/ti/ipc/remoteproc/rsc_types.h</p></li>
</ul>
<p>The rsc_table_vayu_dsp.h file defines an initialized structure so letâs
make a <em>.c</em> source file.</p>
<ul class="simple">
<li><p>In your CCS project, rename rsc_table_vayu_ipu.h to
rsc_table_vayu_ipu.c</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Now we want to <em>merge</em> the IPC example configuration file with the LED
blink example configuration file. Follow these stepsâ¦</p>
<ul class="simple">
<li><p>Open up <em>Ipu2.cfg</em> using a text editor (donât open it using the GUI).
Right click on it and select <em>Open With -&gt; XDCscript Editor</em></p></li>
<li><p>We want to copy the entire contents into the clipboard. Select all
and copy.</p></li>
<li><p>Now just like above, open the uart_m4_evmAM572x.cfg config file in
the text editor. Go to the very bottom and <em>paste</em> in the contents
from the Ipu2.cfg file. Basically weâve appended the contents of
Ipu2.cfg into uart_m4_evmAM572x.cfg.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Weâve now added in all the necessary configuration and source files
into our project. Donât expect it to build at this point, we have to
make edits first. These edits are listed below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can download the full CCS project with source files to use as a reference.
See link towards the end of this section.</p>
</div>
<ul class="simple">
<li><p>Edit <strong>uart_m4_evmAM572x.cfg</strong></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add the following to the beginning(at the top) of your configuration
file</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>var Program = xdc.useModule(&#39;xdc.cfg.Program&#39;);
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Since we are no longer using a shared folder, make the following
change</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//var ipc_cfg = xdc.loadCapsule(&quot;../shared/ipc.cfg.xs&quot;);</span>
<span class="n">var</span> <span class="n">ipc_cfg</span> <span class="o">=</span> <span class="n">xdc</span><span class="p">.</span><span class="n">loadCapsule</span><span class="p">(</span><span class="s">&quot;../ipc.cfg.xs&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the following. Weâll be calling this function directly from
main.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//BIOS.addUserStartupFunction(&#39;&amp;IpcMgr_ipcStartup&#39;);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Increase the system stack size</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Program.stack = 0x1000;</span>
<span class="n">Program</span><span class="p">.</span><span class="n">stack</span> <span class="o">=</span> <span class="mh">0x8000</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the entire TICK section</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* --------------------------- TICK --------------------------------------*/</span>
<span class="c1">// var Clock = xdc.useModule(&#39;ti.sysbios.knl.Clock&#39;);</span>
<span class="c1">// Clock.tickSource = Clock.TickSource_NULL;</span>
<span class="c1">// //Clock.tickSource = Clock.TickSource_USER;</span>
<span class="c1">// /* Configure BIOS clock source as GPTimer5 */</span>
<span class="c1">// //Clock.timerId = 0;</span>
<span class="c1">//</span>
<span class="c1">// var Timer = xdc.useModule(&#39;ti.sysbios.timers.dmtimer.Timer&#39;);</span>
<span class="c1">//</span>
<span class="c1">// /* Skip the Timer frequency verification check. Need to remove this later */</span>
<span class="c1">// Timer.checkFrequency = false;</span>
<span class="c1">//</span>
<span class="c1">// /* Match this to the SYS_CLK frequency sourcing the dmTimers.</span>
<span class="c1">//  * Not needed once the SYS/BIOS family settings is updated. */</span>
<span class="c1">// Timer.intFreq.hi = 0;</span>
<span class="c1">// Timer.intFreq.lo = 19200000;</span>
<span class="c1">//</span>
<span class="c1">// //var timerParams = new Timer.Params();</span>
<span class="c1">// //timerParams.period = Clock.tickPeriod;</span>
<span class="c1">// //timerParams.periodType = Timer.PeriodType_MICROSECS;</span>
<span class="c1">// /* Switch off Software Reset to make the below settings effective */</span>
<span class="c1">// //timerParams.tiocpCfg.softreset = 0x0;</span>
<span class="c1">// /* Smart-idle wake-up-capable mode */</span>
<span class="c1">// //timerParams.tiocpCfg.idlemode = 0x3;</span>
<span class="c1">// /* Wake-up generation for Overflow */</span>
<span class="c1">// //timerParams.twer.ovf_wup_ena = 0x1;</span>
<span class="c1">// //Timer.create(Clock.timerId, Clock.doTick, timerParams);</span>
<span class="c1">//</span>
<span class="c1">// var Idle = xdc.useModule(&#39;ti.sysbios.knl.Idle&#39;);</span>
<span class="c1">// var Deh = xdc.useModule(&#39;ti.deh.Deh&#39;);</span>
<span class="c1">//</span>
<span class="c1">// /* Must be placed before pwr mgmt */</span>
<span class="c1">// Idle.addFunc(&#39;&amp;ti_deh_Deh_idleBegin&#39;);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Make configuration change to use custom resource table. Add to the end
of the file.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>/* Override the default resource table with my own */
var Resource = xdc.useModule(&#39;ti.ipc.remoteproc.Resource&#39;);
Resource.customTable = true;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p>Edit <strong>main_uart_example.c</strong></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add the following external declarations</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span> <span class="n">Int</span> <span class="nf">ipc_main</span><span class="p">();</span>
<span class="k">extern</span> <span class="n">Void</span> <span class="nf">IpcMgr_ipcStartup</span><span class="p">(</span><span class="n">Void</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In main(), add a call to ipc_main() and IpcMgr_ipcStartup() just before
BIOS_start()</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ipc_main</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">callIpcStartup</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">IpcMgr_ipcStartup</span><span class="p">();</span>
 <span class="p">}</span>
 <span class="cm">/* Start BIOS */</span>
 <span class="n">BIOS_start</span><span class="p">();</span>
 <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment out the line that calls Board_init(boardCfg). This call is in
the original example because it assumes TI-RTOS is running on the Arm
but in our case here, we are running Linux and this call is destructive
so we comment it out. The board init call does all pinmux configuration,
module clock and UART peripheral initialization.</p>
<p>In order to run the UART Example on M4, you need to disable the UART in
the Linux DTB file and interact with the Linux kernel using Telnet (This
will be described later in the article). Since Linux will be running
uboot performs the pinmux configuration but clock and UART Stdio setup
needs to be performed by the M4.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Original code</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(EVM_K2E) || defined(EVM_C6678)</span>
    <span class="n">boardCfg</span> <span class="o">=</span> <span class="n">BOARD_INIT_MODULE_CLOCK</span> <span class="o">|</span> <span class="n">BOARD_INIT_UART_STDIO</span><span class="p">;</span>
<span class="cp">#else</span>
    <span class="n">boardCfg</span> <span class="o">=</span> <span class="n">BOARD_INIT_PINMUX_CONFIG</span> <span class="o">|</span> <span class="n">BOARD_INIT_MODULE_CLOCK</span> <span class="o">|</span> <span class="n">BOARD_INIT_UART_STDIO</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Modified CodeÂ :</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">boardCfg</span> <span class="o">=</span> <span class="n">BOARD_INIT_UART_STDIO</span><span class="p">;</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>We are not done yet as we still need to configure turn the clock control
on for the UART without impacting the other clocks. We can do that by
adding the following code before Board_init API call:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">CSL_l4per_cm_core_componentRegs</span> <span class="o">*</span><span class="n">l4PerCmReg</span> <span class="o">=</span>
    <span class="p">(</span><span class="n">CSL_l4per_cm_core_componentRegs</span> <span class="o">*</span><span class="p">)</span><span class="n">CSL_MPU_L4PER_CM_CORE_REGS</span><span class="p">;</span>
<span class="n">CSL_FINST</span><span class="p">(</span><span class="n">l4PerCmReg</span><span class="o">-&gt;</span><span class="n">CM_L4PER_UART3_CLKCTRL_REG</span><span class="p">,</span>
    <span class="n">L4PER_CM_CORE_COMPONENT_CM_L4PER_UART3_CLKCTRL_REG_MODULEMODE</span><span class="p">,</span> <span class="n">ENABLE</span><span class="p">);</span>
<span class="k">while</span><span class="p">(</span><span class="n">CSL_L4PER_CM_CORE_COMPONENT_CM_L4PER_UART3_CLKCTRL_REG_IDLEST_FUNC</span>Â <span class="o">!=</span>
   <span class="n">CSL_FEXT</span><span class="p">(</span><span class="n">l4PerCmReg</span><span class="o">-&gt;</span><span class="n">CM_L4PER_UART3_CLKCTRL_REG</span><span class="p">,</span>
    <span class="n">L4PER_CM_CORE_COMPONENT_CM_L4PER_UART3_CLKCTRL_REG_IDLEST</span><span class="p">));</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Edit <strong>MainIpu2.c</strong></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The app now has itâs own main(), so rename this one and get rid of args</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Int main(Int argc, Char* argv[])</span>
<span class="n">Int</span> <span class="nf">ipc_main</span><span class="p">()</span>
<span class="p">{</span>
</pre></div>
</div>
<p>No longer using args so comment these lines</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//taskParams.arg0 = (UArg)argc;</span>
<span class="c1">//taskParams.arg1 = (UArg)argv;</span>
</pre></div>
</div>
<p>BIOS_start() is done in the app main() so comment it out here</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* start scheduler, this never returns */</span>
<span class="c1">//BIOS_start();</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Comment this out</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Log_print0(Diags_EXIT, &quot;&lt;-- main:&quot;);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p>Edit <strong>rsc_table_vayu_ipu.c</strong></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Set this #define before itâs used to select PHYS_MEM_IPC_VRING value</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define VAYU_IPU_2</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add this extern declaration prior to the symbol being used</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span> <span class="kt">char</span> <span class="n">ti_trace_SysMin_Module_State_0_outbuf__A</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p>Edit <strong>Server.c</strong></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>No longer have shared folder so change include path</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* local header files */</span>
<span class="c1">//#include &quot;../shared/AppCommon.h&quot;</span>
<span class="cp">#include</span> <span class="cpf">&quot;../AppCommon.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="handling-ammu-l1-unicache-mmu-and-l2-mmu">Handling AMMU (L1 Unicache MMU) and L2 MMU</p>
<p>There are two MMUs inside each of the IPU1, and IPU2 subsystems. The L1
MMU is referred to as IPU_UNICACHE_MMU or AMMU and L2 MMU. The
description of how this is configured in IPC-remoteproc has been
described in section
<a class="reference external" href="http://processors.wiki.ti.com/index.php/Linux_IPC_on_AM57xx#Changing_Cortex_M4_IPU_Memory_Map">Changing_Cortex_M4_IPU_Memory_Map</a>.
IPC handling of L1 and L2 MMU is different from how the PDK driver
examples setup the memory access using these MMUs which the users need
to manage when integrating the components. This difference is
highlighted below:</p>
<img alt="../_images/IPU_MMU_Peripheral_access.png" src="../_images/IPU_MMU_Peripheral_access.png" />
<ul class="simple">
<li><p>PDK examples use addresses (0x4X000000) to peripheral registers and
use following MMU setting</p>
<ul>
<li><p>L2 MMU uses default 1:1 Mapping</p></li>
<li><p>AMMU configuration translates physical 0x4X000000 access to
logical 0x4X000000</p></li>
</ul>
</li>
<li><p>IPC+ Remote Proc ARM+M4 requires IPU to use logical address
(0x6X000000) and uses following MMU setting</p>
<ul>
<li><p>L2 MMU is configured such that MMU translates 0x6X000000 access to
addresss 0x4X000000</p></li>
<li><p>AMMU is configured for 1:1 mapping 0x6X000000 and 0x6X000000</p></li>
</ul>
</li>
</ul>
<p>Therefore after integrating IPC with PDK drivers, it is recommended that
the alias addresses are used to access peripherals and PRCM registers.
This requires changes to the addresses used by PDK drivers and in
application code.</p>
<p>The following changes were then made to the IPU application source code:</p>
<p>Add UART_soc.c file to the project and modify the base addresses for all
IPU UART register instance in the UART_HwAttrs to use alias addresses:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef _TMS320C6X</span>
    <span class="n">CSL_DSP_UART3_REGS</span><span class="p">,</span>
    <span class="n">OSAL_REGINT_INTVEC_EVENT_COMBINER</span><span class="p">,</span>
<span class="cp">#elif defined(__ARM_ARCH_7A__)</span>
    <span class="n">CSL_MPU_UART3_REGS</span><span class="p">,</span>
    <span class="mi">106</span><span class="p">,</span>
<span class="cp">#else</span>
    <span class="p">(</span><span class="n">CSL_IPU_UART3_REGS</span> <span class="o">+</span> <span class="mh">0x20000000</span><span class="p">),</span>    <span class="c1">//Base Addr = 0x48000000 + 0x20000000 = 0x68000000</span>
    <span class="mi">45</span><span class="p">,</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Adding custom SOC configuration also means that you should use the
generic UART driver instead of driver with built in SOC setup. To do
this comment the following line in .cfg:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>var Uart              = xdc.loadPackage(&#39;ti.drv.uart&#39;);
//Uart.Settings.socType = socType;
</pre></div>
</div>
<p>There is also an instance in the application code where we added pointer
to PRCM registers that need to be changed as follows.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span> <span class="n">CSL_l4per_cm_core_componentRegs</span> <span class="o">*</span><span class="n">l4PerCmReg</span> <span class="o">=</span>
<span class="p">(</span><span class="n">CSL_l4per_cm_core_componentRegs</span> <span class="o">*</span><span class="p">)</span> <span class="mh">0x6a009700</span><span class="p">;</span> <span class="c1">//CSL_MPU_L4PER_CM_CORE_REGS;</span>
</pre></div>
</div>
<p>Now, you are ready to build the firmware. After the .out is built,
change the extension to .xem4 and copy it over to the location in the
filesystem that is used to load M4 firmware.</p>
</div>
<div class="section" id="customizing-memory-map-for-creating-multicore-applications-on-am57xx-using-ipc">
<h3>10.8.2. Customizing Memory map for creating Multicore Applications on AM57xx using IPC<a class="headerlink" href="#customizing-memory-map-for-creating-multicore-applications-on-am57xx-using-ipc" title="Permalink to this headline">Â¶</a></h3>
<p><a class="reference external" href="http://www.ti.com/lit/an/sprac60/sprac60.pdf">http://www.ti.com/lit/an/sprac60/sprac60.pdf</a></p>
</div>
<div class="section" id="ipc-debugging-tools-and-techniques-on-am57xx">
<h3>10.8.3. IPC Debugging Tools and Techniques on AM57xx<a class="headerlink" href="#ipc-debugging-tools-and-techniques-on-am57xx" title="Permalink to this headline">Â¶</a></h3>
<p>The sections relevant to AM57xx have been pulled from the <a class="reference external" href="http://www.ti.com/lit/an/sprac12/sprac12.pdf">Debugging Tools and Techniques With IPC3.x Application Note</a> and placed here.</p>
<p>During development of software, it is common to encounter issues that must be debugged to provide a
robust software offering. When developing software that uses the IPC3.x product for inter-processor
communication, there are tools and techniques available to aid in the debugging process. These tools and
techniques help to more quickly understand and debug the issue. This document addresses all three
HLOSâs supported by IPC3.x: Androidâ¢ platform, LinuxÂ®, and QNXÂ®. Where applicable, differences
between the OSâs are noted.
This document aims to provide tools, techniques, and resources for debugging issues encountered when
using the IPC3.x to communicate with remote core software.</p>
<p>There are several tools that can be leveraged for debugging the IPC, from simple tracing to using Code
Composer Studioâ¢ (CCS) to attach to the remote cores. Each provides different advantages in
the debugging process.</p>
<p>When an issue occurs, checking the traces is often the first thing done. The traces can give quick insight
into what may be happening. In normal, non-error cases, you might see little to no traces from the IPC.
But when there is an error, there often is an error trace that can be used to shed light on the issue. An
error trace often gives an error code and a module or function name that can be used to identify where the
error was thrown.</p>
<p>Another useful place to look for debug info is in the debugfs. Information for each remote processor can
be found there, as well as remote core traces, state information, and more.</p>
<p>Connecting over JTAG using Code Composer Studio provides the ability to see exactly what is happening
on the remote core, providing access to a wealth of information including viewing memory, registers, and
stepping through the code.</p>
<p>The first place to check when an issue occurs is the traces. Often an error code or a trace regarding an
error gives some clue. Both the remote core traces and the HLOS-side traces can be checked.</p>
<p>By default, the IPC only prints error traces. To enable additional tracing, use the IPC_DEBUG
environment variable at runtime. This feature is only supported on Linux and is available starting in IPC
3.22.00.05. Table 1 lists the two levels of tracing supported.</p>
<p>Table 1. IPC_DEBUG Trace Levels</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 84%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Trace Level</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Enables all warnings and errors to be printed</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Turns on all tracing (including socket and LAD client tracing).</p></td>
</tr>
</tbody>
</table>
<p>When using QNX, additional traces are enabled by setting environment variables. There are separate
environment variables for enabling traces in the resource manager and the user libraries.</p>
<p><strong>Resource Manager Traces</strong></p>
<p>Enable additional traces in the slog by setting the environment variable IPC_DEBUG_SLOG_LEVEL at
runtime. By default, only errors and warnings are printed. The IPC_DEBUG_SLOG_LEVEL can be set
before launching IPC to enable more traces. Setting the level to 7 enables all IPC traces. The default level
is 2.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">export</span> <span class="n">IPC_DEBUG_SLOG_LEVEL</span><span class="o">=</span><span class="mi">7</span>
</pre></div>
</div>
<p>These traces are printed to the slog, and can be viewed by using the sloginfo command. All IPC traces
use 42 as identification in the slog, and you can filter the slog to view only these traces:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>sloginfo âm42
</pre></div>
</div>
<p><strong>User Library Traces</strong></p>
<p>User library traces can be enabled by using the variable IPC_DEBUG when launching the application.
Valid levels are 1 to 3, with 3 being the most verbose. For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">IPC_DEBUG</span><span class="o">=&lt;</span><span class="n">level</span><span class="o">&gt;</span> <span class="n">app_host</span>
</pre></div>
</div>
<p>The remote core traces can be checked by using debugfs. Run the following command, replacing the âXâ
with the core-id for the remote core to be checked.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">remoteproc</span><span class="o">/</span><span class="n">remoteprocX</span><span class="o">/</span><span class="n">trace0</span>
</pre></div>
</div>
<p>Check the following when checking the traces after an error recovery has occurred:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">remoteproc</span><span class="o">/</span><span class="n">remoteprocX</span><span class="o">/</span><span class="n">trace0_last</span>
</pre></div>
</div>
<p>This provides the last traces that happened before error recovery was triggered. For more information
about debugging remote core faults and exceptions, see <a href="#id1"><span class="problematic" id="id2">`Debugging MMU Faults and Exceptions`_</span></a>.</p>
<p>The core-id, âXâ, starts at 0 and increments to include all of the remote cores supported by the remoteproc
module in the dts file. Because the number of remoteprocs supported can vary depending on the dts
configuration, it is not ensured that a certain remote core will always have a certain core-id if the
remoteprocs supported in the dts file changes.</p>
<p>The core associated with a particular core-id can be found by checking the name of the remoteproc (see <a href="#id3"><span class="problematic" id="id4">`Linux and Android - Remoteproc`_</span></a>). Table 2 associates the remoteproc name with the common name of the
remote processor.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">remoteproc</span><span class="o">/</span><span class="n">remoteprocX</span><span class="o">/</span><span class="n">name</span>
</pre></div>
</div>
<p>Table 2. Remoteproc Names for AM57xx</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Debugfs Name</p></th>
<th class="head"><p>Remote Core Name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>58820000.ipu</p></td>
<td><p>IPU1</p></td>
</tr>
<tr class="row-odd"><td><p>55020000.ipu</p></td>
<td><p>IPU2</p></td>
</tr>
<tr class="row-even"><td><p>40800000.dsp</p></td>
<td><p>DSP1</p></td>
</tr>
<tr class="row-odd"><td><p>41000000.dsp</p></td>
<td><p>DSP2</p></td>
</tr>
</tbody>
</table>
<p>The remote core traces can be checked by using sysfs. Run the following command, replacing &lt;core
name&gt; with the core name for the remote core to check. Valid core names for AM57xx are IPU1, IPU2,
DSP1, and DSP2.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">ipc</span><span class="o">-</span><span class="n">trace</span><span class="o">/&lt;</span><span class="n">core</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>When checking the traces after error recovery has happened, check the logfile specified at IPC startup, if
one was specified. When starting IPC, specify a logfile using the â-câ option. When an error recovery
happens, the last traces are dumped to this log file. For more information about debugging remote core
faults and exceptions, see <a href="#id5"><span class="problematic" id="id6">`Debugging MMU Faults and Exceptions`_</span></a>.</p>
<p>In some cases, you may want to add traces to get more information about the issue. If the issue is reliably
reproducible, one technique is to add additional traces to get more information. If the issue is timing-related, this technique may not be helpful, as it may mask the issue</p>
<p><strong>SYS-BIOS</strong></p>
<p>You can add traces in the SYS-BIOS IPC code that come to the trace buffer by using the System_printf()
API. After adding traces to the SYS-BIOS IPC and rebuilding the IPC, you must rebuild the remote core
image. The traces come to the remote core trace buffer and can be viewed by following the instructions in
<a href="#id7"><span class="problematic" id="id8">`Linux and Android - Remote Core Traces`_</span></a>.</p>
<p><strong>Linux</strong></p>
<p>Additionally, traces can be added in the Linux code. The modules of interest when adding traces are the
remoteproc, iommu, and rpmsg modules in the kernel, and the MessageQ, MMRPC, and LAD modules in
the user space.</p>
<p>In the kernel are these modules in the following paths:</p>
<ul class="simple">
<li><p>drivers/remoteproc/</p></li>
<li><p>drivers/iommu/</p></li>
<li><p>drivers/rpmsg/</p></li>
</ul>
<p>Most of the user space code can be found in the IPC package, in the linux folder. The MMRPC code is
found in the packages/ti/ipc/mm/ folder.</p>
<p>Useful information about the status of the remote cores can be found in debugfs.</p>
<p>Information about each remote core can be found in the following, where the âXâ can be replaced with the
remote core id.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">remoteproc</span><span class="o">/</span><span class="n">remoteprocX</span><span class="o">/&lt;</span><span class="n">entry</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Table 3 lists what can be found for each core.</p>
<p>Table 3. Remoteproc Debugfs Entries</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 87%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Entry</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>name</p></td>
<td><p>Processor name, comprised of the RAM address and the processor type,
(for example, 58820000.ipu for IPU1). For a complete list of names, see Table 2.</p></td>
</tr>
<tr class="row-odd"><td><p>recovery</p></td>
<td><p>Returns either âenabledâ or âdisabledâ, indicating if recovery is enabled or disabled for
the remote processor.</p></td>
</tr>
<tr class="row-even"><td><p>state</p></td>
<td><p>Gives the state of the remote processor. State is one of:
* offline (0)
* suspended (1)
* running (2)
* crashed (3)</p></td>
</tr>
<tr class="row-odd"><td><p>trace0</p></td>
<td><p>Returns the contents of the remote processor trace buffer.</p></td>
</tr>
<tr class="row-even"><td><p>trace0_last</p></td>
<td><p>Created after recovering the remote core. Returns the contents of the remote processor
trace buffer before recovery was triggered.</p></td>
</tr>
<tr class="row-odd"><td><p>version</p></td>
<td><p>Returns the version. Currently returns nothing.</p></td>
</tr>
</tbody>
</table>
<p>Information about the IOMMU can also be found in debugfs. It can be found in the following path, where
âXXXXXXXXâ is replaced by the register address for the remote core MMU registers.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">omap_iommu</span><span class="o">/</span><span class="n">XXXXXXXX</span><span class="p">.</span><span class="n">mmu</span><span class="o">/&lt;</span><span class="n">entry</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Table 4 gives the corresponding core name for each MMU for AM57xx, and the register address in the TRM.</p>
<p>Table 4. IOMMU Entry Names</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>IOMMU Entry</p></th>
<th class="head"><p>Core Name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>58882000.mmu</p></td>
<td><p>IPU1</p></td>
</tr>
<tr class="row-odd"><td><p>55082000.mmu</p></td>
<td><p>IPU2</p></td>
</tr>
<tr class="row-even"><td><p>40d01000.mmu</p></td>
<td><p>DSP1 (MMU1)</p></td>
</tr>
<tr class="row-odd"><td><p>40d02000.mmu</p></td>
<td><p>DSP1 (MMU2)</p></td>
</tr>
<tr class="row-even"><td><p>41501000.mmu</p></td>
<td><p>DSP2 (MMU1)</p></td>
</tr>
<tr class="row-odd"><td><p>41502000.mmu</p></td>
<td><p>DSP2 (MMU2)</p></td>
</tr>
</tbody>
</table>
<p>Some of this information is inaccessible from a suspended state. Table 5 lists what can be found for each core.</p>
<p>Table 5. IOMMU Debugfs Entries</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Entry</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>nr_tlb_entries</p></td>
<td><p>Gives the number of tlb entries</p></td>
</tr>
<tr class="row-odd"><td><p>pagetable</p></td>
<td><p>Dumps the pagetable entries</p></td>
</tr>
<tr class="row-even"><td><p>regs</p></td>
<td><p>Gives the values of the MMU registers</p></td>
</tr>
<tr class="row-odd"><td><p>tlb</p></td>
<td><p>Lists the tlb entries.</p></td>
</tr>
</tbody>
</table>
<p>Find out the current state of the remote core by issuing the following command:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">ipc</span><span class="o">-</span><span class="n">state</span><span class="o">/&lt;</span><span class="n">core_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The âcore_nameâ is the name of the remote core. Valid names for AM57xx are IPU1, IPU2, DSP1, and
DSP2. The current state will show as ârunningâ or âresetâ.</p>
<p>A useful tool for debugging issues is Code Composer Studio. CCS allows easy connection to the remote
core in order to see the state of the remote core.</p>
<p>The remote core image must be built with debug symbols to see information such as the call stack and
variables. Once attached, load the symbols. The symbols are built into the executable itself. When loading
symbols, point to the same executable that is loaded on the target (or the unstripped version locally, if it is stripped to save space when loading to the target.)</p>
<p>You may want to disable auto-suspend of the remote cores (provided that is not what is being debugged).
When the core is suspended, you will not be able to connect to the remote core using CCS. Auto-suspend
can be disabled by setting the power control to âonâ for the remote core.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="n">on</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">bus</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">devices</span><span class="o">/&lt;</span><span class="n">device</span><span class="o">&gt;/</span><span class="n">power</span><span class="o">/</span><span class="n">control</span>
</pre></div>
</div>
<p>The remote core device name for each remote core can be found in Table 2.</p>
<p>You may decide to disable the watchdog timers when debugging and using CCS. Otherwise, while
connected to the target, the watchdog may expire, triggering an abort sequence. Disable the watchdog
timers for a remote core by removing their definitions from the dts file. For example, to disable the
watchdog timers for IPU1, change the dts file as below:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">ipu1</span> <span class="p">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;okay&quot;</span><span class="p">;</span>

    <span class="n">memory</span><span class="o">-</span><span class="n">region</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">ipu1_cma_pool</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="n">mboxes</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">mailbox5</span> <span class="o">&amp;</span><span class="n">mbox_ipu1_legacy</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="n">timers</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">timer11</span><span class="o">&gt;</span><span class="p">;</span>

   <span class="o">-</span> <span class="n">watchdog</span><span class="o">-</span><span class="n">timers</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">timer7</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;&amp;</span><span class="n">timer8</span><span class="o">&gt;</span><span class="p">;</span>

   <span class="o">+</span> <span class="cm">/*watchdog-timers = &lt;&amp;timer7&gt;, &lt;&amp;timer8&gt;;*/</span>
</pre></div>
</div>
<p>When using QNX, you can disable the watchdog from within the remote core image itself.
If using Linux or Android, this step is not required; simply follow the instructions in <a href="#id9"><span class="problematic" id="id10">`Linux and Android â Disabling Watchdog`_</span></a>.</p>
<p>To disable the usage of the watchdog from the remote core without completely disabling the device
exception module (DEH), comment out the calls to Watchdog_init in the SYS/BIOS IPC code. These calls
can be found in packages/ti/deh/Deh.c, packages/ti/deh/DehDsp.c, and packages/ti/ipc/ipcmgr/IpcMgr.c.</p>
<p>packages/ti/deh/Deh.c:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">* ======== Deh_Module_startup ========</span>
<span class="cm">*/</span>
<span class="n">Int</span> <span class="nf">Deh_Module_startup</span><span class="p">(</span><span class="n">Int</span> <span class="n">phase</span><span class="p">)</span>
<span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="n">AMMU_Module_startupDone</span><span class="p">()</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span> <span class="p">{</span>
<span class="o">-</span> <span class="n">Watchdog_init</span><span class="p">(</span><span class="n">ti_sysbios_family_arm_m3_Hwi_excHandlerAsm__I</span><span class="p">);</span>
<span class="o">+</span> <span class="c1">//Watchdog_init(ti_sysbios_family_arm_m3_Hwi_excHandlerAsm__I);</span>
<span class="k">return</span> <span class="n">Startup_DONE</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">return</span> <span class="n">Startup_NOTDONE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>packages/ti/deh/DehDsp.c:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Int</span> <span class="nf">Deh_Module_startup</span><span class="p">(</span><span class="n">Int</span> <span class="n">phase</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if defined(HAS_AMMU)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">AMMU_Module_startupDone</span><span class="p">()</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span> <span class="p">{</span>
<span class="o">-</span> <span class="n">Watchdog_init</span><span class="p">((</span><span class="n">Void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">Void</span><span class="p">))</span><span class="n">ti_sysbios_family_c64p_Exception_handler</span><span class="p">);</span>
<span class="o">+</span> <span class="c1">//Watchdog_init((Void (*)(Void))ti_sysbios_family_c64p_Exception_handler);</span>
<span class="k">return</span> <span class="n">Startup_DONE</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">return</span> <span class="n">Startup_NOTDONE</span><span class="p">;</span>
<span class="cp">#else</span>
<span class="o">-</span> <span class="n">Watchdog_init</span><span class="p">((</span><span class="n">Void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">Void</span><span class="p">))</span><span class="n">ti_sysbios_family_c64p_Exception_handler</span><span class="p">);</span>
<span class="o">+</span> <span class="c1">//Watchdog_init((Void (*)(Void))ti_sysbios_family_c64p_Exception_handler);</span>
<span class="k">return</span> <span class="n">Startup_DONE</span><span class="p">;</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>packages/ti/ipc/ipcmgr/IpcMgr.c:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>Void IpcMgr_rpmsgStartup(Void)
{
Assert_isTrue(MultiProc_self() != MultiProc_getId(&quot;HOST&quot;), NULL);
RPMessage_init(MultiProc_getId(&quot;HOST&quot;));
-#ifdef IpcMgr_USEDEH
+#if 0
/*
* When using DEH, initialize the Watchdog timers if not already done
* (i.e. late-attach)
*/
#ifdef IpcMgr_DSP
Watchdog_init((Void (*)(Void))ti_sysbios_family_c64p_Exception_handler);
#elif IpcMgr_IPU
Watchdog_init(ti_sysbios_family_arm_m3_Hwi_excHandlerAsm__I);
#endif
#endif
}
[...]
Void IpcMgr_ipcStartup(Void)
{
UInt procId = MultiProc_getId(&quot;HOST&quot;);
Int status;
/* TransportRpmsgSetup will busy wait until host kicks ready to recv: */
status = TransportRpmsgSetup_attach(procId, 0);
Assert_isTrue(status &gt;= 0, NULL);
/* Sets up to communicate with host&#39;s NameServer: */
status = NameServerRemoteRpmsg_attach(procId, 0);
Assert_isTrue(status &gt;= 0, NULL);
-#ifdef IpcMgr_USEDEH
+#if 0
/*
* When using DEH, initialize the Watchdog timers if not already done
* (i.e. late-attach)
*/
#ifdef IpcMgr_DSP
Watchdog_init((Void (*)(Void))ti_sysbios_family_c64p_Exception_handler);
#elif IpcMgr_IPU
Watchdog_init(ti_sysbios_family_arm_m3_Hwi_excHandlerAsm__I);
#endif
#endif
}
</pre></div>
</div>
<p>Following this, rebuild the IPC and the remote core image to have an image with DEH, but without
watchdog enabled.</p>
<p>In certain cases, you may want to attach to the remote core before the issue has occurred. If the issue is
reliably reproducible and always occurs at the same location, then adding a breakpoint close to where the
issue happens could be a good way to get a better picture of what is happening.</p>
<p>One instance where it may be difficult is if the issue is happening during boot-up of the remote core. In
this case, it may be necessary to add a while loop in the main function, to attach before the issue occurs.
Add a loop similar to this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="k">volatile</span> <span class="kt">int</span> <span class="n">foo</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="n">foo</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, after attaching, load the symbols, add the breakpoints, change âfooâ to 0, and continue running.</p>
<p>You can also attach to the core after the issue, load the symbols, and see the state and view memory.
You can view the Exception moduleâs exception CallStack ROV view and the task moduleâs per task
CallStack ROV view. For more information about the runtime object viewer (ROV) in the RTSC
documentation online, see <a class="reference external" href="http://rtsc.eclipse.org/docs-tip/Runtime_Object_Viewer/">Runtime Object Viewer</a>.</p>
<p>Once attached and with symbols loaded, the state of the processor can be inspected. You can see the
program counter, memory windows, registers, call stack, and the ROV, among other things.</p>
<p>Errors commonly manifest as MMU faults, exceptions, and watchdog errors (if using a version of IPC with
watchdog available and enabled).</p>
<p>To debug an error, it may be necessary to turn of error recovery. Error recovery can be disabled by giving
the following command:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="n">disabled</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">remoteproc</span><span class="o">/</span><span class="n">remoteprocX</span><span class="o">/</span><span class="n">recovery</span>
</pre></div>
</div>
<p>See <a href="#id11"><span class="problematic" id="id12">`Linux and Android - Remoteproc`_</span></a> for more information.</p>
<p>To disable error recovery on QNX using IPC version 3.22 and above, give the -d option when launching
the ipc binary. For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>ipc âd IPU2 dra7x-ipu2-fw.xem4
</pre></div>
</div>
<p>If any of these three errors are encountered, you will get a crash dump from the remote core which is
visible in the remote core traces. If error recovery is disabled, the dump can be found in trace0 (when
using Linux/Android) or in /dev/ipc-trace/&lt;core_name&gt; (when using QNX); otherwise, the trace is found in
trace0_last (when using Linux/Android) and in the logfile (when using QNX).</p>
<p>An example of the crash dump will look like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">Exception</span> <span class="n">occurred</span> <span class="n">at</span> <span class="p">(</span><span class="n">PC</span><span class="p">)</span> <span class="o">=</span> <span class="mo">0000</span><span class="n">c976</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">CPU</span> <span class="nl">context</span><span class="p">:</span> <span class="kr">thread</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">BIOS</span> <span class="n">Task</span> <span class="nl">name</span><span class="p">:</span> <span class="p">{</span><span class="n">empty</span><span class="o">-</span><span class="n">instance</span><span class="o">-</span><span class="n">name</span><span class="p">}</span> <span class="nl">handle</span><span class="p">:</span> <span class="mh">0x80060090</span><span class="p">.</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">BIOS</span> <span class="n">Task</span> <span class="n">stack</span> <span class="nl">base</span><span class="p">:</span> <span class="mh">0x800600e0</span><span class="p">.</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">BIOS</span> <span class="n">Task</span> <span class="n">stack</span> <span class="nl">size</span><span class="p">:</span> <span class="mh">0x800</span><span class="p">.</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="p">[</span><span class="n">t</span><span class="o">=</span><span class="mh">0x18f6df13</span><span class="p">]</span> <span class="n">ti</span><span class="p">.</span><span class="n">sysbios</span><span class="p">.</span><span class="n">family</span><span class="p">.</span><span class="n">arm</span><span class="p">.</span><span class="n">m3</span><span class="p">.</span><span class="nl">Hwi</span><span class="p">:</span> <span class="nl">ERROR</span><span class="p">:</span> <span class="n">line</span> <span class="mi">1078</span><span class="o">:</span> <span class="nl">E_hardFault</span><span class="p">:</span> <span class="n">FORCED</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">ti</span><span class="p">.</span><span class="n">sysbios</span><span class="p">.</span><span class="n">family</span><span class="p">.</span><span class="n">arm</span><span class="p">.</span><span class="n">m3</span><span class="p">.</span><span class="nl">Hwi</span><span class="p">:</span> <span class="n">line</span> <span class="mi">1078</span><span class="o">:</span> <span class="nl">E_hardFault</span><span class="p">:</span> <span class="n">FORCED</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="p">[</span><span class="n">t</span><span class="o">=</span><span class="mh">0x18f9a0cb</span><span class="p">]</span> <span class="n">ti</span><span class="p">.</span><span class="n">sysbios</span><span class="p">.</span><span class="n">family</span><span class="p">.</span><span class="n">arm</span><span class="p">.</span><span class="n">m3</span><span class="p">.</span><span class="nl">Hwi</span><span class="p">:</span> <span class="nl">ERROR</span><span class="p">:</span> <span class="n">line</span> <span class="mi">1155</span><span class="o">:</span> <span class="nl">E_busFault</span><span class="p">:</span> <span class="nl">PRECISERR</span><span class="p">:</span> <span class="n">Immediate</span> <span class="n">Bus</span> <span class="n">Fault</span><span class="p">,</span> <span class="n">exact</span> <span class="n">addr</span> <span class="n">known</span><span class="p">,</span> <span class="nl">address</span><span class="p">:</span> <span class="mi">96000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">ti</span><span class="p">.</span><span class="n">sysbios</span><span class="p">.</span><span class="n">family</span><span class="p">.</span><span class="n">arm</span><span class="p">.</span><span class="n">m3</span><span class="p">.</span><span class="nl">Hwi</span><span class="p">:</span> <span class="n">line</span> <span class="mi">1155</span><span class="o">:</span> <span class="nl">E_busFault</span><span class="p">:</span> <span class="nl">PRECISERR</span><span class="p">:</span> <span class="n">Immediate</span> <span class="n">Bus</span>

<span class="n">Fault</span><span class="p">,</span> <span class="n">exact</span> <span class="n">addr</span> <span class="n">known</span><span class="p">,</span> <span class="nl">address</span><span class="p">:</span> <span class="mi">96000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R0</span> <span class="o">=</span> <span class="mh">0x96000000</span> <span class="n">R8</span> <span class="o">=</span> <span class="mh">0xffffffff</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R1</span> <span class="o">=</span> <span class="mh">0x00000000</span> <span class="n">R9</span> <span class="o">=</span> <span class="mh">0xffffffff</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R2</span> <span class="o">=</span> <span class="mh">0x00000000</span> <span class="n">R10</span> <span class="o">=</span> <span class="mh">0xffffffff</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R3</span> <span class="o">=</span> <span class="mh">0x80060814</span> <span class="n">R11</span> <span class="o">=</span> <span class="mh">0xffffffff</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R4</span> <span class="o">=</span> <span class="mh">0x00013098</span> <span class="n">R12</span> <span class="o">=</span> <span class="mh">0x8006074c</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R5</span> <span class="o">=</span> <span class="mh">0x0000000a</span> <span class="n">SP</span><span class="p">(</span><span class="n">R13</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x80060820</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R6</span> <span class="o">=</span> <span class="mh">0xffffffff</span> <span class="n">LR</span><span class="p">(</span><span class="n">R14</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x0000c973</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">R7</span> <span class="o">=</span> <span class="mh">0xffffffff</span> <span class="n">PC</span><span class="p">(</span><span class="n">R15</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x0000c976</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">PSR</span> <span class="o">=</span> <span class="mh">0x61000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">ICSR</span> <span class="o">=</span> <span class="mh">0x00438803</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">MMFSR</span> <span class="o">=</span> <span class="mh">0x00</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">BFSR</span> <span class="o">=</span> <span class="mh">0x82</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">UFSR</span> <span class="o">=</span> <span class="mh">0x0000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">HFSR</span> <span class="o">=</span> <span class="mh">0x40000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">DFSR</span> <span class="o">=</span> <span class="mh">0x00000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">MMAR</span> <span class="o">=</span> <span class="mh">0x96000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">BFAR</span> <span class="o">=</span> <span class="mh">0x96000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">AFSR</span> <span class="o">=</span> <span class="mh">0x00000000</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">Stack</span> <span class="n">trace</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mo">00</span> <span class="p">[</span><span class="n">op</span> <span class="n">faaaf00e</span><span class="p">]</span> <span class="mo">00006</span><span class="n">abd</span> <span class="p">(</span><span class="n">ret</span> <span class="n">from</span> <span class="n">call</span> <span class="n">to</span> <span class="mo">00015010</span><span class="p">)</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mo">01</span> <span class="p">[</span><span class="n">op</span> <span class="n">ff49f005</span><span class="p">]</span> <span class="mo">00006</span><span class="n">ac3</span> <span class="p">(</span><span class="n">ret</span> <span class="n">from</span> <span class="n">call</span> <span class="n">to</span> <span class="mo">0000</span><span class="n">c954</span><span class="p">)</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="n">op</span> <span class="mi">98009000</span><span class="p">]</span> <span class="mo">000154</span><span class="n">c9</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="n">op</span> <span class="mo">00000000</span><span class="p">]</span> <span class="mo">000</span><span class="n">a0001</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="n">op</span> <span class="mi">80084</span><span class="n">a64</span><span class="p">]</span> <span class="mf">0000f</span><span class="n">ec9</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="n">op</span> <span class="mo">0001</span><span class="n">a75c</span><span class="p">]</span> <span class="mo">00006</span><span class="mi">8</span><span class="n">b9</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="n">op</span> <span class="mi">80084</span><span class="n">a64</span><span class="p">]</span> <span class="mf">0000f</span><span class="n">ec9</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="n">op</span> <span class="n">bd0ef919</span><span class="p">]</span> <span class="mo">00015</span><span class="n">b91</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">Stack</span> <span class="n">dump</span> <span class="n">base</span> <span class="mf">800600e0</span> <span class="n">size</span> <span class="mi">2048</span> <span class="n">sp</span> <span class="mi">80060820</span><span class="o">:</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mi">80060820</span><span class="o">:</span> <span class="mo">00000001</span> <span class="mo">00006</span><span class="n">abd</span> <span class="mi">96000000</span> <span class="mo">00000000</span> <span class="n">ffffffff</span> <span class="mo">00006</span><span class="n">ac3</span> <span class="mo">0000000</span><span class="n">a</span> <span class="mo">00006</span><span class="n">bf4</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mi">80060840</span><span class="o">:</span> <span class="mo">00000000</span> <span class="mo">00000000</span> <span class="mi">80041800</span> <span class="mi">80060</span><span class="n">ab0</span> <span class="mo">000000</span><span class="mi">80</span> <span class="mi">56414</span><span class="n">c53</span> <span class="mf">50495f</span><span class="mi">45</span> <span class="n">be003155</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mi">80060860</span><span class="o">:</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mi">80060880</span><span class="o">:</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="n">bebebebe</span> <span class="mo">00000000</span> <span class="mo">00000000</span> <span class="mo">00000001</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mi">800608</span><span class="nl">a0</span><span class="p">:</span> <span class="mo">00000001</span> <span class="mo">000154</span><span class="n">c9</span> <span class="mo">000130</span><span class="mi">9</span><span class="n">a</span> <span class="mo">0000000</span><span class="n">a</span> <span class="mo">00000000</span> <span class="mi">80041820</span> <span class="mo">00000001</span> <span class="n">ffffffff</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="mi">800608</span><span class="nl">c0</span><span class="p">:</span> <span class="n">ffffffff</span> <span class="mf">0000f</span><span class="n">ec9</span> <span class="mo">00000000</span> <span class="mo">00000000</span> <span class="mo">00006</span><span class="mi">8</span><span class="n">b9</span> <span class="mf">0000f</span><span class="n">ec9</span> <span class="mo">00015</span><span class="n">b91</span> <span class="n">bebebebe</span>

<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">91.045</span><span class="p">]</span> <span class="n">Terminating</span> <span class="n">execution</span><span class="p">...</span>
</pre></div>
</div>
<p>Some useful information that can be found in the dump is the fault address, PC address, register contents, and call stack.</p>
<p>When an error occurs, you gets a crash dump from the remote core that looks similar to the one in <a href="#id13"><span class="problematic" id="id14">`Crash Dump`_</span></a>.</p>
<p>The particular dump example above is from a MMU read fault. This dump provides important information
in helping to understand what has happened. Some of the useful parts are broken down in the following
section.</p>
<p><strong>Timestamp</strong></p>
<p>All traces (not just exception dumps) provide a timestamp for each trace. The time starts from the booting
of the remote core.</p>
<blockquote>
<div><p>[0] <strong>[ 91.045]</strong> Exception occurred at (PC) = 0000c976</p>
<p>[0] <strong>[ 91.045]</strong> CPU context: thread</p>
<p>[0] <strong>[ 91.045]</strong> BIOS Task name: {empty-instance-name} handle: 0x80060090.</p>
</div></blockquote>
<p>The timestamp information can be useful even in non-crash situations, indicating the amount of time taken
between two events. You can add traces at each event and then see when the events run.</p>
<p>For example, to check that a certain event is happening every second, put a trace at that event, then
check the timestamps to see that it is happening as expected.</p>
<p><strong>PC Address</strong></p>
<p>The PC address where the exception occurred is also provided. This can be used, in
conjunction with the map file or CCS, to identify the line of code where the exception happened.</p>
<blockquote>
<div><p>[0] [ 91.045] <strong>Exception occurred at (PC) = 0000c976</strong></p>
<p>[0] [ 91.045] CPU context: thread</p>
<p>[0] [ 91.045] BIOS Task name: {empty-instance-name} handle: 0x80060090.</p>
</div></blockquote>
<p><strong>Task Information</strong></p>
<p>The information about the task that was executing when the exception occurred is also provided.</p>
<blockquote>
<div><p>[0] [ 91.045] Exception occurred at (PC) = 0000c976</p>
<p>[0] [ 91.045] CPU context: thread</p>
<p>[0] <strong>[ 91.045] BIOS Task name: {empty-instance-name} handle: 0x80060090.</strong></p>
<p>[0] <strong>[ 91.045] BIOS Task stack base: 0x800600e0.</strong></p>
<p>[0] <strong>[ 91.045] BIOS Task stack size: 0x800.</strong></p>
</div></blockquote>
<p><strong>Fault Information</strong></p>
<p>The information about the fault is also provided. This can look different depending on the
type of exception that occurred, but often provides a fault address to identify the source of the fault.</p>
<blockquote>
<div><p>[0] [ 91.045] Exception occurred at (PC) = 0000c976</p>
<p>[0] [ 91.045] CPU context: thread</p>
<p>[0] [ 91.045] BIOS Task name: {empty-instance-name} handle: 0x80060090.</p>
<p>[0] [ 91.045] BIOS Task stack base: 0x800600e0.</p>
<p>[0] [ 91.045] BIOS Task stack size: 0x800.</p>
<p>[0] [ 91.045] <strong>[t=0x18f6df13] ti.sysbios.family.arm.m3.Hwi: ERROR: line 1078: E_hardFault: FORCED</strong></p>
<p>[0] [ 91.045] <strong>ti.sysbios.family.arm.m3.Hwi: line 1078: E_hardFault: FORCED</strong></p>
<p>[0] [ 91.045] <strong>[t=0x18f9a0cb] ti.sysbios.family.arm.m3.Hwi: ERROR: line 1155: E_busFault: PRECISERR: Immediate Bus Fault, exact addr known, address: 96000000</strong></p>
<p>[0] [ 91.045] <strong>ti.sysbios.family.arm.m3.Hwi: line 1155: E_busFault: PRECISERR: Immediate Bus Fault, exact addr known, address: 96000000</strong></p>
</div></blockquote>
<p><strong>Registers</strong></p>
<p>A dump of the register contents at the time of the exception is also provided.</p>
<img alt="../_images/RegisterDump.PNG" src="../_images/RegisterDump.PNG" />
<p><strong>Stack Trace</strong></p>
<p>The stack trace is also provided (see Figure 6). This can be used in conjunction with the source code and
the map file or CCS to get more information about what was executing at the time of the crash.</p>
<img alt="../_images/StackTraceDump.PNG" src="../_images/StackTraceDump.PNG" />
<p>MMU faults occur when an address that is not mapped to the remote core MMU is accessed. This can be
due to a read, write, or an attempt to execute the address. When an MMU fault occurs, a crash dump from
the remote core occurs that looks similar to the example provided in <a href="#id15"><span class="problematic" id="id16">`Crash Dump`_</span></a>.</p>
<p>Some debugging techniques, as well as common times when an MMU fault occurs, are given as
examples in the following sections.</p>
<p><strong>Using CCS to Halt the Code When the Fault Happens</strong></p>
<p>If the fault always happens at the same address, pre-map the location and then set up CCS with a
breakpoint for that address. In this way, you can view the state of the remote core when the fault happens
and see the call stack. From there, put a breakpoint at the surrounding code and step through to see
where the fault happens.</p>
<p>Pre-mapping the address can be done either through the remote core resource table, or through CCS.
With CCS, you can connect to the debug DAP and then bring up a memory window to inspect the MMU
registers. Directly program the MMU from here to map some unused memory to the fault address location.</p>
<p>For example:</p>
<ul class="simple">
<li><p>MMU CAM: 0x9600000E (Change the most significant 20 bits here to match the fault address. For example, it would be 96000 if the fault address is 0x96000010)</p></li>
<li><p>MMU RAM: 0xBA300000 (Change the most significant 20 bits here to match an unused 4-KB physical region in the memory map)</p></li>
<li><p>MMU Lock: 0x00000400</p></li>
<li><p>MMU LD: 0x00000001</p></li>
</ul>
<p><strong>Using the Crash Dump to Find the Location of the Fault</strong></p>
<p>The crash dump call stack can indicate where the crash occurred. Using that information, connect to the
remote core with CCS and put a breakpoint in the code at the most recent function in the call stack before
the crash. From there, step through the code until the crash happens.</p>
<p><strong>Example â Accessing a Memory Region That is Not Mapped</strong></p>
<p>When using the L2 MMU, every address accessed by the remote core must be mapped. An attempt to
access an un-mapped address results in an MMU fault. The following example explores the crash dump of
an access to an un-mapped area.</p>
<p>Here is an example fault dump:</p>
<img alt="../_images/StackTraceDump2.PNG" src="../_images/StackTraceDump2.PNG" />
<p>From the crash dump, the fault address is 0x96000000. The address will not be found in the resource
table, which is why the fault occurred.</p>
<p>Avoid hard-coding of virtual addresses for peripherals and memory blocks with a one-time physical to
virtual address lookup using the resource table. There is an API available for this called
Resource_physToVirt() in the resource module. This alerts that the address is not mapped in the resource
table when the translation fails.</p>
<p>From here, either use the crash dump to see the PC and call stack or follow the instructions under the section âUsing CCS to Halt the Code When the Fault Happens.â Error recovery, watchdog timers, and remoteproc autosuspend
may need to be disabled to connect CCS. See <a href="#id17"><span class="problematic" id="id18">`Linux and Android - Disabling Error Recovery`_</span></a>, <a href="#id19"><span class="problematic" id="id20">`Linux and Android â Disabling Watchdog`_</span></a>, and <a href="#id21"><span class="problematic" id="id22">`Linux and Android - Disabling Remoteproc Auto-Suspend`_</span></a> for more
information on disabling these.</p>
<p>For this example, use the PC address which, as seen in the crash dump, is at 0xcfa6</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="mf">107.092</span><span class="p">]</span> <span class="n">Exception</span> <span class="n">occurred</span> <span class="n">at</span> <span class="p">(</span><span class="n">PC</span><span class="p">)</span> <span class="o">=</span> <span class="mo">0000</span><span class="n">cfa6</span>
</pre></div>
</div>
<p>Find the corresponding function by looking this address up in the map file for the remote core image. If the
PC address is invalid due to an issue such as stack corruption, then this may not yield useful results. In
this case, something useful is found:</p>
<img alt="../_images/SourceInsightCrashDump.PNG" src="../_images/SourceInsightCrashDump.PNG" />
<p>Alternatively, use CCS to see the location of the fault. If CCS was already connected to the remote core
before the fault happened, the core will have halted in the abort function. From here, directly set the PC
address and see the line that caused the fault:</p>
<img alt="../_images/CCSFault.PNG" src="../_images/CCSFault.PNG" />
<p>Use this technique at any time after booting the remote core to see what a PC address corresponds to. It
will display the line that caused the error. This may, however, prevent proper execution because the
registers and call stack wonât have proper values.</p>
<p>You can now isolate the particular line in the fxnFault() function that was executing. That code is found in
the file &lt;ipc_package&gt;/packages/ti/ipc/tests/fault.c:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
        <span class="n">System_printf</span><span class="p">(</span><span class="s">&quot;Generating read MMU Fault...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">a</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="mh">0x96000000</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
</pre></div>
</div>
<p>Figure 8 clearly shows what caused the fault in this code, but when it is not clear, use CCS to see the fault in action. Once connected and the symbols are loaded, put a breakpoint in this function (if this function does not happen often). Once the breakpoint is hit, step through the code to find what is causing the fault.</p>
<p>Upon stepping through, observe that the variable, a, is being set to the contents of 0x96000000, which is
equal to the fault address. This is the fault in this example.</p>
<p>Next, decide if this is a valid value that needs mapping, or if this is an invalid value that passed due to
some error in the code. If it is still not known where the value is coming from, use CCS to trace it back
through the call stack to fix the code. If it turns out that the address is an address that must be accessible to the remote core, then map it through the resource table to the appropriate physical memory.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="index_how_to_guides.html" class="btn btn-neutral float-right" title="10.1. Target" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index_examples_demos.html" class="btn btn-neutral" title="9.1. Template Application Workshop" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2019</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'06_01_00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>