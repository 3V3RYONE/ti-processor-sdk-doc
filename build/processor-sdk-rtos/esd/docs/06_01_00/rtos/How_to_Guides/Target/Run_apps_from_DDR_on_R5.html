

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Run BIOS Applications from DDR on R5 &mdash; Processor SDK RTOS Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Processor SDK RTOS Documentation" href="../../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../../../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Processor SDK RTOS
          

          
          </a>

          
            
            
              <div class="version">
                06_01_00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../Overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Release_Specific.html">2. Release Specific</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Board_EVM_Abstration.html">3. Board/EVM Abstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Foundational_Components.html">4. Foundational Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DSP_Software.html">5. DSP Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Device_Drivers.html">6. Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PRU_ICSS.html">7. PRU-ICSS Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Compilers.html">8. Compilers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Examples_and_Demonstrations.html">9. Examples and Demonstrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../How_to_Guides.html">10. How to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ.html">11. Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Documentation_Tarball.html">12. Documentation Tarball</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Processor SDK RTOS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
    <li>Run BIOS Applications from DDR on R5</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p id="run-apps-from-ddr-on-r5-cores">Once the R5 core is out of reset, the R5 defaults to no execute permissions for
the DDR memory space. The side effect of this is,  that all code, from entry point
till the code that sets up the MPU (Memory Protection Unit), has to be run from
internal memory.</p>
<div class="section" id="run-bios-applications-from-ddr-on-r5">
<span id="run-bios-app-from-ddr-on-r5"></span><h1>Run BIOS Applications from DDR on R5<a class="headerlink" href="#run-bios-applications-from-ddr-on-r5" title="Permalink to this headline">¶</a></h1>
<p>In BIOS, the application sets up the MPU as per the memory configuration specified
in the <a href="#id1"><span class="problematic" id="id2">*</span></a>.xs file (that is referred to in the applications bios config file).  Once the
MPU is setup by the app, the rest of the code can run from DDR.</p>
<p>To ensure that all code from entry point to MPU setup is run from internal memory, the
text sections of the following libs must be placed in internal memory using the application’s linker
command file.</p>
<ul class="simple">
<li><p><a href="#id3"><span class="problematic" id="id4">*</span></a>sysbios.aer5f(.text)</p></li>
<li><p><a href="#id5"><span class="problematic" id="id6">*</span></a>boot.aer5f(.text)</p></li>
<li><p><a href="#id7"><span class="problematic" id="id8">*</span></a>auto_init.aer5f(.text)</p></li>
<li><p><a href="#id9"><span class="problematic" id="id10">*</span></a>&lt;app&gt;_per5f.oer5f(.text)</p></li>
</ul>
<p>Refer <a class="reference external" href="https://git.ti.com/keystone-rtos/emac-lld/blobs/master/test/EmacLoopbackTest/am65xx/emac_linker_r5.lds">emac_linker_r5.lds</a>
for an example.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please note that you need to replace <a href="#id11"><span class="problematic" id="id12">*</span></a>&lt;app&gt;_per5f.oer5f with the corresponding
file for your application. For eg, if the application’s .cfg file is emacUnitTest_r5.cfg,
then the .oer5f file will be named emacUnitTest_r5_per5f.oer5f</p>
</div>
<p>You also need to update the <a href="#id13"><span class="problematic" id="id14">*</span></a>.xs file referred to by the applications .cfg file
to make sure that the DDR has execute privileges. Please refer <a class="reference external" href="http://git.ti.com/keystone-rtos/processor-pdk-build/blobs/master/am65xx/r5_mpu.xs">r5_mpu.xs</a>
for an example memory configuration. You could also make the applications .cfg
file refer to the common .xs file, as shown in the example
<a class="reference external" href="https://git.ti.com/keystone-rtos/emac-lld/blobs/master/test/EmacLoopbackTest/am65xx/emacUnitTest_r5.cfg">emacUnitTest_r5.cfg</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Once you update the .xs file, please note remember to delete <a href="#id15"><span class="problematic" id="id16">*</span></a>&lt;app&gt;_per5f.oer5f
from the applications <a href="#id17"><span class="problematic" id="id18">*</span></a>configuro directory, so that it is autogenerated again.
If you simply do a clean build, <a href="#id19"><span class="problematic" id="id20">*</span></a>&lt;app&gt;_per5f.oer5f will not be updated to reflect the
changes in the <a href="#id21"><span class="problematic" id="id22">*</span></a>.xs file.</p>
</div>
</div>
<div class="section" id="run-baremetal-applications-from-ddr-on-r5">
<span id="run-baremetal-app-from-ddr-on-r5"></span><h1>Run Baremetal Applications from DDR on R5<a class="headerlink" href="#run-baremetal-applications-from-ddr-on-r5" title="Permalink to this headline">¶</a></h1>
<p>Baremetal applications have similar restrictions on running code from
internal memory till the MPU is configured, just like BIOS applications.
For best comaptibility, however, make sure that the entry point is
always the reset vector, and that the code that sets up the DDR access
permissions in the MPU resides completely within 0x100 bytes of the
entry point.</p>
<p>For applications that find the default R5 configuration setup by the
CSL sufficient, there is another method that can be used to execute
an application from DDR. If the bootloader (SBL) is re-built using the
SBL_SKIP_MCU_RESET compile option (by enabling the corresponding line
in <a class="reference external" href="https://git.ti.com/keystone-rtos/sbl/blobs/master/sbl_component.mk#line399">sbl_component.mk</a>,
then SBL will branch to the application entry point without resetting the R5 core.</p>
<p>In this scenario, as the  R5 core was already setup when the SBL
invoked CSL init, the app can execute directly from DDR, right from its
entry point. However, the app must take care not to redo the R5 initialization
using CSL init, as the CSL initialization code assumes that the R5 registers are at their
reset default values. This can be done by simply defining an empty __mpu_init function in the
baremetal application. Refer <a class="reference external" href="https://git.ti.com/keystone-rtos/sbl/blobs/master/example/k3MulticoreApp/sbl_smp_r5.asm">sbl_smp_r5.asm</a>
for an example.</p>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2019</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'06_01_00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/language_data.js"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>