

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>9.1. Template Application Workshop &mdash; Processor SDK RTOS Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Processor SDK RTOS Documentation" href="../index.html"/>
        <link rel="up" title="9. Examples and Demonstrations" href="Examples_and_Demonstrations.html"/>
        <link rel="next" title="10. How to Guides" href="How_to_Guides.html"/>
        <link rel="prev" title="9. Examples and Demonstrations" href="Examples_and_Demonstrations.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Processor SDK RTOS
          

          
          </a>

          
            
            
              <div class="version">
                06_01_00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Release_Specific.html">2. Release Specific</a></li>
<li class="toctree-l1"><a class="reference internal" href="Board_EVM_Abstration.html">3. Board/EVM Abstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Foundational_Components.html">4. Foundational Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="DSP_Software.html">5. DSP Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="Device_Drivers.html">6. Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="PRU_ICSS.html">7. PRU-ICSS Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="Compilers.html">8. Compilers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Examples_and_Demonstrations.html">9. Examples and Demonstrations</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">9.1. Template Application Workshop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">9.1.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">9.1.2. Prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#software">9.1.2.1. Software</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hardware">9.1.2.2. Hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#recommended-training-videos">9.1.2.3. Recommended Training Videos</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#template-application-overview">9.1.3. Template Application Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#components-used">9.1.3.1. Components Used</a></li>
<li class="toctree-l4"><a class="reference internal" href="#software-design">9.1.3.2. Software Design</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#lab">9.1.4. Lab</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#task-1-installing-the-processor-sdk-into-ccs">9.1.4.1. Task 1 - Installing the Processor SDK into CCS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-2-importing-and-building-the-template-application">9.1.4.2. Task 2 - Importing and Building the  Template Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-3-hardware-setup">9.1.4.3. Task 3 - Hardware Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-4-loading-and-running-the-template-application">9.1.4.4. Task 4 - Loading and Running the Template Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-5-examining-the-template-application">9.1.4.5. Task 5 - Examining the Template Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-6-modifying-the-rtos-template-application">9.1.4.6. Task 6 - Modifying the RTOS Template Application</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#additional-information">9.1.5. Additional Information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#porting-to-a-custom-board">9.1.5.1. Porting to a Custom Board</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#next-steps">9.1.6. Next Steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#image-processing-demo">9.2. Image Processing Demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id14">9.2.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirements">9.2.2. Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">9.2.3. Software Design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#more-about-processing-algorithms">9.2.3.1. More about processing algorithms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#framework-for-multicore">9.2.3.2. Framework for multicore</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-build-the-demo">9.2.3.3. How to Build the Demo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-run-the-demo">9.2.3.4. How to Run the Demo</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#posix-smp-demo">9.3. POSIX-SMP Demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id17">9.3.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">9.3.2. Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id19">9.3.3. Software Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id20">9.3.4. How to Run the Demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">9.3.5. How to Build the Demo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#processor-sdk-rtos">9.3.5.1. Processor-SDK RTOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#processor-sdk-linux">9.3.5.2. Processor-SDK Linux</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#audio-benchmark-starterkit">9.4. Audio Benchmark Starterkit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id22">9.4.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#software-features">9.4.2. Software Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#directory-structure">9.4.3. Directory Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#software-dependencies">9.4.4. Software Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#supported-hardware">9.4.5. Supported Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quickstart-with-how-to-video">9.4.6. QuickStart with How-To-Video</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-build-the-benchmarks">9.4.7. How to Build the Benchmarks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-makefile">9.4.7.1. Using Makefile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-ccs-projects">9.4.7.2. Using CCS Projects</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-run-the-benchmarks">9.4.8. How to Run the Benchmarks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-ccs">9.4.8.1. Using CCS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-sd-card-supported-only-on-am57xx-and-k2g">9.4.8.2. Using SD card (Supported only on AM57xx and K2G)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#benchmark-app-output-on-uart-console">9.4.9. Benchmark App output on UART console</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#benchmark-starterkit-implementation">9.4.9.1. Benchmark Starterkit Implementation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#memory-placement-of-instruction-and-data">9.4.10. Memory placement of Instruction and Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compiler-optimization-flags">9.4.11. Compiler Optimization Flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="#soc-integration-and-optimization">9.4.12. SOC Integration and Optimization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuring-device-clocks">9.4.12.1. Configuring device clocks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#benchmarking-using-dsp-tsch-tscl-registers">9.4.13. Benchmarking using DSP TSCH/TSCL registers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#benchmark-logging">9.4.14. Benchmark logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cache-configuration-for-code-data-sections-in-sram-ddr">9.4.15. Cache configuration for Code/data sections in SRAM/DDR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#benchmark-results">9.4.16. Benchmark results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#support">9.4.17. Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-resources">9.4.18. Additional resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#audio-pre-processing-demo">9.5. Audio Pre-Processing Demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id23">9.5.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24">9.5.2. Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id25">9.5.3. Software Design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id26">9.5.3.1. More about processing algorithms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#framework-for-audio-pre-processing">9.5.3.2. Framework for Audio Pre-processing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#file-based-demo">9.5.4. File Based Demo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id27">9.5.4.1. How to Build the Demo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id29">9.5.4.2. How to Run the Demo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#circular-microphone-board-demo">9.5.5. Circular Microphone Board Demo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id33">9.5.5.1. How to Build the Demo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id36">9.5.5.2. How to Run the Demo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-read-the-input-output-audio-files">9.5.6. How to Read the Input/output Audio Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#import-raw-audio-data-file-using-adobe-audition">9.5.6.1. Import Raw Audio Data File using Adobe Audition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#before-and-after-comparison">9.5.6.2. Before and After Comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#performance-audio-demo">9.6. Performance Audio Demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id39">9.6.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id40">9.6.2. Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id41">9.6.3. How to Run the Demo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#hardware-setup">9.6.3.1. Hardware Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-setup-for-hdmi">9.6.3.2. Optional Setup for HDMI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#software-and-tools-setup">9.6.3.3. Software and Tools Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-and-run-pre-built-binaries">9.6.3.4. Load and Run Pre-built Binaries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-time-reconfiguration-in-windows-only">9.6.3.5. Run-time Reconfiguration (in Windows only)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-rebuild-the-demo">9.6.4. How to Rebuild the Demo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setup-environment-variables-in-linux">9.6.4.1. Setup Environment Variables in Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-environment-variables-in-windows">9.6.4.2. Setup Environment Variables in Windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rebuild-the-demo">9.6.4.3. Rebuild the Demo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#trouble-shooting">9.6.5. Trouble Shooting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#big-data-ipc-example">9.7. Big Data IPC Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id42">9.7.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#architecture-overview">9.7.2. Architecture Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simple-buffer-example-program-sequence">9.7.3. Simple Buffer example: Program Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="#host-linux-example">9.7.4. Host Linux example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#architecture-updates-for-linux">9.7.4.1. Architecture Updates for Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-run-the-example">9.7.4.2. How to Run the Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-re-build-the-example">9.7.4.3. How to Re-Build the example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#host-rtos-example">9.7.5. Host RTOS example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id43">9.7.5.1. How to Run the Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id44">9.7.5.2. How to Re-Build the Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ti-rtos-kernel-example">9.8. TI-RTOS Kernel Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">9.8.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arm-cortex-a53">9.8.2. ARM Cortex-A53</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arm-cortex-a15">9.8.3. ARM Cortex-A15</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arm-cortex-a9">9.8.4. ARM Cortex-A9</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arm-cortex-a8">9.8.5. ARM Cortex-A8</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arm-cortex-r5">9.8.6. ARM Cortex-R5</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arm-cortex-m4">9.8.7. ARM Cortex-M4</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dsp-c66x">9.8.8. DSP C66x</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dsp-c674x">9.8.9. DSP C674x</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage-notes">9.8.10. Usage Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#known-issues">9.8.11. Known Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="#useful-resources">9.8.12. Useful Resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-os-bare-metal-example">9.9. No OS (Bare Metal) Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id45">9.9.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id46">9.9.2. ARM Cortex-A53</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id47">9.9.3. ARM Cortex-A15</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id48">9.9.4. ARM Cortex-A9</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id49">9.9.5. ARM Cortex-A8</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id50">9.9.6. ARM Cortex-R5</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id51">9.9.7. ARM Cortex-M4</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id52">9.9.8. DSP C66x</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id53">9.9.9. DSP C674x</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gravity-simulator-demo">9.10. Gravity Simulator Demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id54">9.10.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#version-details">9.10.2. Version Details</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id55">9.10.3. Components Used</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-the-demo">9.10.4. Building the Demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-demo">9.10.5. Running the Demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#terminal-screenshot">9.10.6. Terminal Screenshot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#display-output">9.10.7. Display Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#useful-references">9.10.8. Useful References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#jailhouse-hypervisor">9.11. Jailhouse Hypervisor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#k2g-audio-dc-addon">9.12. K2G AUDIO DC AddOn</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cmb-addon">9.13. CMB AddOn</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simplelink-wifi-demo">9.14. SimpleLink WiFi Demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id68">9.14.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#supported-platforms">9.14.2. Supported platforms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id69">9.14.3. Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id70">9.14.4. Components Used</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id71">9.14.5. Software Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-build-the-simplelink-wifi-plugin-demo-using-ccs">9.14.6. How to Build the SimpleLink WiFi Plugin Demo using CCS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-build-the-simplelink-wifi-plugin-demo-using-makefile-on-windows">9.14.7. How to Build the SimpleLink WiFi Plugin Demo using makefile on Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-build-the-simplelink-wifi-plugin-demo-using-makefile-on-linux">9.14.8. How to Build the SimpleLink WiFi Plugin Demo using makefile on Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-run-the-simplelink-wifi-plugin-demo-using-ccs">9.14.9. How to Run the SimpleLink WiFi Plugin Demo using CCS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-run-the-simplelink-wifi-plugin-demo-using-uart-boot">9.14.10. How to Run the SimpleLink WiFi Plugin Demo using UART Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#can-eth-gatway-demo">9.15. CAN-Eth Gatway Demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id72">9.15.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id73">9.15.2. Architecture Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id74">9.15.3. Software Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id75">9.15.4. Directory Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id76">9.15.5. Components Used</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id77">9.15.6. Building the Demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#host-applications">9.15.7. Host Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id78">9.15.8. Running the Demo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tools">9.15.8.1. Tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up">9.15.8.2. Set up</a></li>
<li class="toctree-l4"><a class="reference internal" href="#am65x-evm-idk-board-set-up">9.15.8.3. AM65x EVM/IDK Board Set up</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pcan-tool-set-up">9.15.8.4. PCAN Tool Set up</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-and-run-the-demo">9.15.8.5. Load and run the demo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#terminal-screen-shot">9.15.9. Terminal Screen-shot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#known-issues-limitations">9.15.9.1. Known issues &amp; limitations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sercos-iii-softmaster">9.16. Sercos III Softmaster</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id79">9.16.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id80">9.16.2. Architecture Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mdt-at-telegrams-tx-queue-distribution">9.16.3. MDT/AT Telegrams - TX queue distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id81">9.16.4. Directory Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id82">9.16.5. Components Used</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id83">9.16.6. Building the Demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enabling-time-triggered-send-tts">9.16.7. Enabling Time Triggered Send (TTS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enabling-redundancy">9.16.8. Enabling Redundancy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id84">9.16.9. Running the Demo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#additional-hardware">9.16.9.1. Additional Hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sd-card-creation">9.16.9.2. SD Card Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id85">9.16.9.3. Set up</a></li>
<li class="toctree-l4"><a class="reference internal" href="#supported-features">9.16.9.4. Supported features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unsupported-features">9.16.9.5. Unsupported features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fixed-issues">9.16.9.6. Fixed issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id86">9.16.9.7. Known issues &amp; limitations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interrupt-latency-benchmark">9.17. Interrupt Latency Benchmark</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id87">9.17.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id88">9.17.2. Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id89">9.17.3. Software Design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dhrystone">9.17.3.1. Dhrystone</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id90">9.17.3.2. Interrupt Latency Benchmark</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id91">9.17.4. How to Build the Demo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id92">9.17.4.1. Processor-SDK RTOS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id93">9.17.5. How to Run the Demo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ccs">9.17.5.1. CCS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#secondary-bootloader-sbl">9.17.5.2. Secondary Bootloader (SBL)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#known-issues-and-limitations">9.17.6. Known Issues and Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#results">9.17.7. Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="How_to_Guides.html">10. How to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">11. Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Documentation_Tarball.html">12. Documentation Tarball</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Processor SDK RTOS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="Examples_and_Demonstrations.html">9. Examples and Demonstrations</a> &raquo;</li>
      
    <li>9.1. Template Application Workshop</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="template-application-workshop">
<h1>9.1. Template Application Workshop<a class="headerlink" href="#template-application-workshop" title="Permalink to this headline">¶</a></h1>
<span class="target" id="demo-rtos-template-application-label"></span><div class="section" id="introduction">
<h2>9.1.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This workshop duplicates information found elsewhere in the RTOS Software
Developer Guide for the purpose of creating a cohesive document.</p>
</div>
<p>This workshop is a simple introduction for software development using
Processor SDK RTOS. The goal of this workshop is to get you familiarized with
Processor SDK RTOS and introduce you to using Sitara Evaluation Modules (EVMs)
and TI tools.</p>
<p>To accomplish this goal, we will work through an interactive lab using the
RTOS/Bare-metal Template Application. This application will introduce key concepts of
the SDK and serves as the starting point for creating your own application.</p>
<p>Here’s what we will learn over the course of this lab:</p>
<ul class="simple">
<li><p>Basic usage of Code Composer Studio (CCS)</p>
<ul>
<li><p>Importing</p></li>
<li><p>Editing</p></li>
<li><p>Building</p></li>
<li><p>Flashing</p></li>
</ul>
</li>
<li><p>Processor SDK RTOS Software</p>
<ul>
<li><p>Low level drivers (LLDs) such as UART, GPIO, etc.</p></li>
<li><p>Operating System Abstraction Layer (OSAL)</p></li>
<li><p>Board library</p></li>
</ul>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="prerequisites">
<h2>9.1.2. Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<div class="section" id="software">
<h3>9.1.2.1. Software<a class="headerlink" href="#software" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Processor SDK RTOS for your platform</p>
<ul>
<li><p><a class="reference external" href="http://www.ti.com/tool/PROCESSOR-SDK-AM335X">AM335x</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/tool/PROCESSOR-SDK-AM437X">AM437x</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/tool/PROCESSOR-SDK-AM57X">AM57x</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/tool/PROCESSOR-SDK-AM65X">AM65x</a></p></li>
</ul>
</li>
<li><p>CCS Version associated with your SDK Release</p>
<ul>
<li><p>A download link for CCS is located on the same page as the SDK download.</p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using AM65x, you will also need to install latest TI Emulators
and Sitara device support packages into CCS. This can be done through
CCS –&gt; Help –&gt; Check for Updates.</p>
</div>
</div>
<div class="section" id="hardware">
<h3>9.1.2.2. Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>A supported Sitara Evaluation Module</p>
<ul>
<li><p><a class="reference external" href="http://www.ti.com/tool/TMDXEVM3358">AM335x EVM</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/tool/TMDSEVM437X">AM437x EVM</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/tool/TMDSEVM572X">AM572x EVM</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/tool/TMDX654IDKEVM">AM654x EVM</a></p></li>
</ul>
</li>
<li><p>JTAG Debug Probe if using AM572x EVM</p>
<ul>
<li><p>XDS100-class JTAG debug probes</p>
<ul>
<li><p>Low cost, low performance</p></li>
<li><p>XDS100v1 is not supported.</p></li>
</ul>
</li>
<li><p>XDS200-class JTAG debug probes</p>
<ul>
<li><p>Recommended</p></li>
</ul>
</li>
<li><p>XDS560v2-class JTAG debug probes</p>
<ul>
<li><p>High performance</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Serial UART cable provided in the EVM kit</p></li>
</ul>
</div>
<div class="section" id="recommended-training-videos">
<h3>9.1.2.3. Recommended Training Videos<a class="headerlink" href="#recommended-training-videos" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://training.ti.com/processor-sdk-training-series">Processor SDK Training Series</a></p>
<ul>
<li><p>Introduction to the Processor SDK Training Series</p></li>
<li><p>Processor SDK Overview</p></li>
<li><p>Introduction to Processor SDK RTOS Part 1</p></li>
<li><p>Introduction to Processor SDK RTOS Part 2</p></li>
<li><p>Application Development Using Processor SDK RTOS</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://training.ti.com/am437x-sitara-processors-training-series">AM437x Sitara Processors Training Series</a></p></li>
<li><p><a class="reference external" href="https://training.ti.com/am57x-sitara-processors-training-series">AM57x Sitara Processors Training Series</a></p></li>
<li><p><a class="reference external" href="https://training.ti.com/am6x">AM65x Sitara Processors Training Series</a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="template-application-overview">
<h2>9.1.3. Template Application Overview<a class="headerlink" href="#template-application-overview" title="Permalink to this headline">¶</a></h2>
<p>The Template Application is intended for
customers to use as a starting point during software development using
Processor SDK RTOS software. The Template Application can be quickly brought up
by importing the included Code Composer Studio (CCS) project into the CCS
development environment. The application currently includes the typical low
level drivers such as UART, GPIO, and I2C, the OSAL layer, and Board Library.
For additional details refer to the <strong>README.txt</strong> file in the installed
package.</p>
<div class="section" id="components-used">
<h3>9.1.3.1. Components Used<a class="headerlink" href="#components-used" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>SYS/BIOS (RTOS only)</p></li>
<li><p>XDCTools (RTOS only)</p></li>
<li><p>Processor SDK RTOS PDK</p>
<ul>
<li><p>Drivers, OSAL, etc.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="software-design">
<h3>9.1.3.2. Software Design<a class="headerlink" href="#software-design" title="Permalink to this headline">¶</a></h3>
<p>The Template Application is designed to provide a foundational project with a
clean separation of the application-specific submodule from the startup and
initialization code. This gives users the ability to focus on
application-specific code and quickly get it up and running. This separation is
achieved by splitting the “main” and “app” submodules into different files.</p>
<p>The source files are organized as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>└── template_app
    ├── baremetal
    │   ├── app.c --&gt; Application tasks are here
    │   ├── app.h --&gt; Application header file
    │   ├── baremetal_template_app_am572x_a15_evmAM572X.projectspec --&gt; Project spec file
    |   ├── main.c --&gt; Main file which has board and driver init code
    │   ├── lnk_a15.cmd --&gt; Linker command file.
    ├── GPIO_board.h --&gt; Gpio board header
    ├── GPIO_evmAM572x_board.c --&gt; Gpio board configuration
    └── rtos
        ├── app.c --&gt; Application tasks are here
        ├── app.cfg --&gt; Application specific config file
        ├── app.defs --&gt; Definitions (Currently empty)
        ├── app.h --&gt; Application header file
        ├── main.c --&gt; Main file which has board and driver init cod
        ├── main.cfg --&gt; Main BIOS config file
        └── rtos_template_app_am572x_a15_evmAM572X.projectspec --&gt; Project spec file
</pre></div>
</div>
<p>In general, to write a new application <strong>app.c</strong> and <strong>app.h</strong> can be
modified, recompiled, and run.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="lab">
<h2>9.1.4. Lab<a class="headerlink" href="#lab" title="Permalink to this headline">¶</a></h2>
<p>Now that the introductory material is out of the way, it is time to get our
hands dirty and begin the lab.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The AM572x EVM was used for the creation of this lab material, but the same
instructions apply for the other supported platforms – AM335x EVM,
AM437x EVM, and AM654x EVM.</p>
</div>
<div class="section" id="task-1-installing-the-processor-sdk-into-ccs">
<h3>9.1.4.1. Task 1 - Installing the Processor SDK into CCS<a class="headerlink" href="#task-1-installing-the-processor-sdk-into-ccs" title="Permalink to this headline">¶</a></h3>
<p>Before using the Processor SDK, we must install its components into Code
Composer Studio (CCS). Typically – if you chose to install the Software
Development Kit (SDK) into the default <strong>$HOME/ti</strong>
or <strong>C:\ti</strong> location – CCS will automatically detect the new products the
next time it is opened and prompt you to install them. If you are not prompted
to install the new products, you can do so manually through the <em>Window –&gt;
Preferences –&gt; Code Composer Studio –&gt; Products</em> menu. This menu will allow
you define product discovery paths and rediscover, install, and unistall
products.</p>
<a class="reference internal image-reference" href="../_images/install-discovered-products.png"><img alt="../_images/install-discovered-products.png" src="../_images/install-discovered-products.png" style="width: 602.6999999999999px; height: 399.0px;" /></a>
<p>For more info on setting up CCS. Check out
<a class="reference external" href="index_how_to_guides.html#setup-ccs-for-evm-and-processor-sdk-rtos">Setup CCS for EVM and Processor-SDK RTOS</a>
in the How To Guides.</p>
</div>
<div class="section" id="task-2-importing-and-building-the-template-application">
<h3>9.1.4.2. Task 2 - Importing and Building the  Template Application<a class="headerlink" href="#task-2-importing-and-building-the-template-application" title="Permalink to this headline">¶</a></h3>
<p>We begin the lab by importing the RTOS or Bare-metal Template Application into CCS. The
Template Application is delivered as a preconfigured CCS Project, making this
process very simple. We will also use this as an opportunity to briefly dive
into the structure of the SDK.</p>
<p>To import a project into CCS, go to the <em>Project –&gt; Import CCS Projects…</em>
menu. Typically, you will import SDK projects from either the
<strong>pdk_&lt;platform&gt;_&lt;version&gt;</strong> or <strong>processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;</strong>
directories. The <strong>pdk_&lt;platform&gt;_&lt;version&gt;</strong> directory contains Chip Support
Library (CSL), Low Level Drivers (LLDs), Boot, Diagnostics, and other
functions. It is also where LLD example projects are created. The
<strong>processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;</strong> directory contains demos
(including the Template App), documentation, and resources for creating
bootable SD cards.</p>
<p>Now that you have an understanding of these directories, let us move on to
importing the Template Application.</p>
<p>To import a project into CCS open the <em>Project –&gt; Import CCS Projects…</em>
menu. Then click <em>Browse…</em> to locate the template app which can be found at:
<strong>processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;/demos/rtos_template_app/&lt;soc_name&gt;/&lt;evm_name&gt;/&lt;core_name&gt;</strong>.
This will create a copy of the project in your CCS workspace.</p>
<a class="reference internal image-reference" href="../_images/import-ccs-project.png"><img alt="../_images/import-ccs-project.png" src="../_images/import-ccs-project.png" style="width: 765.8px; height: 478.09999999999997px;" /></a>
<p>After project import is complete you will see the Template Application under
the <em>Project Explorer</em> on the left side of CCS. Next, right click on the
project and select <em>Build Project</em>. You should get a message that says
<code class="docutils literal notranslate"><span class="pre">****</span> <span class="pre">Build</span> <span class="pre">Finished</span> <span class="pre">****</span></code> in the CCS Console.</p>
</div>
<div class="section" id="task-3-hardware-setup">
<h3>9.1.4.3. Task 3 - Hardware Setup<a class="headerlink" href="#task-3-hardware-setup" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The EVM board is sensitive to electrostatic discharges
(ESD). Use a grounding strap or other device to prevent damaging the
board. Be sure to connect communication cables before applying power to
any equipment.</p>
</div>
<p>Hardware setup will vary depending on which EVM you are using. Generally,
you need to make sure that the boot switches are set correctly and that serial,
a JTAG debug probe, and power are connected to the board.</p>
<p>Refer to the Quick Start Guide that came with your board and the Hardware
User’s Guide for more detailed hardware setup information.</p>
<ul class="simple">
<li><p>AM335x EVM:</p>
<ul>
<li><p><a class="reference external" href="http://www.ti.com/lit/ml/sprw225d/sprw225d.pdf">Quick Start Guide</a></p></li>
<li><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/AM335x_General_Purpose_EVM_HW_User_Guide">HW User’s Guide</a></p></li>
</ul>
</li>
<li><p>AM437x EVM:</p>
<ul>
<li><p><a class="reference external" href="http://www.ti.com/lit/ml/sprw256/sprw256.pdf">Quick Start Guide</a></p></li>
<li><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/AM437x_General_Purpose_EVM_HW_User_Guide">HW User’s Guide</a></p></li>
</ul>
</li>
<li><p>AM572x EVM:</p>
<ul>
<li><p><a class="reference external" href="http://www.ti.com/lit/ug/sprw275/sprw275.pdf">Quick Start Guide</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/lit/pdf/spruig1">HW User’s Guide</a></p></li>
</ul>
</li>
<li><p>AM654x EVM
- <a class="reference external" href="http://www.ti.com/lit/pdf/sprw323">Quick Start Guide</a></p></li>
</ul>
<p>Example connections for the AM572x EVM are provided below:</p>
<div class="section" id="front">
<h4>9.1.4.3.1. Front<a class="headerlink" href="#front" title="Permalink to this headline">¶</a></h4>
<a class="reference internal image-reference" href="../_images/am572x-evm-hw-setup-front.jpg"><img alt="../_images/am572x-evm-hw-setup-front.jpg" src="../_images/am572x-evm-hw-setup-front.jpg" style="width: 812.5px; height: 457.0px;" /></a>
</div>
<div class="section" id="back">
<h4>9.1.4.3.2. Back<a class="headerlink" href="#back" title="Permalink to this headline">¶</a></h4>
<a class="reference internal image-reference" href="../_images/am572x-evm-hw-setup-back.jpg"><img alt="../_images/am572x-evm-hw-setup-back.jpg" src="../_images/am572x-evm-hw-setup-back.jpg" style="width: 815.32px; height: 458.48px;" /></a>
</div>
</div>
<div class="section" id="task-4-loading-and-running-the-template-application">
<h3>9.1.4.4. Task 4 - Loading and Running the Template Application<a class="headerlink" href="#task-4-loading-and-running-the-template-application" title="Permalink to this headline">¶</a></h3>
<div class="section" id="creating-a-target-configuration-file">
<h4>9.1.4.4.1. Creating a Target Configuration File<a class="headerlink" href="#creating-a-target-configuration-file" title="Permalink to this headline">¶</a></h4>
<p>In order to connect to the target platform we first need to create a target
configuration file. To do this, open CCS and go to the <em>File –&gt; New –&gt;
Target Configuration File</em> menu and create a new target configuration file
named after your board. For example, <strong>am572x-evm.ccxml</strong>. Next, you need to
choose your <em>connection</em> and <em>board</em> on the target configuration file page.
The <em>connection</em> is your chosen JTAG Debug Probe (for example, the XDS200) and
the <em>board</em> is the name of your EVM (either <em>EVMAM3358</em>, <em>EVMAM437X</em>, or
<em>GPEVM_AM572x_SiRevA</em>).</p>
<p>For example, here is the target configuration for the AM572x EVM using an
XDS200 Debug Probe:</p>
<a class="reference internal image-reference" href="../_images/am572x-evm-target-config.png"><img alt="../_images/am572x-evm-target-config.png" src="../_images/am572x-evm-target-config.png" style="width: 872.1999999999999px; height: 444.5px;" /></a>
<p>After setup is complete, clike the <em>Save</em> button to save your target
configuration. Then click <em>Test Connection</em> to verify that you can connect
to the board. If the test is successful you should receive the following
message:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">JTAG</span> <span class="n">DR</span> <span class="n">Integrity</span> <span class="n">scan</span><span class="o">-</span><span class="n">test</span> <span class="n">has</span> <span class="n">succeeded</span><span class="p">.</span>
</pre></div>
</div>
</div>
<div class="section" id="connecting-to-the-target">
<h4>9.1.4.4.2. Connecting to the Target<a class="headerlink" href="#connecting-to-the-target" title="Permalink to this headline">¶</a></h4>
<p>With our target configuration confirmed, we can now move on to connecting to
the target and loading our application.</p>
<p>First, set up the UART connection using the following host configuration
in your favorite serial terminal program (e.g. Tera Term, screen, Minicom):</p>
<ul class="simple">
<li><p><strong>Baud Rate</strong>: 115200</p></li>
<li><p><strong>Data Bits</strong>: 8</p></li>
<li><p><strong>Parity</strong>: None</p></li>
<li><p><strong>Flow Control</strong>: Off</p></li>
</ul>
<p>Next, click on <em>View –&gt; Target Configurations</em> in CCS. Then, right click on
the target configuration that you created earlier and click <em>Launch Selected
Configuration</em>. This action will switch CCS into the debug perspective. Your
CCS instance should look similar to below:</p>
<a class="reference internal image-reference" href="../_images/ccs-debug-pers.png"><img alt="../_images/ccs-debug-pers.png" src="../_images/ccs-debug-pers.png" style="width: 1297.8px; height: 738.5px;" /></a>
<p>In the top left corner of CCS you should see a list of all of the available
cores on your device. Right click on the primary core (listed below) and choose
the <em>Connect Target</em> option. During this process you should see GEL output in
the CCS console and the status of the core should change from “Disconnected”
to “Suspended”.</p>
<p>Primary cores for each target:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>AM335x</p></th>
<th class="head"><p>AM437x</p></th>
<th class="head"><p>AM572x</p></th>
<th class="head"><p>AM654x</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A8</p></td>
<td><p>A9</p></td>
<td><p>A15_0</p></td>
<td><p>A53_0</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For AM572x EVM, the template application can also run on the M4 and DSP
cores. If you intend to run the application on one of these cores you must
still connect to the main A15_0 core <strong>first</strong>. After connecting to the
A15_0 core you can then follow the same procedure as above to connect
to the secondary core where you would like to run the application. Do not
attempt to load and run the template application on two cores simultaneously
as the Template Application is not designed to run this way.</p>
<p>Similar instructions apply to AM654x EVM, where you should connect to the M3
core first before running on your application core.</p>
</div>
</div>
<div class="section" id="running-the-application">
<h4>9.1.4.4.3. Running the Application<a class="headerlink" href="#running-the-application" title="Permalink to this headline">¶</a></h4>
<p>Now that we are connected to the target, it is time to load the application.
To do this, go to the <em>Run –&gt; Load –&gt; Load Program</em> menu in CCS. Then, click
the <em>Browse project…</em> button and choose the
<strong>[rtos or baremetal]_template_app_&lt;board&gt;_&lt;core&gt;.out</strong> executable. Then click <em>OK</em> to load
the executable.</p>
<img alt="../_images/load-executable.png" src="../_images/load-executable.png" />
<p>You should now see the <strong>main.c</strong> file open in CCS and the program halted at
the beginning of the <code class="docutils literal notranslate"><span class="pre">main()</span></code> function. At this point you can click on the
<em>Resume (F8)</em> <img alt="resume" src="../_images/resume-button.png" /> button to start executing the Template Application.</p>
<p>The application will begin running and print progress over the UART. You should
see the following text printed to your serial terminal:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Board</span> <span class="n">Init</span> <span class="n">complete</span>
<span class="n">Uart</span> <span class="n">Init</span> <span class="n">complete</span>
<span class="n">I2C</span> <span class="n">Init</span> <span class="n">complete</span>
<span class="n">Gpio</span> <span class="n">Init</span> <span class="n">complete</span>
<span class="n">MCSPI</span> <span class="n">Init</span> <span class="n">complete</span>
<span class="o">========</span> <span class="n">Peripheral</span> <span class="n">Initialization</span> <span class="n">complete</span> <span class="o">========</span>

<span class="o">========</span> <span class="n">Starting</span> <span class="n">to</span> <span class="n">create</span> <span class="n">application</span> <span class="n">tasks</span> <span class="o">========</span>

<span class="n">gpio_toggle_led_task</span> <span class="n">task</span> <span class="n">created</span><span class="p">.</span>
<span class="n">uart_task</span> <span class="n">task</span> <span class="n">created</span><span class="p">.</span>
<span class="n">spi_test_task</span> <span class="n">task</span> <span class="n">created</span><span class="p">.</span>
<span class="n">i2c_eeprom_read_and_display_task</span> <span class="n">task</span> <span class="n">created</span><span class="p">.</span>
<span class="o">========</span> <span class="n">Application</span> <span class="n">tasks</span> <span class="n">created</span> <span class="n">successfully</span> <span class="o">========</span>

<span class="n">gpio_toggle_led</span> <span class="n">task</span> <span class="n">started</span>
<span class="n">uart_task</span> <span class="n">task</span> <span class="n">started</span>

<span class="n">i2c_eeprom_read_and_display</span> <span class="n">task</span> <span class="n">started</span>
<span class="n">spi_test</span> <span class="n">task</span> <span class="n">started</span>
<span class="n">Board</span> <span class="n">Name</span> <span class="nl">read</span><span class="p">:</span> <span class="n">AM572PM_</span>
<span class="n">Board</span> <span class="n">version</span> <span class="nl">read</span><span class="p">:</span> <span class="n">A</span><span class="mf">.30</span>
<span class="n">spi_test</span> <span class="n">task</span> <span class="n">ended</span>
<span class="n">i2c_eeprom_read_and_display</span> <span class="n">task</span> <span class="n">ended</span>
<span class="nl">uart_task</span> <span class="p">:</span><span class="n">Enter</span> <span class="n">a</span> <span class="n">word</span> <span class="n">or</span> <span class="n">Esc</span> <span class="n">to</span> <span class="n">quit</span> <span class="o">&gt;</span>
</pre></div>
</div>
<p>Type a word into the serial terminal. It should be echoed back to you. Then,
enter the <code class="docutils literal notranslate"><span class="pre">ESC</span></code> character to exit the Template Application. For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="nl">uart_task</span> <span class="p">:</span><span class="n">Enter</span> <span class="n">a</span> <span class="n">word</span> <span class="n">or</span> <span class="n">Esc</span> <span class="n">to</span> <span class="n">quit</span> <span class="o">&gt;</span><span class="n">hello</span>
<span class="n">Data</span> <span class="n">received</span> <span class="nl">is</span><span class="p">:</span><span class="n">hello</span>

<span class="nl">uart_task</span> <span class="p">:</span><span class="n">Enter</span> <span class="n">a</span> <span class="n">word</span> <span class="n">or</span> <span class="n">Esc</span> <span class="n">to</span> <span class="n">quit</span> <span class="o">&gt;</span><span class="n">test</span>
<span class="n">Data</span> <span class="n">received</span> <span class="nl">is</span><span class="p">:</span><span class="n">test</span>

<span class="nl">uart_task</span> <span class="p">:</span><span class="n">Enter</span> <span class="n">a</span> <span class="n">word</span> <span class="n">or</span> <span class="n">Esc</span> <span class="n">to</span> <span class="n">quit</span> <span class="o">&gt;^</span><span class="p">[</span>

<span class="n">uart_task</span> <span class="n">task</span> <span class="n">ended</span>
<span class="n">Template</span> <span class="n">app</span> <span class="n">ended</span>
</pre></div>
</div>
<p>Next, click the <em>Terminate</em> <img alt="terminate" src="../_images/terminate-button.png" /> button to disconnect from the target.
At this point you have successfully imported, built, and run the Template
Application.</p>
</div>
</div>
<div class="section" id="task-5-examining-the-template-application">
<h3>9.1.4.5. Task 5 - Examining the Template Application<a class="headerlink" href="#task-5-examining-the-template-application" title="Permalink to this headline">¶</a></h3>
<p>Now that you’re familiar with using the Template Application, let us look into
the code to see how it all works.</p>
<div class="section" id="the-main-c-file">
<h4>9.1.4.5.1. The main.c File<a class="headerlink" href="#the-main-c-file" title="Permalink to this headline">¶</a></h4>
<p>Begin by opening the <strong>main.c</strong> file. At the top of this file, after the
copyright header, there are a series of <code class="docutils literal notranslate"><span class="pre">#include</span></code> statements gathering
the necessary header files for the application:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Standard header files */</span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="cm">/* XDCtools Header files (RTOS only) */</span>
<span class="cp">#include</span> <span class="cpf">&lt;xdc/std.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;xdc/cfg/global.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;xdc/runtime/System.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;xdc/runtime/Error.h&gt;</span><span class="cp"></span>

<span class="cm">/* BIOS Header files (RTOS only) */</span>
<span class="cp">#include</span> <span class="cpf">&lt;ti/sysbios/BIOS.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ti/sysbios/knl/Task.h&gt;</span><span class="cp"></span>

<span class="cm">/* Board header file */</span>
<span class="cp">#include</span> <span class="cpf">&lt;ti/board/board.h&gt;</span><span class="cp"></span>

<span class="cm">/* Local template app header file */</span>
<span class="cp">#include</span> <span class="cpf">&quot;app.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<ul>
<li><p>(RTOS only) XDCtools provides configuration tools to create and build a static
configuration as part of your application. These headers are necessary
for the <code class="docutils literal notranslate"><span class="pre">*.cfg</span></code> configuration files.</p></li>
<li><p>(RTOS only) BIOS is a synonym for TI-RTOS. These headers are necessary for accessing
common RTOS features such as tasks.</p></li>
<li><p>The Board Library is a thin utility
layer on top of  CSL and other board utilities. It provides uniform
Application Programming Interfaces (APIs)
for all supported boards. It aims to assist the user to quickly write
portable applications for supported boards by hiding board level details
from the user.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">app.h</span></code> header file includes header files for drivers used
in the application code as well as macros and function prototypes.
Specifically, <code class="docutils literal notranslate"><span class="pre">app.h</span></code> includes headers for the following LLDs
which are used by the application:</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Low level driver header files */</span>
<span class="cp">#include</span> <span class="cpf">&lt;ti/drv/gpio/GPIO.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ti/drv/uart/src/UART_utils_defs.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ti/drv/uart/UART_stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ti/drv/uart/UART.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ti/drv/i2c/I2C.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ti/drv/spi/MCSPI.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>Next, we come across the <code class="docutils literal notranslate"><span class="pre">main()</span></code> function which demonstrates the common
procedure for initializing an RTOS or bare-metal application. You can read the comments in
the code for further clarification. Let’s break down the steps:</p>
<ol class="arabic">
<li><p>Initialize the board:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Board_initCfg</span> <span class="n">boardCfg</span><span class="p">;</span>
<span class="n">boardCfg</span> <span class="o">=</span>
    <span class="n">BOARD_INIT_PINMUX_CONFIG</span> <span class="o">|</span>
    <span class="n">BOARD_INIT_MODULE_CLOCK</span> <span class="o">|</span>
    <span class="n">BOARD_INIT_UART_STDIO</span><span class="p">;</span>
<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Intialize the peripherals:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">UART_init</span><span class="p">();</span>
<span class="n">I2C_init</span><span class="p">();</span>
<span class="n">GPIO_init</span><span class="p">();</span>
<span class="n">MCSPI_init</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p>(RTOS only) Create the application tasks. We will discuss this further in the section
covering the <code class="docutils literal notranslate"><span class="pre">app.c</span></code> file.</p></li>
<li><p>Start BIOS (RTOS) or start the application tasks directly (Bare-metal):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">BIOS_start</span><span class="p">();</span>

<span class="n">or</span>

<span class="nf">appRunTasks</span><span class="p">();</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="the-app-c-file">
<h4>9.1.4.5.2. The app.c File<a class="headerlink" href="#the-app-c-file" title="Permalink to this headline">¶</a></h4>
<p><strong>RTOS</strong></p>
<p>Open the <strong>app.c</strong> file and take a look at the <code class="docutils literal notranslate"><span class="pre">appTasksCreate()</span></code>
function. You should recall that this function was called in step three
of <code class="docutils literal notranslate"><span class="pre">main()</span></code>. Inside of <code class="docutils literal notranslate"><span class="pre">appTasksCreate()</span></code> there are <code class="docutils literal notranslate"><span class="pre">biosTaskCreate()</span></code>
function calls for each peripheral task. <code class="docutils literal notranslate"><span class="pre">biosTaskCreate()</span></code> just wraps the
common task creation procudure into an easy-to-use function call. Navigate to
the bottom of the <strong>app.c</strong> file to check out <code class="docutils literal notranslate"><span class="pre">biosTaskCreate()</span></code>.</p>
<p>The task creation procudure is as follows:</p>
<ol class="arabic">
<li><p>Create task variables</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Task_Params</span> <span class="n">taskParams</span><span class="p">;</span>
<span class="n">Error_Block</span> <span class="n">eb</span><span class="p">;</span>
<span class="n">Task_Handle</span> <span class="n">task</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Initialize <code class="docutils literal notranslate"><span class="pre">Error_Block</span></code> and <code class="docutils literal notranslate"><span class="pre">Task_Params</span></code> to their default values</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Error_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eb</span><span class="p">);</span>
<span class="n">Task_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">taskParams</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Apply user arguments for stack name, priority, and stack size</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">taskParams</span><span class="p">.</span><span class="n">instance</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="n">taskName</span><span class="p">;</span>
<span class="n">taskParams</span><span class="p">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">taskPriority</span><span class="p">;</span>
<span class="n">taskParams</span><span class="p">.</span><span class="n">stackSize</span> <span class="o">=</span> <span class="n">stackSize</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Create the task</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">task</span> <span class="o">=</span> <span class="n">Task_create</span><span class="p">(</span><span class="n">taskFunctionPtr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">taskParams</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">eb</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>The tasks themselves are simply functions in your code following the format
below:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">myTaskFunc</span><span class="p">(</span><span class="n">UArg</span> <span class="n">arg0</span><span class="p">,</span> <span class="n">UArg</span> <span class="n">arg1</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Bare-metal</strong></p>
<p>Open the <strong>app.c</strong> file and take a look at the <code class="docutils literal notranslate"><span class="pre">appRunTasks()</span></code> function.
Inside of <code class="docutils literal notranslate"><span class="pre">appRunTasks()</span></code> there are function calls for each peripheral task.
This file also contains setup code for a timer interrupt that controls
the LED blink task.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The application functions are called “tasks” for naming consistency
with the RTOS template application, but they are not actual SYS/BIOS
tasks.</p>
</div>
<p>Next, let’s take a look at <code class="docutils literal notranslate"><span class="pre">i2c_eeprom_read_and_display_task()</span></code> to
see how to use TI Drivers. The procedure for opening a TI Driver generally
follows these steps:</p>
<ol class="arabic">
<li><p>Create driver handle and params structure</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">I2C_Handle</span>      <span class="n">handle</span><span class="p">;</span>
<span class="n">I2C_Params</span>      <span class="n">params</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Initialize and set the driver parameters</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">I2C_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">params</span><span class="p">);</span>
<span class="n">params</span><span class="p">.</span><span class="n">transferMode</span>  <span class="o">=</span> <span class="n">I2C_MODE_CALLBACK</span><span class="p">;</span>
<span class="n">params</span><span class="p">.</span><span class="n">transferCallbackFxn</span> <span class="o">=</span> <span class="n">someI2CCallbackFunction</span><span class="p">;</span>
<span class="c1">// etc...</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Open the driver</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">handle</span> <span class="o">=</span> <span class="n">I2C_open</span><span class="p">(</span><span class="n">someI2C_configIndexValue</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">params</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">handle</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System_printf</span><span class="p">(</span><span class="s">&quot;I2C did not open&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>For more information on TI Drivers, check out the included documentation for
each driver at <strong>pdk_&lt;platform&gt;_&lt;version&gt;/packages/ti/drv/&lt;driver&gt;/docs</strong>.</p>
<p>For more infomation on SYS/BIOS, check out the  User Guide at
<strong>bios_&lt;version&gt;/docs</strong>.</p>
</div>
</div>
<div class="section" id="task-6-modifying-the-rtos-template-application">
<h3>9.1.4.6. Task 6 - Modifying the RTOS Template Application<a class="headerlink" href="#task-6-modifying-the-rtos-template-application" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The instructions below apply to the RTOS Template Application only.</p>
</div>
<p>Now that you have an understanding of how to use the drivers and create RTOS
tasks, let us make some simple modifications to create our own application.</p>
<p>We will create a simple application which allows the user to control the LED
blink rate over the UART terminal. The user should be able to enter an LED
blink period (between 0 and 5 seconds) and the user LED
should blink at that rate.</p>
<p>This part of the lab is broken down into several sections. In each section,
you will be given general instructions for modifications to make to the source
files. After you make your own modifications they will be verified against
provided code examples. Try to make the modifications on your own before
looking at the answers!</p>
<div class="section" id="delete-the-code-you-don-t-need">
<h4>9.1.4.6.1. Delete the Code You Don’t Need<a class="headerlink" href="#delete-the-code-you-don-t-need" title="Permalink to this headline">¶</a></h4>
<p>The Template Application has tasks for UART, I2C, GPIO, and MCSPI drivers. Some
of these tasks will not be used by our application. Go ahead and remove any
tasks that you do not think you will need to create the
application. Hold off on modifying tasks that will be reused until later
steps.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Don’t peek! The next section will discuss answers to the task above.</p>
</div>
<p>Since our application is only consuming user input and blinking the LEDs, we
only need the UART and GPIO tasks. That means the I2C and SPI tasks can be
removed.</p>
</div>
<div class="section" id="add-support-for-additional-features">
<h4>9.1.4.6.2. Add Support for Additional Features<a class="headerlink" href="#add-support-for-additional-features" title="Permalink to this headline">¶</a></h4>
<p>Our application will require that the UART task has a way to communicate the
delay value it receives from the user to the LED task to modify the blink rate.
While this could be accomplished with something as simple as a shared global
variable, TI-RTOS provides many other ways to accomplish inter-process
communication. Take a look at the BIOS User Guide, which is bundled with the
SDK at <strong>bios_&lt;version&gt;/docs/Bios_User_Guide.pdf</strong> for ideas on how to share
data between tasks. After you decide on a method, you can use the API
documentation located at <strong>bios_&lt;version&gt;/docs/Bios_APIs.html</strong> to figure out
how to use the API in your application.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Don’t peek! The next section will discuss answers to the task above.</p>
</div>
<p>A good choice for passing the LED blink rate is the <code class="docutils literal notranslate"><span class="pre">ti.sysbios.knl.Mailbox</span></code>
module. This module can be used to pass buffers from one task to another on the
same processor.</p>
<p>To include <code class="docutils literal notranslate"><span class="pre">Mailbox</span></code> in your project you first need to add the module to the
<strong>app.cfg</strong> file:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Mailbox</span> <span class="o">=</span> <span class="nx">xdc</span><span class="p">.</span><span class="nx">useModule</span><span class="p">(</span><span class="s1">&#39;ti.sysbios.knl.Mailbox&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Next, you need to include the <code class="docutils literal notranslate"><span class="pre">ti/sysbios/knl/Mailbox.h</span></code> header file in
<strong>app.h</strong>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/sysbios/knl/Mailbox.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>To create a Mailbox, use the <code class="docutils literal notranslate"><span class="pre">Mailbox_create()</span></code> API which is defined below:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Mailbox_Handle</span> <span class="n">Mailbox_create</span><span class="p">(</span><span class="n">SizeT</span>             <span class="n">bufsize</span><span class="p">,</span>
                              <span class="n">UInt</span>              <span class="n">numBufs</span><span class="p">,</span>
                              <span class="n">Mailbox_Params</span>    <span class="o">*</span><span class="n">params</span><span class="p">,</span>
                              <span class="n">Error_Block</span>       <span class="o">*</span><span class="n">eb</span><span class="p">)</span>
</pre></div>
</div>
<p>You are now set up to use <code class="docutils literal notranslate"><span class="pre">Mailbox</span></code> in your application code.</p>
</div>
<div class="section" id="add-new-application-code">
<h4>9.1.4.6.3. Add New Application Code<a class="headerlink" href="#add-new-application-code" title="Permalink to this headline">¶</a></h4>
<p>Modify the existing UART and LED task code to functions for the new application.
If you run in to any issues, make sure to use CCS debug features such as
breakpoints and variable watching to verify that the application is functioning
in the way that you expect. Functional example code for the AM572x EVM will be
provided at the end.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Don’t peek! The next section will discuss answers to the task above.</p>
</div>
<ol class="arabic simple">
<li><p>Create a global <code class="docutils literal notranslate"><span class="pre">Mailbox_Handle</span></code> to be shared by the <code class="docutils literal notranslate"><span class="pre">uart_task()</span></code> and
<code class="docutils literal notranslate"><span class="pre">gpio_toggle_led_task()</span></code>. Then create a Mailbox at the end of the
<code class="docutils literal notranslate"><span class="pre">appTasksCreate()</span></code> function.</p></li>
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">uart_task()</span></code> code to scan for an unisgned integer delay value
instead of a string. This value should then be placed in the Mailbox by
using the <code class="docutils literal notranslate"><span class="pre">Mailbox_post()</span></code> API.</p></li>
<li><p>Modify <code class="docutils literal notranslate"><span class="pre">gpio_toggle_led_task()</span></code> to retrieve a delay value from the
Mailbox via the <code class="docutils literal notranslate"><span class="pre">Mailbox_pend()</span></code> API. This delay value should be used in
the <code class="docutils literal notranslate"><span class="pre">task_sleep()</span></code> function calls.</p></li>
</ol>
<p>Now, give your project a try. You should be able to type in LED delay values to
the UART terminal and see the blink rate of the LED change accordingly. To see
a functioning solution, you can download the modified source files from the
links below. Sections of the source files that were modified from the originals
are marked with a <code class="docutils literal notranslate"><span class="pre">/*</span> <span class="pre">Modification:</span> <span class="pre">*/</span></code> comment.</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference download internal" download="" href="../_downloads/9f3784a13650e2e39bd15d307fe11b60/app.c"><code class="xref download docutils literal notranslate"><span class="pre">app.c</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="../_downloads/7eff35bf2d031e876f9db640f6576ca6/app.h"><code class="xref download docutils literal notranslate"><span class="pre">app.h</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="../_downloads/df63cd8a4e25d30917e648fdc4392778/app.cfg"><code class="xref download docutils literal notranslate"><span class="pre">app.cfg</span></code></a></p></li>
</ul>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="additional-information">
<h2>9.1.5. Additional Information<a class="headerlink" href="#additional-information" title="Permalink to this headline">¶</a></h2>
<div class="section" id="porting-to-a-custom-board">
<h3>9.1.5.1. Porting to a Custom Board<a class="headerlink" href="#porting-to-a-custom-board" title="Permalink to this headline">¶</a></h3>
<p>The Template Application can be easily modified to run on a custom board. The
major change required is to link in a new Board Library. Modifying the
Template Application for your custom Board can be achieved by simply removing
the <code class="docutils literal notranslate"><span class="pre">ti.board</span></code> library and PATH from the project and replacing with your
specific board libraty and PATH under the linker build options in CCS by
right clicking on the project and selecting
<em>Properties –&gt; GNU Linker –&gt; Libraries</em>.</p>
<p>For example, currently the library linked for AM572x is specified in the
<strong>.projectspec</strong> file as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>linkerBuildOptions=
    -L${TI_PDK_INSTALL_DIR}/packages/ti/board/lib/evmAM572x/a15/release/
    -l:ti.board.aa15fg
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently for AM572x EVM there is also a dependemcy on the
<strong>GPIO_evmAM572x_board.c</strong> and <strong>GPIO_board.h</strong> files. These files can be
modified for your custom board.</p>
</div>
</div>
</div>
<div class="section" id="next-steps">
<h2>9.1.6. Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>Thanks for taking the time to read through this getting started workshop.
At this point you should be comfortable with the basic structure of the SDK,
know how to import, build, modify, and run applications on the target, and know
where to find various documentation in the SDK and Software Developer Guide.</p>
<p>Next, you can check out our various video training series in the <a class="reference external" href="https://training.ti.com/">TI training
portal</a>, check out our
<a class="reference external" href="index_examples_demos.html">Examples and Demonstrations</a>, and get
started writing your own application!</p>
<p>If you have any questions along the way please remember to read the
<a class="reference external" href="index_faq.html">FAQ</a> or reach out to our engineers on the <a class="reference external" href="http://e2e.ti.com/">E2E forums</a>.</p>
</div>
</div>
<div class="section" id="image-processing-demo">
<h1>9.2. Image Processing Demo<a class="headerlink" href="#image-processing-demo" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id14">
<h2>9.2.1. Introduction<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<p>This page describes the image processing demo provided in the
Processor-SDK for RTOS. This demo illustrates the integration of key
components in the SDK and provides a framework for application
development.</p>
<p>The use case implemented is the transfer of image data from/to DDR and
internal memory. Typically, images are large and need to be stored in
external memory. Key functions include</p>
<ul class="simple">
<li><p>Operates on different segments of the same image in different cores</p></li>
<li><p>Operates across multiple cores executing different algorithms on the
same image data</p></li>
<li><p>Transfers input/output image to a medium (SD card or external system)</p></li>
<li><p>Utilize IPC to communicate between cores to perform an image
processing task parallel</p></li>
</ul>
<p>This demo utilizes many SDK features/components:</p>
<ul class="simple">
<li><p><strong>Multi-core</strong> application utilizing ARM-A15 and DSP-C66x cores</p></li>
<li><p><strong>IMGLIB</strong> for optimized C66x image processing</p></li>
<li><p><strong>IPC</strong> for interprocessor communication</p></li>
<li><p><strong>NDK</strong> application utilizing NDK for internet access</p></li>
<li><p><strong>UIA</strong> for instrumentation logging</p></li>
</ul>
<p>This demo is not available for all devices. Currently, the following
devices and EVM are supported:</p>
<ul class="simple">
<li><p>AM57x, on the AM572x GP EVM</p></li>
<li><p>C665x, on the C665x EVM</p></li>
<li><p>C667x, on the C667x EVM</p></li>
<li><p>K2H, on the K2H EVM</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For AM572x EVM, only the SD card boot option (via SBL) is current supported.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This demo has been only verified with the Google Chrome along with the 100Mbit router with DHCP</p>
</div>
</div>
<div class="section" id="requirements">
<h2>9.2.2. Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>The following materials are required to run this demonstration:</p>
<p>Hardware</p>
<ul class="simple">
<li><p>TI EVM (see list above)</p></li>
<li><p>Local Area Network with DHCP support</p></li>
<li><p>JTAG Emulator (on board or external)</p></li>
</ul>
<p>Software</p>
<ul class="simple">
<li><p>Processor-SDK RTOS</p></li>
<li><p>Code Composer Studio</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id15">
<h2>9.2.3. Software Design<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<div class="section" id="more-about-processing-algorithms">
<h3>9.2.3.1. More about processing algorithms<a class="headerlink" href="#more-about-processing-algorithms" title="Permalink to this headline">¶</a></h3>
<p>The application will use IMGLIB APIs for its core image processing
needs. The following steps are performed for edge detection:</p>
<ul class="simple">
<li><p>Split input image into multiple overlapping slices</p></li>
<li><p>If it is a RGB image, separate out the Luma component (Y) for
processing (See <a class="reference external" href="http://en.wikipedia.org/wiki/Ycbcr">YCbCr</a> for
further details)</p></li>
<li><p>Run <a class="reference external" href="http://en.wikipedia.org/wiki/Sobel_operator">Sobel operator</a>
(IMG_sobel_3x3_8) to get the gradient image of each slices</p></li>
<li><p>Run the thresholding operation ( IMG_thr_le2min_8) on the slices to
get the edges</p></li>
<li><p>Combine the slices to get the final output</p></li>
</ul>
</div>
<div class="section" id="framework-for-multicore">
<h3>9.2.3.2. Framework for multicore<a class="headerlink" href="#framework-for-multicore" title="Permalink to this headline">¶</a></h3>
<p>The current framework for multicore is IPC (Message Queue). The
following are the overall steps (the master and threads will be run on
one or more cores):</p>
<ul class="simple">
<li><p>The master thread will preprocess the input image to make a gray
scale or luma image</p></li>
<li><p>The master thread signal each slave thread to start processing and
wait for processing complete signal from all slave threads</p></li>
<li><p>The slave threads run edge detection function to generate output edge
image of the slice</p></li>
<li><p>Then the slave threads signal master thread indicating the processing
completed</p></li>
<li><p>Once master thread receives completion signal from all threads it
proceeds with further user interface processing</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="how-to-build-the-demo">
<h3>9.2.3.3. How to Build the Demo<a class="headerlink" href="#how-to-build-the-demo" title="Permalink to this headline">¶</a></h3>
<div class="section" id="am572x-gp-evm">
<h4>9.2.3.3.1. AM572x GP EVM<a class="headerlink" href="#am572x-gp-evm" title="Permalink to this headline">¶</a></h4>
<p><strong>For Linux:</strong></p>
<ul class="simple">
<li><p>Under ~/ti/processor_sdk_rtos_am57xx_x_0x_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="p">.</span><span class="o">/</span><span class="n">setupenv</span><span class="p">.</span><span class="n">sh</span>
<span class="n">make</span> <span class="n">demo_clean</span>
<span class="n">make</span> <span class="n">demo</span>
<span class="n">the</span> <span class="n">OUT</span> <span class="n">files</span> <span class="k">for</span> <span class="n">A15</span><span class="p">,</span> <span class="n">DSP1</span> <span class="n">and</span> <span class="n">DSP2</span> <span class="n">will</span> <span class="n">be</span> <span class="n">built</span> <span class="n">at</span>
   <span class="o">~/</span><span class="n">ti</span><span class="o">/</span><span class="n">processor_sdk_rtos_am57xx_x_0x_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">image_processing</span><span class="o">/</span><span class="n">ipc</span><span class="o">/</span><span class="n">evmam572x</span><span class="o">/</span><span class="n">host</span><span class="o">/</span><span class="n">build</span><span class="p">,</span>
   <span class="o">~/</span><span class="n">ti</span><span class="o">/</span><span class="n">processor_sdk_rtos_am57xx_x_0x_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">image_processing</span><span class="o">/</span><span class="n">ipc</span><span class="o">/</span><span class="n">evmam572x</span><span class="o">/</span><span class="n">dsp1</span><span class="o">/</span><span class="n">build</span><span class="p">,</span> <span class="n">and</span>
   <span class="o">~/</span><span class="n">ti</span><span class="o">/</span><span class="n">processor_sdk_rtos_am57xx_x_0x_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">image_processing</span><span class="o">/</span><span class="n">ipc</span><span class="o">/</span><span class="n">evmam572x</span><span class="o">/</span><span class="n">dsp2</span><span class="o">/</span><span class="n">build</span> <span class="n">respectively</span>
</pre></div>
</div>
<p><strong>For Windows:</strong></p>
<ul class="simple">
<li><p>Under C:\ti\processor_sdk_rtos_am57xx_x_0x_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>setupenv.bat
gmake demo_clean
gmake demo
the OUT files for A15, DSP1 and DSP2 will be built at
   C:\ti\processor_sdk_rtos_am57xx_x_0x_xx_xx\demos\image_processing\ipc\evmam572x\host\build,
   C:\ti\processor_sdk_rtos_am57xx_x_0x_xx_xx\demos\image_processing\ipc\evmam572x\dsp1\build, and
   C:\ti\processor_sdk_rtos_am57xx_x_0x_xx_xx\demos\image_processing\ipc\evmam572x\dsp2\build respectively
</pre></div>
</div>
</div>
<div class="section" id="c6657-evm">
<h4>9.2.3.3.2. C6657 EVM<a class="headerlink" href="#c6657-evm" title="Permalink to this headline">¶</a></h4>
<p><strong>For Linux:</strong></p>
<ul class="simple">
<li><p>Under ~/ti/processor_sdk_rtos_c665x_x_0x_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="p">.</span><span class="o">/</span><span class="n">setupenv</span><span class="p">.</span><span class="n">sh</span>
<span class="n">make</span> <span class="n">demo_clean</span>
<span class="n">make</span> <span class="n">demo</span>
<span class="n">the</span> <span class="n">OUT</span> <span class="n">files</span> <span class="k">for</span> <span class="n">DSPs</span> <span class="n">will</span> <span class="n">be</span> <span class="n">built</span> <span class="n">at</span>
   <span class="o">~/</span><span class="n">ti</span><span class="o">/</span><span class="n">processor_sdk_rtos_c665x_x_0x_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">image_processing</span><span class="o">/</span><span class="n">ipc</span><span class="o">/</span><span class="n">evmc6657l</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">build</span><span class="p">,</span>
   <span class="o">~/</span><span class="n">ti</span><span class="o">/</span><span class="n">processor_sdk_rtos_c665x_x_0x_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">image_processing</span><span class="o">/</span><span class="n">ipc</span><span class="o">/</span><span class="n">evmc6657l</span><span class="o">/</span><span class="n">slave</span><span class="o">/</span><span class="n">build</span> <span class="n">respectively</span>
</pre></div>
</div>
<p><strong>For Windows:</strong></p>
<ul class="simple">
<li><p>Under C:\ti\processor_sdk_rtos_c665x_x_0x_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>setupenv.bat
gmake demo_clean
gmake demo
the OUT files for DSPs will be built at
   C:\ti\processor_sdk_rtos_c665x_x_0x_xx_xx\demos\image_processing\ipc\evmc6657l\master\build,
   C:\ti\processor_sdk_rtos_c665x_x_0x_xx_xx\demos\image_processing\ipc\evmc6657l\slave\build respectively
</pre></div>
</div>
</div>
<div class="section" id="c6678-evm">
<h4>9.2.3.3.3. C6678 EVM<a class="headerlink" href="#c6678-evm" title="Permalink to this headline">¶</a></h4>
<p><strong>For Linux:</strong></p>
<ul class="simple">
<li><p>Under ~/ti/processor_sdk_rtos_c667x_x_0x_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="p">.</span><span class="o">/</span><span class="n">setupenv</span><span class="p">.</span><span class="n">sh</span>
<span class="n">make</span> <span class="n">demo_clean</span>
<span class="n">make</span> <span class="n">demo</span>
<span class="n">the</span> <span class="n">OUT</span> <span class="n">files</span> <span class="k">for</span> <span class="n">DSPs</span> <span class="n">will</span> <span class="n">be</span> <span class="n">built</span> <span class="n">at</span>
   <span class="o">~/</span><span class="n">ti</span><span class="o">/</span><span class="n">processor_sdk_rtos_c667x_x_0x_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">image_processing</span><span class="o">/</span><span class="n">ipc</span><span class="o">/</span><span class="n">evmc6678l</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">build</span><span class="p">,</span>
   <span class="o">~/</span><span class="n">ti</span><span class="o">/</span><span class="n">processor_sdk_rtos_c667x_x_0x_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">image_processing</span><span class="o">/</span><span class="n">ipc</span><span class="o">/</span><span class="n">evmc6678l</span><span class="o">/</span><span class="n">slave</span><span class="o">/</span><span class="n">build</span> <span class="n">respectively</span>
</pre></div>
</div>
<p><strong>For Windows:</strong></p>
<ul class="simple">
<li><p>Under C:\ti\processor_sdk_rtos_c667x_x_0x_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>setupenv.bat
gmake demo_clean
gmake demo
the OUT files for DSPs will be built at
   C:\ti\processor_sdk_rtos_c667x_x_0x_xx_xx\demos\image_processing\ipc\evmc6678l\master\build,
   C:\ti\processor_sdk_rtos_c667x_x_0x_xx_xx\demos\image_processing\ipc\evmc6678l\slave\build respectively
</pre></div>
</div>
</div>
<div class="section" id="k2h-evm">
<h4>9.2.3.3.4. K2H EVM<a class="headerlink" href="#k2h-evm" title="Permalink to this headline">¶</a></h4>
<p><strong>For Linux:</strong></p>
<ul class="simple">
<li><p>Under ~/ti/processor_sdk_rtos_k2hk_x_0x_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="p">.</span><span class="o">/</span><span class="n">setupenv</span><span class="p">.</span><span class="n">sh</span>
<span class="n">make</span> <span class="n">demo_clean</span>
<span class="n">make</span> <span class="n">demo</span>
<span class="n">the</span> <span class="n">OUT</span> <span class="n">files</span> <span class="k">for</span> <span class="n">A15</span><span class="p">,</span> <span class="n">DSPs</span> <span class="n">will</span> <span class="n">be</span> <span class="n">built</span> <span class="n">at</span>
   <span class="o">~/</span><span class="n">ti</span><span class="o">/</span><span class="n">processor_sdk_rtos_k2hk_x_0x_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">image_processing</span><span class="o">/</span><span class="n">ipc</span><span class="o">/</span><span class="n">evmk2hk</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">build</span><span class="p">,</span>
   <span class="o">~/</span><span class="n">ti</span><span class="o">/</span><span class="n">processor_sdk_rtos_k2hk_x_0x_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">image_processing</span><span class="o">/</span><span class="n">ipc</span><span class="o">/</span><span class="n">evmk2hk</span><span class="o">/</span><span class="n">slave</span><span class="o">/</span><span class="n">build</span> <span class="n">respectively</span>
</pre></div>
</div>
<p><strong>For Windows:</strong></p>
<ul class="simple">
<li><p>Under C:\ti\processor_sdk_rtos_k2hk_x_0x_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>setupenv.bat
gmake demo_clean
gmake demo
the OUT files for A15, DSPs will be built at
   C:\ti\processor_sdk_rtos_k2hk_x_0x_xx_xx\demos\image_processing\ipc\evmk2hk\master\build,
   C:\ti\processor_sdk_rtos_k2hk_x_0x_xx_xx\demos\image_processing\ipc\evmk2hk\slave\build respectively
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="how-to-run-the-demo">
<h3>9.2.3.4. How to Run the Demo<a class="headerlink" href="#how-to-run-the-demo" title="Permalink to this headline">¶</a></h3>
<div class="section" id="am572x-gp-evm-using-ccs">
<h4>9.2.3.4.1. AM572x GP EVM (Using CCS)<a class="headerlink" href="#am572x-gp-evm-using-ccs" title="Permalink to this headline">¶</a></h4>
<p>The CCS is used to load the program and run on ARM-A15 (HOST), C66x Core
1 (DSP1) and C66x Core 2 (DSP2) by following the steps below:</p>
<ul class="simple">
<li><p>Launch CCS and connect to AM572 GP EVM using proper target
configuration</p></li>
<li><p>Connect to CortexA15_0 (Host) [Push “Power” button right before
connect to CortexA15_0]</p></li>
</ul>
<img alt="../_images/Am572x_connect_a15.jpg" src="../_images/Am572x_connect_a15.jpg" />
<ul class="simple">
<li><p>Connect to C66xx_DSP1</p></li>
</ul>
<img alt="../_images/Am572x_connect_dsp1.jpg" src="../_images/Am572x_connect_dsp1.jpg" />
<ul class="simple">
<li><p>Connect to C66xx_DSP2</p></li>
</ul>
<img alt="../_images/Am572x_connect_dsp2.jpg" src="../_images/Am572x_connect_dsp2.jpg" />
<ul class="simple">
<li><p>Load image_processing_evmam572x_dsp1.out to C66xx_DSP1 using JTAG</p></li>
</ul>
<img alt="../_images/Am572x_load_dsp1.jpg" src="../_images/Am572x_load_dsp1.jpg" />
<ul class="simple">
<li><p>Run image_processing_evmam572x_dsp1.out on C66xx_DSP1</p></li>
<li><p>Load image_processing_evmam572x_dsp2.out to C66xx_DSP2 using JTAG</p></li>
</ul>
<img alt="../_images/Am572x_load_dsp2.jpg" src="../_images/Am572x_load_dsp2.jpg" />
<ul class="simple">
<li><p>Run image_processing_evmam572x_dsp2.out on C66xx_DSP2</p></li>
<li><p>Loaded image_processing_evmam572x_host.out to CortexA15_0</p></li>
</ul>
<img alt="../_images/Am572x_load_host.jpg" src="../_images/Am572x_load_host.jpg" />
<ul class="simple">
<li><p>Run image_processing_evmc6678l_master.out on CortexA15_0</p></li>
<li><p>The HOST will display the IP address on CCS CIO</p></li>
</ul>
<img alt="../_images/Am572x_cio.jpg" src="../_images/Am572x_cio.jpg" />
<ul class="simple">
<li><p>Users can use internet browser to access this IP address</p></li>
<li><p>The Image Processing Demo page will be displayed</p></li>
<li><p>Provide values for the “Number of Cores” and “Select Image to
Process” fields</p></li>
</ul>
<img alt="../_images/Am572x_web_1.jpg" src="../_images/Am572x_web_1.jpg" />
<p>The HOST will read the image via NDK, partition it according to the
number of cores, send the messages to DSP cores (Slaves) via IPC
MessageQ. The DSP cores will start processing the partitioned images
concurrently. The resulting output image will be stored in DDR and the
HOST will be notified by DSP cores via IPC MessageQ. Subsequently, the
HOST will write the input and output images to the Image Processing Demo
page using NDK.</p>
<img alt="../_images/Am572x_web_2.jpg" src="../_images/Am572x_web_2.jpg" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="am572x-gp-evm-using-sbl">
<h4>9.2.3.4.2. AM572x GP EVM (Using SBL)<a class="headerlink" href="#am572x-gp-evm-using-sbl" title="Permalink to this headline">¶</a></h4>
<p>The SBL is used to load the program from SD card and run on ARM-A15
(HOST), C66x Core 1 (DSP1) and C66x Core 2 (DSP2) by following the steps
below:</p>
<ul class="simple">
<li><p>Copy “app” and “MLO” from
processor_sdk_rtos_am57xx_x_0x_00_0x\prebuilt-sdcards\evmAM572x\sd_card_files
on Windows or
processor_sdk_rtos_am57xx_x_0x_00_0x/prebuilt-sdcards/evmAM572x/sd_card_files
on Linux to the root directory of a formatted micro SD card</p></li>
<li><p>Plug in the micro SD card into uSD slot on AM572x GP EVM</p></li>
<li><p>Connect “Serial Debug” on AM572x GP EVM to a PC USB port via a
“Serial to USB” cable</p></li>
<li><p>Launch a terminal emulator like Tera Term and open the local COM port
corresponding to the “Serial Debug” (Set it to 115200 bps, 8 bit,
none parity, one bit stop, no flow control)</p></li>
<li><p>Plug power adapter (12V) into the AM572x GP EVM (DC-In) and power on
the EVM</p></li>
<li><p>There the IP address will be displayed on the “Serial Debug”</p></li>
<li><p>Users can use internet browser to access this IP address</p></li>
<li><p>The Image Processing Demo page will be displayed</p></li>
<li><p>Provide values for the “Number of Cores” and “Select Image to
Process” fields</p></li>
</ul>
<img alt="../_images/Am572x_web_1.jpg" src="../_images/Am572x_web_1.jpg" />
<p>The HOST will read the image via NDK, partition it according to the
number of cores, send the messages to DSP cores (Slaves) via IPC
MessageQ. The DSP cores will start processing the partitioned images
concurrently. The resulting output image will be stored in DDR and the
HOST will be notified by DSP cores via IPC MessageQ. Subsequently, the
HOST will write the input and output images to the Image Processing Demo
page using NDK.</p>
<img alt="../_images/Am572x_web_2.jpg" src="../_images/Am572x_web_2.jpg" />
</div>
<div class="section" id="c6678-evm-or-c6657-evm">
<h4>9.2.3.4.3. C6678 EVM or C6657 EVM<a class="headerlink" href="#c6678-evm-or-c6657-evm" title="Permalink to this headline">¶</a></h4>
<p>CCS is used to load the program and Core 0 will be configured as the
host. The following steps show C667x but a similar process applies for
C665x.</p>
<ul class="simple">
<li><p>Launch CCS and connect to C6678 EVM using proper target configuration</p></li>
<li><p>Connect to C66x Core 0 (Host)</p></li>
</ul>
<img alt="../_images/C6678_connect_core0.jpg" src="../_images/C6678_connect_core0.jpg" />
<ul class="simple">
<li><p>Loaded image_processing_evmc6678l_master.out to C66x Core 0</p></li>
</ul>
<img alt="../_images/C6678_load_master.jpg" src="../_images/C6678_load_master.jpg" />
<ul class="simple">
<li><p>Run image_processing_evmc6678l_master.out on C66xx_0</p></li>
<li><p>Group C66x Core 1-N into a group (Group 1, Slave)</p></li>
<li><p>Connect to Group 1</p></li>
</ul>
<img alt="../_images/C6678_connect_group1.jpg" src="../_images/C6678_connect_group1.jpg" />
<ul class="simple">
<li><p>Load image_processing_evmc6678l_slave.out to Group 1 using JTAG</p></li>
</ul>
<img alt="../_images/C6678_load_slave.jpg" src="../_images/C6678_load_slave.jpg" />
<ul class="simple">
<li><p>Run image_processing_evmc6678l_slave.out on Group 1</p></li>
<li><p>The HOST will display the IP address on CCS CIO</p></li>
</ul>
<img alt="../_images/C6678_cio.jpg" src="../_images/C6678_cio.jpg" />
<ul class="simple">
<li><p>Users can use internet browser to access this IP address</p></li>
<li><p>The Image Processing Demo page will be displayed</p></li>
<li><p>Provide values for the “Number of Cores” and “Select Image to
Process” fields</p></li>
</ul>
<img alt="../_images/Demo_web_page_1.jpg" src="../_images/Demo_web_page_1.jpg" />
<p>The HOST will read the image via NDK, partition it according to the
number of cores, send the messages to DSP cores (Slaves) via IPC
MessageQ. The DSP cores will start processing the partitioned images
concurrently. The resulting output image will be stored in DDR and the
HOST will be notified by DSP cores via IPC MessageQ. Subsequently, the
HOST will write the input and output images to the Image Processing Demo
page using NDK.</p>
<img alt="../_images/Demo_web_page_2.jpg" src="../_images/Demo_web_page_2.jpg" />
</div>
<div class="section" id="id16">
<h4>9.2.3.4.4. K2H EVM<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<p>CCS is used to load the program and arm_A15_0 will be configured as the
master and C66xx_0 - C66xx_7 will be configured as slaves.</p>
<ul class="simple">
<li><p>Launch CCS and connect to K2H EVM using proper target configuration</p></li>
<li><p>Connect to arm_A15_0 (Host)</p></li>
</ul>
<img alt="../_images/K2h_connect_a15.jpg" src="../_images/K2h_connect_a15.jpg" />
<ul class="simple">
<li><p>Group C66xx_0 to C66xx_7 into a group (Group 1, Slaves)</p></li>
</ul>
<img alt="../_images/K2h_from_group1.jpg" src="../_images/K2h_from_group1.jpg" />
<ul class="simple">
<li><p>Connect to Group 1</p></li>
</ul>
<img alt="../_images/K2h_connect_group1.jpg" src="../_images/K2h_connect_group1.jpg" />
<ul class="simple">
<li><p>Load image_processing_evmk2hk_slave.out to Group 1 using JTAG</p></li>
</ul>
<img alt="../_images/K2h_load_group1.jpg" src="../_images/K2h_load_group1.jpg" />
<ul class="simple">
<li><p>Run image_processing_evmk2hk_slave.out on Group 1</p></li>
</ul>
<img alt="../_images/K2h_run_group1.jpg" src="../_images/K2h_run_group1.jpg" />
<ul class="simple">
<li><p>Loaded image_processing_evmk2hk_master_arm.out to arm_A15_0</p></li>
</ul>
<img alt="../_images/K2h_load_a15.jpg" src="../_images/K2h_load_a15.jpg" />
<ul class="simple">
<li><p>Run image_processing_evmk2hk_master_arm.out on arm_A15_0</p></li>
</ul>
<img alt="../_images/K2h_run_a15.jpg" src="../_images/K2h_run_a15.jpg" />
<ul class="simple">
<li><p>The HOST will display the IP address on CCS CIO</p></li>
</ul>
<img alt="../_images/K2h_cio.jpg" src="../_images/K2h_cio.jpg" />
<ul class="simple">
<li><p>Users can use internet browser to access this IP address</p></li>
<li><p>The Image Processing Demo page will be displayed</p></li>
<li><p>Provide values for the “Number of Cores” and “Select Image to
Process” fields</p></li>
</ul>
<img alt="../_images/K2h_web_1.jpg" src="../_images/K2h_web_1.jpg" />
<p>The HOST will read the image via NDK, partition it according to the
number of cores, send the messages to DSP cores (Slaves) via IPC
MessageQ. The DSP cores will start processing the partitioned images
concurrently. The resulting output image will be stored in DDR and the
HOST will be notified by DSP cores via IPC MessageQ. Subsequently, the
HOST will write the input and output images to the Image Processing Demo
page using NDK.</p>
<img alt="../_images/K2h_web_2.jpg" src="../_images/K2h_web_2.jpg" />
</div>
</div>
</div>
</div>
<div class="section" id="posix-smp-demo">
<h1>9.3. POSIX-SMP Demo<a class="headerlink" href="#posix-smp-demo" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id17">
<h2>9.3.1. Introduction<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<p>This page describes the SMP/Posix demo provided in the Processor-SDK for
RTOS and Linux. This demo uses Posix APIs together with a simple
benchmark (Dhrystone) to automatically calculate the effective
throughput of all the cores in each SMP cluster. SMP mode is only
supported on Coretex-A15 cores.</p>
<p>This demo runs on:</p>
<ul class="simple">
<li><p>AM572x (A15, C66, M4)</p></li>
<li><p>AM437x (A9)</p></li>
<li><p>AM335x (A8)</p></li>
<li><p>K2H (A15, C66)</p></li>
<li><p>K2E (A15, C66)</p></li>
<li><p>K2G (A15, C66)</p></li>
<li><p>K2L (A15, C66)</p></li>
<li><p>C6678 (C66)</p></li>
<li><p>C6657 (C66)</p></li>
</ul>
<p>The sections below provide details of the application as well as build
and run instructions.</p>
</div>
<div class="section" id="id18">
<h2>9.3.2. Requirements<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<p>The following materials are required to run this demonstration:</p>
<p>Hardware</p>
<ul class="simple">
<li><p>TI EVM (see list above)</p></li>
<li><p>Serial UART cable (provided in EVM kit)</p></li>
</ul>
<p>Software</p>
<ul class="simple">
<li><p>Processor-SDK RTOS</p></li>
<li><p>Code Composer Studio</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id19">
<h2>9.3.3. Software Design<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h2>
<p>The demo is based on Dhrystone 2.1 from
<a class="reference external" href="http://fossies.org/linux/privat/old/dhrystone-2.1.tar.gz/">link</a>.</p>
<p>The purpose of the demo is two-fold. First, it is to show easy scaling
of throughput across cores in a SMP cluster when running TI-RTOS.
Second, it shows easy portability of Posix threads between TI-RTOS and
Linux.</p>
<p>The overall requirement is discover all parameters automatically without
user input, and to minimize the amount of code that must be customized
between TI-RTOS and Linux. This demonstrates that the same Posix threads
as well as their setup/control code can be run on either TI-RTOS or
Linux with minimal effort.</p>
<p>In order to accomplish this, several major modifications were made to
Dhrystone in order to “threadify” it. Some of these changes slightly
affect the results compared to an unmodified version. Thus this modified
version should be run on all processors where comparisons will be drawn.</p>
<ul class="simple">
<li><p><strong>Removal of most printf() during normal operation.</strong> Original code
dumped all final values for the user to verify. Changed to
programmatic verification. Only printf() for actual results (DMIPS
and Dhrystones) preserved.</p></li>
<li><p><strong>Removal of all global variables.</strong> They are accessed through an
“inst” pointer instead.</p></li>
<li><p><strong>Adaptive discovery of iteration count.</strong> Original code used a
#define. This version doubles iteration count until execution time is
about 10M timer ticks.</p></li>
<li><p><strong>Adaptive discovery of number of cores in SMP cluster.</strong> Original
code didn’t use threads. This version doubled number of threads until
cumulative DMIPS flattens out.</p></li>
</ul>
<p>POSIX barriers are used inside the timed portion of the code. This is
not to time the performance of the barrier, but is instead used to time
how long all threads together take to complete. It is assumed the
execution times of the threads (&gt; 0.1 second) are orders of magnitude
more than the barrier, so the barrier’s effect on results is negligible.</p>
<p>Processor SDK uses makefiles for TI-RTOS and Yocto recipes for Linux for
the supported EVMs. The makefile can also be used to compile native
builds for Linux (both for EVMs and x86).</p>
<p>For more information on TI-RTOS Posix, see <a class="reference external" href="http://processors.wiki.ti.com/index.php/SYS/BIOS_POSIX_Thread_(pthread)_Support">POSIX
Support</a>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id20">
<h2>9.3.4. How to Run the Demo<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h2>
<p>The processor SDK includes pre-built binaries which may be loaded and
run using the SBL with UART or using CCS with UART or ROV (UART display
for newer versions and ROV for older versions). To run using UART, hook
up to the board using UART and run the .out file.</p>
<img alt="../_images/Posix-demo-uart.PNG" src="../_images/Posix-demo-uart.PNG" />
<p>To run using CCS, use the following steps. Each binary has an associated
\*.rov.xs file located in the same directory–enabling the CCS ROV tool.
Newer versions will display directly to the UART console and any steps
involving ROV may be skipped.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">SDK_INSTALL_PATH</span><span class="o">&gt;/</span><span class="n">processor_sdk_rtos_</span><span class="o">&lt;</span><span class="n">platform</span><span class="o">&gt;</span><span class="n">_2_00_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">posix</span><span class="o">-</span><span class="n">smp</span><span class="o">/</span><span class="n">bin</span><span class="o">/&lt;</span><span class="n">platform</span><span class="o">&gt;/&lt;</span><span class="n">core</span><span class="o">&gt;/</span><span class="n">debug</span><span class="o">/</span><span class="n">dhry</span><span class="p">.</span><span class="n">out</span>
<span class="o">&lt;</span><span class="n">SDK_INSTALL_PATH</span><span class="o">&gt;/</span><span class="n">processor_sdk_rtos_</span><span class="o">&lt;</span><span class="n">platform</span><span class="o">&gt;</span><span class="n">_2_00_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">posix</span><span class="o">-</span><span class="n">smp</span><span class="o">/</span><span class="n">bin</span><span class="o">/&lt;</span><span class="n">platform</span><span class="o">&gt;/&lt;</span><span class="n">core</span><span class="o">&gt;/</span><span class="n">debug</span><span class="o">/</span><span class="n">dhry_pa15fg</span><span class="p">.</span><span class="n">rov</span><span class="p">.</span><span class="n">xs</span>
</pre></div>
</div>
<p>For all platforms and core types, the basic procedure for running the
demo will be the same:</p>
<ol class="arabic simple">
<li><p>Using CCS, launch the target configuration for the EVM <a class="reference external" href="http://processors.wiki.ti.com/index.php/Target_Configuration_-_Custom_Configurations">CCS-Target
Configurations</a>.
Please ensure that the target configuration will load the appropriate
CCS gel files found in the emupak. Make sure all Coretex-A15 cores in
the SMP cluster have an appropriate CCS gel file.</p></li>
<li><p>The default ccxml file only loads a gel on connect for some of the
cores. Modify the ccxml file to load the gel for all the
corresponding cores.</p></li>
<li><p>In the CCS debug view, group and then connect to all cores of device
that you wish to test on (i.e. - all of the clustered A15 cores).</p></li>
<li><p>For each, core load the dhry.out file. The principle core should halt
at main while the SMP linked cores will begin auto-running upon load.</p></li>
<li><p>Once all cores have been loaded, run all the cores.</p></li>
<li><p>The output will be sent to the UART console in real time.</p></li>
<li><p>The demo should not take more than a few minutes to run. You must
manually halt the cores to end the demo.</p></li>
</ol>
<p>If using Processor-SDK 3.0 or later,</p>
<ol class="arabic simple">
<li><p>Open the ROV window (Tools &gt; RTOS Object View (ROV)) and view the
SysMin module to inspect the output of the demo. If you see the below
message, please specify the XDC and SYSBIOS versions:</p></li>
</ol>
<img alt="../_images/Use_rov_1.jpg" src="../_images/Use_rov_1.jpg" />
<img alt="../_images/Use_rov_2.png" src="../_images/Use_rov_2.png" />
<img alt="../_images/Posix-smp2.png" src="../_images/Posix-smp2.png" />
<p>The output buffer shown in the ROV contains the different stages of the
demo’s progression:</p>
<ol class="arabic simple">
<li><p>The demo finds an appropriate number of iterations for the device.</p></li>
<li><p>The demo begins to add threads.</p></li>
<li><p>The demo concludes when adding additional threads does not further
increase the DMIPS.</p></li>
</ol>
<p>The output takes the form of: “xxxxxxx iterations *n threads;
dhrystones xxxxxxxx, dmips = xxxx”. In the screenshot above, moving from
two threads to four threads does not appreciably improve the DMIPS, so
the demo completes. This behavior is expected because the demo is only
running on two cores in this example.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>A15 cores may usually be connected to directly; on the AM572x, the M4
IPUs must first be initialized by the gel scripts (Scripts &gt; AM572x
MULTICORE initialization &gt; IPUxSSClkEnable_API)</p></li>
<li><p>If the K2 demo will not run, try updating to the latest emupack by
doing “Help/Check For Updates” and selecting “Keystone2 device
support” update (only). There are additional instructions for
configuring groups, etc. at <a class="reference external" href="http://processors.wiki.ti.com/index.php/SMP_Debug">SMP
Debug</a>.</p></li>
<li><p>If the primary core of an SMP group will not allow running after
loading the demo, try pausing the linked cores and then running all
the cores in a group</p></li>
<li><p>For TI-RTOS documentation for enabling SMP, refer to
<a class="reference external" href="http://processors.wiki.ti.com/index.php/SMP/BIOS">SMP/BIOS</a>. The
POSIX demo in the Processor SDK RTOS packages with C66x does not
support SMP. This is a POSIX pthread demo intended to run Dhrystone
on one C66x core without SMP.</p></li>
<li><p>Some of the DMIPS values may not be accurate, but the values will
increase proportionally with the number of cores</p></li>
</ul>
</div>
</div>
<div class="section" id="id21">
<h2>9.3.5. How to Build the Demo<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<div class="section" id="processor-sdk-rtos">
<h3>9.3.5.1. Processor-SDK RTOS<a class="headerlink" href="#processor-sdk-rtos" title="Permalink to this headline">¶</a></h3>
<p>To build the project manually, first navigate to the top level makefile:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">SDK_INSTALL_PATH</span><span class="o">&gt;/</span><span class="n">processor_sdk_rtos_</span><span class="o">&lt;</span><span class="n">platform</span><span class="o">&gt;</span><span class="n">_2_00_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">posix</span><span class="o">-</span><span class="n">smp</span><span class="o">/</span><span class="n">makefile</span>
</pre></div>
</div>
<p>Edit the makefile to include the paths to BIOS, XDC, PDK packages, and
the toolchains for the cores being used.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#DEPOT = &lt;ROOT_INSTALL_PATH&gt;</span>
<span class="cp">#### BIOS-side dependencies ####</span>
<span class="cp">#BIOS_INSTALL_PATH ?= $(DEPOT)\bios_n_nn_nn_nn</span>
<span class="cp">#XDC_INSTALL_PATH ?= $(DEPOT)\xdctools_n_nn_nn_nn_core</span>
<span class="cp">#### BIOS-side toolchains ####</span>
<span class="cp">#TOOLCHAIN_PATH_A15 ?= $(DEPOT)\ccsv6\tools\compiler\gcc-arm-none-eabi-n_n-xxxxqn</span>
<span class="cp">#TOOLCHAIN_PATH_M4 ?= $(DEPOT)\ccsv6\tools\compiler\ti-cgt-arm_x.x.x</span>
</pre></div>
</div>
<p>Navigate to the demo directory and run “make”. The steps to run the demo
will be the same.</p>
</div>
<div class="section" id="processor-sdk-linux">
<h3>9.3.5.2. Processor-SDK Linux<a class="headerlink" href="#processor-sdk-linux" title="Permalink to this headline">¶</a></h3>
<p>The Posix-SMP demo has been added to the Linux SDK matrix starting in
Processor-SDK 3.0. Simply run the example from the Matrix and the output
will be displayed on the console.</p>
<p>For the documentation on the Linux Matrix, please see:
<a class="reference external" href="http://processors.wiki.ti.com/index.php/Matrix_Users_Guide">link</a>.</p>
</div>
</div>
</div>
<div class="section" id="audio-benchmark-starterkit">
<h1>9.4. Audio Benchmark Starterkit<a class="headerlink" href="#audio-benchmark-starterkit" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id22">
<h2>9.4.1. Introduction<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h2>
<p>The Audio Benchmark Starterkit is intended to provide an easy and quick
way to benchmark key audio functions on C66x and C674x DSP devices. This
package is intended for users who are new to the TI DSP development
environment and provides an easy path to compare core audio benchmarks
to other implementations. For the purposes of benchmarking we have
selected the following signal processing functions</p>
<ul class="simple">
<li><p>Complex Fast Fourier transform (FFT)</p></li>
<li><p>Real Block FIR filters with 128 samples, 16 coefficients</p></li>
<li><p>Cascaded Biquad (2 channels, 3 stages) IIR filter for 128 Samples</p></li>
</ul>
<p>The package is also a great way to get familiar with benchmarking
functions on TI DSP with or without TI`s Code Composer Studio
environment. It also intends to provide guidance on the compiler options
and code/data memory placement that allows developers to obtain optimal
performance on TI DSP architecture. The package also demonstrates use of
signal processing functions from TI C6000 DSPLIB which contains several
kernels optimized for TI DSP architectures.</p>
</div>
<div class="section" id="software-features">
<h2>9.4.2. Software Features<a class="headerlink" href="#software-features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Benchmark applications for core signal processing functions</p></li>
<li><p>Makefile and CCS Project scripts to build applications</p></li>
<li><p>SD card bootable binaries [Supported on SOCs that support SD boot]</p></li>
</ul>
</div>
<div class="section" id="directory-structure">
<h2>9.4.3. Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h2>
<p>The audio benchmark starterkit is located in the Processor SDK RTOS
release under the directory path</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>&lt;SDK_INSTALL_PATH&gt;\processor_sdk_rtos_&lt;soc&gt;_x_xx_xx_xx\demos\audio-benchmark-starterkit
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">The directory structure for the audio benchmark starterkit is shown in
the image below.</div>
</div>
<p>Detailed description of the directory structure is given below:
.. Image:: ../images/Audben_dirStructure.png</p>
<ul class="simple">
<li><p>prebuilt-binaries - directory contains prebuilt out files to run the benchmarks.</p></li>
<li><p>bootimages - SD card boot files to run the benchmarks using SD boot.</p></li>
<li><p>docs - directory contains ReadMe, Quick start guide and the software manifest for the package.</p></li>
<li><p>scripts - directory contains .txt script files that is used by BenchmarkProjectCreate
script to create CCS projects</p></li>
<li><p>src
-  common - Contains linker command file and logging functions used by all benchmark tests.
-  singlePrecision_FFT - Source files for benchmark app for FFT
-  singlePrecision_FIR - Source files for benchmark app for FIR
-  singlePrecision_IIR - Source files for benchmark app for IIR</p></li>
</ul>
</div>
<div class="section" id="software-dependencies">
<h2>9.4.4. Software Dependencies<a class="headerlink" href="#software-dependencies" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="index_overview.html#processor-sdk-for-rtos">Processor SDK RTOS v3.3 and later</a></p></li>
<li><p><a class="reference external" href="index_overview.html#code-composer-studio">Code Composer Studio IDE Environment v7 and later</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>For correct version of Code Composer Studio to download, please refer
to the `Release Notes &lt;index_release_specific.html#release-notes&gt;`__
corresponding to the Processor SDK RTOS version that you have
installed</strong></p>
</div>
</div>
<div class="section" id="supported-hardware">
<h2>9.4.5. Supported Hardware<a class="headerlink" href="#supported-hardware" title="Permalink to this headline">¶</a></h2>
<p><strong>Platforms supported in Processor SDK RTOS 3.3 and later</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.ti.com/tool/EVMK2G">K2G EVM</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/tool/tmdsevm572x">AM572x GP EVM</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/tool/TMDXIDK5718">AM571x IDK</a></p></li>
</ul>
<p><strong>Platforms planned in Processor SDK RTOS 4.0</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.ti.com/tool/tmdslcdk6748">OMAPL138/C6748 LCDK</a></p></li>
<li><p><a class="reference external" href="http://www2.advantech.com/Support/TI-EVM/EVMK2HX.aspx">K2H EVM rev 1.1 and
later</a></p></li>
<li><p><a class="reference external" href="https://www.einfochips.com/index.php/partnerships/texas-instruments/k2e-evm.html">K2E EVMs rev 1.0.2.0 and
later</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/tool/tmdsevm6678">C6678 EVM</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/tool/tmdsevm6657">C6657 EVM</a></p></li>
</ul>
</div>
<div class="section" id="quickstart-with-how-to-video">
<h2>9.4.6. QuickStart with How-To-Video<a class="headerlink" href="#quickstart-with-how-to-video" title="Permalink to this headline">¶</a></h2>
<p>For an easy and visual experience to build and run the benchmark tests,
we have created a short How to video that demonstrates how the Benchmark
Starterkit can be built and run on C66x DSP on the K2G EVM which you can
check out from the link provided below:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://training.ti.com/66ak2gx-gp-evm-audio-benchmark-starter-kit-demo">Demonstration of Audio Benchmark starterkit demo on 66AK2G02 GP
EVM</a></p></li>
</ul>
</div>
<div class="section" id="how-to-build-the-benchmarks">
<h2>9.4.7. How to Build the Benchmarks<a class="headerlink" href="#how-to-build-the-benchmarks" title="Permalink to this headline">¶</a></h2>
<p>The benchmark starterkit is designed to build with makefiles as well as
with Code Composer Studio (CCS) IDE Environment. Both the approaches
requires developers to setup the Processor SDK RTOS development
environment. Developers can use either approach based on their
familiarity with the chosen build environment. Let us take a closer look
at both approaches.</p>
<div class="section" id="using-makefile">
<h3>9.4.7.1. Using Makefile<a class="headerlink" href="#using-makefile" title="Permalink to this headline">¶</a></h3>
<p><strong>Step1 : Setup Processor SDK RTOS build Environment.</strong></p>
<p>Developers are required to setup the Processor SDK RTOS build
environment as described in <a class="reference internal" href="index_overview.html#build-the-sdk-setup-environment-label"><span class="std std-ref">Processor SDK RTOS Setup environment</span></a></p>
<ol class="arabic simple">
<li><p><strong>set SDK_INSTALL_PATH = C:\ti\&lt;Install directory&gt;</strong></p></li>
<li><p><strong>setupenv.bat</strong></p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If developers install CCS or Processor SDK RTOS under Custom path then
they need to refer to the setup instructions described under
<a class="reference internal" href="index_how_to_guides.html#processor-sdk-rtos-install-in-custom-path-label"><span class="std std-ref">Setup environment when installing to a custom path</span></a></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Step2 : Invoke Make from root directory</strong></p>
<p>The make file in the root director of the audio-starterkit can be used
to build the entire package. To build the benchmark examples:</p>
<ol class="arabic simple">
<li><p><strong>cd &lt;PROC_SDK_INSTALL_PATH&gt;/demos/audio-benchmark-starterkit</strong></p></li>
<li><p><strong>make all</strong></p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The build picks up the SOC information from the SDK setup. Also, in the
make environment the benchmark application is built to send benchmark
logs to UART console so that there is no dependency on the CCS IDE
environment</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>For Other supported options, please type</p>
<p><strong>For Windows:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">gmake</span> <span class="n">help</span>
</pre></div>
</div>
<p><strong>For Linux :</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">help</span>
</pre></div>
</div>
<p>All available options are provided below:</p>
<img alt="../_images/Make_help.png" src="../_images/Make_help.png" />
</div>
<div class="section" id="using-ccs-projects">
<h3>9.4.7.2. Using CCS Projects<a class="headerlink" href="#using-ccs-projects" title="Permalink to this headline">¶</a></h3>
<p>The audio benchmark starterkit does not provide pre-canned CCS Projects
as it is difficult to set up projects to be portable across various
developer build environments. To create CCS Projects with the
benchmarks, developers are required to run the BenchmarkProjectCreate
script provided in the root directory of the starterkit.</p>
<p><strong>Step1 : Setup Processor SDK RTOS build Environment.</strong></p>
<ol class="arabic simple">
<li><p><strong>set SDK_INSTALL_PATH = C:\ti\&lt;Install directory&gt;</strong></p></li>
<li><p><strong>set TOOLS_INSTALL_PATH = C:\ti\&lt;CCS Install directory&gt;</strong></p></li>
<li><p><strong>setupenv.bat</strong></p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CCS by default is installed in the path C:\ti\ccsv7 so
TOOLS_INSTALL_PATH=C:\ti</p>
</div>
<p>Developers are required to setup the Processor SDK RTOS build
environment as described in <a class="reference internal" href="index_overview.html#build-the-sdk-setup-environment-label"><span class="std std-ref">Processor SDK RTOS Setup environment</span></a></p>
<p>If developers install CCS or Processor SDK RTOS under a Custom path then
they need to refer to the setup instructions described under
<a class="reference internal" href="index_how_to_guides.html#processor-sdk-rtos-install-in-custom-path-label"><span class="std std-ref">Setup environment when installing to a custom path</span></a></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Step 2: Run BenchmarkProjectCreate script to generate CCS Projects</strong></p>
<p>To generate the CCS Projects</p>
<ol class="arabic simple">
<li><p><strong>cd $PROC_SDK_INSTALL_PATH/demos/audio-benchmark-starterkit</strong></p></li>
<li><p><strong>BenchmarkProjectCreate [Options]</strong></p></li>
</ol>
<p>The Project create script can be run using the following syntax</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">BenchmarkProjectCreate</span><span class="p">.</span><span class="n">bat</span> <span class="o">&lt;</span><span class="n">soc</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">board</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">all</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Description of arguments:</p>
<ul class="simple">
<li><p><strong>soc</strong> - <strong>K2G (Default)</strong> / K2H/ K2E/ C6678/ C6657/ AM572X/ AM571x/
OMAPL138</p></li>
<li><p><strong>board</strong> - <strong>all (Default)</strong> / &lt;SOC supported EVMs&gt;</p></li>
<li><p><strong>module</strong> - <strong>all</strong> / (FFT / FIR / IIR)</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="nl">Example</span><span class="p">:</span>
 <span class="n">a</span><span class="p">)</span> <span class="n">BenchmarkProjectCreate</span><span class="p">.</span><span class="n">bat</span>
             <span class="o">-</span> <span class="n">Creates</span> <span class="n">all</span> <span class="n">module</span> <span class="n">projects</span> <span class="k">for</span> <span class="n">the</span> <span class="n">K2G</span> <span class="n">soc</span> <span class="k">for</span> <span class="n">evmK2G</span> <span class="n">platform</span>
 <span class="n">b</span><span class="p">)</span> <span class="n">BenchmarkProjectCreate</span><span class="p">.</span><span class="n">bat</span> <span class="n">AM572x</span>
             <span class="o">-</span> <span class="n">Creates</span> <span class="n">all</span> <span class="n">module</span> <span class="n">projects</span> <span class="k">for</span> <span class="n">AM572x</span> <span class="n">soc</span> <span class="k">for</span> <span class="n">evmAM572x</span> <span class="n">and</span> <span class="n">idkAM572x</span> <span class="n">platform</span>
 <span class="n">c</span><span class="p">)</span> <span class="n">BenchmarkProjectCreate</span><span class="p">.</span><span class="n">bat</span> <span class="n">C6657</span> <span class="n">evmC6657</span>
             <span class="o">-</span> <span class="n">Creates</span> <span class="n">all</span> <span class="n">modules</span> <span class="k">for</span> <span class="n">C6657</span> <span class="n">DSP</span> <span class="k">for</span> <span class="n">evmC6657</span> <span class="n">platform</span>
 <span class="n">d</span><span class="p">)</span> <span class="n">BenchmarkProjectCreate</span><span class="p">.</span><span class="n">bat</span> <span class="n">K2H</span> <span class="n">evmK2H</span> <span class="n">FFT</span>
             <span class="o">-</span> <span class="n">Creates</span> <span class="n">FFT</span> <span class="n">module</span> <span class="n">project</span> <span class="k">for</span> <span class="n">K2H</span> <span class="n">soc</span> <span class="k">for</span> <span class="n">evmK2H</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Known issue with Processor SDK RTOS 3.3</strong>
The BenchmarkProjectCreate script uses text files .txt from scripts
folder to generate the CCS projects. The name for the demo folder was
updated from “audio-benchmark-kit” to “audio-benchmark-starterkit”. This
will require CCS users to update the name in the .txt file before
generating the scripts.</p>
<p>For Example if you are using K2G platform locate file
Benchmark_FFT_evmK2G_c66ExampleProject.txt,
Benchmark_FIR_evmK2G_c66ExampleProject.txt and
Benchmark_IIR_evmK2G_c66ExampleProject.txt and update the demo name in
the text files from “audio-benchmark-kit” to
“audio-benchmark-starterkit”</p>
</div>
<p><strong>Step 3: Import Generated CCS Projects in CCS Workspace</strong></p>
<p>Launch CCS and Import the CCS Project using the Project-&gt;Import Existing
CCS Project and browse to the audio-benchmark-starterkit folder</p>
<img alt="../_images/CCS_Project_Browse.png" src="../_images/CCS_Project_Browse.png" />
<p><strong>Step 4: Build Imported CCS Benchmark Projects</strong></p>
<p>Right click on the Benchmark Project File and Build the project as shown
below:</p>
<img alt="../_images/Build_Benchmark.png" src="../_images/Build_Benchmark.png" />
</div>
</div>
<div class="section" id="how-to-run-the-benchmarks">
<h2>9.4.8. How to Run the Benchmarks<a class="headerlink" href="#how-to-run-the-benchmarks" title="Permalink to this headline">¶</a></h2>
<p>The benchmark examples can be run by loading the built out files with an
emulator using the CCS Debug functionality or the examples can be run on
the DSP by creating SD card bootable images using out files. Let us take
a look at both these approaches.</p>
<div class="section" id="using-ccs">
<h3>9.4.8.1. Using CCS<a class="headerlink" href="#using-ccs" title="Permalink to this headline">¶</a></h3>
<p><strong>Step 1: Connect Emulator and UART to Hardware</strong></p>
<ul class="simple">
<li><p>Refer to the <a class="reference external" href="index_release_specific.html#supported-platforms-and-versions">Hardware Setup guide</a>
and connect the onboard or external emulator to the Hardware and Host
machine with CCS installed.</p></li>
<li><p>Connect the UART cable from the EVM to the Host machine and configure
the Serial console with following settings:</p>
<ul>
<li><p><strong>Baud Rate</strong>: 115200</p></li>
<li><p><strong>Data Bits</strong>: 8</p></li>
<li><p><strong>Parity</strong>: None</p></li>
<li><p><strong>Flow Control</strong>: Off</p></li>
</ul>
</li>
</ul>
<p><strong>Step 2: Create Target configuration and connect to the DSP</strong></p>
<p>To connect to the SOC, developers need to create a Target configuration
by following the procedure described in wiki
<span class="xref std std-ref">Create_Target_Configuration_File_for_EVM</span></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Instructions specific to supported EVMs:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/66AK2G02_GP_EVM_Hardware_Setup#Connect_without_a_SD_card_boot_image">K2G GP EVM CCS
Setup</a></p></li>
<li><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/AM572x_GP_EVM_Hardware_Setup#Connect_without_a_SD_card_boot_image">AM572x GP EVM CCS
Setup</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please refer to <a class="reference external" href="index_release_specific.html#supported-platforms-and-versions">Hardware User Guide</a>
corresponding to each supported EVM so setup the boot switches to No
boot if available</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Step 3: Loading and Running Benchmark application on the DSP</strong></p>
<ul class="simple">
<li><p>Load the out file using <strong>Run -&gt; Load -&gt; Load Program</strong> and browse to
the output binary.</p></li>
<li><p>After loading the out file, run the benchmark app by Pressing <strong>F8</strong>
or <strong>Run -&gt; Resume</strong></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../_images/FFTBenchmark_CCS_Output.png" src="../_images/FFTBenchmark_CCS_Output.png" />
<table class="docutils align-default">
<tbody>
</tbody>
</table>
</div>
<div class="section" id="using-sd-card-supported-only-on-am57xx-and-k2g">
<h3>9.4.8.2. Using SD card (Supported only on AM57xx and K2G)<a class="headerlink" href="#using-sd-card-supported-only-on-am57xx-and-k2g" title="Permalink to this headline">¶</a></h3>
<p><strong>Step 1: Run Create SD script to generate SD bootable binaries</strong></p>
<p>The root directory in the audio-benchmark-starterkit contains a
create-sd.bat file that will convert the .out files installed int the
bin folder into SD bootable images which will be installed in the path
bin/sd_card_files/&lt;EVM&gt;</p>
<p>The syntax to run the create-sd script is as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">create</span><span class="o">-</span><span class="n">sd</span><span class="p">.</span><span class="n">bat</span> <span class="o">&lt;</span><span class="n">EVM</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><strong>EVM</strong> : refers to evaluation platfom on which the binaries are meant
to be run</p>
<p>Eg: create-sd evmK2G - Creates SD bootable images for K2G EVM.</p>
<p><strong>Step 2 : Format and copy the SD card binaries to the SD card</strong></p>
<p>Create an SD card using the procedure described in <a class="reference internal" href="index_overview.html#tools-create-sd-card-windows-label"><span class="std std-ref">Creating SD card in Windows</span></a>
and <a class="reference internal" href="index_overview.html#tools-create-sd-card-linux-label"><span class="std std-ref">Create SD card in Linux</span></a></p>
<p>Copy the “MLO” and “Singleprecision_&lt;Module&gt;_app” to the boot partition
on the SD card.</p>
<p><strong>Step 3: Boot the Benchmark app by configuring SD boot on the EVM</strong></p>
<ul class="simple">
<li><p>Configure the boot switches on the evaluation hardware to SD boot.</p></li>
<li><p>Insert the SD card in the microSD or SD card slot on the board.</p></li>
<li><p>Connect the UART on the hardware to the Host and configure the host
to <strong>Baud Rate</strong>= 115200, <strong>Data Bits</strong>= 8 , <strong>Parity</strong>= None,
<strong>Flow Control</strong>= Off</p></li>
<li><p>Power on the EVM to view the output on the Serial console on the host</p></li>
</ul>
</div>
</div>
<div class="section" id="benchmark-app-output-on-uart-console">
<h2>9.4.9. Benchmark App output on UART console<a class="headerlink" href="#benchmark-app-output-on-uart-console" title="Permalink to this headline">¶</a></h2>
<img alt="../_images/FFTbenchmark_sdBoot.png" src="../_images/FFTbenchmark_sdBoot.png" />
<div class="section" id="benchmark-starterkit-implementation">
<h3>9.4.9.1. Benchmark Starterkit Implementation<a class="headerlink" href="#benchmark-starterkit-implementation" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="signal-processing-functions-used-in-starterkit">Signal Processing functions used in Starterkit</p>
<p class="rubric" id="single-precision-fft-dspf-sp-fftspxsp-mixed-radix-forward-fft">Single Precision FFT: DSPF_sp_fftSPxSP (Mixed Radix Forward
FFT )</p>
<p>The audio benchmark kit uses the FFT implementation(DSPF_sp_fftSPxSP)
from the <a class="reference external" href="http://processors.wiki.ti.com/index.php/Software_libraries#DSPLIB">TI DSP
Library</a>.
The DSPF_sp_fftSPxSP kernel calculates the discrete Fourier transform of
complex input array <code class="docutils literal notranslate"><span class="pre">ptr_x</span></code> using a mixed radix FFT algorithm. The
result is stored in complex output array <code class="docutils literal notranslate"><span class="pre">ptr_y</span></code> in normal order. Each
complex array contains real and imaginary values at even and odd
indices, respectively. DSPF_sp_fftSPxSP kernel is implemented in
assembly to maximize performance, but a natural C implementation is also
provided. The demonstration app for this kernel includes the required
bit reversal coefficients, <code class="docutils literal notranslate"><span class="pre">brev</span></code>, and additional code to calculate
the twiddle factor coefficients, <code class="docutils literal notranslate"><span class="pre">ptr_w</span></code>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>For implementation details of this FFT computation refer to
documentation provided in <a class="reference external" href="index_examples_demos.html#additional-resources">Additional resources</a></p></li>
<li><p>For Real input sequences, efficient FFT Implementation is described
here
<a class="reference external" href="http://processors.wiki.ti.com/index.php/Efficient_FFT_Computation_of_Real_Input">Efficient_FFT_Computation_of_Real_Input</a></p></li>
</ul>
</div>
<p class="rubric" id="single-precision-fir-dspf-sp-fir-cplx-complex-fir-filter">Single Precision FIR: DSPF_sp_fir_cplx (Complex FIR Filter)</p>
<p>The audio benchmark kit uses the FFT implementation(DSPF_sp_fftSPxSP)
from the <a class="reference external" href="http://processors.wiki.ti.com/index.php/Software_libraries#DSPLIB">TI DSP
Library</a>.
The DSPF_sp_fir_cplx kernel performs complex FIR filtering on complex
input array x with complex coefficient array h. The result is stored in
complex output array y. For each complex array, real and imaginary
elements are respectively stored at even and odd index locations.</p>
<p>The API reference and the implementation details can found in the TI
DSPLIB documentation included in the Processor SDK.</p>
<p class="rubric" id="single-precision-iir-tisigcascadebiquadsp-2c-3s-kernel-cascade-biquad-filter-for-multichannel-input">Single Precision IIR : tisigCascadeBiquadSP_2c_3s_kernel
(Cascade Biquad Filter for Multichannel input)</p>
<p>The Cascade biquad filtering function in the audio benchmark starterkit
is an improved biquad infinite impulse response filter <a class="reference external" href="http://appft1.uspto.gov/netacgi/nph-Parser?Sect1=PTO1&amp;Sect2=HITOFF&amp;d=PG01&amp;p=1&amp;u=/netahtml/PTO/srchnum.html&amp;r=1&amp;f=G&amp;l=50&amp;s1=20160112033.PGNR.">Patent
US20160112033
Pending</a>.
The new filter structure modifies the feedback path in the filter,
resulting in a significant reduction in execution cycles. One of the
most-used digital filter forms is the biquad. A biquad is a second order
(two poles and two zeros) Infinite Impulse Response (IIR) filter. It is
high enough order to be useful on its own, and because of the
coefficient sensitivities in higher order filters the biquad is often
used as the basic building block for more complex filters. For instance,
a biquad low pass filter has a cutoff slope of 12 dB/octave, useful for
tone controls; if a 24 dB/octave filter is needed, you can cascade two
biquads and it will have less coefficient sensitivity problems than a
single fourth-order design.</p>
<p>For implementation details please check the <a class="reference external" href="http://appft1.uspto.gov/netacgi/nph-Parser?Sect1=PTO1&amp;Sect2=HITOFF&amp;d=PG01&amp;p=1&amp;u=/netahtml/PTO/srchnum.html&amp;r=1&amp;f=G&amp;l=50&amp;s1=20160112033.PGNR.">USTO
link</a></p>
<p>API reference:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">tisigCascadeBiquad32f_2c_3skernel</span><span class="p">(</span><span class="n">CascadeBiquad_FilParam</span> <span class="o">*</span><span class="n">pParam</span><span class="p">)</span>
</pre></div>
</div>
<p>where CascadeBiquad_FilParam is defined as</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">CascadeBiquad_FilParam</span> <span class="p">{</span>
     <span class="kt">float</span> <span class="o">*</span><span class="k">restrict</span> <span class="n">pin1</span><span class="p">;</span>    <span class="c1">// Input Data Channel 1</span>
     <span class="kt">float</span> <span class="o">*</span><span class="k">restrict</span> <span class="n">pin2</span><span class="p">;</span>    <span class="c1">// Input Data Channel 2</span>
     <span class="kt">float</span>  <span class="o">*</span><span class="k">restrict</span> <span class="n">pOut1</span><span class="p">;</span>  <span class="c1">// Output Data Channel 1</span>
     <span class="kt">float</span>  <span class="o">*</span><span class="k">restrict</span> <span class="n">pOut2</span><span class="p">;</span>  <span class="c1">// Output Data Channel 1</span>
     <span class="kt">float</span>  <span class="o">*</span><span class="k">restrict</span> <span class="n">pCoef</span><span class="p">;</span>  <span class="c1">// Filter Coefficients a, b for 3 stages</span>
     <span class="kt">float</span>  <span class="o">*</span><span class="k">restrict</span> <span class="n">pVar0</span><span class="p">;</span>  <span class="c1">// Filter Variables d0, d1 for 3 stages channel 0</span>
     <span class="kt">float</span>  <span class="o">*</span><span class="k">restrict</span> <span class="n">pVar1</span><span class="p">;</span>  <span class="c1">// Filter Variables d0, d1 for 3 stages channel 1</span>
     <span class="kt">int</span>      <span class="n">sampleCount</span><span class="p">;</span>    <span class="c1">// Number of samples</span>
<span class="p">}</span>  <span class="n">CascadeBiquad_FilParam</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="memory-placement-of-instruction-and-data">
<h2>9.4.10. Memory placement of Instruction and Data<a class="headerlink" href="#memory-placement-of-instruction-and-data" title="Permalink to this headline">¶</a></h2>
<p>The best performance of the DSP can be obtained by placing all the data
and instructions in L2 SRAM. Please refer to the linker command files
include in the src/common folder to see how the instructions and data
can be place in DSP internal L2 memory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In application use cases where audio data needs to be place in onchip
shared memory (OCMC or MSMC) and DDR memory, we recommend that users
move data from external memory to L2 for processing using EDMA or enable
DSP cache using CSL to optimize performance.</p>
</div>
</div>
<div class="section" id="compiler-optimization-flags">
<h2>9.4.11. Compiler Optimization Flags<a class="headerlink" href="#compiler-optimization-flags" title="Permalink to this headline">¶</a></h2>
<p>All the projects in the Audio Benchmark starterkit are built using C6000
compiler with -o3 optimization that allows the source code to be
compiled with highest compiler optimization settings. User can refer to
the compiler Build settings in the Makefiles or go to Build Settings in
CCS Project settings to modify the compiler options.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For more Details on recommended C6000 Compiler options refer
<a class="reference external" href="http://processors.wiki.ti.com/index.php/C6000_Compiler:_Recommended_Compiler_Options">C6000_Compiler:_Recommended_Compiler_Options</a></p>
<ul class="simple">
<li><p>C6000 compiler documentation: <a class="reference external" href="http://www.ti.com/lit/ug/sprui04a/sprui04a.pdf">C6000 Compiler v8.x User
Guide</a></p></li>
</ul>
</div>
</div>
<div class="section" id="soc-integration-and-optimization">
<h2>9.4.12. SOC Integration and Optimization<a class="headerlink" href="#soc-integration-and-optimization" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configuring-device-clocks">
<h3>9.4.12.1. Configuring device clocks<a class="headerlink" href="#configuring-device-clocks" title="Permalink to this headline">¶</a></h3>
<p>Every SOC with TI DSP requires users to enable the DSP clocks by setting
up the PLL and or enabling the DSP through Power Sleep Controller or
Power and Control (PRCM) module. The way the clocks are set up differs
depending on the environment setup</p>
<ul class="simple">
<li><p><strong>Development environment with emulator:</strong>In this case the SOC
clocks are setup using GEL files which are added to the target
configuration file. For audio benchmark starterkit, this done using
GEL files setup explained in the Hardware Setup section</p></li>
<li><p><strong>Application Boot from boot media</strong>If you are booting application
from a boot media like SD/MMC or flash device, the ROM bootloader or
a secondary level bootloader performs the clock configuration. For
audio starterkit, this initialization is done using board library
which is linked to the secondary bootloader and the benchmark tests.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the clocks are not configured the DSP will run at speed of the input
clock rather than at the device speed grade. Hence if the clocks are not
configured correctly the benchmarks will run much slower than
anticipated but the cycle count will show the same.</p>
</div>
</div>
</div>
<div class="section" id="benchmarking-using-dsp-tsch-tscl-registers">
<h2>9.4.13. Benchmarking using DSP TSCH/TSCL registers<a class="headerlink" href="#benchmarking-using-dsp-tsch-tscl-registers" title="Permalink to this headline">¶</a></h2>
<p>For C66x+ and C674x members of the C6000 family, there is a pair of
registers, TSCL and TSCH, which together provide a 64-bit clock value.
You can create your own clock function to take advantage of these
registers. Simply add this function to your program and it will override
the clock function from the library.</p>
<p>The Bench mark test application, use the following functions to capture
cycle count using the TSCH and TSCL regsiters.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* ---------------------------------------------------------------- */</span>
<span class="cm">/* Initialize timer for clock */</span>
<span class="n">TSCL</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">TSCH</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="cm">/* Compute the overhead of calling _itoll(TSCH, TSCL) twice to get timing info */</span>
<span class="cm">/* ---------------------------------------------------------------- */</span>
<span class="n">t_start</span> <span class="o">=</span> <span class="n">_itoll</span><span class="p">(</span><span class="n">TSCH</span><span class="p">,</span> <span class="n">TSCL</span><span class="p">);</span>
<span class="n">t_stop</span> <span class="o">=</span> <span class="n">_itoll</span><span class="p">(</span><span class="n">TSCH</span><span class="p">,</span> <span class="n">TSCL</span><span class="p">);</span>
<span class="n">t_overhead</span> <span class="o">=</span> <span class="n">t_stop</span> <span class="o">-</span> <span class="n">t_start</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">t_start</span> <span class="o">=</span> <span class="n">_itoll</span><span class="p">(</span><span class="n">TSCH</span><span class="p">,</span> <span class="n">TSCL</span><span class="p">);</span>
<span class="o">&lt;</span><span class="n">Algorithm</span> <span class="n">to</span> <span class="n">be</span> <span class="n">bechmarked</span><span class="o">&gt;</span>
<span class="n">t_stop</span> <span class="o">=</span> <span class="n">_itoll</span><span class="p">(</span><span class="n">TSCH</span><span class="p">,</span> <span class="n">TSCL</span><span class="p">);</span>
<span class="n">t_measured</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_stop</span> <span class="o">-</span> <span class="n">t_start</span><span class="p">)</span> <span class="o">-</span> <span class="n">t_overhead</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="benchmark-logging">
<h2>9.4.14. Benchmark logging<a class="headerlink" href="#benchmark-logging" title="Permalink to this headline">¶</a></h2>
<p>The Audio benchmarks demonstrates two ways to log benchmark numbers. One
approach that can be used when code is loaded and run from Code composer
studio is to use standard printf messages from the standard IO RTS
libraries and the other approach is to use UART based logging that can
send the benchmark logs to serial console on the host at the baud rate
of 115.2 kbps.</p>
<p>All the benchmark test application include a file Benchmark_log.h and
Benchmark_log.c, that are used to log messages based on the definition
of macro <strong>IO_CONSOLE</strong>. If IO_CONSOLE is defined the output will be
directed to CCS console. If it is not defined, the logs are sent to the
UART console.</p>
<p>Makefiles and scripts that build binaries to boot from SD card will not
have IO_CONSOLE defined hence the benchmark logs will be directed to the
UART serial console. In the CCS projects, we define the IO_CONSOLE macro
so that the output can be observed on the CCS console.</p>
</div>
<div class="section" id="cache-configuration-for-code-data-sections-in-sram-ddr">
<h2>9.4.15. Cache configuration for Code/data sections in SRAM/DDR<a class="headerlink" href="#cache-configuration-for-code-data-sections-in-sram-ddr" title="Permalink to this headline">¶</a></h2>
<p>The best performance of the DSP can be obtained by placing all the data
and instructions in L2 SRAM. If developer application use cases places
audio data in onchip shared memory (OCMC or MSMC) and DDR memory then
the user will need to enable L1 and L2 cache using CSL API.</p>
<p>To enable and utilize cache in the application, please refer to the
csl_cacheAux.h file in the pdk_&lt;soc&gt;_x_x_x/packages/ti/csl folder in the
SDK and link the CSL library for the soc into the application code.</p>
</div>
<div class="section" id="benchmark-results">
<h2>9.4.16. Benchmark results<a class="headerlink" href="#benchmark-results" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>AlgorithmDSP
Architecture</p></th>
<th class="head"><p>C66x DSP</p></th>
<th class="head"><p>C674x DSP</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Single Precision FFT
(256 samples)</p></td>
<td><p>1808 cycles</p></td>
<td><p>2314 cycles</p></td>
</tr>
<tr class="row-odd"><td><p>Single Precision FIR
(128 samples, 16
coefficients)</p></td>
<td><p>2652 cycles</p></td>
<td><p>4465 cycles</p></td>
</tr>
<tr class="row-even"><td><p>Single Precision IIR
(1k samples from 2
channel with 3 stage
cascade biquad)</p></td>
<td><p>8258 cycles</p></td>
<td><p>12381 cycles</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>All code and data for the benchmark tests is placed in L2 Memory.</p></li>
<li><p>C6000 compiler version used was CGTools v8.1.3</p></li>
<li><p>Bench marks were obtained from C66x DSP on K2G and C674x DSP on
OMAPL138 LCDK</p></li>
<li><p>FFT and FIR benchmarks were obtained using the DSPLIB functions.</p></li>
</ul>
</div>
</div>
<div class="section" id="support">
<h2>9.4.17. Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h2>
<p>For questions, feature requests and bug reports, please use the TI E2E
Forum provided below:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://e2e.ti.com/support/processors/">E2E Processor Support</a></p></li>
</ul>
</div>
<div class="section" id="additional-resources">
<h2>9.4.18. Additional resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h2>
<p><strong>White papers:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.ti.com/lit/an/sprabf2/sprabf2.pdf">Introduction to TMS320C6000 DSP
Optimization</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/lit/an/sprac13/sprac13.pdf">TI DSP
Benchmarking</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/lit/an/sprabg7/sprabg7.pdf">Optimizing Loops on
C66x</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/lit/wp/spry147/spry147.pdf">TI’s new TMS320C66x fixed and floating-point DSP core conquers the
‘Need for Speed’</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/lit/wp/spry127/spry127.pdf">Efficient fixed- and floating-point code execution on the
TMS320C674x core delivers faster code development and reduces system
cost with improved
performance</a></p></li>
</ul>
</div>
</div>
<div class="section" id="audio-pre-processing-demo">
<h1>9.5. Audio Pre-Processing Demo<a class="headerlink" href="#audio-pre-processing-demo" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id23">
<h2>9.5.1. Introduction<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<p>This page describes the audio pre-processing for speech recognition
framework provided in the Processor-SDK for RTOS. This demo illustrates
the integration of Beamforming (BF), Adaptive Spectral Noise Reduction
(ASNR), Multiple Source Selection (MSS) and Dynamic Range Compression
(DRC) components and provides a framework for application development.</p>
<img alt="../_images/Aud_pre_processing_arch.png" src="../_images/Aud_pre_processing_arch.png" />
<p>The key functions in this use case include:</p>
<ul class="simple">
<li><p>Read 7 canned audio input files from hard drive into buffers in DDR
using GEL function</p></li>
<li><p>Generate 12 virtual mics using BF (Beamforming) (30° apart)</p></li>
<li><p>Apply ASNR (Adaptive Spectral Noise Reduction) on each virtual mic</p></li>
<li><p>Use MSS (Multiple Source Selection) to select the best virtual mic
from the 12 virtual mics</p></li>
<li><p>Do DRC (Dynamic Range Compression) on the best virtual mic</p></li>
<li><p>Display performance data</p></li>
<li><p>Write one processed audio channel from buffer in DDR to hard drive
using GEL function</p></li>
</ul>
<p>This demo utilizes other Processor SDK features/components:</p>
<ul class="simple">
<li><p><strong>SYS/BIOS</strong> application utilizing TI-RTOS features for
DSP-C66x/C674x core</p></li>
<li><p><strong>UIA</strong> for instrumentation logging</p></li>
</ul>
<p>The audio components are available in AER and VOLIB packages, which are
optimized for C66x cores, so this demo not available for all devices.
Currently, the following devices and EVMs are supported:</p>
<ul class="simple">
<li><p>AM57x, on the AM572x GP EVM</p></li>
<li><p>K2G, on the K2G EVM. See TIDEP-0088
(<a class="reference external" href="http://www.ti.com/tool/TIDEP-0088">http://www.ti.com/tool/TIDEP-0088</a>) for details</p></li>
<li><p>OMAP-L137, on the OMAP-L137 EVM. See TIDEP-0099
(<a class="reference external" href="http://www.ti.com/tool/TIDEP-0099">http://www.ti.com/tool/TIDEP-0099</a>) for details</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id24">
<h2>9.5.2. Requirements<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h2>
<p>The following materials are required to run this demonstration:</p>
<p>Hardware</p>
<ul class="simple">
<li><p>TI EVMs (see list above)</p></li>
<li><p>CMB for K2G and OMAP-L137, if using circular microphone</p></li>
<li><p>Blackhawk USB560 JTAG Emulator (BH-USB-560m)</p></li>
</ul>
<p>Software</p>
<ul class="simple">
<li><p>Processor-SDK RTOS (4.0 or greater)</p></li>
<li><p>Code Composer Studio</p></li>
<li><p>AER 17.0.0.0 (C64P) (<a class="reference external" href="http://www.ti.com/tool/telecomlib">http://www.ti.com/tool/telecomlib</a>)</p></li>
<li><p>VOLIB 2.1.0.1(C64P for OMAP-L137, C66 for K2G and AM572x)
(<a class="reference external" href="http://www.ti.com/tool/telecomlib">http://www.ti.com/tool/telecomlib</a>)</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id25">
<h2>9.5.3. Software Design<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id26">
<h3>9.5.3.1. More about processing algorithms<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>The application will use AER &amp; VOLIB APIs for its noise reduction
processing needs. The following steps are performed for noise reduction:</p>
<ul class="simple">
<li><p>Use 7 canned audio inputs to generate 12 virtual mics using
BF(Beamforming) (30° apart)</p></li>
<li><p>Apply ASNR(Adaptive Spectral Noise Reduction) on each virtual mic</p></li>
<li><p>Use MSS(Multiple Source Selection)to select the best virtual mic from
the 12 virtual mics</p></li>
<li><p>Do VAD(Voice Activity Detection) on the best virtual mic</p></li>
<li><p>Write 1 processed audio channel into the buffer in DDR</p></li>
</ul>
</div>
<div class="section" id="framework-for-audio-pre-processing">
<h3>9.5.3.2. Framework for Audio Pre-processing<a class="headerlink" href="#framework-for-audio-pre-processing" title="Permalink to this headline">¶</a></h3>
<p>The current framework is based on SYS/BIOS. The following are the
overall steps:</p>
<ul class="simple">
<li><p>The CLK object in SYS/BIOS will be configured to generate a Software
Interrupt(SWI) every 10 ms</p></li>
<li><p>The SWI will prepare the audio frame buffer pointers for further
processing</p></li>
<li><p>The SWI will also send a semaphore to wake up the main thread</p></li>
<li><p>When woke up, the main thread will perform the BF, ASNR, MSS and DRC</p></li>
<li><p>The main thread will also output the final processing audio frame to
the DDR</p></li>
<li><p>After completed the audio frame processing, the main thread will wait
on semaphore for next audio frames to come</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="file-based-demo">
<h2>9.5.4. File Based Demo<a class="headerlink" href="#file-based-demo" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id27">
<h3>9.5.4.1. How to Build the Demo<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to make the following build procedure to work, AER and VOLIB
have to be installed at the same location as the Processor SDK RTOS
and make sure the AER 17.0.0.0 (C64P) is installed at aer_c64Px_obj_17_0_0_0</p>
</div>
<div class="section" id="id28">
<h4>9.5.4.1.1. AM572x GP EVM<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<p><strong>For Linux:</strong></p>
<ul class="simple">
<li><p>Under processor_sdk_rtos_am57xx_4_xx_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="p">.</span><span class="o">/</span><span class="n">setupenv</span><span class="p">.</span><span class="n">sh</span>
<span class="n">make</span> <span class="n">audio_preproc_clean</span>
<span class="n">make</span> <span class="n">audio_preproc</span>
<span class="n">the</span> <span class="n">OUT</span> <span class="n">files</span> <span class="k">for</span> <span class="n">DSP1</span> <span class="n">will</span> <span class="n">be</span> <span class="n">built</span> <span class="n">at</span>
   <span class="n">processor_sdk_rtos_am57xx_4_xx_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">audio</span><span class="o">-</span><span class="n">preprocessing</span><span class="o">/</span><span class="n">file_demo_bios</span><span class="o">/</span><span class="n">am572x</span><span class="o">/</span><span class="n">build</span>
</pre></div>
</div>
<p><strong>For Windows:</strong></p>
<ul class="simple">
<li><p>Under processor_sdk_rtos_am57xx_4_00_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>setupenv.bat
gmake audio_preproc_clean
gmake audio_preproc
the OUT files for DSP1 will be built at
   processor_sdk_rtos_am57xx_4_xx_xx_xx\demos\audio-preprocessing\file_demo_bios\am572x\build
</pre></div>
</div>
</div>
<div class="section" id="k2g-evm">
<h4>9.5.4.1.2. K2G EVM<a class="headerlink" href="#k2g-evm" title="Permalink to this headline">¶</a></h4>
<p><strong>For Linux:</strong></p>
<ul class="simple">
<li><p>Under processor_sdk_rtos_k2g_4_xx_xx_xx directory, run the following
commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="p">.</span><span class="o">/</span><span class="n">setupenv</span><span class="p">.</span><span class="n">sh</span>
<span class="n">make</span> <span class="n">audio_preproc_clean</span>
<span class="n">make</span> <span class="n">audio_preproc</span>
<span class="n">the</span> <span class="n">OUT</span> <span class="n">files</span> <span class="k">for</span> <span class="n">DSP</span> <span class="n">will</span> <span class="n">be</span> <span class="n">built</span> <span class="n">at</span>
   <span class="n">processor_sdk_rtos_k2g_4_xx_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">audio</span><span class="o">-</span><span class="n">preprocessing</span><span class="o">/</span><span class="n">file_demo_bios</span><span class="o">/</span><span class="n">k2g</span><span class="o">/</span><span class="n">build</span>
</pre></div>
</div>
<p><strong>For Windows:</strong></p>
<ul class="simple">
<li><p>Under processor_sdk_rtos_k2g_4_00_xx_xx directory, run the following
commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>setupenv.bat
gmake audio_preproc_clean
gmake audio_preproc
the OUT files for DSP will be built at
   processor_sdk_rtos_k2g_4_xx_xx_xx\demos\audio-preprocessing\file_demo_bios\k2g\build
</pre></div>
</div>
</div>
<div class="section" id="omap-l137-evm">
<h4>9.5.4.1.3. OMAP-L137 EVM<a class="headerlink" href="#omap-l137-evm" title="Permalink to this headline">¶</a></h4>
<p><strong>For Linux:</strong></p>
<ul class="simple">
<li><p>Under processor_sdk_rtos_omapl137_4_xx_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="p">.</span><span class="o">/</span><span class="n">setupenv</span><span class="p">.</span><span class="n">sh</span>
<span class="n">make</span> <span class="n">audio_preproc_clean</span>
<span class="n">make</span> <span class="n">audio_preproc</span>
<span class="n">the</span> <span class="n">OUT</span> <span class="n">files</span> <span class="k">for</span> <span class="n">DSP</span> <span class="n">will</span> <span class="n">be</span> <span class="n">built</span> <span class="n">at</span>
   <span class="n">processor_sdk_rtos_omapl137_4_xx_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">audio</span><span class="o">-</span><span class="n">preprocessing</span><span class="o">/</span><span class="n">file_demo_bios</span><span class="o">/</span><span class="n">omapl137</span><span class="o">/</span><span class="n">build</span>
</pre></div>
</div>
<p><strong>For Windows:</strong></p>
<ul class="simple">
<li><p>Under processor_sdk_rtos_omapl137_4_xx_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>setupenv.bat
gmake audio_preproc_clean
gmake audio_preproc
the OUT files for DSP will be built at
   processor_sdk_rtos_omapl137_4_xx_xx_xx\demos\audio-preprocessing\file_demo_bios\omapl137\build
</pre></div>
</div>
</div>
</div>
<div class="section" id="id29">
<h3>9.5.4.2. How to Run the Demo<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<p>The demo along with the audio input files will be loaded onto the target
using JTAG. After executing, the output file can be read from target.
Play both input and output audio files to compare effect of audio
pre-processing.</p>
<p>The following sections provide detailed steps for each EVM.</p>
<div class="section" id="id30">
<h4>9.5.4.2.1. AM572x GP EVM<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Follow this link <a class="reference internal" href="index_how_to_guides.html#processor-sdk-rtos-setup-ccs-label"><span class="std std-ref">Setup CCS for EVM and Processor-SDK RTOS</span></a>
to get target configuration setup correctly.</p></li>
<li><p>Then in CCS tools –&gt; Gel file to load the modified gel file –
audio-preprocessing/file_demo_bios/am572x/files_io_7.gel</p></li>
<li><p>Connect the Blackhawk USB 560M JTAG to P4 on AM572x GP EVM</p></li>
<li><p>Plug power adaptor(12V) into the AM572x GP EVM (Do not press the
Power Button(S1) yet)</p></li>
<li><p>Launch the target configuration created in step 1 using “Launch
Selected Configuration” from CCS 6.1.3</p></li>
<li><p>Press the Power Button(S1) and “Connect to CortexA15_0” immediately
(Due to the EVM will be auto power off in 10 secs)</p></li>
<li><p>Then “Connect to C66xx_DSP1”</p></li>
<li><p>Load the AM572x_bf.out from
audio-preprocessing\file_demo_bios\am572x\build</p></li>
<li><p>Execute GEL function Scripts–&gt;Microphone Load
Functions–&gt;BFMicLoadAll to load all 7 microphone input files
(audio-preprocessing\common\t8\y16L7g3m7090_x.pcm) into external
memory buffers</p></li>
<li><p>Run the program (loaded previously) by pressing F8</p></li>
<li><p>The program will print out the statistics and “EOF reached” when the
program completes processing</p></li>
<li><p>Execute GEL function Scripts–&gt;Microphone Save
Functions–&gt;BFSaveOutput to save the processed audio output from
external memory buffer to a file
(audio-preprocessingcommont8fileOutput7.bin)</p></li>
</ul>
</div>
<div class="section" id="id31">
<h4>9.5.4.2.2. K2G EVM<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Follow this link <a class="reference internal" href="index_how_to_guides.html#processor-sdk-rtos-setup-ccs-label"><span class="std std-ref">Setup CCS for EVM and Processor-SDK RTOS</span></a>
to get target configuration setup correctly.</p></li>
<li><p>Then in CCS tools –&gt; Gel file to load the modified gel file –
audio-preprocessing/file_demo_bios/k2g/files_io_7.gel</p></li>
<li><p>Connect to the on board emulator (J1 on K2G EVM) to your PC USB</p></li>
<li><p>Plug power adaptor(12V) into the K2G EVM and power on the EVM</p></li>
<li><p>Launch the target configuration created in step 1 using “Launch
Selected Configuration” from CCS 6.1.3</p></li>
<li><p>Then “Connect to C66xx_DSP”</p></li>
<li><p>Load the K2G_bf.out from audio-preprocessing\file_demo_bios\k2g\build</p></li>
<li><p>Execute GEL function Scripts–&gt;Microphone Load
Functions–&gt;BFMicLoadAll to load all 7 microphone input files
((audio-preprocessing\common\t8\y16L7g3m7090_x.pcm)) into external
memory buffers</p></li>
<li><p>Run the program (loaded previously) by pressing F8</p></li>
<li><p>The program will print out the statistics and “EOF reached” when the
program completes processing</p></li>
<li><p>Execute GEL function Scripts–&gt;Microphone Save
Functions–&gt;BFSaveOutput to save the processed audio output from
external memory buffer to a file
(audio-preprocessing\common\t8\fileOutput7.bin)</p></li>
</ul>
</div>
<div class="section" id="id32">
<h4>9.5.4.2.3. OMAP-L137 EVM<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Follow this link <a class="reference internal" href="index_how_to_guides.html#processor-sdk-rtos-setup-ccs-label"><span class="std std-ref">Setup CCS for EVM and Processor-SDK RTOS</span></a>
to get target configuration setup correctly.</p></li>
<li><p>Then in CCS tools –&gt; Gel file to load the modified gel file –
audio-preprocessing/file_demo_bios/k2g/files_io_7.gel</p></li>
<li><p>Connect to the on board emulator (J201 on OMAP-L137 EVM) to your PC
USB</p></li>
<li><p>Plug power adaptor(5V) into the OMAP-L137 EVM and power on the EVM</p></li>
<li><p>Launch the target configuration created in step 1 using “Launch
Selected Configuration” from CCS 6.1.3</p></li>
<li><p>Then “Connect to C674x_0”</p></li>
<li><p>Load the DA830_bf.out from
audio-preprocessing\file_demo_bios\omapl137\build</p></li>
<li><p>Execute GEL function Scripts–&gt;Microphone Load
Functions–&gt;BFMicLoadAll to load all 7 microphone input files
((audio-preprocessing\common\t8\y16L7g3m7090_x.pcm)) into external
memory buffers</p></li>
<li><p>Run the program (loaded previously) by pressing F8</p></li>
<li><p>The program will print out the statistics and “EOF reached” when the
program completes processing</p></li>
<li><p>Execute GEL function Scripts–&gt;Microphone Save
Functions–&gt;BFSaveOutput to save the processed audio output from
external memory buffer to a file
(audio-preprocessing\common\t8\fileOutput7.bin)</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="circular-microphone-board-demo">
<h2>9.5.5. Circular Microphone Board Demo<a class="headerlink" href="#circular-microphone-board-demo" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id33">
<h3>9.5.5.1. How to Build the Demo<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to make the following build procedure to work, AER and VOLIB
have to be installed at the same location as the Processor SDK RTOS
and make sure the AER 17.0.0.0 (C64P) is installed at aer_c64Px_obj_17_0_0_0</p>
</div>
<div class="section" id="id34">
<h4>9.5.5.1.1. K2G EVM<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h4>
<p><strong>For Linux:</strong></p>
<ul class="simple">
<li><p>Under processor_sdk_rtos_k2g_4_xx_xx_xx directory, run the following
commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="p">.</span><span class="o">/</span><span class="n">setupenv</span><span class="p">.</span><span class="n">sh</span>
<span class="n">make</span> <span class="n">audio_preproc_clean</span>
<span class="n">make</span> <span class="n">audio_preproc</span>
<span class="n">the</span> <span class="n">OUT</span> <span class="n">files</span> <span class="k">for</span> <span class="n">DSP</span> <span class="n">will</span> <span class="n">be</span> <span class="n">built</span> <span class="n">at</span>
   <span class="n">processor_sdk_rtos_k2g_4_xx_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">audio</span><span class="o">-</span><span class="n">preprocessing</span><span class="o">/</span><span class="n">realtime_demo_bios</span><span class="o">/</span><span class="n">k2g</span><span class="o">/</span><span class="n">build</span>
</pre></div>
</div>
<p><strong>For Windows:</strong></p>
<ul class="simple">
<li><p>Under processor_sdk_rtos_k2g_4_00_xx_xx directory, run the following
commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>setupenv.bat
gmake audio_preproc_clean
gmake audio_preproc
the OUT files for DSP will be built at
   processor_sdk_rtos_k2g_4_xx_xx_xx\demos\audio-preprocessing\realtime_demo_bios\k2g\build
</pre></div>
</div>
</div>
<div class="section" id="id35">
<h4>9.5.5.1.2. OMAP-L137 EVM<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<p><strong>For Linux:</strong></p>
<ul class="simple">
<li><p>Under processor_sdk_rtos_omapl137_4_xx_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="p">.</span><span class="o">/</span><span class="n">setupenv</span><span class="p">.</span><span class="n">sh</span>
<span class="n">make</span> <span class="n">audio_preproc_clean</span>
<span class="n">make</span> <span class="n">audio_preproc</span>
<span class="n">the</span> <span class="n">OUT</span> <span class="n">files</span> <span class="k">for</span> <span class="n">DSP</span> <span class="n">will</span> <span class="n">be</span> <span class="n">built</span> <span class="n">at</span>
   <span class="n">processor_sdk_rtos_omapl137_4_xx_xx_xx</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">audio</span><span class="o">-</span><span class="n">preprocessing</span><span class="o">/</span><span class="n">realtime_demo_bios</span><span class="o">/</span><span class="n">omapl137</span><span class="o">/</span><span class="n">make</span>
</pre></div>
</div>
<p><strong>For Windows:</strong></p>
<ul class="simple">
<li><p>Under processor_sdk_rtos_omapl137_4_00_xx_xx directory, run the
following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>setupenv.bat
gmake audio_preproc_clean
gmake audio_preproc
the OUT files for DSP will be built at
   processor_sdk_rtos_omapl137_4_xx_xx_xx\demos\audio-preprocessing\realtime_demo_bios\omapl137\make
</pre></div>
</div>
</div>
</div>
<div class="section" id="id36">
<h3>9.5.5.2. How to Run the Demo<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<p>The demo works with the real time audio input from CMB. After processing
is complete, the audio output will be sent to the line-out(left channel)
of the K2G EVM on-board audio codec. For the purpose of comparison, the
unprocessed center microphone (mic 8) will be sent out to the line-out
(right channel) of the K2G EVM on-board audio codec.</p>
<p>The following sections provide detailed steps for each EVM.</p>
<div class="section" id="k2g-evm-using-ccs">
<h4>9.5.5.2.1. K2G EVM (using CCS)<a class="headerlink" href="#k2g-evm-using-ccs" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Follow this link <a class="reference internal" href="index_how_to_guides.html#processor-sdk-rtos-setup-ccs-label"><span class="std std-ref">Setup CCS for EVM and Processor-SDK RTOS</span></a>
to get target configuration setup correctly.</p></li>
<li><p>Connect to the on board emulator (J1 on K2G EVM) to your PC USB</p></li>
<li><p>Plug power adaptor(12V) into the K2G EVM and power on the EVM</p></li>
<li><p>Launch the target configuration created in step 1 using “Launch
Selected Configuration” from CCS 6.1.3</p></li>
<li><p>Then “Connect to C66xx_DSP”</p></li>
<li><p>Load the K2G_bf_rt.out from
audio-preprocessing\realtime_demo_bios\k2g\build</p></li>
<li><p>Run the program (loaded previously) by pressing F8</p></li>
<li><p>The program will run the real time demo forever, taking the input
from CMB and output to the on-board line-out</p></li>
</ul>
</div>
<div class="section" id="omap-l137-evm-using-ccs">
<h4>9.5.5.2.2. OMAP-L137 EVM (using CCS)<a class="headerlink" href="#omap-l137-evm-using-ccs" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Follow this link <a class="reference internal" href="index_how_to_guides.html#processor-sdk-rtos-setup-ccs-label"><span class="std std-ref">Setup CCS for EVM and Processor-SDK RTOS</span></a>
to get target configuration setup correctly.</p></li>
<li><p>Connect to the on board emulator (J201 on OMAP-L137 EVM) to your PC
USB</p></li>
<li><p>Plug power adaptor(5V) into the OMAP-L137 EVM and power on the EVM</p></li>
<li><p>Launch the target configuration created in step 1 using “Launch
Selected Configuration” from CCS 6.1.3</p></li>
<li><p>Then “Connect to C674X_0”</p></li>
<li><p>Load the OMAPL137_bf_rt.out from
audio-preprocessing\realtime_demo_bios\omapl137\make</p></li>
<li><p>Run the program (loaded previously) by pressing F8</p></li>
<li><p>The program will run the real time demo forever, taking the input
from CMB and output to the on-board line-out</p></li>
</ul>
</div>
<div class="section" id="k2g-evm-boot-from-sd-card">
<h4>9.5.5.2.3. K2G EVM (Boot from SD card)<a class="headerlink" href="#k2g-evm-boot-from-sd-card" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Copy “app” and “MLO” from
audio-preprocessing\realtime_demo_bios\k2g\pre-built\mmcsd on Windows
or audio-preprocessing/realtime_demo_bios/k2g/pre-built/mmcsd on
Linux to the root directory of a formatted micro SD card</p></li>
<li><p>Plug in the micro SD card into uSD Card slot on K2G EVM</p></li>
<li><p>Connect “USB TO SOC UART0” on K2G EVM to a PC USB port via USB cable</p></li>
<li><p>Launch a terminal emulator like Tera Term and open the local COM port
corresponding to the UART0 (Set it to 115200 bps, 8 bit, none parity,
one bit stop, no flow control)</p></li>
<li><p>Plug power adapter (12V) into the K2G EVM and power on the EVM and
Power on the K2G EVM</p></li>
<li><p>There will be some information displayed on the SOC UART0</p></li>
<li><p>The program will run the real time demo forever, taking the input
from CMB and output to the on-board line-out</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-read-the-input-output-audio-files">
<h2>9.5.6. How to Read the Input/output Audio Files<a class="headerlink" href="#how-to-read-the-input-output-audio-files" title="Permalink to this headline">¶</a></h2>
<p>Both the input/output audio files are in raw PCM format (<a href="#id37"><span class="problematic" id="id38">*</span></a>.pcm or
*.bin) 16 bit per sample, big endian, mono, at 16Khz. They can be
imported either by Adobe Audition or Audacity as the raw audio data.</p>
<div class="section" id="import-raw-audio-data-file-using-adobe-audition">
<h3>9.5.6.1. Import Raw Audio Data File using Adobe Audition<a class="headerlink" href="#import-raw-audio-data-file-using-adobe-audition" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Launch the Adobe Audition CS5.5</p></li>
<li><p>File –&gt; Import –&gt; Raw Data…</p></li>
<li><p>The following dialog will pop up</p></li>
</ul>
<img alt="../_images/Aud_pre_processing_import.png" src="../_images/Aud_pre_processing_import.png" />
<ul class="simple">
<li><p>Select the raw audio file and input the correct parameters</p></li>
<li><p>Click OK</p></li>
</ul>
</div>
<div class="section" id="before-and-after-comparison">
<h3>9.5.6.2. Before and After Comparison<a class="headerlink" href="#before-and-after-comparison" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Before audio pre-processing (t8/y16L7g3m7090_1.pcm)</p></li>
</ul>
<img alt="../_images/Aud_pre_processing_before.png" src="../_images/Aud_pre_processing_before.png" />
<ul class="simple">
<li><p>After audio pre-processing (t8/fileOutput.bin)</p></li>
</ul>
<img alt="../_images/Aud_pre_processing_after.png" src="../_images/Aud_pre_processing_after.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="performance-audio-demo">
<h1>9.6. Performance Audio Demo<a class="headerlink" href="#performance-audio-demo" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id39">
<h2>9.6.1. Introduction<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h2>
<p>This page describes the performance audio demo, developed within Processor SDK RTOS on 66AK2Gx platform.
This demo implements and integrates audio I/O, framework, auto-detection, decoding, audio stream
processing (ASP) and encoding - the foundational building blocks of any performance audio application.
The system block diagram below shows the structure of the demo.</p>
<a class="reference internal image-reference" href="../_images/pa_k2g_layout.png"><img alt="../_images/pa_k2g_layout.png" src="../_images/pa_k2g_layout.png" style="width: 954.0px; height: 581.0px;" /></a>
<p>This demo utilizes Processor SDK features/components:</p>
<ul class="simple">
<li><p><strong>SYS/BIOS</strong> application utilizing TI-RTOS features for DSP-C66x core and ARM-A15 core</p></li>
<li><p><strong>McASP LLD</strong> from PDK for audio input/output</p></li>
<li><p><strong>IPC</strong> for inter-processor communications between DSP and ARM</p></li>
<li><p><strong>UIA</strong> for instrumentation logging</p></li>
</ul>
</div>
<div class="section" id="id40">
<h2>9.6.2. Requirements<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h2>
<p>Hardware</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.ti.com/tool/evmk2g">66AK2Gx Evaluation Module (EVMK2G)</a></p></li>
<li><p><a class="reference external" href="http://www.ti.com/tool/AUDK2G">66AK2Gx Audio Daughter Card (AUDK2G)</a></p></li>
<li><p><a class="reference external" href="http://www.mds.com/products/hdmivideo/">Momentum Data Systems (MDS) HDMI repeater kit</a> (optional).
Contact <a class="reference external" href="mailto:contactsales&#37;&#52;&#48;mds&#46;com">contactsales<span>&#64;</span>mds<span>&#46;</span>com</a> for more information.</p></li>
</ul>
<p>Software</p>
<ul class="simple">
<li><p>Code Composer Studio (CCS)</p></li>
<li><p>Python 2.7.14 and Sed 4.2.1 for Windows only</p></li>
</ul>
</div>
<div class="section" id="id41">
<h2>9.6.3. How to Run the Demo<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h2>
<div class="section" id="hardware-setup">
<h3>9.6.3.1. Hardware Setup<a class="headerlink" href="#hardware-setup" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Setup K2G EVM according to the <a class="reference external" href="http://www.ti.com/lit/pdf/sprw292">Quick Start Guide</a></p></li>
<li><p>Setup Audio Daughter Card according to the <a class="reference external" href="http://www.ti.com/lit/pdf/sprw287">Quick Start Guide</a> and attach it to the K2G EVM.
The Audio Daughter Card connects to the EVM through the JP1 “Audio Expansion” and J12 “Serial Expansion” connectors on EVM.</p></li>
<li><p>Connect an analog player output to the ADC_IN0-3 input jacks on the Audio Daughter Card.</p></li>
<li><p>Connect a DVD/Blue-Ray player digital output (S/PDIF) to the MOD1 Digital Input (Optical) connector on the Audio Daughter Card.</p></li>
<li><p>Connect speakers to DAC_OUT0-3 output jacks on the Audio Daughter Card.</p></li>
<li><p>Connect a COM port on PC to UART0 port on K2G EVM using a RS-232 cable.</p></li>
<li><p>Connect XDS2xx USB Onboard Debug Probe to a PC USB port using the USB cable delivered with the EVM.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/pa_k2g_EVM_DC_setup.png"><img alt="../_images/pa_k2g_EVM_DC_setup.png" src="../_images/pa_k2g_EVM_DC_setup.png" style="width: 724.5px; height: 512.4px;" /></a>
</div>
<div class="section" id="optional-setup-for-hdmi">
<h3>9.6.3.2. Optional Setup for HDMI<a class="headerlink" href="#optional-setup-for-hdmi" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Connect the MDS HSR41P to the MDS IFB.</p>
<ul>
<li><p>Connect HSR41P J4 “Main” header to the IFB J5 “Main” header using the short 26-wire ribbon cable. Ensure the red wire on the ribbon
cable is connected between HSR41P J4 Pin1 and IFB J5 Pin1.</p></li>
<li><p>Connect HSR41P J7 “Sec” header to the IFB J2 “Sec” header using the short 34-wire ribbon cable. Ensure the red wire on the ribbon
cable is connected between HSR41P J7 Pin1 and IFB J2 Pin1.</p></li>
</ul>
</li>
<li><p>Connect the MDS IFB to the Audio Daughter Card. Connect IFB J3 “McASP0” header to Audio Daughter Card “I2S Header” using the supplied
long 34-wire ribbon cable. Ensure the red wire on the ribbon cable is connected between IFB J3 Pin1 and Audio Daughter Card “I2S Header”
Pin1 (note the “I2S Header” is only 32 pins, so the two wires on the ribbon cable opposite Pin1 are unused).</p></li>
<li><p>Connect HDMI cable from audio source (e.g. Blu-ray player) to HSR41P J6 “IN”. Connect HDMI cable to audio sink (e.g. HDMI enabled monitor)
from HSR41P J8 “HDMI OUT”.</p></li>
<li><p>Connect 5V AC to USB power supply to IFB power connector J1.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/pa_k2g_EVM_DC_HDMI_setup.png"><img alt="../_images/pa_k2g_EVM_DC_HDMI_setup.png" src="../_images/pa_k2g_EVM_DC_HDMI_setup.png" style="width: 736.4px; height: 503.29999999999995px;" /></a>
</div>
<div class="section" id="software-and-tools-setup">
<h3>9.6.3.3. Software and Tools Setup<a class="headerlink" href="#software-and-tools-setup" title="Permalink to this headline">¶</a></h3>
<p>CCS is required to load the binaries and run the demo. Sed and Python are required for run time reselection of input/output, control and reconfiguration
of decoding and/or audio stream procesing, etc. One may choose to run the demo first and then install Sed and Python for run-time reconfiguration.</p>
<ul class="simple">
<li><p>Download and Install CCS (download link available at Processor SDK download page)</p></li>
<li><p>Obtain Sed 4.2.1 from <a class="reference external" href="http://gnuwin32.sourceforge.net/packages/sed.htm">http://gnuwin32.sourceforge.net/packages/sed.htm</a>,
executable installer, sed-4.2.1-setup.exe (click on Setup next to “Complete package, except sources” and download will start).
Install it to c:/PA_Tools/GnuWin32 (or change installation location in
&lt;process-sdk installation root&gt;/demos/performance-audio/src/setup_build_env/setup_env.bat.</p></li>
<li><p>Obtain Python 2.7.14 from <a class="reference external" href="https://www.python.org/downloads/release/python-2714/">https://www.python.org/downloads/release/python-2714/</a> (click on
Windows x86 MSI installer, and the installer python-2.7.14.msi will be downloaded automatically).
Install it to c:/PA_Tools/Python27 (or change installation location in
&lt;process-sdk installation root&gt;/demos/performance-audio/src/setup_build_env/setup_env.bat.</p></li>
<li><p>Once Python is installed, open a Command Prompt and go to &lt;process-sdk installation root&gt;/demos/performance-audio/src/setup_build_env. Run setup_env.bat,
and then go to &lt;process-sdk installation root&gt;/demos/performance-audio/tools/ and run setup.bat
to install PyAlpha dependencies. Note: since tools/setup.bat will download Python packages from the web, one needs to
make sure that the proxy environment variables are set properly.</p></li>
</ul>
</div>
<div class="section" id="load-and-run-pre-built-binaries">
<h3>9.6.3.4. Load and Run Pre-built Binaries<a class="headerlink" href="#load-and-run-pre-built-binaries" title="Permalink to this headline">¶</a></h3>
<p>This demo can be run by loading and running the DSP and ARM binaries through CCS:</p>
<ol class="arabic simple">
<li><p>Click View -&gt; Target Configurations.</p></li>
<li><p>In the Target Configurations window, right click and then click Import Target Configurations.</p></li>
<li><p>Browse to &lt;process-sdk installation root&gt;/demos/performance-audio/src/pasrc/test_dsp/targetConfigs, click K2GEVM.ccxml and then click Open.</p></li>
<li><p>In the Target Configurations window, right-click on K2GEVM.ccxml and select Launch Selected Configuration.</p></li>
<li><p>In the Debug window, right-click on the C66x and select Connect Target. The output from the GEL code invoked on the target connection can be observed in the Console output window. The final line of this output should read “C66xx: GEL Output: DDR3A initialization complete”.</p></li>
<li><p>In the Debug window, right-click on the CortexA15 and select Connect Target. The output from the GEL code invoked on the target connection can be observed in the Console output window. The final line of this output should read “CortexA15: GEL Output: A15 non secure mode entered”.</p></li>
<li><p>In the Debug Window, click on the C66x. Then open Run-&gt;Load-&gt;Load Program. In the Load Program window, click on Browse and double click &lt;process-sdk installation root&gt;/demos/performance-audio/prebuilt-binaries/test_dsp.xe66. Then click OK to load the C66x binary.</p></li>
<li><p>In the Debug Window, click on the CortexA15. Then open Run-&gt;Load-&gt;Load Program. In the Load Program window, click on Browse and double click &lt;process-sdk installation root&gt;/demos/performance-audio/prebuilt-binaries/test_arm.xa15fg. Then click OK to load the CortexA15 binary.</p></li>
<li><p>In the Debug window, click on the C66x. Then Open Run-&gt;Resume to execute the C66x code.</p></li>
<li><p>In the Debug window, click on the CortexA15. Then Open Run-&gt;Resume to execute the CortexA15 code.</p></li>
<li><p>The CIO Console output window should display memory usage statistics. The final line of output should display the memory usage summary for the EXT NC SHM heap.</p></li>
<li><p>Default input interface is S/PDIF. Play music on the media player with S/PDIF output. Sound should come out of speakers connected to analog out DAC_OUT0.</p></li>
</ol>
<p>Limitations:</p>
<ul class="simple">
<li><p>If code needs to be reload and rerun, one must terminate the CCS debugging session,
power cycle the EVM, and start a new CCS debugging session. Then repeat from step 4 listed above.</p></li>
</ul>
</div>
<div class="section" id="run-time-reconfiguration-in-windows-only">
<h3>9.6.3.5. Run-time Reconfiguration (in Windows only)<a class="headerlink" href="#run-time-reconfiguration-in-windows-only" title="Permalink to this headline">¶</a></h3>
<p>Please make sure src/setup_build_env/setup_env.bat and tools/setup.bat have both been run to setup the tools path.</p>
<p>Output volume can be changed at run-time via Python scripts through UART:</p>
<ul class="simple">
<li><p>Open a windows command prompt, go to tools folder and use the following command to change output volume:</p>
<ul>
<li><p>python.exe pyalpha -I alpha -h pa_i13_evmk2g_io_a -p COM1 writeVOLControlMasterN(&lt;volume level&gt;),
where &lt;volume level&gt; is level adjustment from default in units of 0.5dB. For example,
python.exe pyalpha -I alpha -h pa_i13_evmk2g_io_a -p COM1 writeVOLControlMasterN(-24)
lowers the level by 12dB from default.</p></li>
</ul>
</li>
</ul>
<p>Input interface is S/PDIF by default and can be reslected at run-time (Note: interface can be reselected
only when playing is stopped):</p>
<ul class="simple">
<li><p>Switch to HDMI input:</p>
<ul>
<li><p>Stop playing</p></li>
<li><p>Issue command to change to HDMI input:
python.exe pyalpha -I alpha -h pa_i13_evmk2g_io_a -p COM1 execPAIInHDMI</p></li>
<li><p>Play again using digital player with HDMI output</p></li>
</ul>
</li>
<li><p>Switch to analog input:</p>
<ul>
<li><p>Stop playing</p></li>
<li><p>Issue command to change output to ADC slave:
python.exe pyalpha -I alpha -h pa_i13_evmk2g_io_a -p COM1 execPAIOutAnalogSlave</p></li>
<li><p>Issue command to change input to analog:
python.exe pyalpha -I alpha -h pa_i13_evmk2g_io_a -p COM1 execPAIInAnalog</p></li>
<li><p>Play again using analog player</p></li>
</ul>
</li>
</ul>
<p>Limitations of run-time reconfiguration as of this release:</p>
<ul class="simple">
<li><p>Input interface reselection can only be done when input is mute.</p></li>
<li><p>Once analog input is selected, S/PDIF can NOT be selected anymore. One
must reload the code and rerun the demo.</p></li>
</ul>
</div>
</div>
<div class="section" id="how-to-rebuild-the-demo">
<h2>9.6.4. How to Rebuild the Demo<a class="headerlink" href="#how-to-rebuild-the-demo" title="Permalink to this headline">¶</a></h2>
<p>The performance audio demo can be rebuilt from the source code, following the
instructions given below.</p>
<div class="section" id="setup-environment-variables-in-linux">
<h3>9.6.4.1. Setup Environment Variables in Linux<a class="headerlink" href="#setup-environment-variables-in-linux" title="Permalink to this headline">¶</a></h3>
<p>A bash shell script, &lt;process-sdk installation root&gt;/demos/performance-audio/src/setup_build_env/setup_env.sh,
can be used to set up the environment variables:</p>
<ul class="simple">
<li><p>set the TI tools path and performance audio demo path in setup_env.sh properly.</p></li>
<li><p>set version numbers of each component to what’s going to be used for the build (default is what’s delivered in PRSDK).</p></li>
<li><p>run the shell script using command “source setup_env.sh”.</p></li>
</ul>
</div>
<div class="section" id="setup-environment-variables-in-windows">
<h3>9.6.4.2. Setup Environment Variables in Windows<a class="headerlink" href="#setup-environment-variables-in-windows" title="Permalink to this headline">¶</a></h3>
<p>Batch file &lt;process-sdk installation root&gt;/demos/performance-audio/src/setup_build_env/setup_env.bat can be
used to set up the environment variables.</p>
<ul class="simple">
<li><p>set variable TI_TOOLS_DIR in setup_env.bat properly (default is C:ti).</p></li>
<li><p>set version numbers of each component to what’s going to be used for the build (default is what’s delivered in PRSDK).</p></li>
<li><p>go to folder &lt;process-sdk installation root&gt;/demos/performance-audio/src/setup_build_env and run setup_env.bat (Note: this
script MUST be run in the setup_build_env folder.)</p></li>
<li><p>after running setup_env.bat, run setup_paf.bat in the same folder (Note: setup_env.bat MUST be run before setup_paf.bat).</p></li>
</ul>
</div>
<div class="section" id="rebuild-the-demo">
<h3>9.6.4.3. Rebuild the Demo<a class="headerlink" href="#rebuild-the-demo" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Go to source folder: &lt;process-sdk installation root&gt;/demos/performance-audio/src</p></li>
<li><p>Issue command “make clean” and “make install” for Linux</p></li>
<li><p>Issue command “gmake clean” and “gmake install” for Windows</p></li>
<li><p>The rebuilt binaries are placed in src/install/pasdk/debug. They can also be
found at src/pasdk/test_dsp/bin/debug and src/pasdk/test_arm/bin/debug</p></li>
</ul>
</div>
</div>
<div class="section" id="trouble-shooting">
<h2>9.6.5. Trouble Shooting<a class="headerlink" href="#trouble-shooting" title="Permalink to this headline">¶</a></h2>
<p>Problems may be encountered when setting up or running the demo. Here are some common problems and the corresponding solutions:</p>
<ol class="arabic simple">
<li><p>Sound doesn’t come out of the speakers:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Make sure the audio daughter card (and HDMI repeater card if used) is connected well. The <a class="reference external" href="index_examples_demos.html#k2g-audio-dc-addon">PDK addon audio loopback test</a> can be run to verify the setup of EVM and audio daughter card.</p></li>
<li><p>In CCS Expressions window, enter variable “asipLoopCount1” and check if it is incrementing. If not, terminate the debug session, power cycle
the EVM, and restart.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>The Python command times out:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Make sure to use UART0 COM port on the EVM. The Python scripts may not work well if J23 USB connector is used for UART communications.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>The source code doesn’t build:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Make sure the environment variables are set correctly. The default tools location in setup.env may not be where the tools are installed.
Change TI_TOOLS_DIR to where tools and Proc-SDK components are installed.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Python setup can’t install PyAlpha dependencies.</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Make sure proxy environment variables, HTTP_PROXY and HTTPS_PROXY, are set properly.</p></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="big-data-ipc-example">
<h1>9.7. Big Data IPC Example<a class="headerlink" href="#big-data-ipc-example" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id42">
<h2>9.7.1. Introduction<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h2>
<p>High Performance Computing applications and other Data intensive
applications often require passing of Big data buffers between the
multi-core processors in an SOC.</p>
<p>The Big Data IPC examples are created mainly to show exchange of big
data buffers between cores and is part of the Processor SDK RTOS
package.</p>
<p>Currently the example named “simple_buffer_example”, captures the
details of exchange of big buffers with both host A15 core and a DSP
cores.</p>
</div>
<div class="section" id="architecture-overview">
<h2>9.7.2. Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permalink to this headline">¶</a></h2>
<p>The following block diagram shows the various functional blocks used in
the example on the cores running TI-RTOS/BIOS.</p>
<img alt="../_images/Big_Data_IPC_RTOS_Software_blocks.png" src="../_images/Big_Data_IPC_RTOS_Software_blocks.png" />
<p>For the small message IPC, sharedRegion and Heap, the modules in the
Standard TI IPC package are used.</p>
<p>The BigDataXlat module, which is part of the example code, provides a
high level abstraction to take care of Address translation and Cache
sync on the big data buffers.</p>
</div>
<div class="section" id="simple-buffer-example-program-sequence">
<h2>9.7.3. Simple Buffer example: Program Sequence<a class="headerlink" href="#simple-buffer-example-program-sequence" title="Permalink to this headline">¶</a></h2>
<p>This section describes the program sequence captured in the example.</p>
<p>The main aim of the overall program is to show the exchange of big data
buffers. The sequence is described in words here to sort of walk through
the main application code.</p>
<p>Initially, the host sends first message with shared memory init
information followed by two more dummy messages to slave core ( all
three messages sent in sequence without waiting for reply).</p>
<p>The shared memory region init message conveys the details about the
shared memory expected to hold the big data buffers.</p>
<p>Independently, the slave processor receives messages and sends back
reply back for each of the messages to the host.</p>
<p>Then the host receives one message from the slave and sends a message
with Big data buffer allocated from the Big data heap and filled with an
incrementing pattern. (This process is repeated with 10 Big data Buffer
messages). Each of these Messages are received by slave and the values
in the buffers are updated with a modified incrementing pattern and sent
back to the host.</p>
<p>Note the Slave and Host processors checks the expected incrementing
pattern for errors.</p>
<p>At this point only 7 Big data buffer messages would have been received.
Then the host sends two dummy messages plus one shutdown message to the
slave core when receiving the remaining three Big data buffer messages.
Totally 10 Big data buffers are exchanged between the cores. The slave
core on receiving the shutdown message, shuts itself down and
reinitializes itself for future runs.</p>
<p>Then the host receives back the remaining returned messages before
shutting down.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The size of the big data buffer is configurable compile time by
changing value of the define BIGDATA_SIZE in shared/AppCommon.h</p>
</div>
</div>
<div class="section" id="host-linux-example">
<h2>9.7.4. Host Linux example<a class="headerlink" href="#host-linux-example" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Host linux example is only available starting from Processor SDK
4.0.0 release for AM57xx platform</p>
</div>
<p>Under the host_linux directory the simple_buffer_example is implemented
for Host A15 running Linux and DSP core running TI-RTOS.</p>
<div class="section" id="architecture-updates-for-linux">
<h3>9.7.4.1. Architecture Updates for Linux<a class="headerlink" href="#architecture-updates-for-linux" title="Permalink to this headline">¶</a></h3>
<p>The following block diagram shows the various functional blocks used in
the example on the host running linux.</p>
<img alt="../_images/Big_DATA_IPC_Linux_Software_blocks.png" src="../_images/Big_DATA_IPC_Linux_Software_blocks.png" />
<p>The SharedRegion and HeapMem modules are not currently supported for
Linux in the TI Standard IPC package.</p>
<p>The example provides these modules with same/similar API implemented for
Linux with some limitations.</p>
<p>The CMEM APIs provide user space allocation of contiguous memory for the
Big data buffers.</p>
</div>
<div class="section" id="how-to-run-the-example">
<h3>9.7.4.2. How to Run the Example<a class="headerlink" href="#how-to-run-the-example" title="Permalink to this headline">¶</a></h3>
<p>The Processor SDK Linux release includes the pre-built binaries for the
host_linux example as part of the tisdk-rootfs-image filesystem.</p>
<p>Step 1 : To run the demo, the first step is to make sure there is no
other default applications using the same resources. For example, the
following command is needed to disable the default OpenCL applications.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">stop</span> <span class="n">ti</span><span class="o">-</span><span class="n">mct</span><span class="o">-</span><span class="n">daemon</span><span class="p">.</span><span class="n">service</span>
</pre></div>
</div>
<p>Step 2: Switch the firmware running in the DSP. This can be done by
using the following steps. Unbind dsp</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="mf">40800000.</span><span class="n">dsp</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">bus</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">drivers</span><span class="o">/</span><span class="n">omap</span><span class="o">-</span><span class="n">rproc</span><span class="o">/</span><span class="n">unbind</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>May need to unbind all the other cores as well to avoid issues.</p>
</div>
<p>Update firmware symbolic link</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ln</span> <span class="o">-</span><span class="n">sf</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">simple_buffer_example</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">server_dsp</span><span class="p">.</span><span class="n">xe66</span> <span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">firmware</span><span class="o">/</span><span class="n">dra7</span><span class="o">-</span><span class="n">dsp1</span><span class="o">-</span><span class="n">fw</span><span class="p">.</span><span class="n">xe66</span>
</pre></div>
</div>
<p>Bind dsp</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="mf">40800000.</span><span class="n">dsp</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">bus</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">drivers</span><span class="o">/</span><span class="n">omap</span><span class="o">-</span><span class="n">rproc</span><span class="o">/</span><span class="n">bind</span>
</pre></div>
</div>
<p>Step 3: Now the Host side application can be run using the following
command</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">simple_buffer_example</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">app_host</span>
</pre></div>
</div>
<p>The DSP side log can be checked by typing the following command to dump
the trace.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">remoteproc</span><span class="o">/</span><span class="n">remoteproc2</span><span class="o">/</span><span class="n">trace0</span>
</pre></div>
</div>
<p>Here is a sample log.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# /usr/bin/simple_buffer_example/release/app_host DSP1
--&gt; main:
[523682.897761] omap_hwmod: mmu0_dsp2: _wait_target_disable failed
[523682.903751] omap-iommu 41501000.mmu: 41501000.mmu: version 3.0
[523682.911797] omap-iommu 41502000.mmu: 41502000.mmu: version 3.0
--&gt; Main_main:
--&gt; App_create:
App_create: Host is ready
&lt;-- App_create:
--&gt; App_exec:
CMEM_init success
CMEM_getPool success
CMEM_allocPool success: Allocated buffer 0xaa641000
SharedRegion_setup success
App_taskFxn: SR_1, base 0xaa641000, len=1000000
HeapMem_setup success
HeapMem_create success
App_taskFxn: SR_1 heap, totalSize=16777216,totalFreeSize=16777216,largestFreeSize=16777216
App_taskFxn: SR_1 heap, buf=0x0xaa641080,size=16777216
App_exec: sending message 1
Shared memory phys Addr ffffffffa0000000
App_exec: sending message 2
App_exec: sending message 3
App_exec: message received 1
App_exec: Preparing message 4
App_exec: Sending message 4
App_exec: message received 2
App_exec: Preparing message 5
App_exec: Sending message 5
App_exec: message received 3
App_exec: Preparing message 6
App_exec: Sending message 6
App_exec: message received 4
App_exec: Preparing message 7
App_exec: Sending message 7
App_exec: message received 5
App_exec: Preparing message 8
App_exec: Sending message 8
App_exec: message received 6
App_exec: Preparing message 9
App_exec: Sending message 9
App_exec: message received 7
App_exec: Preparing message 10
App_exec: Sending message 10
App_exec: message received 8
App_exec: Preparing message 11
App_exec: Sending message 11
App_exec: message received 9
App_exec: Preparing message 12
App_exec: Sending message 12
App_exec: message received 10
App_exec: Preparing message 13
App_exec: Sending message 13
App_exec: message received 11
App_exec: Preparing message 14
App_exec: Sending message 14
App_exec: message received 12
App_exec: Preparing message 15
App_exec: Sending message 15
App_exec: message received 13
App_exec: Preparing message 16
App_exec: Sending message 16
App_exec: message received: 14
App_exec: message received: 15
App_exec: message received: 16
App_exec: Data check clean
&lt;-- App_exec: 0
--&gt; App_delete:
&lt;-- App_delete:
&lt;-- Main_main:

 Host: Test Passed
&lt;-- main:
root@am57xx-evm:~#

root@am57xx-evm:~# cat /sys/kernel/debug/remoteproc/remoteproc2/trace0
[      0.000] 18 Resource entries at 0x95000000
[      0.000] [t=0x0002122e] xdc.runtime.Main: --&gt; main:
[      0.000] registering rpmsg-proto:rpmsg-proto service on 61 with HOST
[      0.000] [t=0x003c5d7b] xdc.runtime.Main: NameMap_sendMessage: HOST 53, port=61
[      0.000] [t=0x003d5186] xdc.runtime.Main: --&gt; smain:
[      0.000] [t=0x003e8259] Server: Server_create: server is ready
[      0.000] [t=0x003ecc97] Server: &lt;-- Server_create: 0
[      0.000] [t=0x003f04a4] Server: --&gt; Server_exec:
[     51.571] [t=0x00000008:a56e6a9a] Server: Message received...1
[     51.571] [t=0x00000008:a56f9b77] Server: Shared region entry configured...
[     51.571] [t=0x00000008:a5700cb1] Server: Server_exec: processed id 1, cmd=0x1
[     51.571] [t=0x00000008:a570aea5] Server: Message received...2
[     51.571] [t=0x00000008:a57119fd] Server: Server_exec: processed id 2, cmd=0x0
[     51.571] [t=0x00000008:a571b1e9] Server: Message received...3
[     51.571] [t=0x00000008:a5721eac] Server: Server_exec: processed id 3, cmd=0x0
[     51.571] [t=0x00000008:a5755f6b] Server: Message received...4
[     51.573] [t=0x00000008:a583e61b] Server: Server_exec: processed id 4, cmd=0x2
[     51.573] [t=0x00000008:a584a087] Server: Message received...5
[     51.574] [t=0x00000008:a592c2cc] Server: Server_exec: processed id 5, cmd=0x2
[     51.574] [t=0x00000008:a5937d8c] Server: Message received...6
[     51.575] [t=0x00000008:a5a19aeb] Server: Server_exec: processed id 6, cmd=0x2
[     51.575] [t=0x00000008:a5a2543d] Server: Message received...7
[     51.577] [t=0x00000008:a5b07d15] Server: Server_exec: processed id 7, cmd=0x2
[     51.577] [t=0x00000008:a5b137c0] Server: Message received...8
[     51.578] [t=0x00000008:a5bf5d83] Server: Server_exec: processed id 8, cmd=0x2
[     51.578] [t=0x00000008:a5c019cc] Server: Message received...9
[     51.579] [t=0x00000008:a5ce3dca] Server: Server_exec: processed id 9, cmd=0x2
[     51.579] [t=0x00000008:a5cef75e] Server: Message received...10
[     51.581] [t=0x00000008:a5dd247a] Server: Server_exec: processed id 10, cmd=0x2
[     51.581] [t=0x00000008:a5dde2d9] Server: Message received...11
[     51.582] [t=0x00000008:a5ec04df] Server: Server_exec: processed id 11, cmd=0x2
[     51.582] [t=0x00000008:a5ecc1a3] Server: Message received...12
[     51.583] [t=0x00000008:a5fae91c] Server: Server_exec: processed id 12, cmd=0x2
[     51.583] [t=0x00000008:a5fba4c6] Server: Message received...13
[     51.585] [t=0x00000008:a609d1c1] Server: Server_exec: processed id 13, cmd=0x2
[     51.585] [t=0x00000008:a60a8dd4] Server: Message received...14
[     51.585] [t=0x00000008:a60af96e] Server: Server_exec: processed id 14, cmd=0x0
[     51.585] [t=0x00000008:a60b9229] Server: Message received...15
[     51.585] [t=0x00000008:a60bffd3] Server: Server_exec: processed id 15, cmd=0x0
[     51.585] [t=0x00000008:a60e179b] Server: Message received...16
[     51.585] [t=0x00000008:a60e9727] Server: Server_exec: processed id 16, cmd=0x2000000
[     51.585] [t=0x00000008:a60f3fb7] Server: Server_exec: Data check clean
[     51.585] [t=0x00000008:a60fb280] Server: &lt;-- Server_exec: 0
[     51.585] [t=0x00000008:a6101708] xdc.runtime.Main: DSP: Test Passed
[     51.585] [t=0x00000008:a6109170] Server: --&gt; Server_delete:
[     51.585] [t=0x00000008:a6114fa2] Server: &lt;-- Server_delete: 0
[     51.586] [t=0x00000008:a6127d48] Server: Server_create: server is ready
[     51.586] [t=0x00000008:a612ff93] Server: &lt;-- Server_create: 0
[     51.586] [t=0x00000008:a613620c] Server: --&gt; Server_exec:
root@am57xx-evm:~#
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="how-to-re-build-the-example">
<h3>9.7.4.3. How to Re-Build the example<a class="headerlink" href="#how-to-re-build-the-example" title="Permalink to this headline">¶</a></h3>
<p>Also source code for the example is included in the Processor SDK Linux
release. Once installed the source files can be found in the directory
example-applications/big-data-ipc-demo-linux_&lt;version&gt;.</p>
<p>Prerequisites: Also need to have the Processor SDK RTOS release
installed to build the DSP side RTOS image. See the instruction in <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">RTOS
SDK Getting Started Guide</span></a></p>
<p>The example can be rebuilt by using the following commands.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">export</span> <span class="n">TI_RTOS_PATH</span><span class="o">=&lt;</span><span class="n">TI_RTOS_PROC_SDK_INSTALL_DIR</span><span class="o">&gt;</span>
<span class="n">make</span> <span class="n">big</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">ipc</span><span class="o">-</span><span class="n">demo</span>
</pre></div>
</div>
<p>(e.g)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>export TI_RTOS_PATH=$HOME/ti
make big-data-ipc-demo
</pre></div>
</div>
<p>The test binaries can be installed into the default filesystem using the
command.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">big</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">ipc</span><span class="o">-</span><span class="n">demo_install</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Rules.make file can be edited to change the DESTDIR where the
binaries will be installed.</p>
</div>
<div class="section" id="source-files">
<h4>9.7.4.3.1. Source files<a class="headerlink" href="#source-files" title="Permalink to this headline">¶</a></h4>
<p>The source files for the example are located at</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">processor</span><span class="o">-</span><span class="n">sdk_linux</span><span class="o">-&lt;</span><span class="n">platform</span><span class="o">&gt;-&lt;</span><span class="n">version</span><span class="o">&gt;/</span><span class="n">example</span><span class="o">-</span><span class="n">applications</span><span class="o">/</span><span class="n">big</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">ipc</span><span class="o">-</span><span class="n">demo</span><span class="o">-</span><span class="n">linux</span><span class="o">-&lt;</span><span class="n">version</span><span class="o">&gt;/</span><span class="n">host_linux</span><span class="o">/</span><span class="n">simple_buffer_example</span><span class="p">.</span>
</pre></div>
</div>
<p>The host directory and dsp directory has the corresponding sources.
The shared folder contains some common sources.
The main sequence for big data IPC can be followed by looking at
host/App.c and dsp/Server.c.
|</p>
</div>
<div class="section" id="memory-layout-details">
<h4>9.7.4.3.2. Memory layout details<a class="headerlink" href="#memory-layout-details" title="Permalink to this headline">¶</a></h4>
<p>The DSP side memory layout can be found in the file
host_linux/simple_buffer_example/shared/&lt;platform&gt;/config.bld.
Also note the addition of the following section in
host_linux/simple_buffer_example/shared/&lt;platform&gt;/rsc_table_dsp.h.
Please note the reserved carve-out in the DSP resource table</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure this matches what is configured in the linux device tree</p>
</div>
<ol class="arabic simple">
<li><p>define DSP_CMEM_IOBUFS 0xA0000000</p></li>
<li><p>define PHYS_CMEM_IOBUFS 0xA0000000</p></li>
<li><p>define DSP_CMEM_IOBUFS_SIZE (SZ_1M * 192)</p></li>
</ol>
<p>The CMEM area allocated from this region is used for the big data
buffers.</p>
</div>
</div>
</div>
<div class="section" id="host-rtos-example">
<h2>9.7.5. Host RTOS example<a class="headerlink" href="#host-rtos-example" title="Permalink to this headline">¶</a></h2>
<p>Under the host_bios directory the simple_buffer_example is implemented
for Host A15 and DSP both running TI RTOS/BIOS.</p>
<div class="section" id="id43">
<h3>9.7.5.1. How to Run the Example<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h3>
<p>The Processor SDK RTOS release include the pre-built binaries for the
host_bios example under:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">processor_sdk_</span><span class="o">&lt;</span><span class="n">platform</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;/</span><span class="n">demos</span><span class="o">/</span><span class="n">bigdataipc</span><span class="o">/</span><span class="n">prebuilt</span><span class="o">-</span><span class="n">binaries</span><span class="o">/&lt;</span><span class="n">board</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;/</span><span class="n">simple_buffer_example</span><span class="o">/</span><span class="n">release</span><span class="o">/</span>
</pre></div>
</div>
<p>Also for the platforms that support boot through SDcard, pre-built boot
image or ‘app’ bootable through SBL is located under:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">processor_sdk_</span><span class="o">&lt;</span><span class="n">platform</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;/</span><span class="n">demos</span><span class="o">/</span><span class="n">bigdataipc</span><span class="o">/</span><span class="n">prebuilt</span><span class="o">-</span><span class="n">binaries</span><span class="o">/</span><span class="n">bootimages</span><span class="o">/</span><span class="n">host_bios</span><span class="o">/</span><span class="n">simple_buffer_example</span><span class="o">/&lt;</span><span class="n">board</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;/</span><span class="n">app</span>
</pre></div>
</div>
<div class="section" id="am57xx-k2g-boards">
<h4>9.7.5.1.1. AM57xx &amp; K2G boards<a class="headerlink" href="#am57xx-k2g-boards" title="Permalink to this headline">¶</a></h4>
<p class="rubric" id="pre-requisites">Pre-requisites</p>
<p>1. Create a bootable SDCard using the procedure here: <a class="reference internal" href="index_overview.html#tools-create-sd-card-windows-label"><span class="std std-ref">Creating SD card in Windows</span></a>
or
<a class="reference internal" href="index_overview.html#tools-create-sd-card-linux-label"><span class="std std-ref">Create SD card in Linux</span></a></p>
<p>2. Connect the UART on the hardware to the Host.
( Configure the terminal/console to Baud Rate= 115200, Data Bits= 8 ,
Parity= None, Flow Control= Off )</p>
<p class="rubric" id="procedure">Procedure</p>
<ul class="simple">
<li><p>Copy/overwrite the pre-built boot image ‘app’ corresponding to the
board to a bootable SD Card</p></li>
<li><p>Insert the SD card into the board</p></li>
<li><p>Boot/Reboot the board</p></li>
</ul>
<p>The application will be loaded and run automatically and the “Host: Test
Passed” message will be printed to the UART console.</p>
<img alt="../_images/BigDataIPC_Rtos_Demo.png" src="../_images/BigDataIPC_Rtos_Demo.png" />
</div>
<div class="section" id="k2h-k2k-k2l-k2e-boards">
<h4>9.7.5.1.2. K2H, K2K, K2L, K2E Boards<a class="headerlink" href="#k2h-k2k-k2l-k2e-boards" title="Permalink to this headline">¶</a></h4>
<p>The prebuilt elf binaries of Host and DSP images can be loaded through
CCS to the appropriate cores and run.</p>
</div>
</div>
<div class="section" id="id44">
<h3>9.7.5.2. How to Re-Build the Example<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h3>
<p>The bigdata ipc examples can be built from the Processor SDK top level
directory using the following steps</p>
<p class="rubric" id="build-environment-setup">1. Build environment setup</p>
<p class="rubric" id="linux-host">Linux host</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span>  <span class="o">&lt;</span><span class="n">processor_sdk_</span><span class="o">&lt;</span><span class="n">platform</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span>
<span class="k">export</span> <span class="n">SDK_INSTALL_PATH</span><span class="o">=&lt;</span><span class="n">Base</span> <span class="n">directory</span> <span class="n">where</span> <span class="n">Processor</span> <span class="n">SDK</span> <span class="n">is</span> <span class="n">installed</span><span class="o">&gt;</span>
<span class="n">source</span> <span class="n">setupenv</span><span class="p">.</span><span class="n">sh</span>
</pre></div>
</div>
<p class="rubric" id="windows-host">Windows host</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span>  <span class="o">&lt;</span><span class="n">processor_sdk_</span><span class="o">&lt;</span><span class="n">platform</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span>
<span class="n">set</span> <span class="n">SDK_INSTALL_PATH</span><span class="o">=&lt;</span><span class="n">Base</span> <span class="n">directory</span> <span class="n">where</span> <span class="n">Processor</span> <span class="n">SDK</span> <span class="n">is</span> <span class="n">installed</span><span class="o">&gt;</span>
<span class="n">setupenv</span><span class="p">.</span><span class="n">bat</span>
</pre></div>
</div>
<p class="rubric" id="build">2. Build</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">bigdataipc_examples</span>
</pre></div>
</div>
<p>This creates the elf binaries for both the host and DSP cores.
And the binaries can be installed using</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">bigdataipc_examples_install</span>
</pre></div>
</div>
<p>(NOTE: The above command installs the elf binaries under the
prebuilt-binaries location mentioned above.
Need to convert the prebuilt elf binaries into bootable images refer
to <a class="reference internal" href="index_Foundational_Components.html#fc-boot-label"><span class="std std-ref">Processor SDK RTOS Boot</span></a>)</p>
<p class="rubric" id="source-files-1">Source files</p>
<p>The source files for the example are located at</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">processor_sdk_</span><span class="o">&lt;</span><span class="n">platform</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;/</span><span class="n">demos</span><span class="o">/</span><span class="n">bigdataipc</span><span class="o">/</span><span class="n">host_bios</span><span class="o">/</span><span class="n">simple_buffer_example</span><span class="p">.</span>
</pre></div>
</div>
<p>The host directory and dsp directory has the corresponding sources.
The shared folder contains some common sources.
The main sequence for big data IPC can be followed by looking at
host/App.c and dsp/Server.c.</p>
</div>
</div>
</div>
<div class="section" id="ti-rtos-kernel-example">
<h1>9.8. TI-RTOS Kernel Example<a class="headerlink" href="#ti-rtos-kernel-example" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>9.8.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The SYS/BIOS examples gets user started with development of code using a
real-time operating system. These are simple examples that does not get
into details of software components provided in the SDK.</p>
</div>
<div class="section" id="arm-cortex-a53">
<h2>9.8.2. ARM Cortex-A53<a class="headerlink" href="#arm-cortex-a53" title="Permalink to this headline">¶</a></h2>
<p>The hello example serves as a basic sanity check program for SYS/BIOS.
It demonstrates how to print the string ‘hello world’ to stdout. As a
sample we will use the AM65x device to describe the steps for the Cortex-A53.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For future Device Support Package releases, the Hello World example for the Cortex-A53 will be added to CCS as an out-of-box experience.</p>
</div>
<p>1. Create a work space folder (/ti/am65x_am53_hello_workspace) under ti
folder to be used for Hello Example project, and start CCS. You may be
prompted with <strong>New Products Discovered</strong>, so select all and <strong>click on
Finish</strong></p>
<p>2. In CCS, go to File –&gt; New –&gt;
CCS Project</p>
<p>3. Enter a project name and configure the new CCS project as
follows:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Target</strong>: GPEVM_AM65x</p></li>
<li><p><strong>Cortex A</strong></p></li>
<li><p><strong>Compiler</strong>: GNU v7.2.1 (Linaro aarch64) (or higher)</p></li>
<li><p><strong>Device Endianness</strong>: little</p></li>
<li><p><strong>Linker Command File</strong>: (PDK INSTALL PATH)/packages/ti/build/am65xx/linker_a53.lds</p></li>
</ul>
</div></blockquote>
<p>4. Select the Empty Project (with main.c) template and
click Finish.</p>
<p>5. Remove startup_ARMCA53.S from the project. Add the file <strong>sysbios_a53.cfg</strong> located in the
folder (PDK INSTALL PATH)/packages/ti/build/am65xx/.</p>
<p>You will be prompted to enable XDCtools, click yes.</p>
<p>6. In Project Properties –&gt; CCS General –&gt; Products, set Target to <strong>gnu.targets.arm.A53F</strong> and
Platform to <strong>ti.platforms.cortexA:AM65X</strong>. Uncheck all products except for SYS/BIOS and XDCtools. Refer to the Release Notes for the recommended package verisons.
Click Apply and Close.</p>
<p>7. Add the file <strong>InitMmu.c</strong> located under (IPC INSTALL PATH)/examples/AM65XX_bios_elf/ex02_messageq/host
to the project.</p>
<p>8. In Project Properties –&gt; CCS Build –&gt; XDCtools –&gt; Package Repositories,
add the path <strong>${BIOS_CG_ROOT}/packages</strong></p>
<p>9. In Project Properties –&gt; GNU Linker –&gt; Libraries, add the <strong>gcc</strong> and <strong>rdimon</strong> libraries,
and the library search path “${xdc_find:gnu/targets/arm/libs/install-native/arm-none-eabi/lib:${ProjName}}”</p>
<p>10. In Project Properties –&gt; GNU Linker –&gt; Basic, check the option “Do not use the standard system
startup files when linking (-nostartfiles).”</p>
<p>11. Navigate to Project Properties –&gt; GNU Compiler –&gt; Debugging and
uncheck “Do not emit DWARF additions beyong selected version” and set the gdwarf version to 2 or lower.</p>
<p>12. Finally, add the following code to main.c and
build the project.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;stdio.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;hello world&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>13. Launch the target configuration using the appropriate emulator to connect to AM65x EVM
as described in the AM65x EVM Hardware Setup Guide.</p>
<p>14. Right click on DMSC_Cortex_M3_0 and click
Connect Target.</p>
<p>15. Connect to the CortexA53_0_0 core. Load and run Hello Example out file. You should
see Hello World string displayed on console window.</p>
</div>
<div class="section" id="arm-cortex-a15">
<h2>9.8.3. ARM Cortex-A15<a class="headerlink" href="#arm-cortex-a15" title="Permalink to this headline">¶</a></h2>
<p>The hello example serves as a basic sanity check program for SYS/BIOS.
It demonstrates how to print the string ‘hello world’ to stdout. As a
sample we will use the AM572x device to describe the steps. The same
steps can be used for create hello world examples for A15 cores in
Keystone 2 family of devices.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The K2G, K2E and K2H devices, can be located under Unclassified
devices in the Resource Explorer. Refer below Screenshot for Keystone II</p></li>
</ul>
</div>
<img alt="../_images/KSII_RS.png" src="../_images/KSII_RS.png" />
<p>1. Create a work space folder (tiam_572x_hello_workspace) under ti
folder to be used for Hello Example project, and start CCS. You may be
prompted with <strong>New Products Discovered</strong>, so select all and <strong>click on
Finish</strong></p>
<ol class="arabic simple" start="2">
<li><p>On CCS click View –&gt; Resource Explorer (Examples).</p></li>
</ol>
<p>3. On SYS/BIOS scroll down to AM572X –&gt; Cortex A –&gt; Generic Example
–&gt; click on Hello Example.</p>
<img alt="../_images/Sys_bios_hello_example_screen_1.jpg" src="../_images/Sys_bios_hello_example_screen_1.jpg" />
<p>4. To import Hello Example, on the right window click on step 1. Import
The Example to CCS Project.</p>
<ol class="arabic simple" start="5">
<li><p>On New CCS Project window enter project name and then click Next.</p></li>
</ol>
<img alt="../_images/Sys_bios_hello_example_screen_2.jpg" src="../_images/Sys_bios_hello_example_screen_2.jpg" />
<p>6. On RSTC window select platform name: <strong>ti.platforms.evmAM572X</strong> and
check that the target is set to <strong>gnu.targets.arm.A15F</strong></p>
<ol class="arabic simple" start="7">
<li><p>Click Finish. Your project should show up on Project Explorer window.</p></li>
</ol>
<p>8. To get log message to print on console add this variable to hello.cfg
file:</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span>var SemiHostSupport = xdc.useModule(&#39;ti.sysbios.rts.gnu.SemiHostSupport&#39;);
</pre></div>
</div>
</div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>You also need to replace the nosys library in linker with
rdimon which is the Semi-Hosting enabled BSP library.</p>
</div>
<p>Right click on project –&gt; Show Build Settings… –&gt; Build –&gt; GNU
Linker –&gt; Libraries</p>
<p>9. Build Hello Example project by Right click on Hello Project and click
Build project.</p>
<p>10. Create new target configuration (if one doesn`t exist) as described
in here <span class="xref std std-ref">Create Target Configuration File for EVM</span></p>
<p>11. Right click on the target configuration and Launch target
configurations.</p>
<ol class="arabic simple" start="12">
<li><p>Right click CortexA15_0 and connect target.</p></li>
</ol>
<p>13. Load and run Hello Example out file. You should see <strong>Hello World</strong>
string displayed on console window.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="arm-cortex-a9">
<h2>9.8.4. ARM Cortex-A9<a class="headerlink" href="#arm-cortex-a9" title="Permalink to this headline">¶</a></h2>
<p>The hello example serves as a basic sanity check program for SYS/BIOS.
It demonstrates how to print the string ‘hello world’ to stdout.</p>
<p>1. Create a work space folder (\ti\am_437x_hello_workspace) under ti
folder to be used for Hello Example project, and start CCS. You may be
prompted with <strong>New Products Discovered</strong>, so select all and <strong>click on
Finish</strong></p>
<ol class="arabic simple" start="2">
<li><p>On CCS click View –&gt; Resource Explorer (Examples).</p></li>
</ol>
<p>3. On SYS/BIOS scroll down to AM4378 –&gt; Cortex A –&gt; Generic Example
–&gt; click on Hello Example.</p>
<img alt="../_images/RTOS_CortexA9_HelloWorld.png" src="../_images/RTOS_CortexA9_HelloWorld.png" />
<p>4. To import Hello Example, on the right window click on step 1. Import
The Example to CCS Project.</p>
<ol class="arabic simple" start="5">
<li><p>On New CCS Project window enter project name and then click Next.</p></li>
</ol>
<img alt="../_images/HelloWorld_cortexA9.png" src="../_images/HelloWorld_cortexA9.png" />
<p>6. On RSTC window select platform name: <strong>ti.platforms.evmAM437X</strong> and
check that the target is set to <strong>gnu.targets.arm.A9F</strong></p>
<ol class="arabic simple" start="7">
<li><p>Click Finish. Your project should show up on Project Explorer window.</p></li>
</ol>
<p>8. To get log message to print on console add this variable to hello.cfg
file:</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span>var SemiHostSupport = xdc.useModule(&#39;ti.sysbios.rts.gnu.SemiHostSupport&#39;);
</pre></div>
</div>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>You also need to replace the nosys library in linker with
rdimon which is the Semi-Hosting enabled BSP library.</p>
</div>
<p>Right click on project –&gt; Show Build Settings… –&gt; Build –&gt; GNU
Linker –&gt; Libraries</p>
<p>9. Build Hello Example project by Right click on Hello Project and click
Build project.</p>
<p>10. Create new target configuration (if one doesn`t exist) as described
here <span class="xref std std-ref">Create Target Configuration File for EVM</span></p>
<p>11. Right click on the target configuration and Launch target
configurations.</p>
<ol class="arabic simple" start="12">
<li><p>Right click CortexA9_0 and connect target.</p></li>
</ol>
<p>13. Load and run Hello Example out file. You should see <strong>Hello World</strong>
string displayed on console window.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="arm-cortex-a8">
<h2>9.8.5. ARM Cortex-A8<a class="headerlink" href="#arm-cortex-a8" title="Permalink to this headline">¶</a></h2>
<p>The hello example serves as a basic sanity check program for SYS/BIOS.
It demonstrates how to print the string ‘hello world’ to stdout.</p>
<p>1. Create a work space folder (\ti\am_335x_hello_workspace) under ti
folder to be used for Hello Example project, and start CCS. You may be
prompted with <strong>New Products Discovered</strong>, so select all and <strong>click on
Finish</strong></p>
<p>2. On CCS click View –&gt;
Resource Explorer (Examples).</p>
<p>3. On SYS/BIOS scroll down to AM3352 –&gt; Cortex A –&gt; Generic Example
–&gt; click on Hello Example.</p>
<img alt="../_images/RTOS_CortexA8_HelloWorld.png" src="../_images/RTOS_CortexA8_HelloWorld.png" />
<p>4. To import Hello Example, on the right window click on step 1. Import
The Example to CCS Project.</p>
<p>5. On New CCS Project window enter project name and then
click Next.</p>
<img alt="../_images/HelloWorld_cortexA8.png" src="../_images/HelloWorld_cortexA8.png" />
<p>6. On RSTC window select platform name: <strong>ti.platforms.evmAM335X</strong> and
check that the target is set to <strong>gnu.targets.arm.A8F</strong></p>
<p>7. Click Finish. Your project should show up on
Project Explorer window.</p>
<p>8. To get log message to print on console add this variable to hello.cfg
file:</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span>var SemiHostSupport = xdc.useModule(&#39;ti.sysbios.rts.gnu.SemiHostSupport&#39;);
</pre></div>
</div>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>You also need to replace the nosys library in linker with
rdimon which is the Semi-Hosting enabled BSP library.</p>
</div>
<p>Right click on project –&gt; Show Build Settings… –&gt; Build –&gt; GNU
Linker –&gt; Libraries</p>
<p>9. Build Hello Example project by Right click on Hello Project and click
Build project.</p>
<p>10. Create new target configuration (if one doesn`t exist) as described
here <span class="xref std std-ref">Create Target Configuration File for EVM</span></p>
<p>11. Right click on the target configuration and Launch target
configurations.</p>
<ol class="arabic simple" start="12">
<li><p>Right click CortexA8_0 and connect target.</p></li>
</ol>
<p>13. Load and run Hello Example out file. You should see <strong>Hello World</strong>
string displayed on console window.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="arm-cortex-r5">
<h2>9.8.6. ARM Cortex-R5<a class="headerlink" href="#arm-cortex-r5" title="Permalink to this headline">¶</a></h2>
<p>The hello example serves as a basic sanity check program for SYS/BIOS.
It demonstrates how to print the string ‘hello world’ to stdout.</p>
<p>1. Create a work space folder (/ti/am65x_r5_hello_workspace) under ti
folder to be used for Hello Example project, and start CCS. You may be
prompted with <strong>New Products Discovered</strong>, so select all and <strong>click on
Finish</strong></p>
<p>2. On CCS click View –&gt; Resource Explorer
Classic.</p>
<p>3. On SYS/BIOS scroll down to AM65x - Cortex A53 –&gt; AM6548 –&gt; Cortex R –&gt; TI Target Examples –&gt; Generic Examples
–&gt; click on Hello Example.</p>
<img alt="../_images/AM65x_R5_Examples.png" src="../_images/AM65x_R5_Examples.png" />
<p>4. To import Hello Example, on the right window click on step 1. Import
The Example to CCS Project.</p>
<p>5. On New CCS Project window enter project name, set the device endianness to little, and add the linker command
file located at (PDK INSTALL PATH)/packages/ti/build/am65xx/linker_r5_sysbios.lds and click Next.</p>
<p>6. On RSTC window, make sure the correct XDCtools version is selected and select the correct versions
of the SYS/BIOS and PDK packages.</p>
<p>7. Set the platform to ti.platforms.cortexR:AM65X and set the target
to ti.targets.arm.elf.R5F.</p>
<img alt="../_images/AM65x_R5_CCS_Project.png" src="../_images/AM65x_R5_CCS_Project.png" />
<ol class="arabic simple" start="8">
<li><p>Click Finish. Your project should appear in Project Explorer window.</p></li>
<li><p>Launch the target configuration using the appropriate emulator to connect to AM65x EVM as described in the AM65x EVM Hardware Setup Guide.</p></li>
<li><p>Right click on DMSC_Cortex_M3_0 and click Connect Target.</p></li>
<li><p>Connect to the MCU_PULSAR_Cortex_R5_0 core. Load and run Hello Example out file. You should see Hello World string displayed on console window.</p></li>
</ol>
</div>
<div class="section" id="arm-cortex-m4">
<h2>9.8.7. ARM Cortex-M4<a class="headerlink" href="#arm-cortex-m4" title="Permalink to this headline">¶</a></h2>
<p>The hello example serves as a basic sanity check program for SYS/BIOS.
It demonstrates how to print the string ‘hello world’ to stdout.</p>
<p>1. Create a work space folder (/ti/am_572x_hello_workspace) under ti
folder to be used for Hello Example project, and start CCS. You may be
prompted with <strong>New Products Discovered</strong>, so select all and <strong>click on
Finish</strong></p>
<p>2. On CCS click View –&gt; Resource Explorer
(Examples).</p>
<p>3. on SYS/BIOS scroll down to AM572X –&gt; Cortex M –&gt; Generic Example
–&gt; click on Hello Example.</p>
<img alt="../_images/SYSBIOS_hello_world_M4_template.jpg" src="../_images/SYSBIOS_hello_world_M4_template.jpg" />
<p>4. To import Hello Example, on the right window click on step 1. Import
The Example to CCS Project.</p>
<ol class="arabic simple" start="5">
<li><p>Go to Project Explorer window and click on project properties.</p></li>
</ol>
<img alt="../_images/SYSBIOS_M4_platformSelect.jpg" src="../_images/SYSBIOS_M4_platformSelect.jpg" />
<p>6. On RSTC window select platform name: <strong>ti.platforms.evmAM572X</strong> and
check that the target is set to <strong>gnu.targets.arm.elf.M4</strong></p>
<p>7. Click Finish. Your project should show up on
Project Explorer window.</p>
<p>8. Build Hello Example project by Right click on Hello Project and click
Build project.</p>
<p>9. Launch target configurations using appropriate emulator to connect to
AM572X EVM.</p>
<p>10. Right click CortexA15_0 and connect target. From the Scripts menu
select <a class="reference external" href="index_how_to_guides.html#connect-to-am57x-slave-cores">AM572x Multicore
Initialization-&gt;IPU1SSClkEnable_API</a>.</p>
<p>11. Connect to the Cortex_M4_IPU1_C0. Load and run Hello Example out
file. You should see <strong>Hello World</strong> string displayed on console window.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="dsp-c66x">
<h2>9.8.8. DSP C66x<a class="headerlink" href="#dsp-c66x" title="Permalink to this headline">¶</a></h2>
<p>The hello example serves as a basic sanity check program for SYS/BIOS.
It demonstrates how to print the string ‘hello world’ to stdout. As a
sample we will use the AM572x device to describe the steps but the same
steps can be used for create hello world examples for C66x cores in
Keystone I and Keystone 2 family of devices.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The C66x examples corresponding Keystone I devices can be located
under C66x Multi-core DSP devies in the Resource Explorer. Refer
below screenshot</p></li>
</ul>
</div>
<img alt="../_images/KSI_RS.png" src="../_images/KSI_RS.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The K2G, K2E and K2H devices, can be located under Unclassified
devices in the Resource Explorer. Refer below screen shot</p></li>
</ul>
</div>
<img alt="../_images/KSII_RS.png" src="../_images/KSII_RS.png" />
<p>1. Create a work space folder (tiam_572x_hello_workspace) under ti
folder to be used for Hello Example project, and start CCS. You may be
prompted with <strong>New Products Discovered</strong>, so select all and <strong>click on
Finish</strong></p>
<ol class="arabic simple" start="2">
<li><p>On CCS click View –&gt; Resource Explorer (Examples).</p></li>
</ol>
<p>3. on SYS/BIOS scroll down to AM572X –&gt; C66x –&gt; Generic Example –&gt;
click on Hello Example.</p>
<img alt="../_images/SYSBIOS_hello_world_dsp_template.jpg" src="../_images/SYSBIOS_hello_world_dsp_template.jpg" />
<p>4. To import Hello Example, on the right window click on step 1. Import
The Example to CCS Project.</p>
<ol class="arabic simple" start="5">
<li><p>On New CCS Project window enter project name and then click Next.</p></li>
</ol>
<img alt="../_images/SYSBIOS_DSP_platformSelect.jpg" src="../_images/SYSBIOS_DSP_platformSelect.jpg" />
<p>6. On RSTC window select platform name: <strong>ti.platforms.evmAM572X</strong> and
check that the target is set to <strong>ti.targets.elf.C66</strong> (Auto populated)</p>
<ol class="arabic simple" start="7">
<li><p>Click Finish. Your project should show up on Project Explorer window.</p></li>
</ol>
<p>8. Build Hello Example project by Right click on Hello Project and click
Build project.</p>
<p>10. Create new target configuration (if one doesn`t exist) as described
<a class="reference external" href="index_how_to_guides.html#create-target-configuration-file-for-evm">here</a>.</p>
<p>11. Right click on the target configuration and Launch target
configurations.</p>
<p>12. Right click CortexA15_0 and connect target. From the Scripts menu
select <a class="reference external" href="index_how_to_guides.html#connect-to-am57x-slave-cores">AM572x Multicore
Initialization-&gt;DSP1SSClkEnable_API</a>.</p>
<p>13. Route the GPTimer5 suspend ctrl signal to the DSP using the Scripts
menu GP timer Suspend Ctrl -&gt; GPTimer5SuspendCtl_DSP1SS_BIOS as
described <a class="reference external" href="index_how_to_guides.html#timer-suspend-control-options-for-dsp">here</a>.</p>
<p>14. Connect to C66x_DSP1 Load and run Hello Example out file. You should
see <strong>Hello World</strong> string displayed on console window.</p>
</div>
<div class="section" id="dsp-c674x">
<h2>9.8.9. DSP C674x<a class="headerlink" href="#dsp-c674x" title="Permalink to this headline">¶</a></h2>
<p>The hello example serves as a basic sanity check program for SYS/BIOS.
It demonstrates how to print the string ‘hello world’ to stdout. As a
sample we will use the C6748 device to describe the steps but the same
steps can be used for create hello world examples for C674x cores in
OMAPL1x/DA8x family of devices.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Locate the appropriate device that you are using to make sure the
correct SYSBIOS platform definiition gets used in the build</p></li>
</ul>
</div>
<p>1. Create a work space folder ( Eg. tirtos_hello_workspace) that can be
used for Hello Example project, and start CCS. You may be prompted with
<strong>New Products Discovered</strong>, so select all and <strong>click on Finish</strong> Note:
at this stage the version of SYSBIOS and corresponding dependencies are
assumed to be discovered by CCS. If not please follow the steps
described here:
<a class="reference external" href="index_how_to_guides.html#discovering-sdk-products">Discovering_SDK_products</a></p>
<ol class="arabic simple" start="2">
<li><p>On CCS click View –&gt; Resource Explorer Classic (Examples).</p></li>
</ol>
<p>3. on SYS/BIOS scroll down to C6748 /OMAPL1x and select –&gt; C674x –&gt;
Generic Example –&gt; click on Hello Example.</p>
<img alt="../_images/OMAPL138_SYSBIOS_TI_RTOS_CCSv7.png" src="../_images/OMAPL138_SYSBIOS_TI_RTOS_CCSv7.png" />
<p>4. To import Hello Example, on the right window click on step 1. Import
The Example to CCS Project.</p>
<ol class="arabic simple" start="5">
<li><p>On New CCS Project window enter project name and then click Next.</p></li>
</ol>
<img alt="../_images/Create_Project_Step1.png" src="../_images/Create_Project_Step1.png" />
<p>6. On RSTC window select platform name: <strong>ti.platforms.evmc6748</strong> and
check that the target is set to <strong>ti.targets.elf.C674</strong> (Auto populated)</p>
<img alt="../_images/Create_Project_Step2.png" src="../_images/Create_Project_Step2.png" />
<ol class="arabic simple" start="7">
<li><p>Click Finish. Your project should show up on Project Explorer window.</p></li>
</ol>
<p>8. Build Hello Example project by Right click on Hello Project and click
Build project.</p>
<p>10. Create new target configuration (if one doesn`t exist) as described
<a class="reference external" href="index_how_to_guides.html#create-target-configuration-file-for-evm">here</a>.</p>
<p>11. Right click on the target configuration and Launch target
configurations.</p>
<p>12. Developers can Connect to the C674x on OMAPL137/C6747/C6748 can
connect directly to the DSP. For OMAPL138 device, you will need to
connect to the ARM as this is ARM master boot device and ARM needs to
power up the DSP You should see the following log in the Console</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>   <span class="n">Target</span> <span class="n">Connected</span><span class="p">.</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="o">---------------------------------------------</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">Memory</span> <span class="n">Map</span> <span class="n">Cleared</span><span class="p">.</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="o">---------------------------------------------</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">Memory</span> <span class="n">Map</span> <span class="n">Setup</span> <span class="n">Complete</span><span class="p">.</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="o">---------------------------------------------</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">PSC</span> <span class="n">Enable</span> <span class="n">Complete</span><span class="p">.</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="o">---------------------------------------------</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">PLL0</span> <span class="n">init</span> <span class="n">done</span> <span class="k">for</span> <span class="nl">Core</span><span class="p">:</span><span class="mi">300</span><span class="n">MHz</span><span class="p">,</span> <span class="nl">EMIFA</span><span class="p">:</span><span class="mi">25</span><span class="n">MHz</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">DDR</span> <span class="n">initialization</span> <span class="n">is</span> <span class="n">in</span> <span class="n">progress</span><span class="p">....</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">PLL1</span> <span class="n">init</span> <span class="n">done</span> <span class="k">for</span> <span class="nl">DDR</span><span class="p">:</span><span class="mi">150</span><span class="n">MHz</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">Using</span> <span class="n">DDR2</span> <span class="n">settings</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">DDR2</span> <span class="n">init</span> <span class="k">for</span> <span class="mi">150</span> <span class="n">MHz</span> <span class="n">is</span> <span class="n">done</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="o">---------------------------------------------</span>
</pre></div>
</div>
<p>13. Connect to C674x_DSP1 Load and run Hello Example out file. You
should see <strong>Hello World</strong> string displayed on console window.</p>
<img alt="../_images/Hello_world_dsp674x_rtos.png" src="../_images/Hello_world_dsp674x_rtos.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="usage-notes">
<h2>9.8.10. Usage Notes<a class="headerlink" href="#usage-notes" title="Permalink to this headline">¶</a></h2>
<p>After execution of the hello world examples on the core, the CCS Editor
may report “Can’t find a source file” error messages when you pause or
the application exits/aborts after completion. This occurs due to source
files from SYSBIOS or XDC packages not being in the default search path
of the CCS Editor. when you run into this issue, you can navigate to the
file using Locate file option in the Editor. Once you provide the
location the CCS Editor will be able to locate all the other required
files from that package based on relative path.</p>
<p>For example, when running SYS/BIOS Hello Example using AM57x-GP EVM if
you see the message</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>Can&#39;t find a source file at &quot;/db/ztree/library/trees/xdctargets/xdctargets-i02/src/gnu/targets    /arm/rtsv7A/syscalls.c&quot;
Locate the file or edit the source lookup path to include its location. The above file is located  under file path ${PROC_SDK_DIR}\bios_6_42_02_29\packages\gnu\targets\arm\rtsv7A
</pre></div>
</div>
<p>You can also prevent these issues by adding the Processor SDK components
to file search path under Windows-&gt;Preferences options in CCS GUI.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="known-issues">
<h2>9.8.11. Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>SYS/BIOS examples for Cortex-A15 generate linker errors due to the
FPU related flags</strong></p></li>
</ul>
<p>Some versions of CCS are impacted by linker setting used in CCS RTOS
templates and may need some manual modification to set the correct
-mfpu, -mcpu and -march. If you are seeing VFP errors in the link step,
you are most likely running into this issue. To correct this issue
please check the resolution here:
<a class="reference external" href="https://e2e.ti.com/support/development_tools/code_composer_studio/f/81/t/539973">https://e2e.ti.com/support/development_tools/code_composer_studio/f/81/t/539973</a></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="useful-resources">
<h2>9.8.12. Useful Resources<a class="headerlink" href="#useful-resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/Introduction_to_the_TI-RTOS_Kernel_Workshop">TI RTOS
training</a></p></li>
<li><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/Category:SYSBIOS">SYS/BIOS
Information</a></p></li>
<li><p><a class="reference external" href="http://processors.wiki.ti.com/index.php/SYS/BIOS_FAQs">SYS/BIOS
FAQ</a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="no-os-bare-metal-example">
<h1>9.9. No OS (Bare Metal) Example<a class="headerlink" href="#no-os-bare-metal-example" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id45">
<h2>9.9.1. Overview<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h2>
<p>The bare-metal examples gets user started with development of code
without an operating system. These are simple examples that does not get
into details of software components provided in the SDK. Consequently,
make sure there are no SD cards installed on the EVM with an OS prior to
exploring the following examples.</p>
<p>If you face any problems with CCS or JTAG, try these
<a class="reference external" href="index_how_to_guides.html#troubleshooting">troubleshooting steps</a>.</p>
</div>
<div class="section" id="id46">
<h2>9.9.2. ARM Cortex-A53<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h2>
<p>In this article, we take a look at creating bare-metal hello world examples for the Cortex-A53 core in CCS. We will be using the AM654x device as an example.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For future Device Support Package releases, the Hello World examples will be added to CCS as an out-of-box experience.</p>
</div>
<p>1. Start CCS and create a workspace for
generating the project.</p>
<p>2. Navigate to File -&gt; New -&gt;
CCS Project.</p>
<p>3. Select Target as AM65x - Cortex A53 and GPEVM_AM65x as
shown in the image below.</p>
<p>4. Select <strong>Cortex A setting</strong> in the options below and provide a name for the project. Use the default advanced settings
for the project. Select <strong>GNU v7.2.1 (Linaro aarch64)</strong> (or higher) for the Compiler Version. Under Tool-chain, for the Linker Command file, select the file (PDK INSTALL PATH)/packages/ti/build/am65xx/<strong>linker_a53.lds</strong>.</p>
<p>Under Project templates and examples, select <strong>Empty Project (with main.c).</strong></p>
<p>Click Finish after you are done to allow CCS to auto generate the
project from the template.</p>
<img alt="../_images/AM65x_Create_CCS_Project.png" src="../_images/AM65x_Create_CCS_Project.png" />
<p>5. The generated CCS project contains source file <strong>main.c</strong>, ARM assembly code <strong>startup_ARMCA53.S</strong> and a linker command file <strong>AM65X.lds</strong>.
Remove startup_ARMCA53.S and AM65X.lds from the project.</p>
<p>6. Add the following linker command file to the project.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">PDK</span> <span class="n">INSTALL</span> <span class="n">PATH</span><span class="p">)</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">am65xx</span><span class="o">/</span><span class="n">linker_a53</span><span class="p">.</span><span class="n">lds</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>7. Modify main.c to include the
following:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Header files */</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;stdio.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello World</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li><p>Navigate to Project Properties -&gt; CCS Build -&gt; GNU Linker and add “Entry” to the “Set start address” field.</p></li>
</ol>
<p>9. Navigate to CCS Build -&gt; GNU Linker -&gt; Libraries and add the
following libraries.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ti</span><span class="p">.</span><span class="n">csl</span><span class="p">.</span><span class="n">init</span><span class="p">.</span><span class="n">aa53fg</span>
<span class="n">ti</span><span class="p">.</span><span class="n">csl</span><span class="p">.</span><span class="n">aa53fg</span>
<span class="n">rdimon</span>
<span class="n">stdc</span><span class="o">++</span>
<span class="n">gcc</span>
<span class="n">c</span>
<span class="n">m</span>
</pre></div>
</div>
<p>10. Add the following library search
path.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">PDK</span> <span class="n">INSTALL</span> <span class="n">PATH</span><span class="p">)</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">csl</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">am65xx</span><span class="o">/</span><span class="n">a53</span><span class="o">/</span><span class="n">release</span>
</pre></div>
</div>
<p>11. Save all changes, and right click on the project and select Build Project to
build the project and generate hello_world.out.</p>
<p>12. Launch the target configuration using your emulator to connect to the AM65x EVM as
described in the <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Processor SDK RTOS Getting Started Guide</span></a>.</p>
<p>13. Right click on <strong>DMSC_Cortex_M3_0</strong> and click connect to target.
After connecting to the M3, right click on <strong>CortexA53_0_0</strong> and connect to it.</p>
<p>14. Load and run hello_world.out example file on the Cortex-A53.
You should see a Hello_world string displayed in the CCS console window.</p>
<img alt="../_images/AM65x_CCS_Hello_World.PNG" src="../_images/AM65x_CCS_Hello_World.PNG" />
</div>
<div class="section" id="id47">
<h2>9.9.3. ARM Cortex-A15<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h2>
<p>In this article, we take a look at creating bare-metal hello world
examples for Cortex A15 core using pre-built templates in CCS. As a
sample we will use the AM572x device to describe the steps but the same
steps can be used for create hello world examples for Cortex A15 cores
in the Keystone 2 family of devices.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Only major difference between A15 examples for AM572x and Keystone 2
is that the Keystone 2 device contain MSMC memory instead of OCMC
memory as the shared memory.</p></li>
<li><p>For K2G devices, the hello world template will be created with the
.lds file that specifies MSMC and DDR memory sections. For K2E and
K2H, the CCS template doesn`t populate the .lds file. K2H &amp; K2E users
can choose to use 66AK2G02.lds located at ccsv6ccs_basearminclude
as reference to add .lds file to their hello world projects.</p></li>
</ul>
</div>
<ol class="arabic simple">
<li><p>Start CCS and create a work space for generating the project.</p></li>
<li><p>Click on File menu option and select New–&gt; CCS Project.</p></li>
</ol>
<p>3. Select Target as AM572x -Cortex A15 and GPEVM_AM572x as shown in the
image</p>
<p>4. Select <strong>Cortex A setting</strong> in the options below and provide name of
the project as “hello_world” and use default Advanced settings for the
project. If the Default settings uses “TI ARM compiler 5.x.x” switch to
<strong>GNU Linaro 4.8.4</strong> (or higher) tool chain for A15 and check the build
<strong>little</strong> endian <strong>ELF</strong> binary for the A15 core. Under Project
templates and examples, select <strong>Basic Examples-&gt; Hello World</strong></p>
<p>Click Finish after you are done to allow CCS to auto generate the
project from the template <strong>Basic Examples-&gt; Hello World</strong>.</p>
<img alt="../_images/NewCCSProject_Hello_world.png" src="../_images/NewCCSProject_Hello_world.png" />
<p>5. The generated CCS project contains source file <strong>main.c</strong>, ARM
assembly code <strong>startup_ARMCA15.S</strong> and a linker command file
<strong>AM572x.lds</strong>. Please modify the main.c file by adding the following
highlighted code lines and save main.c file.</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span> <span class="cm">/*</span>
<span class="cm"> * hello.c</span>
<span class="cm"> */</span>
 <span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

 <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello_world</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Keystone2 users, the startup_ARMCA15.S and .lds file is not auto
populated by CCS. To add these file, right click the project and add
files and locate the 66AK2Gxx.lds and startup_ARMCA15.S under the file
path ccsvX/ccs_base/arm/include and add them to the project</p>
</div>
<p>6. Ensure that CCSv6 generated linker command file <strong>AM572x.lds</strong>
contains the following Memory configurations.</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">MEMORY</span>
<span class="p">{</span>
   <span class="nl">OCMC_RAM1</span> <span class="p">:</span>  <span class="n">o</span> <span class="o">=</span> <span class="mh">0x40300000</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00080000</span>  <span class="cm">/* 512kB L3 OCMC RAM1 */</span>
   <span class="nl">OCMC_RAM2</span> <span class="p">:</span>  <span class="n">o</span> <span class="o">=</span> <span class="mh">0x40400000</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00100000</span>  <span class="cm">/* 1MB L3 OCMC RAM2 */</span>
   <span class="nl">OCMC_RAM3</span> <span class="p">:</span>  <span class="n">o</span> <span class="o">=</span> <span class="mh">0x40500000</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00100000</span>  <span class="cm">/* 1MB L3 OCMC RAM3 */</span>
   <span class="nl">DDR0</span> <span class="p">:</span>       <span class="n">o</span> <span class="o">=</span> <span class="mh">0x80000000</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x40000000</span>  <span class="cm">/* 1GB external DDR Bank 0 */</span>
   <span class="nl">DDR1</span> <span class="p">:</span>       <span class="n">o</span> <span class="o">=</span> <span class="mh">0xC0000000</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x40000000</span>  <span class="cm">/* 1GB external DDR Bank 1 */</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Keystone 2 devices, replace all the OCMC_RAM# regions in the lds
file and replace it with MSMC memory section as shown below. Refer to
66AK2G02.lds file in ccs installation under directory path
ccsv6ccs_basearminclude</p>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="nl">MSMC</span>  <span class="p">:</span>      <span class="n">o</span><span class="o">=</span><span class="mh">0x0c000000</span><span class="p">,</span>    <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00600000</span>  <span class="cm">/* 6MB Muticore shared memory */</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The .lds file expects users to provide STACKSIZE and HEAPSIZE from
linker settings. To provide these settings got to Build Settings GNU
Linker add the following to the Symbols section. Keystone II devices
require this to be done explicitly in the linker settings</p>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">STACKSIZE</span><span class="o">=</span><span class="mi">10000</span>
<span class="n">HEAPSIZE</span><span class="o">=</span><span class="mi">400</span>
</pre></div>
</div>
<p>7. Right click on the project and select Build Project, to build the
project and generate hello_world.out.</p>
<p>8. Launch target configuration using your emulator to connect to AM572X
EVM as described in the <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Processor SDK RTOS Getting Started Guide</span></a>.</p>
<ol class="arabic simple" start="9">
<li><p>Right click <strong>CortexA15_0</strong> and select connect target.</p></li>
</ol>
<p>10. Initialize DDR configuration. On CCS –&gt; Scripts –&gt; DDR
configurations –&gt; AM572_DDR3_532MHz_config</p>
<p>11. Load and run hello_world.out example file. You should see
<strong>Hello_world</strong> string displayed on CCS console window.</p>
<img alt="../_images/HelloWorldOutput.jpg" src="../_images/HelloWorldOutput.jpg" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>If the example does not load correctly in the first attempt, reload
and <strong>ensure ARM core starts at main</strong>.</p></li>
<li><p>If the ARM loads correctly but you don`t see any output then check to
see if the GNU linker is linking to Semihosting library (librdimon)
in the linker setting. If it is not linked go to GNU linker settings
in CCS project and add <strong>“rdimon”</strong> to the libraries that are linked</p></li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id48">
<h2>9.9.4. ARM Cortex-A9<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Start CCSv6 and create a work space for generating the project.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CCSv6.1.1 doesn`t contain a hello world project template for Cortex A9
core using GNU Linaro 4.8.x tool chain. Due to code compatibility of
Cortex A8 and cortex A9 platforms, We recommend that you create a
project for Cortex A8 platform like AM335x using the GNU Linaro tool
chain and then use the code to test hello world application on the
Cortex A9 on the AM437x platform. If you wish to use TI ARM compiler
5.2.x, then you can use the default hello world template in CCSv6 for
the Cortex A9 on AM437x</p>
</div>
<p>2. Click on File menu option and select New–&gt; CCS Project. Steps assume
that user is using GN Linaro tool chain for Cortex A9.</p>
<p>3. Select Target as AM33xx -Cortex A8 and appropriate target Board
setting as shown in the image</p>
<p>4. Select <strong>Cortex A8</strong> setting in the options below and provide name of
the project as “hello_world_a9” and use default Advanced settings for
the project. If the Default settings uses “TI ARM compiler 5.x.x” switch
to <strong>GNU Linaro 4.8.4</strong> (or higher) tool chain for A9 and check the
build <strong>little</strong> endian <strong>ELF</strong> binary for the A9 core. Click Finish
after you are done to allow CCS to auto generate the project from the
template <strong>Basic Examples-&gt; Hello World</strong>.</p>
<img alt="../_images/Bare-Metal_A9_templateselect.jpg" src="../_images/Bare-Metal_A9_templateselect.jpg" />
<p>5. The generated CCS project contains source file <strong>main.c</strong>, ARM
assembly code <strong>startup_ARMCA8.S</strong> and a linker command file
<strong>AM335x.lds</strong>. The startup file does some basic setup and there is no
difference between A8 and A9, so it can be used directly on A9 target.
Ensure the main.c file contains the following code</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span> <span class="cm">/*</span>
<span class="cm"> * hello.c</span>
<span class="cm"> */</span>
 <span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

 <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello_world</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div><ol class="arabic simple" start="6">
<li><p>Ensure that CCSv6 generates the linker command file <strong>AM335x.lds</strong>.</p></li>
</ol>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">MEMORY</span>
<span class="p">{</span>
   <span class="nl">SRAM</span> <span class="p">:</span>     <span class="n">o</span> <span class="o">=</span> <span class="mh">0x402F0400</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x0000FC00</span>  <span class="cm">/* 64kB internal SRAM */</span>
   <span class="nl">L3OCMC0</span> <span class="p">:</span>  <span class="n">o</span> <span class="o">=</span> <span class="mh">0x40300000</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00010000</span>  <span class="cm">/* 64kB L3 OCMC SRAM */</span>
   <span class="nl">M3SHUMEM</span> <span class="p">:</span> <span class="n">o</span> <span class="o">=</span> <span class="mh">0x44D00000</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00004000</span>  <span class="cm">/* 16kB M3 Shared Unified Code Space */</span>
   <span class="nl">M3SHDMEM</span> <span class="p">:</span> <span class="n">o</span> <span class="o">=</span> <span class="mh">0x44D80000</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00002000</span>  <span class="cm">/* 8kB M3 Shared Data Memory */</span>
   <span class="nl">DDR0</span> <span class="p">:</span>     <span class="n">o</span> <span class="o">=</span> <span class="mh">0x80000000</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x40000000</span>  <span class="cm">/* 1GB external DDR Bank 0 */</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>An optional step is to modify the section definition in AM437x.lds file
if you wish to introduce more sections or partition the existing
sections. If you renamed the startup file from startup_ARMCA8.S to
startup_ARMCA9.S in your project, then the linker command file needs to
be updated as well for code section placement: from startup_ARMCA8.o
(.text) to startup_ARMCA9.o (.text)</p>
</div>
<ol class="arabic simple" start="7">
<li><p>Now build the project to generate hello_world.out file.</p></li>
</ol>
<p>8. Launch target configurations using your emulator to connect to AM335X
EVM as described in the <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Getting Started Guide</span></a>.</p>
<p>9. Right click CortexA9 and connect target. The on target functionality
in the GEL will initialize the clocks and DDR.</p>
<p>10. Load and run hello_world_a9.out file. You should see <strong>Hello
World!</strong> string displayed on CCS console window.</p>
<img alt="../_images/Hello_world_a9.jpg" src="../_images/Hello_world_a9.jpg" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the example does not load correctly in the first attempt, reload and
<strong>ensure ARM core starts at main</strong>.</p>
</div>
</div>
<div class="section" id="id49">
<h2>9.9.5. ARM Cortex-A8<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Start CCSv6 and create a work space for generating the project.</p></li>
<li><p>Click on File menu option and select New–&gt; CCS Project.</p></li>
</ol>
<p>3. Select Target as AM33xx -Cortex A8 and appropriate target Board
setting as shown in the image</p>
<p>4. Select <strong>Cortex A8</strong> setting in the options below and provide name of
the project as “hello_world_a8” and use default Advanced settings for
the project. If the Default settings uses “TI ARM compiler 5.x.x” switch
to <strong>GNU Linaro 4.8.4</strong> (or higher) tool chain for A8 and check the
build <strong>little</strong> endian <strong>ELF</strong> binary for the A8 core. Click Finish
after you are done to allow CCS to auto generate the project from the
template <strong>Basic Examples-&gt; Hello World</strong>.</p>
<img alt="../_images/Bare-Metal_A8_templateselect.jpg" src="../_images/Bare-Metal_A8_templateselect.jpg" />
<p>5. The generated CCS project contains source file <strong>hello.c</strong>, ARM
assembly code <strong>startup_ARMCA8.S</strong> and a linker command file
<strong>AM335x.lds</strong>. Ensure the main.c file contains the following code</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span> <span class="cm">/*</span>
<span class="cm"> * hello.c</span>
<span class="cm"> */</span>
 <span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

 <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello_world</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div><ol class="arabic simple" start="6">
<li><p>Ensure that CCSv6 generates the linker command file <strong>AM335x.lds</strong>.</p></li>
</ol>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">MEMORY</span>
<span class="p">{</span>
   <span class="nl">SRAM</span> <span class="p">:</span>     <span class="n">o</span> <span class="o">=</span> <span class="mh">0x402F0400</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x0000FC00</span>  <span class="cm">/* 64kB internal SRAM */</span>
   <span class="nl">L3OCMC0</span> <span class="p">:</span>  <span class="n">o</span> <span class="o">=</span> <span class="mh">0x40300000</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00010000</span>  <span class="cm">/* 64kB L3 OCMC SRAM */</span>
   <span class="nl">M3SHUMEM</span> <span class="p">:</span> <span class="n">o</span> <span class="o">=</span> <span class="mh">0x44D00000</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00004000</span>  <span class="cm">/* 16kB M3 Shared Unified Code Space */</span>
   <span class="nl">M3SHDMEM</span> <span class="p">:</span> <span class="n">o</span> <span class="o">=</span> <span class="mh">0x44D80000</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00002000</span>  <span class="cm">/* 8kB M3 Shared Data Memory */</span>
   <span class="nl">DDR0</span> <span class="p">:</span>     <span class="n">o</span> <span class="o">=</span> <span class="mh">0x80000000</span><span class="p">,</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x40000000</span>  <span class="cm">/* 1GB external DDR Bank 0 */</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>An optional step is to modify the section definition in AM335x.lds file
if you wish to introduce more sections or partition the existing
sections.</p>
</div>
<ol class="arabic simple" start="7">
<li><p>Now build the project to generate hello_world_a8.out file.</p></li>
</ol>
<p>8. Launch target configurations using your emulator to connect to AM335X
EVM as described in the <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Getting Started Guide</span></a>.</p>
<p>9. Right click CortexA8 and select connect target. The on target
functionality in the GEL will initialize the clocks and DDR.</p>
<p>10. Load and run hello_world_a8.out file. You should see <strong>Hello
World!</strong> string displayed on CCS console window.</p>
<img alt="../_images/Hello_world_a8.jpg" src="../_images/Hello_world_a8.jpg" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the example does not load correctly in the first attempt, reload and
<strong>ensure ARM core starts at main</strong>.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id50">
<h2>9.9.6. ARM Cortex-R5<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h2>
<p>In this article, we take a look at creating bare-metal hello world examples for the Cortex-R5 core in CCS. We will be using the AM654x device as an example.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For future Device Support Package releases, the Hello World examples will be added to CCS as an out-of-box experience.</p>
</div>
<p>1. Start CCS and create a workspace for
generating the project.</p>
<p>2. Navigate to File -&gt; New -&gt;
CCS Project.</p>
<p>3. Select Target as AM65x - Cortex R5 and GPEVM_AM65x as
shown in the image below.</p>
<p>4. Select the <strong>Cortex R</strong> tab and provide a name for the project. Select <strong>TI v16.9.4.LTS</strong> (or higher) for the Compiler Version.
Under Tool-chain, set the Device Endianness to <strong>little</strong>, and for the Linker Command file, select <strong>linker_r5.lds</strong> located in the folder (PDK INSTALL PATH)/packages/ti/build/am65xx/.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please refer to the Release Notes for the recommended Compiler version.</p>
</div>
<p>Under Project templates and examples, select <strong>Basic Examples -&gt; Hello World</strong></p>
<p>Click Finish after you are done to allow CCS to auto generate the
project from the template.</p>
<img alt="../_images/AM65x_Create_CCS_Project_R5.png" src="../_images/AM65x_Create_CCS_Project_R5.png" />
<p>5. The generated CCS project contains source file <strong>hello.c</strong>,
and linker command file <strong>linker_r5.lds</strong>.</p>
<p>6. Navigate to CCS Build -&gt; ARM Linker -&gt; File Search Path and
add the following libraries.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ti</span><span class="p">.</span><span class="n">csl</span><span class="p">.</span><span class="n">aer5f</span>
<span class="n">ti</span><span class="p">.</span><span class="n">csl</span><span class="p">.</span><span class="n">init</span><span class="p">.</span><span class="n">aer5f</span>
<span class="n">libc</span><span class="p">.</span><span class="n">a</span>
</pre></div>
</div>
<p>7. Add the following library
search path.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">PDK</span> <span class="n">INSTALL</span> <span class="n">PATH</span><span class="p">)</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">csl</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">am65xx</span><span class="o">/</span><span class="n">r5f</span><span class="o">/</span><span class="n">release</span>
</pre></div>
</div>
<p>8. Save all changes, and right click on the project and select Build Project to
build the project and generate hello_world.out.</p>
<p>9. Launch the target configuration using your emulator to connect to the AM65x EVM as
described in the <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Processor SDK RTOS Getting Started Guide</span></a>.</p>
<p>10. Right click on <strong>DMSC_Cortex_M3_0</strong> and click connect to target.
After connecting to the M3, right click on <strong>MCU_PULSAR_Cortex_R5_0</strong> and connect to it.</p>
<p>11. Load and run hello_world.out example file on the Cortex-R5.
You should see a Hello_world string displayed in the CCS console window.</p>
<img alt="../_images/AM65x_CCS_Hello_World_R5.PNG" src="../_images/AM65x_CCS_Hello_World_R5.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id51">
<h2>9.9.7. ARM Cortex-M4<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Start CCSv6 and create a work space for generating the project.</p></li>
<li><p>Click on File menu option and select New–&gt; CCS Project.</p></li>
</ol>
<p>3. Select Target as AM572x -Cortex M4 and GPEVM_AM572x as shown in the
image</p>
<p>4. Select <strong>Cortex M</strong> setting in the options below and provide name of
the project as “hello_world_m4” and use default Advanced settings for
the project. Click Finish after you are done to allow CCS to auto
generate the project from the template <strong>Basic Examples-&gt; Hello World</strong>.
The Default settings uses “TI ARM compiler 5.x.x” tool chain for cortex
M4 and sets the build for <strong>little</strong> endian <strong>ELF</strong> binary for the M4
core.</p>
<img alt="../_images/Bare-Metal_M4_templateselect.jpg" src="../_images/Bare-Metal_M4_templateselect.jpg" />
<p>5. The generated CCS project contains only one source file <strong>hello.c</strong>.
Ensure the main.c file contains the following code</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span> <span class="cm">/*</span>
<span class="cm"> * hello.c</span>
<span class="cm"> */</span>
 <span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

 <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello_world</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div><p>6. CCSv6 includes a default linker command file(AM57xx_CM4.cmd) for the
M4 (IPU) core which will place code into appropriate device memory. The
linker command file has the following memory sections.</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">MEMORY</span>
<span class="p">{</span>
    <span class="nl">IRAM</span><span class="p">:</span>      <span class="n">o</span> <span class="o">=</span> <span class="mh">0x00000000</span> <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00001000</span>   <span class="cm">/* 4kB internal SRAM */</span>
    <span class="nl">OCMC_RAM1</span><span class="p">:</span> <span class="n">o</span> <span class="o">=</span> <span class="mh">0x40300000</span> <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00080000</span>   <span class="cm">/* 512kB L3 OCMC SRAM1 */</span>
    <span class="nl">OCMC_RAM2</span><span class="p">:</span> <span class="n">o</span> <span class="o">=</span> <span class="mh">0x40400000</span> <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00100000</span>   <span class="cm">/* 1MB L3 OCMC SRAM2 */</span>
    <span class="nl">OCMC_RAM3</span><span class="p">:</span> <span class="n">o</span> <span class="o">=</span> <span class="mh">0x40500000</span> <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00100000</span>   <span class="cm">/* 1MB L3 OCMC SRAM3 */</span>
    <span class="nl">DDR0</span><span class="p">:</span>      <span class="n">o</span> <span class="o">=</span> <span class="mh">0x80000000</span> <span class="n">l</span> <span class="o">=</span> <span class="mh">0x40000000</span>   <span class="cm">/* 1GB external DDR Bank 0 */</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div><p>The linker command file is designed to place code in OCMC memory with
interrupt vectors and .intc_txt generated by the compiler being place in
device internal memory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Please note that if the device GEL files are setting up MMU for the
core then the code will not load correctly on the core and will cause
a CPU exception. We recommend that you modify the linker command file
appropriately to match the MMU settings in the GEL file. The linker
command file in all CCS releases prior to CCS 6.1.3 don`t account for
this MMU Setting in AM57xx GEL files. Please modify the OCMC
addresses to the logical address set in the GEL file</p></li>
<li><p>An optional step is to modify the section definition in
AM57xx_CM4.cmd file if you wish to introduce/partition existing
sections or place the code in different memory section.</p></li>
</ul>
</div>
<ol class="arabic simple" start="7">
<li><p>Now build the project to generate hello_world_m4.out.</p></li>
</ol>
<p>8. Launch target configurations using your emulator to connect to AM572X
EVM as described in the <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Getting Started Guide</span></a></p>
<p>9. In order to wake up the M4 core from A15, Go to Menu option
Scripts-&gt;AM572x_Multicore_Initialization-&gt;IPU1SSClkEnable_API. Refer to
the
<a class="reference external" href="index_how_to_guides.html#connect-to-am57x-slave-cores">Processor_SDK_RTOS_Setup_CCS</a>.</p>
<p>You should see the following log in the Console</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="nl">CortexA15_0</span><span class="p">:</span> <span class="n">GEL</span> <span class="nl">Output</span><span class="p">:</span> <span class="o">---&gt;&gt;&gt;</span> <span class="n">IPU1SS</span> <span class="n">Initialization</span> <span class="n">is</span> <span class="n">in</span> <span class="n">progress</span> <span class="p">...</span> <span class="o">&lt;&lt;&lt;---</span>
<span class="nl">CortexA15_0</span><span class="p">:</span> <span class="n">GEL</span> <span class="nl">Output</span><span class="p">:</span> <span class="o">---&gt;&gt;&gt;</span> <span class="n">IPU1SS</span> <span class="n">Initialization</span> <span class="n">is</span> <span class="n">DONE</span><span class="o">!</span> <span class="o">&lt;&lt;&lt;---</span>
</pre></div>
</div>
<p>11. Select and Connect to Cortex_M4_IPU1_C0. Load and run
Hello_Example_m4.out file. You should see <strong>Hello World</strong> string
displayed on console window.</p>
<img alt="../_images/Hello_world_m4.jpg" src="../_images/Hello_world_m4.jpg" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the example does not load correctly in the first attempt, reload and
<strong>ensure ARM core starts at main</strong>.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id52">
<h2>9.9.8. DSP C66x<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h2>
<p>In this article, we take a look at creating bare-metal hello world
examples for C66x core using pre-built templates in CCS. As a sample we
will use the AM572x device to describe the steps but the same steps can
be used for create hello world examples for C66x cores in the Keystone 2
family of devices.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only major difference C66x examples for AM572x and Keystone 2 is that
the Keystone 2 device contain MSMC memory instead of OCMC memory as the
shared on chip memory.</p>
</div>
<ol class="arabic simple">
<li><p>Start CCSv6 and create a work space for generating the project.</p></li>
<li><p>Click on File menu option and select New–&gt; CCS Project.</p></li>
<li><p>Select Target as AM572x -C66xx and GPEVM_AM572x as shown in the image</p></li>
</ol>
<p>4. Select <strong>C66XX [C6000]</strong> DSP setting in the options below and provide
name of the project as “hello_world_dsp” and use default Advanced
settings for the project. Click Finish after you are done to allow CCS
to auto generate the project from the template <strong>Basic Examples-&gt; Hello
World</strong>. The Default settings uses “TI CG Tools compiler 8.x.x” tool
chain for C66x and sets the build for <strong>little</strong> endian <strong>ELF</strong> binary
for the C66x core.</p>
<img alt="../_images/Bare-Metal_C66x_templateselect.jpg" src="../_images/Bare-Metal_C66x_templateselect.jpg" />
<p>5. The generated CCS project contains only one source file <strong>hello.c</strong>.
Ensure the main.c file contains the following code</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span> <span class="cm">/*</span>
<span class="cm"> * hello.c</span>
<span class="cm"> */</span>
 <span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

 <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello_world</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div><p>6. CCSv6 includes a default linker command file(AM57xx_C66.cmd) for the
C66x DSP core which will place code into appropriate device memory. The
linker command file has the following memory sections.</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">MEMORY</span>
<span class="p">{</span>
    <span class="nl">IRAM_MEM</span><span class="p">:</span>  <span class="n">o</span> <span class="o">=</span> <span class="mh">0x00800000</span> <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00008000</span>   <span class="cm">/* 32kB internal SRAM */</span>
    <span class="nl">OCMC_RAM1</span><span class="p">:</span> <span class="n">o</span> <span class="o">=</span> <span class="mh">0x40300000</span> <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00080000</span>   <span class="cm">/* 512kB L3 OCMC SRAM1 */</span>
    <span class="nl">OCMC_RAM2</span><span class="p">:</span> <span class="n">o</span> <span class="o">=</span> <span class="mh">0x40400000</span> <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00100000</span>   <span class="cm">/* 1MB L3 OCMC SRAM2 */</span>
    <span class="nl">OCMC_RAM3</span><span class="p">:</span> <span class="n">o</span> <span class="o">=</span> <span class="mh">0x40500000</span> <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00100000</span>   <span class="cm">/* 1MB L3 OCMC SRAM3 */</span>
    <span class="nl">DDR0</span><span class="p">:</span>      <span class="n">o</span> <span class="o">=</span> <span class="mh">0x80000000</span> <span class="n">l</span> <span class="o">=</span> <span class="mh">0x40000000</span>   <span class="cm">/* 1GB external DDR Bank 0 */</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div><p>The linker command file is designed to place code in OCMC memory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Keystone 2 devices, replace all the OCMC_RAM# regions in the lds
file and replace it with MSMC memory section as shown below.</p>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="nl">MSMC</span>  <span class="p">:</span>      <span class="n">o</span><span class="o">=</span><span class="mh">0x0c000000</span><span class="p">,</span>    <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00600000</span>  <span class="cm">/* 6MB Muticore shared memory */</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An optional step is to modify the section definition in linker command
file if you wish to introduce/partition existing sections or place the
code in different memory section.</p>
</div>
<ol class="arabic simple" start="7">
<li><p>Now build the project to generate hello_world_dsp.out.</p></li>
</ol>
<p>8. Launch target configurations using your emulator to connect to AM572X
EVM as described in the <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Getting Started Guide</span></a></p>
<p>9. In order to wake up the DSP1 core from A15, Go to Menu option
Scripts-&gt;AM572x_Multicore_Initialization-&gt;DSP1SSClkEnable_API. Refer to
the
<a class="reference external" href="index_how_to_guides.html#connect-to-am57x-slave-cores">Processor_SDK_RTOS_Setup_CCS</a>.</p>
<p>You should see the following log in the Console</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="nl">CortexA15_0</span><span class="p">:</span> <span class="n">GEL</span> <span class="nl">Output</span><span class="p">:</span> <span class="o">---&gt;&gt;&gt;</span> <span class="n">DSP1SS</span> <span class="n">Initialization</span> <span class="n">is</span> <span class="n">in</span> <span class="n">progress</span> <span class="p">...</span> <span class="o">&lt;&lt;&lt;---</span>
<span class="nl">CortexA15_0</span><span class="p">:</span> <span class="n">GEL</span> <span class="nl">Output</span><span class="p">:</span> <span class="nl">DEBUG</span><span class="p">:</span> <span class="n">Clock</span> <span class="n">is</span> <span class="n">active</span> <span class="p">...</span>
<span class="nl">CortexA15_0</span><span class="p">:</span> <span class="n">GEL</span> <span class="nl">Output</span><span class="p">:</span> <span class="nl">DEBUG</span><span class="p">:</span> <span class="n">Checking</span> <span class="k">for</span> <span class="n">data</span> <span class="n">integrity</span> <span class="n">in</span> <span class="n">DSPSS</span> <span class="n">L2RAM</span> <span class="p">...</span>
<span class="nl">CortexA15_0</span><span class="p">:</span> <span class="n">GEL</span> <span class="nl">Output</span><span class="p">:</span> <span class="nl">DEBUG</span><span class="p">:</span> <span class="n">Data</span> <span class="n">integrity</span> <span class="n">check</span> <span class="n">in</span> <span class="n">GEM</span> <span class="n">L2RAM</span> <span class="n">is</span> <span class="n">sucessful</span><span class="o">!</span>
<span class="nl">CortexA15_0</span><span class="p">:</span> <span class="n">GEL</span> <span class="nl">Output</span><span class="p">:</span> <span class="o">---&gt;&gt;&gt;</span> <span class="n">DSP1SS</span> <span class="n">Initialization</span> <span class="n">is</span> <span class="n">DONE</span><span class="o">!</span> <span class="o">&lt;&lt;&lt;---</span>
</pre></div>
</div>
<p>10. Select and Connect to C66x_DSP1. Load and run hello_world_dsp.out
file. You should see <strong>Hello World</strong> string displayed on console window.</p>
<img alt="../_images/Hello_world_dsp.jpg" src="../_images/Hello_world_dsp.jpg" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id53">
<h2>9.9.9. DSP C674x<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h2>
<p>In this article, we take a look at creating bare-metal hello world
examples for C674x core using pre-built templates in CCS. As a sample we
will use the C6748 LCDK device to describe the steps but the same steps
can be used for create hello world examples for C674x cores in the
OMAPL13x/C647x/DA8x family of devices.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All the C674x DSP cores on in OMAPL13x/C674x/DA8x have the same memory
map so modification are limited to selecting the correct platform when
generating the project</p>
</div>
<ol class="arabic simple">
<li><p>Start CCS and create a work space for generating the project.</p></li>
<li><p>Click on File menu option and select New–&gt; CCS Project.</p></li>
<li><p>Select Target as OMAPLx -C674xx and LCDK674x as shown in the image</p></li>
</ol>
<p>4. Select <strong>C67XX [C6000]</strong> DSP setting in the options below and provide
name of the project as “hello_world_lcdk674x” and use default Advanced
settings for the project. Click Finish after you are done to allow CCS
to auto generate the project from the template <strong>Basic Examples-&gt; Hello
World</strong>. The Default settings uses “TI CG Tools compiler 8.x.x” tool
chain for C674x and sets the build for <strong>little</strong> endian <strong>ELF</strong> binary
for the C674x core.</p>
<img alt="../_images/Baremetal_helloWorld_ProjectCreate_step1.png" src="../_images/Baremetal_helloWorld_ProjectCreate_step1.png" />
<p>5. The generated CCS project contains only one source file <strong>hello.c</strong>.
Ensure the main.c file contains the following code</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span> <span class="cm">/*</span>
<span class="cm"> * hello.c</span>
<span class="cm"> */</span>
 <span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

 <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello_world</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div><p>6. CCS includes a default linker command file(C6748.cmd) for the C674x
DSP core which will place code into appropriate device memory. The
linker command file has the following memory sections.</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="c source-c"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">MEMORY</span>
<span class="p">{</span>
    <span class="n">DSPL2ROM</span>     <span class="n">o</span> <span class="o">=</span> <span class="mh">0x00700000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00100000</span>   <span class="cm">/* 1MB L2 Internal ROM */</span>
    <span class="n">DSPL2RAM</span>     <span class="n">o</span> <span class="o">=</span> <span class="mh">0x00800000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00040000</span>   <span class="cm">/* 256kB L2 Internal RAM */</span>
    <span class="n">DSPL1PRAM</span>    <span class="n">o</span> <span class="o">=</span> <span class="mh">0x00E00000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00008000</span>   <span class="cm">/* 32kB L1 Internal Program RAM */</span>
    <span class="n">DSPL1DRAM</span>    <span class="n">o</span> <span class="o">=</span> <span class="mh">0x00F00000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00008000</span>   <span class="cm">/* 32kB L1 Internal Data RAM */</span>
    <span class="n">SHDSPL2ROM</span>   <span class="n">o</span> <span class="o">=</span> <span class="mh">0x11700000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00100000</span>   <span class="cm">/* 1MB L2 Shared Internal ROM */</span>
    <span class="n">SHDSPL2RAM</span>   <span class="n">o</span> <span class="o">=</span> <span class="mh">0x11800000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00040000</span>   <span class="cm">/* 256kB L2 Shared Internal RAM */</span>
    <span class="n">SHDSPL1PRAM</span>  <span class="n">o</span> <span class="o">=</span> <span class="mh">0x11E00000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00008000</span>   <span class="cm">/* 32kB L1 Shared Internal Program RAM */</span>
    <span class="n">SHDSPL1DRAM</span>  <span class="n">o</span> <span class="o">=</span> <span class="mh">0x11F00000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00008000</span>   <span class="cm">/* 32kB L1 Shared Internal Data RAM */</span>
    <span class="n">EMIFACS0</span>     <span class="n">o</span> <span class="o">=</span> <span class="mh">0x40000000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x20000000</span>   <span class="cm">/* 512MB SDRAM Data (CS0) */</span>
    <span class="n">EMIFACS2</span>     <span class="n">o</span> <span class="o">=</span> <span class="mh">0x60000000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x02000000</span>   <span class="cm">/* 32MB Async Data (CS2) */</span>
    <span class="n">EMIFACS3</span>     <span class="n">o</span> <span class="o">=</span> <span class="mh">0x62000000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x02000000</span>   <span class="cm">/* 32MB Async Data (CS3) */</span>
    <span class="n">EMIFACS4</span>     <span class="n">o</span> <span class="o">=</span> <span class="mh">0x64000000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x02000000</span>   <span class="cm">/* 32MB Async Data (CS4) */</span>
    <span class="n">EMIFACS5</span>     <span class="n">o</span> <span class="o">=</span> <span class="mh">0x66000000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x02000000</span>   <span class="cm">/* 32MB Async Data (CS5) */</span>
    <span class="n">SHRAM</span>        <span class="n">o</span> <span class="o">=</span> <span class="mh">0x80000000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x00020000</span>   <span class="cm">/* 128kB Shared RAM */</span>
    <span class="n">DDR2</span>         <span class="n">o</span> <span class="o">=</span> <span class="mh">0xC0000000</span>  <span class="n">l</span> <span class="o">=</span> <span class="mh">0x20000000</span>   <span class="cm">/* 512MB DDR2 Data */</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div><p>The linker command file is designed to place code in OCMC memory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For OMAPL13x/C674x devices, the linker command file places code in the
SHRAM memory section as shown below.</p>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span> <span class="n">SECTIONS</span>
<span class="p">{</span>
 <span class="p">.</span><span class="n">text</span>          <span class="o">&gt;</span>  <span class="n">SHRAM</span>
 <span class="p">.</span><span class="n">stack</span>         <span class="o">&gt;</span>  <span class="n">SHRAM</span>
 <span class="p">.</span><span class="n">bss</span>           <span class="o">&gt;</span>  <span class="n">SHRAM</span>
  <span class="p">.......</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An optional step is to modify the section definition in linker command
file if you wish to introduce/partition existing sections or place the
code in different memory section.</p>
</div>
<p>7. Now build the project by right clicking on the Project and selecting
“Build Project” to generate hello_world_lcdk674x.out.</p>
<p>8. Launch target configurations using your emulator to connect to
OMAPLx/C674x LCDK as described in the <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Getting Started Guide</span></a>.</p>
<p>9. Developers on OMAPL137/C6747/C6748 can
connect directly to the DSP. For OMAPL138 device, you will need to
connect to the ARM as this is ARM master boot device and ARM needs to
power up the DSP. You should see the following log in the console.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>   <span class="n">Target</span> <span class="n">Connected</span><span class="p">.</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="o">---------------------------------------------</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">Memory</span> <span class="n">Map</span> <span class="n">Cleared</span><span class="p">.</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="o">---------------------------------------------</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">Memory</span> <span class="n">Map</span> <span class="n">Setup</span> <span class="n">Complete</span><span class="p">.</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="o">---------------------------------------------</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">PSC</span> <span class="n">Enable</span> <span class="n">Complete</span><span class="p">.</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="o">---------------------------------------------</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">PLL0</span> <span class="n">init</span> <span class="n">done</span> <span class="k">for</span> <span class="nl">Core</span><span class="p">:</span><span class="mi">300</span><span class="n">MHz</span><span class="p">,</span> <span class="nl">EMIFA</span><span class="p">:</span><span class="mi">25</span><span class="n">MHz</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">DDR</span> <span class="n">initialization</span> <span class="n">is</span> <span class="n">in</span> <span class="n">progress</span><span class="p">....</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">PLL1</span> <span class="n">init</span> <span class="n">done</span> <span class="k">for</span> <span class="nl">DDR</span><span class="p">:</span><span class="mi">150</span><span class="n">MHz</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">Using</span> <span class="n">DDR2</span> <span class="n">settings</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="n">DDR2</span> <span class="n">init</span> <span class="k">for</span> <span class="mi">150</span> <span class="n">MHz</span> <span class="n">is</span> <span class="n">done</span>
<span class="nl">C674X_0</span><span class="p">:</span> <span class="nl">Output</span><span class="p">:</span>    <span class="o">---------------------------------------------</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>11. Select and Connect to C674x. Load and run hello_world_dsp.out file.
You should see <strong>Hello World</strong> string displayed on console window.</p>
<img alt="../_images/Hello_world_dsp674x.png" src="../_images/Hello_world_dsp674x.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="gravity-simulator-demo">
<h1>9.10. Gravity Simulator Demo<a class="headerlink" href="#gravity-simulator-demo" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id54">
<h2>9.10.1. Overview<a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h2>
<p>This demo showcases a simple video display with Processor SDK RTOS. This
demo uses Gravit, a GPL-licensed open-sourced library, to simulate
gravity of particles in space.</p>
</div>
<div class="section" id="version-details">
<h2>9.10.2. Version Details<a class="headerlink" href="#version-details" title="Permalink to this headline">¶</a></h2>
<p>Latest version: 1.0.0</p>
<p>Supported platforms: idkAM572x</p>
<p>Available in: Processor SDK RTOS 4.0.0.4</p>
</div>
<div class="section" id="id55">
<h2>9.10.3. Components Used<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h2>
<p>Open Sourced Libraries:</p>
<ul class="simple">
<li><p>Gravit</p></li>
</ul>
<p>RTOS Components:</p>
<ul class="simple">
<li><p>SYSBIOS</p></li>
<li><p>XDC</p></li>
</ul>
<p>Processor SDK RTOS Drivers:</p>
<ul class="simple">
<li><p>VPS</p></li>
<li><p>PM</p></li>
<li><p>I2C</p></li>
<li><p>UART</p></li>
<li><p>Board</p></li>
<li><p>OSAL</p></li>
<li><p>CSL</p></li>
</ul>
</div>
<div class="section" id="building-the-demo">
<h2>9.10.4. Building the Demo<a class="headerlink" href="#building-the-demo" title="Permalink to this headline">¶</a></h2>
<p>The demo is available pre-built for Processor SDK RTOS version 4.0.0.4
or higher. You must first set up your development environment. Refer to
the <a class="reference external" href="index_overview.html#building-the-sdk">Processor SDK RTOS Building</a> page for
information on setting up your build environment.</p>
<p>The following are steps to clean the demo:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">gravit</span>
<span class="n">make</span> <span class="n">clean</span> <span class="n">BOARD</span><span class="o">=</span><span class="n">idkAM572x</span>
</pre></div>
</div>
<p>The following are steps to compile the demo:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">gravit</span>
<span class="n">make</span> <span class="n">BOARD</span><span class="o">=</span><span class="n">idkAM572x</span>
</pre></div>
</div>
</div>
<div class="section" id="running-the-demo">
<h2>9.10.5. Running the Demo<a class="headerlink" href="#running-the-demo" title="Permalink to this headline">¶</a></h2>
<p>You will need the following:</p>
<ol class="arabic simple">
<li><p>Code Composer Studio to load and run the demo. Refer to <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Processor
SDK RTOS Getting Started Guide</span></a> for
installing CCS.</p></li>
<li><p>idkAM572x board with attached LCD screen</p></li>
<li><p>USB cable for JTAG and serial terminal (micro USB port)</p></li>
</ol>
<p>To load and run the demo:</p>
<ol class="arabic simple">
<li><p>Connect the USB cable from your computer to the idkAM572x’s JTAG port</p></li>
<li><p>Power on the idkAM572x board. Ensure that no boot mode is entered (do
not have SD card loaded or QSPI flashed)</p></li>
<li><p>Open up a serial terminal for UART communication (Refer to <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Processor
SDK RTOS Getting Started Guide</span></a>, setup
EVM hardware)</p></li>
<li><p>Open CCS and launch target config file for idkAM572x (Refer to
<a class="reference external" href="index_how_to_guides.html#setup-ccs-for-evm-and-processor-sdk-rtos">Processor SDK RTOS Setup CCS</a> for setting up CCS)</p></li>
<li><p>Connect to CortexA15_0</p></li>
<li><p>Load and launch the demo executable:</p></li>
</ol>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">gravit</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">idkAM572x</span><span class="o">/</span><span class="n">gravit_a15_0_release</span><span class="p">.</span><span class="n">xa15fg</span>
</pre></div>
</div>
</div>
<div class="section" id="terminal-screenshot">
<h2>9.10.6. Terminal Screenshot<a class="headerlink" href="#terminal-screenshot" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>When launched, you will be prompt for number of particles to
simulate. Enter a value up to 1000.</p></li>
<li><p>Use w-a-s-d for display rotation</p></li>
<li><p>Use i-j-k-l for display translation</p></li>
<li><p>Press Esc to end current simulation and display accumulated
statistics</p></li>
<li><p>Frames per second (FPS) and floating point operations per second
(FLOPS) are displayed on the terminal</p></li>
</ul>
<p>Below is a screenshot of the terminal after one simulation:</p>
<img alt="../_images/Gravit-screenshot_version_01_00_00.png" src="../_images/Gravit-screenshot_version_01_00_00.png" />
</div>
<div class="section" id="display-output">
<h2>9.10.7. Display Output<a class="headerlink" href="#display-output" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Particles are set to rotate around a gravity center positioned at the
center of the LCD screen</p></li>
<li><p>Particles are represented with 3D coordinates, projected to a 2D LCD
screen. The projection is simplified such that the camera (or the
viewer) does not change display angles.</p></li>
</ul>
<p>Below is an example display of a 500-particle simulation:</p>
<img alt="../_images/Gravit-displayshot_version_01_00_00.jpg" src="../_images/Gravit-displayshot_version_01_00_00.jpg" />
</div>
<div class="section" id="useful-references">
<h2>9.10.8. Useful References<a class="headerlink" href="#useful-references" title="Permalink to this headline">¶</a></h2>
<p>Main Gravit website: <a class="reference external" href="https://gravit.slowchop.com/">https://gravit.slowchop.com/</a></p>
<p>Gravit github: <a class="reference external" href="https://github.com/gak/gravit">https://github.com/gak/gravit</a></p>
<p>Physics algorithm behind gravit, Barnes-hut:
<a class="reference external" href="https://en.wikipedia.org/wiki/Barnes%E2%80%93Hut_simulation">https://en.wikipedia.org/wiki/Barnes-Hut_simulation</a></p>
<p>Bresenham’s line algorithm:
<a class="reference external" href="https://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm">https://en.wikipedia.org/wiki/Bresenham’s_line_algorithm</a></p>
</div>
</div>
<div class="section" id="jailhouse-hypervisor">
<h1>9.11. Jailhouse Hypervisor<a class="headerlink" href="#jailhouse-hypervisor" title="Permalink to this headline">¶</a></h1>
<p class="rubric" id="id56">Overview</p>
<p>Jailhouse is a static partitioning hypervisor that runs bare metal
binaries. It cooperates closely with Linux. Jailhouse doesn’t emulate
resources that don’t exist. It just splits existing hardware resources
into isolated compartments called “cells” that are wholly dedicated to
guest software programs called “inmates”. One of these cells runs the
Linux OS and is known as the “root cell”. Other cells borrow CPUs and
devices from the root cell as they are created.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../_images/Jailhouse.png" src="../_images/Jailhouse.png" />
<p><a href="#id57"><span class="problematic" id="id58">*</span></a>The picture above shows the jailhouse on a system a) before the
jailhouse is enabled; b) after the jailhouse is enabled; c) after a cell
is created.
*</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Jailhouse consists of three parts: kernel module, hypervisor firmware
and tools, which a user uses to enable the hypervisor, create a cell,
load inmate binary, run and stop it. Jailhouse is an example of
Asynchronous Multiprocessing (AMP) architecture. When we boot Linux on
AM57XX-EVM, which has 2 ARM cores, Linux uses the both cores. After we
enable hypervisor it moves Linux to the root-cell. The root cell still
uses the both ARM cores. When we create a new cell, hypervisor calls
cpu_down() for the ARM1 core, leaving for Linux ARM0 only. The new cell
will use the ARM1 core and hardware resources dedicated for this cell in
the cell configuration file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Jailhouse is an open source project, which can be found on
<a class="reference external" href="https://github.com/siemens/jailhouse">https://github.com/siemens/jailhouse</a>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="demo">Demo</p>
<div class="line-block">
<div class="line">Processor Linux SDK delivers Jailhouse’s prebuilt binaries. You may
try it immediately after installation. This section assumes that you
have already installed PLSDK, and have Linux booted on the AM572X-EVM
or AM572x-IDK.</div>
</div>
<div class="line-block">
<div class="line"><strong>NOTE:</strong> <em>to use Jailhouse hypervisor</em></div>
</div>
<div class="line-block">
<div class="line"><em>1) set u-boot environment variable optargs</em>: setenv optargs
vmalloc=512M</div>
</div>
<p><em>2) use **am572x-evm-jailhouse.dtb*</em> for AM572x-EVM
or <strong>am572x-idk-jailhouse.dtb</strong> for AM572x-IDK
*</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="pre-built-components">Pre-built components</p>
<div class="line-block">
<div class="line">As it was mentioned in the previous section, Jailhouse consists of
following components, which are prebuilt and copied to the target
filesystem:</div>
</div>
<ol class="arabic simple">
<li><p>jailhouse.ko kernel module located at
/lib/modules/4.9.28-&lt;gitid&gt;/extra/driver directory;</p></li>
<li><p>jailhouse.bin - hypervisor itself located at /lib/firmware directory;</p></li>
<li><p>Jailhouse management tools are located at
/usr/local/libexec/jailhouse and /usr/sbin directories;</p></li>
</ol>
<p>In order to create the root-cell and an inmate cell we need to provide
cell configuration files. Those configuration files and example binaries
are located at /usr/share/jailhouse/examples directory:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:/usr/share/jailhouse/examples# ls -1
am572x-rtos-icss.cell
am572x-rtos-pruss.cell
am57xx-evm-ti-app.cell
am57xx-evm.cell
am57xx-pdk-leddiag.cell
icss_emac.bin
led_test.bin
linux-loader.bin
pruss.bin
ti-app.bin
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><p><strong>am57xx-evm.cell</strong> - root cell configuration file;</p></li>
<li><p><strong>ti-app.bin</strong> and <strong>am57xx-evm-ti-app.cell</strong> - bare metal inmate and
its cell configuration;</p></li>
<li><p><strong>led_test.bin</strong> and <strong>am57xx-pdk-leddiag.cell</strong> - PDK led_test
inmate example and its cell configuration (led_test.bin can be run on
AM572x-EVM only);</p></li>
<li><p><strong>pruss.bin</strong> and <strong>am572x-rtos-pruss.cell</strong> - TI-RTOS PRUSS inmate
examples and its cell configuration (pruss.bin can be run on
AM572x-IDK only);</p></li>
<li><p><strong>icss_emac.bin</strong> and <strong>am572x-rtos-icss.cell</strong> - TI-RTOS ICSS-EMAC
inmate example and its cell configuration (icss_emac.bin can be run
on AM572x-IDK only);</p></li>
<li><p><strong>linux-loader.bin</strong> - loader required to run inmates, which start
address is not 0x0;</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="running-the-demo-on-am572x-evm">Running the Demo on AM572x-EVM</p>
<p class="rubric" id="running-bare-metal-ti-app-bin">Running bare-metal ti-app.bin</p>
<p>Here are the steps to run the demo:</p>
<ul class="simple">
<li><p>Boot the Linux</p></li>
<li><p>Insert jailhouse.ko kernel module</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# modprobe jailhouse
</pre></div>
</div>
<ul class="simple">
<li><p>Enable the hypervisor using am57xx-evm.cell root-cell configuration
file</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# jailhouse enable /usr/share/jailhouse/examples/am57xx-evm.cell
Initializing Jailhouse hypervisor v0.6 on CPU 1
Code location: 0xf0000030
Page pool usage after early setup: mem 30/4073, remap 32/131072
Initializing processors:
 CPU 1... OK
 CPU 0... OK
Page pool usage after late setup: mem 39/4073, remap 38/131072
Activating hypervisor
[ 4155.880217] The Jailhouse is opening.
</pre></div>
</div>
<ul class="simple">
<li><p>Create a cell for the inmate</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# jailhouse cell create /usr/share/jailhouse/examples/am57xx-evm-ti-app.cell
[ 5270.449687] CPU1: shutdown
[ 5270.453221] NOHZ: local_softirq_pending 20
Created cell &quot;AM57XX-EVM-timer8-demo&quot;
Page pool usage after cell creation: mem 51/4073, remap 38/131072
[ 5270.487970] Created Jailhouse cell &quot;AM57XX-EVM-timer8-demo&quot;
</pre></div>
</div>
<ul class="simple">
<li><p>Load the ti-app.bin inmate binary</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# jailhouse cell load 1 /usr/share/jailhouse/examples/ti-app.bin
Cell &quot;AM57XX-EVM-timer8-demo&quot; can be loaded
</pre></div>
</div>
<ul class="simple">
<li><p>Start the binary</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# jailhouse cell start 1
Hey, I&#39;m working !!!!!!!!!!!
timer id 4fff2b01
timer value fffffc17; irq status 00000002; raw 00000002
min 00000017; avr 0000001b; max 000002c1
min 00000017; avr 0000001b; max 000000f3
min 00000017; avr 0000001b; max 000002c8
min 00000017; avr 0000001b; max 00000148
min 00000017; avr 0000001b; max 000002d4
min 00000017; avr 0000001b; max 00000158
</pre></div>
</div>
<p><strong>NOTE</strong>: <em>becase all of the components: root-cell, hypervisor and demo
inmate use the same UART, there is a conflict. Once the inmate started
to use the UART, Linux stops getting any input from console. To
workaround this and continue to control the hypervisor, you may telnet
to the EVM and issue all commands from the telnet shell. Hypervisor
still will use Linux console to print it sdebug messages</em></p>
<ul class="simple">
<li><p>Stop the binary</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# jailhouse cell shutdown 1
</pre></div>
</div>
<p><strong>NOTE</strong>: <em>You may restore Linux console by killing the “/bin/login –”
process from telnet session.</em></p>
<ul class="simple">
<li><p>destroy cell</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# jailhouse cell destroy 1
Closing cell &quot;AM57XX-EVM-timer8-demo&quot;
Page pool usage after cell destruction: mem 39/4073, remap 38/131072
[ 6201.111168] Destroyed Jailhouse cell &quot;AM57XX-EVM-timer8-demo&quot;
</pre></div>
</div>
<ul class="simple">
<li><p>disable hypervisor</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# jailhouse disable
Shutting down hypervisor
 Releasing CPU 0
 Releasing CPU 1
[ 6248.149728] The Jailhouse was closed.
</pre></div>
</div>
<p><strong>NOTES</strong>:</p>
<p>You may shutdown and start the same binary multiple times. Every time
you start the binary, it starts from the beginning.</p>
<p>If you have different binaries which use the same cell resources, you
may reuse the created cell to run them. You need just shutdown the cell,
load another binary and start it. If you need to run different binaries
that requires different resources, you need to shutdown the running
cell, destroy it, create a new one with required resources, load a new
binary and start it.</p>
<p class="rubric" id="running-pdk-led-test-bin-example">Running PDK led_test.bin example</p>
<p>After you enable hyprevisor, create a pdk cell</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# jailhouse cell create /usr/share/jailhouse/examples/am57xx-pdk-leddiag.cell
[  312.419978] CPU1: shutdown
Created cell &quot;AM57XX-EVM-PDK-LED&quot;
Page pool usage after cell creation: mem 54/4075, remap 38/131072
[  312.470723] Created Jailhouse cell &quot;AM57XX-EVM-PDK-LED&quot;
root@am57xx-evm:~#
</pre></div>
</div>
<div class="line-block">
<div class="line">load the led_test.bin binary</div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# jailhouse cell load 1 /usr/share/jailhouse/examples/led_test.bin
Cell &quot;AM57XX-EVM-PDK-LED&quot; can be loaded
</pre></div>
</div>
<p>and start it</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:~# jailhouse cell start 1
Started cell &quot;AM57XX-EVM-PDK-LED&quot;
root@am57xx-e
*********************************************
*                 LED Test                  *
*********************************************

Testing LED
Blinking LEDs...
Press &#39;y&#39; to verify pass, &#39;r&#39; to blink again,
or any other character to indicate failure: r

Blinking again
Press &#39;y&#39; to verify pass, &#39;r&#39; to blink again,
or any other character to indicate failure: y
Received: y

Test PASSED!
</pre></div>
</div>
<p>You may see blinking leds, press “r” to repeat the test.</p>
<div class="line-block">
<div class="line"><strong>NOTE:</strong></div>
<div class="line">This example just demonstrates hypervisor’s ability to run binaries
that were built outside of jailhouse source tree. This and other RTOS
examples were ported for this purpose. Look to RTOS SDK documentation
for description of the examples functionality.</div>
</div>
<p class="rubric" id="running-the-demo-on-am572x-idk">Running the Demo on AM572x-IDK</p>
<p>Two TI-RTOS example applications were ported for Jailhouse hypervisor:
pruss.bin and icss_emac.bin. In contrast to led_test.bin, which has its
own startup code, linker script and was linked to start from address
0x0, the pruss.bin and icss_emac.bin used the TI-RTOS building
infrustructure as much as possible. Therefore they are linked to EVM’s
DDR address space (starting from 0x80000000 ) and their entry points are
not 0x0. To support loading and running such applicaiton a special
command shell be used.</p>
<p>To run the pruss.bin applicaton enable the hypervisor the same way as
for other examples.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>cd /usr/share/jailhouse/examples/
root@am57xx-evm:/usr/share/jailhouse/examples# modprobe jailhouse
root@am57xx-evm:/usr/share/jailhouse/examples# jailhouse enable ./am57xx-evm.cell

Initializing Jailhouse hypervisor  on CPU 0
Code location: 0xf0000030
Page pool usage after early setup: mem 30/4075, remap 32/131072
Initializing processors:
 CPU 0... OK
 CPU 1... OK
Page pool usage after late setup: mem 39/4075, remap 38/131072
Activating hypervisor
[  710.008555] The Jailhouse is opening.
</pre></div>
</div>
<p>Create a cell for pruss.bin</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:/usr/share/jailhouse/examples# jailhouse cell create ./am572x-rtos-pruss.cell
[  745.067783] CPU1: shutdown
Created cell &quot;AM572X-IDK-PRUSS&quot;
Page pool usage after cell creation: mem 54/4075, remap 38/131072
[  745.107324] Created Jailhouse cell &quot;AM572X-IDK-PRUSS&quot;
root@am57xx-evm:/usr/share/jailhouse/examples#
</pre></div>
</div>
<p>Use cell load command to load several required components:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:/usr/share/jailhouse/examples# jailhouse cell load 1 linux-loader.bin -a 0 -s &quot;kernel=0x80005128&quot; -a 0x100 pruss.bin -a 0x80000000
Cell &quot;AM572X-IDK-PRUSS&quot; can be loaded
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><p>linux-loader.bin is a small application provided and built by
jailhouse source tree. As you can see (-a 0) it is loaded to virtual
address 0x0;</p></li>
<li><p>“-s “kernel=0x80005128” -a 0x100” - is the linux_loader argument
loaded as string to virtual address 0x100, which instructs the
linux-loader to branch to the pruss.bin 0x80005128 entry point;</p></li>
<li><p>pruss.bin itself, loaded to the virtual address 0x80000000 - the
address where this application is lined to;</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">After loading run the inmate as usual:</div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>root@am57xx-evm:/usr/share/jailhouse/examples# jailhouse cell start 1
Started cell &quot;AM572X-IDK-PRUSS&quot;
root@am57xx-evm:/usr/share/jailhouse/examples# passed verify constant tbl entry for instance 1: pruNum: 0
eventwait: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 1 , pru num: 0
eventwait: got the INTC event from PRU, count: 1
eventwait: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 1 , pru num: 0
eventwait: got the INTC event from PRU, count: 2
eventwait: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 1 , pru num: 0
eventwait: got the INTC event from PRU, count: 3
eventwait: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 1 , pru num: 0
eventwait: got the INTC event from PRU, count: 4
eventwait: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 1 , pru num: 0
eventwait: got the INTC event from PRU, count: 5
eventwait: waiting for the INTC event from PRU
Testing for instance: 1, pru num: 0 is complete
passed verify constant tbl entry for instance 1: pruNum: 1
sending the INTC event to the PRU for instance: 1 , pru num: 1
eventwait: got the INTC event from PRU, count: 1
eventwait: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 1 , pru num: 1
eventwait: got the INTC event from PRU, count: 2
eventwait: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 1 , pru num: 1
eventwait: got the INTC event from PRU, count: 3
eventwait: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 1 , pru num: 1
eventwait: got the INTC event from PRU, count: 4
eventwait: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 1 , pru num: 1
eventwait: got the INTC event from PRU, count: 5
Testing for instance: 1, pru num: 1 is complete
passed verify constant tbl entry for instance 2: pruNum: 0
eventwait2: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 2 , pru num: 0
eventwait2: got the INTC event from PRU, count: 1
eventwait2: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 2 , pru num: 0
eventwait2: got the INTC event from PRU, count: 2
eventwait2: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 2 , pru num: 0
eventwait2: got the INTC event from PRU, count: 3
eventwait2: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 2 , pru num: 0
eventwait2: got the INTC event from PRU, count: 4
eventwait2: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 2 , pru num: 0
eventwait2: got the INTC event from PRU, count: 5
eventwait2: waiting for the INTC event from PRU
Testing for instance: 2, pru num: 0 is complete
passed verify constant tbl entry for instance 2: pruNum: 1
sending the INTC event to the PRU for instance: 2 , pru num: 1
eventwait2: got the INTC event from PRU, count: 1
eventwait2: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 2 , pru num: 1
eventwait2: got the INTC event from PRU, count: 2
eventwait2: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 2 , pru num: 1
eventwait2: got the INTC event from PRU, count: 3
eventwait2: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 2 , pru num: 1
eventwait2: got the INTC event from PRU, count: 4
eventwait2: waiting for the INTC event from PRU
sending the INTC event to the PRU for instance: 2 , pru num: 1
eventwait2: got the INTC event from PRU, count: 5
Testing for instance: 2, pru num: 1 is complete
All tests have passed
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">You may run the <strong>icss_emac.bin</strong> in similar way using appropriate
cell configuration. <strong>Note that icss_emac has different entry point -
0x80000000</strong>.</div>
</div>
<p class="rubric" id="jailhouse-performance-on-am5728">Jailhouse Performance on AM5728</p>
<p>To verify the real-time performance of Jailhouse Sitara AM5728 was setup
to run Linux on one of the ARM Cortex A15 cores, and a TI-RTOS inmate on
the other A15 core. A test was run to measure interrupt latency. Poll
mode driver based application performance of an inmate should be
identical to a system without virtualizationion in a static partitioning
system like Jailhouse. Anything interrupt based is required to share the
interrupt controller (GIC) which will introduce some interference from
Linux to the real-time application. The measurements shown below over a
million interrupts clearly shows the interference, and captures the
upper bound at 8.8us. For the first run of interrupt latency test an
unloaded Linux running on core 0 is in the first column. In the second
column Linux on core 0 is running STREAM. STREAM is an external memory
access benchmark that fully utilizes the number of outstanding reads and
writes to memory. It is scalable from individual processors to clusters
supercomputers, here it is used at the processor level. It was chosen as
representative of a worst case memory access behaviour of a Linux based
application on a Cortex A15, essentially with a memory access profile
like an optimized memorytomemory copy. In AM5728 the two Cortex A15
cores share L2 cache and access to the rest of the SoC, which the STREAM
benchmark running on core 0 stresses while core 1 access GIC registers
to respond to the interrupt.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default" id="id94">
<caption><span class="caption-number">Table 9.1 </span><span class="caption-text"><strong>Interrupt latency of a bare metal inmate (core 1)</strong></span><a class="headerlink" href="#id94" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Unloaded Linux on
core 0</p></th>
<th class="head"><p>Linux Running STREAM
benchmark on core 0</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">Interrutp count</div>
<div class="line">Bucket 1.6 us - 3.2
us</div>
</div>
</td>
<td><p>99.3756%</p></td>
<td><p>33.9323%</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Interrutp count</div>
<div class="line">Bucket 3.2 us - 6.4
us</div>
</div>
</td>
<td><p>0.6244%</p></td>
<td><p>66.0632%</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Interrutp count</div>
<div class="line">Bucket 6.4 us -
12.8 us</div>
</div>
</td>
<td><p>none</p></td>
<td><p>0.0045%</p></td>
</tr>
<tr class="row-odd"><td><p>Minimum interrupt
latency</p></td>
<td><p>2.2 microseconds</p></td>
<td><p>1.8 microseconds</p></td>
</tr>
<tr class="row-even"><td><p>Maximim interrupt
latency</p></td>
<td><p>5.0 microseconds</p></td>
<td><p>8.8 microseconds</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="building-jailhouse-from-sources">Building Jailhouse from Sources</p>
<p>Jailhouse sources are located at
$TI_SDK_PATH/board-support/extra-drivers/jailhouse-0.7 directory. The
directory contains the following subdirectories:</p>
<ul class="simple">
<li><p><strong>Documentation</strong></p></li>
<li><p><strong>ci</strong> - configuration files for different platforms. <strong>*Copy the
jailhouse-config-am57xx-evm.h file into hypervisor/include/jailhouse
directory and rename it to config.h*</strong></p></li>
<li><p><strong>configs</strong> - cell configuration files.</p></li>
<li><p><strong>driver</strong> - jailhouse.ko kernel module code</p></li>
<li><p><strong>hypervisor</strong> - hypervisor code</p></li>
<li><p><strong>inmates</strong> - inmates demos. It also contains code for ti_app inmate
example.</p></li>
<li><p><strong>scripts</strong></p></li>
<li><p><strong>tools</strong> - jailhouse management utility</p></li>
</ul>
<p>The top level SDK Makefile has the <em>jailhouse_clean</em>, <em>jailhouse</em> and
<em>jailhouse_install</em> targets which can be used to clean, build and
install jailhouse to the target file system.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="building-and-running-the-ethercat-slave-demo">Building and Running the Ethercat Slave Demo</p>
<p>To build and run the Ethercat Slave Demo, you need to install the
PLSDK-RT, PRSDK and PRU-ICSS-ETHERCAT-SLAVE builds. We assume that you
already have the first two SDKs installed. The PRU-ICSS-ETHERCAT-SLAVE
can be downloaded from
<a class="reference external" href="http://software-dl.ti.com/processor-industrial-sw/esd/PRU-ICSS-ETHERCAT-SLAVE/01_00_05_00/index_FDS.html">http://software-dl.ti.com/processor-industrial-sw/esd/PRU-ICSS-ETHERCAT-SLAVE/01_00_05_00/index_FDS.html</a>.</p>
<p>Once you have this SDK installed you may build Ethercat slave
components.</p>
<p>If the am572x-ethercat.cell is not installed on target filesystem yet,
build it from PLSDK-RT top level makefile “make jailhouse” and copy it
to target under /usr/share/jailhouse/examples.</p>
<p>To build the ethercat_slave_demo.bin:</p>
<ul class="simple">
<li><p>Modify the IA_SDK_HOME at
~/ti/processor_sdk_rtos_am57xx_[version]/demos/jailhouse-inmate/rtos/ethercat_slave_demo/Makefile
to point to the install directory of PRU-ICSS-ETHERCAT-SLAVE.</p></li>
<li><p>At
~/ti/processor_sdk_rtos_am57xx_[version]/demos/jailhouse-inmate/makefile:
add ethercat_slave_demo* entries as pruss-test/icss-emac-test to the
end of the makefile</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>ethercat_slave_demo:
    $(MAKE) -C ./rtos/ethercat_slave_demo

ethercat_slave_demo_clean:
    $(MAKE) -C ./rtos/ethercat_slave_demo clean

ethercat_slave_demo_install:
    $(MAKE) -C ./rtos/ethercat_slave_demo install
</pre></div>
</div>
<ul class="simple">
<li><p>cd ~/ti/processor_sdk_rtos_am57xx_[version]/</p></li>
<li><p>source setupenv.sh</p></li>
<li><p>cd ~/ti/processor_sdk_rtos_am57xx_[version]/demos/jailhouse-inmate</p></li>
<li><p>source setenv.sh</p></li>
<li><p>make ethercat_slave_demo</p></li>
</ul>
<p>After the steps above, copy ethercat_slave_demo.bin to target under
/usr/share/jailhouse/examples.</p>
<p>To run the inmate refer to the instructions for <a class="reference external" href="#Running_the_Demo_on_AM572x-IDK">**Running the Demo on
AM572x-IDK**</a> . Be aware that the
inmate start address is 0x80000000. So, you need to use it as a
parameter at the “jailhouse cell load” command:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">jailhouse</span> <span class="n">cell</span> <span class="n">load</span> <span class="mi">1</span> <span class="n">linux</span><span class="o">-</span><span class="n">loader</span><span class="p">.</span><span class="n">bin</span> <span class="o">-</span><span class="n">a</span> <span class="mi">0</span> <span class="o">-</span><span class="n">s</span> <span class="s">&quot;kernel=0x80000000&quot;</span> <span class="o">-</span><span class="n">a</span> <span class="mh">0x100</span> <span class="n">ethercat_slave_demo</span><span class="p">.</span><span class="n">bin</span> <span class="o">-</span><span class="n">a</span> <span class="mh">0x80000000</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">Procedure to check two-way communication between the slave inmate and
the master station:</div>
</div>
<ul class="simple">
<li><p>Refer to
<a class="reference external" href="http://processors.wiki.ti.com/index.php/PRU_ICSS_EtherCAT#Running_EtherCAT_Slave_Application">http://processors.wiki.ti.com/index.php/PRU_ICSS_EtherCAT#Running_EtherCAT_Slave_Application</a>
to setup Ethercat master.</p></li>
<li><p>Master: Online write [data] to RxPDO 32Bit Output. After this, the
slave should report the corresponding value via Board_setDigOutput.
The value can be checked with “devmem2 0xeef00000” also.</p></li>
<li><p>Slave: devmem2 0xeef00004 b [data]. After this, Master should display
the corresponding value in TXPDO 32Bit Input.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="jailhouse-internals">Jailhouse Internals</p>
<p>This section gives some Jailhouse details and required kernel
modifications.</p>
<p class="rubric" id="linux-kernel-modifications">Linux Kernel Modifications</p>
<p>In order to run hypervisor itself and inmates Jailhouse requires
additional nodes in kernel dtb. See the am572x-evm-jailhouse.dts and
am572x-idk-jailhouse.dts. They add required nodes or modify existing
nodes of the default am57xx-evm-reva3.dts and am57xx-idk.dts DTS files.</p>
<p class="rubric" id="memory-reservation">Memory Reservation</p>
<p>Linux kernel has to reserve some memory for jailhouse hypervisor and for
inmate. This memory has to be reserver statically. In this release we
reserved 16MB of physical memory for hypervisor and 16MB for inmates.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>/ {

    reserved-memory {
        jailhouse: jailhouse@ef000000 {
            reg = &lt;0x0 0xef000000 0x0 0x1000000&gt;;
            no-map;
            status = &quot;okay&quot;;
        };

        jh_inmate: jh_inmate@ee000000 {
            reg = &lt;0x0 0xee000000 0x0 0x1000000&gt;;
            no-map;
            status = &quot;okay&quot;;
        };
    };
};
</pre></div>
</div>
<p class="rubric" id="hardware-modules-reservation">Hardware Modules Reservation</p>
<p>Linux kernel enables all SOC HW modules which are required for its
configuration. Appropriate drivers configure required clocks and
initialize HW registers. For all unused IPs clocks are not configured.
Also kernel power management can put a module into the sleep mode. A
jailhouse inmate doesn’t share the same hardware module with Linux
kernel (except debug UART). But the inmate doesn’t configure required
clocks and doesn’t deal with power domains. So, we still relay on Linux
kernel (at least at the current release) to configure clocks to inmate
HW modules. If we want to use some hardware modules for an inmate, we
have to tell kernel about this in advance.</p>
<p>The following nodes disable using of the timer8 and uart9 by kernel.
Also this restricts kernel to put those IPs to sleep mode.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">timer8</span> <span class="p">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;disabled&quot;</span><span class="p">;</span>
    <span class="n">ti</span><span class="p">,</span><span class="n">no</span><span class="o">-</span><span class="n">idle</span><span class="p">;</span>
<span class="p">};</span>

<span class="o">&amp;</span><span class="n">uart9</span> <span class="p">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;disabled&quot;</span><span class="p">;</span>
    <span class="n">ti</span><span class="p">,</span><span class="n">no</span><span class="o">-</span><span class="n">idle</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>You may see other nodes in the jailhouse DTSes which reserve other IPs
to be used for inmates. Thus IDK’s DTS disables nodes, which IPs are
used for icss_emac and pruss inmates.</p>
<p class="rubric" id="gic-interrupt-inputs-reservation">GIC Interrupt Inputs Reservation</p>
<p>Interrupt lines from hardware modules don’t go to ARM interrupt
controller (GIC) directly. They go to a crossbar register, which selects
a GIC distributor input. The selection is done dynamically by Linux
kernel. Linux keeps track of all used and unused GIC inputs. If a
jailhouse inmate has to use an interrupt, it has to configure the
crossbar register by itself. To prevent conflicts between the Linux
crossbar manager and the inmate, and give to the inmate some unused GIC
input lines, which it can use, we need to reserve some of them in the
kernel dts.</p>
<p>This can be done by adding GIC input numbers to the “ti,irqs-skip”
property of the “crossbar_mpu:” node. Lines 134 and 135 are added to the
following node.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>crossbar_mpu: crossbar@4a002a48 {
     ti,irqs-skip = &lt;10 133 134 135 139 140&gt;;
 };
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>Note:</strong> The icss_emac.bin application uses much more interrupt
lines. Thats is why IDK’s dtb skips aditional interrupts.</div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>crossbar_mpu: crossbar@4a002a48 {
    ti,irqs-skip = &lt;10 44 127 129 133 134 135 136 137 139 140&gt;;
};
</pre></div>
</div>
<p class="rubric" id="root-cell-configuration">Root-cell configuration</p>
<p>When hypervisor is being enabled it creates a cell for Linux and moves
it to that cell. The cell is called as “root-cell”. The cell
configuration as a “<em>.c” file which is compiled to a special binary
format “</em>.cell” file. The hypervisor uses the “cell” file to create a
cell. The cell configuration describes memory regions and their
attributes which will be used by the cell,</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="n">mem_regions</span> <span class="o">=</span> <span class="p">{</span>
     <span class="cm">/* OCMCRAM */</span> <span class="p">{</span>
         <span class="p">.</span><span class="n">phys_start</span> <span class="o">=</span> <span class="mh">0x40300000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">virt_start</span> <span class="o">=</span> <span class="mh">0x40300000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x80000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">JAILHOUSE_MEM_READ</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_WRITE</span> <span class="o">|</span>
             <span class="n">JAILHOUSE_MEM_IO</span><span class="p">,</span>
     <span class="p">},</span>
     <span class="cm">/* 0x40380000 - 0x48020000 */</span> <span class="p">{</span>
         <span class="p">.</span><span class="n">phys_start</span> <span class="o">=</span> <span class="mh">0x40380000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">virt_start</span> <span class="o">=</span> <span class="mh">0x40380000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x7ca0000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">JAILHOUSE_MEM_READ</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_WRITE</span> <span class="o">|</span>
             <span class="n">JAILHOUSE_MEM_IO</span><span class="p">,</span>
     <span class="p">},</span>
     <span class="cm">/* UART... */</span> <span class="p">{</span>
         <span class="p">.</span><span class="n">phys_start</span> <span class="o">=</span> <span class="mh">0x48020000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">virt_start</span> <span class="o">=</span> <span class="mh">0x48020000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0xe0000</span><span class="p">,</span><span class="c1">//0x00001000,</span>
         <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">JAILHOUSE_MEM_READ</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_WRITE</span> <span class="o">|</span>
             <span class="n">JAILHOUSE_MEM_IO</span><span class="p">,</span>
     <span class="p">},</span>
   <span class="p">...</span>
     <span class="cm">/* RAM */</span> <span class="p">{</span>
         <span class="p">.</span><span class="n">phys_start</span> <span class="o">=</span> <span class="mh">0x80000000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">virt_start</span> <span class="o">=</span> <span class="mh">0x80000000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x6F000000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">JAILHOUSE_MEM_READ</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_WRITE</span> <span class="o">|</span>
             <span class="n">JAILHOUSE_MEM_EXECUTE</span><span class="p">,</span>
     <span class="p">},</span>
     <span class="cm">/* Leave hole for hypervisor */</span>

     <span class="cm">/* RAM */</span> <span class="p">{</span>
         <span class="p">.</span><span class="n">phys_start</span> <span class="o">=</span> <span class="mh">0xF0000000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">virt_start</span> <span class="o">=</span> <span class="mh">0xF0000000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x10000000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">JAILHOUSE_MEM_READ</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_WRITE</span> <span class="o">|</span>
             <span class="n">JAILHOUSE_MEM_EXECUTE</span><span class="p">,</span>
     <span class="p">},</span>
</pre></div>
</div>
<p>bitmap of CPU cores dedicated for the cell,</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="n">cpus</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mh">0x3</span><span class="p">,</span>
    <span class="p">},</span>
</pre></div>
</div>
<p>bitmap of interrupt controller SPI interrupts</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="n">irqchips</span> <span class="o">=</span> <span class="p">{</span>
     <span class="cm">/* GIC */</span> <span class="p">{</span>
         <span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="mh">0x48211000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">pin_base</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
         <span class="p">.</span><span class="n">pin_bitmap</span> <span class="o">=</span> <span class="p">{</span>
             <span class="mh">0xffffffff</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">,</span> <span class="mh">0xffffffff</span>
         <span class="p">},</span>
     <span class="p">},</span>
     <span class="cm">/* GIC */</span> <span class="p">{</span>
         <span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="mh">0x48211000</span><span class="p">,</span>
         <span class="p">.</span><span class="n">pin_base</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>
         <span class="p">.</span><span class="n">pin_bitmap</span> <span class="o">=</span> <span class="p">{</span>
             <span class="mh">0xffffffff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
         <span class="p">},</span>
     <span class="p">},</span>
 <span class="p">},</span>
</pre></div>
</div>
<p>and some other parameters. That is for all cells.</p>
<p>In addition to that the root cell also allocates the physical memory for
the hypervisor.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="n">hypervisor_memory</span> <span class="o">=</span> <span class="p">{</span>
     <span class="p">.</span><span class="n">phys_start</span> <span class="o">=</span> <span class="mh">0xef000000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000000</span><span class="p">,</span>
 <span class="p">},</span>
</pre></div>
</div>
<p>The “memory regions” section is used by hypervisor to create the second
stage MMU translation table. Usually for root-cell the identical mapping
is being used - “VA = PA”.</p>
<p>See the am57xx-evm.c file is the complete am57xx-evm root cell
configuration.</p>
<p class="rubric" id="bare-metal-inmate-example">Bare Metal Inmate Example</p>
<p>Jailhouse comes with inmate demos located at the <em>inmates/demos</em>
directory. Current (v0.6) version has two demo inmates: <strong>gic-demo</strong> and
<strong>uart-demo</strong>. Those are very simple bare-metal applications that
demonstrates a uart and arm-timer interrupt. Those demos are common for
all jailhouse platforms.</p>
<p>More interesting may be the <strong>ti-app</strong>, a demo made especially for
AM572x SOC. The code is located at the <em>inmate/ti_app</em> directory.</p>
<p>Basically this application is a sandbox to make some experiments. The
current version demonstrates of using a uart, timer and a GIC SPI
interrupt (timer generates periodic interrupts). The application also
has some extra code, which was used to measure interrupt latency.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>As any inmate the ti-app inmate works in a cell. The am57xx-evm-ti-app.c
is the cell configuration file. For this cell only ARM1 core will be
used:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="n">cpus</span> <span class="o">=</span> <span class="p">{</span>
     <span class="mh">0x2</span><span class="p">,</span>
 <span class="p">},</span>
</pre></div>
</div>
<p><strong>NOTE:</strong> <em>Actually on am572 SOC, which has only 2 ARM core and Linux
always uses the ARM0 core only ARM1 can be taken for an inmate.</em></p>
<p>The cell configuration has 5 memory regions:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* UART... */</span> <span class="p">{</span>
     <span class="p">.</span><span class="n">phys_start</span> <span class="o">=</span> <span class="mh">0x48020000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">virt_start</span> <span class="o">=</span> <span class="mh">0x48020000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">JAILHOUSE_MEM_READ</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_WRITE</span> <span class="o">|</span>
         <span class="n">JAILHOUSE_MEM_IO</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_ROOTSHARED</span><span class="p">,</span>
 <span class="p">},</span>
 <span class="cm">/* UART... */</span> <span class="p">{</span>
     <span class="p">.</span><span class="n">phys_start</span> <span class="o">=</span> <span class="mh">0x48424000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">virt_start</span> <span class="o">=</span> <span class="mh">0x48424000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">JAILHOUSE_MEM_READ</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_WRITE</span> <span class="o">|</span>
         <span class="n">JAILHOUSE_MEM_IO</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_ROOTSHARED</span><span class="p">,</span>
 <span class="p">},</span>
 <span class="cm">/* TIMER... */</span> <span class="p">{</span>
     <span class="p">.</span><span class="n">phys_start</span> <span class="o">=</span> <span class="mh">0x48826000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">virt_start</span> <span class="o">=</span> <span class="mh">0x48826000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">JAILHOUSE_MEM_READ</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_WRITE</span> <span class="o">|</span>
         <span class="n">JAILHOUSE_MEM_IO</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_ROOTSHARED</span><span class="p">,</span>
 <span class="p">},</span>
 <span class="cm">/* L4_CFG */</span> <span class="p">{</span>
     <span class="p">.</span><span class="n">phys_start</span> <span class="o">=</span> <span class="mh">0x4a000000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">virt_start</span> <span class="o">=</span> <span class="mh">0x4a000000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0xE00000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">JAILHOUSE_MEM_READ</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_WRITE</span> <span class="o">|</span>
         <span class="n">JAILHOUSE_MEM_IO</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_ROOTSHARED</span><span class="p">,</span>
 <span class="p">},</span>
 <span class="cm">/* RAM */</span> <span class="p">{</span>
     <span class="p">.</span><span class="n">phys_start</span> <span class="o">=</span> <span class="mh">0xee000000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">virt_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
     <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x800000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">JAILHOUSE_MEM_READ</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_WRITE</span> <span class="o">|</span>
         <span class="n">JAILHOUSE_MEM_EXECUTE</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_LOADABLE</span><span class="p">,</span>
 <span class="p">},</span>
</pre></div>
</div>
<p>Two for UARTs. <em>The first one for UART3, which is a standard EVM debug
uart. The second for UART9, using of which requires some board
modifications. But UART9 doesn’t conflict with Linux or hypervisor and
may be more useful if the inmate needs a dedicated UART.</em> One region for
timer9 and one for access multiple configuration registers.</p>
<p>The last region is for RAM allocated for the inmate. Similar to
root-cell memory regions configuration memory mapping for all regions
except for RAM are identical (VA = PA). For the RAM region virtual
address has to be ‘0’. The physical addresses of the region must be
inside of the physical memory reserved for inmates in the Linux DTS
file.</p>
<p>In the .irqchip section of the cell configuration file we reserve GIC
interrupt line #134 (<em>One of two lines reserved in the kernel DTS</em>).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* GIC */</span> <span class="p">{</span>
    <span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="mh">0x48211000</span><span class="p">,</span>
    <span class="p">.</span><span class="n">pin_base</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>
    <span class="p">.</span><span class="n">pin_bitmap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mh">0x00000040</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">},</span>
</pre></div>
</div>
<p><em>Here where #134 comes from. The 0x00000040 is the bitmask of the sixth
bit. So, .pin_base(160) + .pin_bitmap(6) - 32(number of SWI and PPI
interrupt) = 134.</em></p>
<p>As other jailhouse demos the <strong>ti-app</strong> uses the jailhouse startup code,
which sets the inmate vector table, zeros BSS segment, sets the stack up
and calls the inmate_main(). The initialization of the GIC controller is
done by hypervisor. Also the hypervisor remaps GICC interface to GICV
interface and intercepts all inmates accesses to GICD. It allows to
read/write only GICD registers, related to the lines given in the
.irq_chips section. In our case for the line #134 only.</p>
<p>In the inmate_main() the inmate initializes uart, sets the crossbar and
calls the gic_setup() to set the inmate’s interrupt handler. <em>The
jailhouse provides inmate interrupt controller API. This can be used by
inmate.</em></p>
<p>The ti-app initializes the timer and enters to the infinite loop.</p>
<p>Actually the inmate code has only about 100 lines and doesn’t require
any more explanation.</p>
<p class="rubric" id="rtos-pdk-inmates">RTOS PDK Inmates</p>
<p>The jailhouse demo applications and the “ti_app” are built by
jailhouse’s makefile inside the jailhouse’s source tree. It is more
interesting to build an inmate outside of the jailhouse source tree,
using independent makefile and third party libraries. This release
provides <strong>led_test</strong>, a simple example of a bare-metal application,
which uses prebuilt RTOS PDK libraries and is built independently on
Jailhouse. It also has ports of two TI RTOS SYSBIOS test applications -
pruss and icss_emac. <em>There are two other examples: 1) bare-metal
memcp_bm - a simple application to measure memory bandwidth; 2)
Ethercat_slave_demo - ported to Jailhouse example from “PRU-ICSS
Industrial Software for Sitara™ Processors”. The example requires some
modifications of the PRU-ICSS Industrial Software, which is not
published yet. That is why the ethercat_slave_demo included here as a
reference only.</em></p>
<p>The code of the applications is located on the
$(SDK_INSTALL_PATH)/processor_sdk_rtos_am57xx_4_01_00_04/demos/jailhouse-inmate
directory, which contains:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>├── baremetal
│   ├── led
│   │   ├── led_test.c
│   │   └── makefile
│   ├── memcp_bm
│   │   ├── makefile
│   │   └── memcp_bm.c
│   └── soc
│       └── am572x
│           ├── evmAM572x
│           │   ├── entry.S
│           │   ├── gic.c
│           │   ├── linker.cmd
│           │   └── make.inc
│           └── rules.mk
├── makefile
├── rtos
│   ├── ethercat_slave_demo
│   │   ├── bios
│   │   │   ├── am572x_app.cfg
│   │   │   └── makefile
│   │   ├── Makefile
│   │   └── src
│   │       └── board_jh.c
│   ├── icss_emac
│   │   ├── bios
│   │   │   ├── icss_emac_arm_wSoCLib.cfg
│   │   │   └── makefile
│   │   ├── lnk_pruss_fw.cmd
│   │   ├── Makefile
│   │   └── src
│   │       ├── idkAM572x_ethernet_config_jh.c
│   │       └── idkAM572x_jh.c
│   ├── pru-icss
│   │   ├── bios
│   │   │   ├── makefile
│   │   │   └── pruss_arm_wSoCLib.cfg
│   │   ├── Makefile
│   │   └── src
│   │       └── idkAM572x_jh.c
│   └── Rules.mk
└── setenv.sh
</pre></div>
</div>
<p class="rubric" id="bare-metal-example">Bare-metal example</p>
<p>The bare-metal directory has three subdirectories: <strong>soc</strong> - has common
for bare-metal applications soc specific code; <strong>led</strong> - led_test
application code; <strong>memcp_bm</strong> - memcp_bm code;</p>
<p>The <strong>soc/am572x/evmAM572x</strong> sub-directory contains:</p>
<ul class="simple">
<li><p><strong>entry.S</strong> - startup file for an inmate;</p></li>
<li><p><strong>gic.c</strong> - has the dummy _weak_ INTCCommonIntrHandler(), which can
be overridden by an actual application handler.</p></li>
<li><p><strong>linker.cmd</strong> - jailhouse requires that an inmate shall start from
address “0”. It also requires that all inmates segments be located in
contiguous memory. This linker.cmd is to meet these requirements.</p></li>
</ul>
<p>The <strong>led</strong> directory contains:</p>
<ul class="simple">
<li><p>The main inmate <strong>led_test.c</strong> code. This file is based on
$(SDK_INSTALL_PATH)/pdk_am57xx_1_0_6/packages/ti/board/diag/led/src/led_test.c
diagnostic application. Because the inmate works as a virtual machine
in order to use caches MMU has to be enabled. So, the application
creates the MMU translation table with identical mapping and enables
MMU. It also has the gic_init(), which is now used at this relese.</p></li>
<li><p><strong>makefile</strong> is to build the inmate. As you can see, it links number
of brebuilt PDK libraries.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">To build the <strong>led_test.bin</strong> (a jailhouse inmate has to be *.bin,
but not *.out file):</div>
</div>
<ul class="simple">
<li><p>cd to $(SDK_INSTALL_PATH)/processor_sdk_rtos_am57xx_4_01_00_04
drectory</p></li>
<li><p>source setupenv.sh</p></li>
<li><p>cd to
$(SDK_INSTALL_PATH)/processor_sdk_rtos_am57xx_4_01_00_04/demos/jailhouse-inmates</p></li>
<li><p>source setenv.sh</p></li>
<li><p>run <strong>make led_test</strong></p></li>
</ul>
<p>That should build the led_test.bin binary, that can be loaded to the
jailhouse cell and run. As any other inmate it has to be run in a cell,
created with appropriate cell configuration. In contrast to the
led_test.bin, which is compiled independently on jailhouse, a
corresponding cell configuration is compiled by jailhouse makefile.</p>
<p>The am57xx-pdk-leddiag.c cell configuration file is located in the
$TI_SDK_PATH/board-support/extra-drivers/jailhouse-0.7/configs
directory. Use the compiled am57xx-pdk-leddiag.cell file when you create
the cell for led_test.bin inmate.</p>
<p>See <a class="reference external" href="#Running_the_Demo">Running the Demo</a> to run the inmate.</p>
<p>The <strong>memcp_bm</strong> is very similar to led_test. It is built in the same
way as the led_test. Use the am57xx-bm.cell file from
$TI_SDK_PATH/board-support/extra-drivers/jailhouse-0.7/configs to create
the jailhouse cell for the memcp_bm inmate.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="rtos-bios-examples">RTOS BIOS Examples</p>
<div class="line-block">
<div class="line">The pruss and icss_emac examples are located in the rtos/pruss and
rtos/icss_emac directories. The structures of the both directories are
identical. Each directory contains the bios and src subdirectories.
The bios contains XDC type application configuration file and
makefile. The configuration file is reworked copy of the original RTOS
application configuration file. For example the configuration file for
icss_emac inmate was ported from
$(SDK_INSTALL_PATH)/ti/pdk_am57xx_1_0_7/packages/ti/drv/icss_emac/test/am572x/armv7/bios/icss_emac_arm_wSoCLib.cfg
file. As far as jailhouse inmate is not responsible for board related
configuration, the board library, i2c library, OCRAM MMU sections and
some other unnecessary for the inmate components were removed from the
configuration file.</div>
</div>
<div class="line-block">
<div class="line">As far as the application main function calls the board_init()
function, this function as well as the Board_moduleClockInit() (with
required for icss_emac application clocks) are implemented in the
idkAM572x_jh.c file.</div>
</div>
<div class="line-block">
<div class="line">Thus the ported configuration file, the idkAM572x_jh.c and makefiles
are only new files required to port RTOS SDK existing project to
jailhouse inmate.</div>
</div>
<p>The jailhouse-inmate/Makefile has the “pruss_test” and “icss_emac_test”
targets to build the BIOS inmates.</p>
<p>The structure of the ethercat_slave_demo example is very similar to the
pruss and icss_emac examples. As far as it depends on a particular
version of the “PRU-ICSS Industrial Software”, which has to be installed
independently, building of the demo is not included into the top level
makefile.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="rtos-bios-porting-notes">RTOS BIOS Porting Notes</p>
<p>As you can see in the previous section, the RTOS BIOS inmates has only
few new files. Almost all files were reused from RTOS SDK examples. But
following notes have to be considered when porting an RTOS BIOS
application to a Jailhouse inmate.</p>
<p>Jailhouse inmate runs in a small cell. The cell is created by
hypervisor, which was started from already booted Linux OS. That says
that the SOC, board and most clocks are already initialized and the
inmate don’t need and usually cannot touch any resources not listed in
the inmate cell configuration file.</p>
<p>Thus the using of board and i2c libraries were removed from
cponfiguration file. Also OCRAM was removed from MMU configuration.</p>
<p>Jailhouse hypervisor allows inmate to access certain GICD registers, but
only for those interrupt lines, which are listed in the cell
configuration file. The cell creating routine reconfigures GICD target
registers by itself. The standard gic_init() BIOS API configures target
registers for all interrupt lines. That is not permitted for an inmate.
To avoid this the latest SYSBIOS release has a special feature, which
allows to disable target configuration from GIC initialization function.
See the following fragment at the configuration file:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>var Hwi = xdc.useModule(&#39;ti.sysbios.family.arm.gic.Hwi&#39;);
Hwi.initGicd = false;
</pre></div>
</div>
<p>The RTOS BIOS applications are built to *.out format. RTOS loader may
load this file to the board even if the image has multiple sections with
their addresses spread across the entire SOC address range. The
Jailhouse supports only *.bin format, and inmate may use only allocated
for it memory carved out from Linux. Therefore the ported application
shall use only limited memory.</p>
<p>Jailhouse may start an inmate that start from virtual address 0x0, but
an usual RTOS application is linked to the 0x80000000 address and with
different from that entry point. The Jailhouse allows to start such
applications (see above). But using the linux-loader required additional
node in the inmate cell configuration.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* RAM loader */</span> <span class="p">{</span>
     <span class="p">.</span><span class="n">phys_start</span> <span class="o">=</span> <span class="mh">0xed000000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">virt_start</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>
     <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x10000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">JAILHOUSE_MEM_READ</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_WRITE</span> <span class="o">|</span>
         <span class="n">JAILHOUSE_MEM_EXECUTE</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_LOADABLE</span><span class="p">,</span>
 <span class="p">},</span>
 <span class="cm">/* RAM RTOS 224MB*/</span> <span class="p">{</span>
     <span class="p">.</span><span class="n">phys_start</span> <span class="o">=</span> <span class="mh">0xe0000000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">virt_start</span> <span class="o">=</span> <span class="mh">0x80000000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0xd000000</span><span class="p">,</span>
     <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">JAILHOUSE_MEM_READ</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_WRITE</span> <span class="o">|</span>
         <span class="n">JAILHOUSE_MEM_EXECUTE</span> <span class="o">|</span> <span class="n">JAILHOUSE_MEM_LOADABLE</span><span class="p">,</span>
 <span class="p">},</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">You may see that cell configuration for icss_emac inmate configures
two RAM regions:</div>
</div>
<ol class="arabic simple">
<li><p>small one with virtual address 0x0 for the linux-loader;</p></li>
<li><p>main region for the icss_emac test itself;</p></li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="general-porting-notes">General Porting Notes</p>
<p>When you start porting your RTOS or bare-metal application to Jailhouse
inmate, you have to consider several things. They are listed below.
<em>This list is not complete and has just recommendations based on common
sense and previous porting experience</em>.</p>
<ul class="simple">
<li><p><strong>Linux always starts first</strong> before hypervisor. Linux initializes
all (or almost all) common resources of SOC. Thus it initializes
memory controller, clocks, interrupt controller etc. It configures
PINMUX registers. In most cases it takes care about board
configuration as well.</p></li>
<li><p><strong>Inmate Cell Configuration</strong> defines resources, which are available
for the inmate. The ported application can use only those resources
and responsible for theirs initialization only. The ported
application will not run on the board it used to run, but on a
different <strong>virtual board</strong>, defined by the cell configuration. Thats
is why the application cannot use any common board_init or soc_init
functions that may touch used by Linux resources. <strong>Inmate is a guest
only</strong>.</p></li>
<li><p>As it mentioned above Linux initializes <strong>Interrupt Controller</strong> and
dynamically configures crossbar registers. It has to be planned ahead
which interrupts inmate may use. Those interrupts has to be reserved
at Linux’s dts file. Also used by the inmate interrupts have to
listed in the inmate cell configuration. Hypervisor configures GIC
target registers for those interrupt. Inmate is responsible only for
enabling, disabling and acknowledging the interrupts.</p></li>
<li><p>Linux owns <strong>I2C</strong> buses. Inmate cannot has its owe driver to control
I2C bus. It is not practicable even if the both root-cell and inmate
cell configurations share I2C region and Linux and the Inmate have an
agreement not to use I2C at the same time. The problem is that the
Linux I2C driver works in interrupt mode and if the Inmate issues an
I2C transaction, Linux’s interrupt handler will be called. It brakes
the Linux’s and Inmate’s I2C drivers state machines (or whatever they
have).</p></li>
<li><p>Using <strong>GPIO</strong> may have the same as I2C problem. It is easy to
disable an entire GPIO bank from using by Linux and use it for the
Inmate. But it is not practical to share the same bank by the both
Linux and Inmate.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="k2g-audio-dc-addon">
<h1>9.12. K2G AUDIO DC AddOn<a class="headerlink" href="#k2g-audio-dc-addon" title="Permalink to this headline">¶</a></h1>
<p class="rubric" id="id59">Introduction</p>
<p>This page describes the unit test for the Audio Daughter Card for K2G
(AUDK2G) AddOn provided in the Processor-SDK for RTOS. This unit test
implemented the audio loopback between the ADC_IN1-4 to DAC_OUT1-4 on
AUDK2G.</p>
<p>The key functions in this unit test include:</p>
<ul class="simple">
<li><p>Use board library to initialize the K2G EVM</p></li>
<li><p>Setup the PinMux for K2G EVM and the AUDK2G</p></li>
<li><p>Allocate the data buffers needed</p></li>
<li><p>Initialize the McASP and EDMA</p></li>
<li><p>Start the infinite loop for continious loopback</p></li>
</ul>
<p>This unit test utilizes other Processor SDK features/components:</p>
<ul class="simple">
<li><p><strong>Board Library</strong> for K2G platform initialization</p></li>
<li><p><strong>AUDK2G Library</strong> for PinMux, McASP/EDMA setups</p></li>
</ul>
<p>Currently, the following device and EVM are supported:</p>
<ul class="simple">
<li><p>K2G, on the K2G EVM with AUDK2G</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="id60">Requirements</p>
<p>The following materials are required to run this unit test:</p>
<p>Hardware</p>
<ul class="simple">
<li><p>K2G EVM</p></li>
<li><p>Audio Daughter Card (AUDK2G)</p></li>
</ul>
<p>Software</p>
<ul class="simple">
<li><p>Processor-SDK RTOS (3.2 or greater)</p></li>
<li><p>Code Composer Studio 6.1.3</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="how-to-build-the-unit-test">How to Build the Unit Test</p>
<p class="rubric" id="id61">K2G EVM</p>
<p><strong>For Linux:</strong></p>
<ul class="simple">
<li><p>Under pdk_k2g_&lt;version&gt;/packages directory, run the following
commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">pdksetupenv</span><span class="p">.</span><span class="n">sh</span>
<span class="n">cd</span> <span class="n">pdk_k2g_</span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">addon</span><span class="o">/</span><span class="n">aud</span><span class="o">/</span>
<span class="n">make</span> <span class="n">clean</span>
<span class="n">make</span> <span class="n">all</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The OUT file (audioAnalogLoopbackTest.out) for DSP will be built at
pdk_k2g_&lt;version&gt;/packages/ti/addon/aud/test/analog/loopback/build/make</p></li>
</ul>
<p><strong>For Windows:</strong></p>
<ul class="simple">
<li><p>Under pdk_k2g_&lt;version&gt;\packages directory, run the following
commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>pdksetupenv.bat
cd pdk_k2g_&lt;version&gt;\packages\ti\addon\aud\
gmake clean
gmake all
</pre></div>
</div>
<ul class="simple">
<li><p>The OUT file (audioAnalogLoopbackTest.out) for DSP will be built at
pdk_k2g_&lt;version&gt;\packages\ti\addon\aud\test\analog\loopback\build\make</p></li>
</ul>
<p class="rubric" id="how-to-run-the-unit-test">How to Run the Unit Test</p>
<p>The unit test works on the K2G EVM with an AUDK2G connected.</p>
<p>The following section provide detailed steps for K2G EVM</p>
<ul class="simple">
<li><p>Follow this link <a class="reference external" href="index_how_to_guides.html#setup-ccs-for-evm-and-processor-sdk-rtos">Processor SDK RTOS Setup CCS</a>
to get target configuration setup correctly</p></li>
<li><p>Connect to the on board emulator (J1 on K2G EVM) to your PC USB</p></li>
<li><p>Plug power adaptor(12V) into the K2G EVM and power on the EVM</p></li>
<li><p>Launch the target configuration file using “Launch Selected
Configuration” from CCS 6.1.3</p></li>
<li><p>Then “Connect to C66xx_DSP”</p></li>
<li><p>Load the audioAnalogLoopbackTest.out from
pdk_k2g_&lt;version&gt;/packages/ti/addon/aud/test/analog/loopback/build/make</p></li>
<li><p>Run the program (loaded previously) by pressing F8</p></li>
<li><p>The program will print out the instructions on how to verify the
loopback physically</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">C66xx</span><span class="p">]</span>
<span class="o">******************************************</span>
      <span class="n">Audio</span> <span class="n">DC</span> <span class="n">Analog</span> <span class="n">Loopback</span> <span class="n">Test</span>
<span class="o">******************************************</span>

<span class="n">Test</span> <span class="n">Verifies</span> <span class="n">ADC</span> <span class="n">and</span> <span class="n">DAC</span> <span class="n">Channels</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">3</span>
<span class="n">Test</span> <span class="n">Runs</span> <span class="n">in</span> <span class="n">Audio</span> <span class="n">Loopback</span> <span class="n">Mode</span>
<span class="n">Confirm</span> <span class="n">that</span> <span class="n">ADC</span> <span class="n">Input</span> <span class="n">Audio</span> <span class="n">is</span> <span class="n">Played</span> <span class="n">at</span> <span class="n">DAC</span> <span class="n">Channels</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">3</span>

<span class="n">Audio</span> <span class="n">Connection</span> <span class="n">Details</span>
<span class="o">**************************************</span>
<span class="n">ADC_IN</span> <span class="mi">0</span> <span class="o">==&gt;</span> <span class="n">DAC_OUT</span> <span class="mi">0</span>
<span class="n">ADC_IN</span> <span class="mi">1</span> <span class="o">==&gt;</span> <span class="n">DAC_OUT</span> <span class="mi">1</span>
<span class="n">ADC_IN</span> <span class="mi">2</span> <span class="o">==&gt;</span> <span class="n">DAC_OUT</span> <span class="mi">2</span>
<span class="n">ADC_IN</span> <span class="mi">3</span> <span class="o">==&gt;</span> <span class="n">DAC_OUT</span> <span class="mi">3</span>
<span class="o">**************************************</span>
</pre></div>
</div>
</div>
<div class="section" id="cmb-addon">
<h1>9.13. CMB AddOn<a class="headerlink" href="#cmb-addon" title="Permalink to this headline">¶</a></h1>
<p class="rubric" id="id62">Introduction</p>
<p>This page describes the Circular Microphone Board (CMB) Addon library
and the unit test provided in the Processor-SDK for RTOS.</p>
<p>The key functions in the CMB Addon library include:</p>
<ul class="simple">
<li><p>Initialize the board connects to the CMB</p></li>
<li><p>Initialize/configure the McASP, EDMA, I2C and GPIO</p></li>
<li><p>Set up the CMB and on-board audio codec to the correct sample rate
and format</p></li>
</ul>
<p>The unit test demo utilizes other Processor SDK features/components:</p>
<ul class="simple">
<li><p><strong>SYS/BIOS</strong> application utilizing TI-RTOS features for DSP-C66x core</p></li>
<li><p><strong>UIA</strong> for instrumentation logging</p></li>
</ul>
<p>Currently, the following devices and EVMs are supported:</p>
<ul class="simple">
<li><p>K2G, on the K2G EVM. See TIDEP-0088
(<a class="reference external" href="http://www.ti.com/tool/TIDEP-0088">http://www.ti.com/tool/TIDEP-0088</a>) for details</p></li>
<li><p>OMAP-L137, on the OMAP-L137 EVM. See TIDEP-0099
((<a class="reference external" href="http://www.ti.com/tool/TIDEP-0099">http://www.ti.com/tool/TIDEP-0099</a>)) for details</p></li>
</ul>
<p class="rubric" id="id63">Requirements</p>
<p>The following materials are required to run this add-on unit test:</p>
<p>Hardware</p>
<ul class="simple">
<li><p>TI EVMs (see list above)</p></li>
<li><p>Circular Microphone Array Board (CMB)</p></li>
<li><p>OMAP-L137 Prototype Board (for OMAP-L137 EVM only)</p></li>
</ul>
<p>Software</p>
<ul class="simple">
<li><p>Processor-SDK RTOS (4.0 or greater)</p></li>
<li><p>Code Composer Studio 6.1.3 and up</p></li>
</ul>
<p class="rubric" id="id64">Software Design</p>
<p class="rubric" id="framework-for-unit-test">Framework for Unit Test</p>
<p>The current framework is based on SYS/BIOS. The following are the
overall steps:</p>
<ul class="simple">
<li><p>The McASP/EDMA will generate interrupt every 10ms (approximately)</p></li>
<li><p>The EDMA ISR will prepare the audio frame buffer pointers (McASP/EDMA
RX buffer) for further processing</p></li>
<li><p>The EDMA ISR will also send a semaphore to wake up the main task</p></li>
<li><p>When woke up, the main thread will perform the audio de-interleaving
to separate the channels</p></li>
<li><p>The main thread will also output two of eight channels to McASP/EDMA
TX buffer</p></li>
<li><p>The McASP/EDMA will send the TX buffer to the on-board audio codec</p></li>
</ul>
<p class="rubric" id="how-to-build-the-cmb-library-and-unit-test">How to Build the CMB Library and Unit Test</p>
<p class="rubric" id="id65">K2G EVM</p>
<p><strong>For Linux:</strong></p>
<ul class="simple">
<li><p>Under pdk_k2g_1_x_x/packages directory, run the following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="p">.</span><span class="o">/</span><span class="n">pdksetupenv</span><span class="p">.</span><span class="n">sh</span>
<span class="n">make</span> <span class="n">cmb_clean</span>
<span class="n">make</span> <span class="n">cmb</span>
<span class="n">the</span> <span class="n">libraries</span> <span class="n">will</span> <span class="n">be</span> <span class="n">in</span>
   <span class="n">pdk_k2g_1_x_x</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">addon</span><span class="o">/</span><span class="n">cmb</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">k2g</span><span class="o">/</span><span class="n">c66</span><span class="o">/</span><span class="n">release</span>
<span class="n">the</span> <span class="n">OUT</span> <span class="n">file</span> <span class="p">(</span><span class="n">audioAnalogLoopbackTest</span><span class="p">.</span><span class="n">out</span><span class="p">)</span> <span class="k">for</span> <span class="n">DSP</span> <span class="n">will</span> <span class="n">be</span> <span class="n">built</span> <span class="n">at</span>
   <span class="n">pdk_k2g_1_x_x</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">addon</span><span class="o">/</span><span class="n">cmb</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">evmK2G</span><span class="o">/</span><span class="n">analog</span><span class="o">/</span><span class="n">loopback</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">make</span>
</pre></div>
</div>
<p><strong>For Windows:</strong></p>
<ul class="simple">
<li><p>Under pdk_k2g_1_x_x/packages directory, run the following commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>pdksetupenv.bat
gmake cmb_clean
gmake cmb
the libraries will be in
   pdk_k2g_1_x_x\packages\ti\addon\cmb\lib\k2g\c66\release
the OUT file (audioAnalogLoopbackTest.out) for DSP will be built at
   pdk_k2g_1_x_x\packages\ti\addon\cmb\test\evmK2G\analog\loopback\build\make
</pre></div>
</div>
<p class="rubric" id="id66">OMAP-L137 EVM</p>
<p><strong>For Linux:</strong></p>
<ul class="simple">
<li><p>Under pdk_omapl137_1_x_x/packages directory, run the following
commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="p">.</span><span class="o">/</span><span class="n">pdksetupenv</span><span class="p">.</span><span class="n">sh</span>
<span class="n">make</span> <span class="n">cmb_clean</span>
<span class="n">make</span> <span class="n">cmb</span>
<span class="n">the</span> <span class="n">libraries</span> <span class="n">will</span> <span class="n">be</span> <span class="n">in</span>
   <span class="n">pdk_omapl137_1_x_x</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">addon</span><span class="o">/</span><span class="n">cmb</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">omapl137</span><span class="o">/</span><span class="n">c674</span><span class="o">/</span><span class="n">release</span>
<span class="n">the</span> <span class="n">OUT</span> <span class="n">file</span> <span class="p">(</span><span class="n">audioAnalogLoopbackTest</span><span class="p">.</span><span class="n">out</span><span class="p">)</span> <span class="k">for</span> <span class="n">DSP</span> <span class="n">will</span> <span class="n">be</span> <span class="n">built</span> <span class="n">at</span>
   <span class="n">pdk_omapl137_1_x_x</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">addon</span><span class="o">/</span><span class="n">cmb</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">evmOMAPL137</span><span class="o">/</span><span class="n">analog</span><span class="o">/</span><span class="n">loopback</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">make</span>
</pre></div>
</div>
<p><strong>For Windows:</strong></p>
<ul class="simple">
<li><p>Under pdk_omapl137_1_x_xpackages directory, run the following
commands:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>pdksetupenv.bat
gmake cmb_clean
gmake cmb
the libraries will be in
   pdk_omapl137_1_x_x\packages\ti\addon\cmb\lib\omapl137\c674\release
the OUT file (audioAnalogLoopbackTest.out) for DSP will be built at
   pdk_omapl137_1_x_x\packages\ti\addon\cmb\test\evmOMAPL137\analog\loopback\build\make
</pre></div>
</div>
<p class="rubric" id="id67">How to Run the Unit Test</p>
<p>The unit test will be loaded onto the target using JTAG. After running
the unit test, the 2 out of 8 input audio channels from CMB will be
output to the line-out of the on-board audio codec.</p>
<p>The following sections provide detailed steps for each EVM.</p>
<p class="rubric" id="k2g-evm-1">K2G EVM</p>
<ul class="simple">
<li><p>Follow this link <a class="reference internal" href="index_how_to_guides.html#processor-sdk-rtos-setup-ccs-label"><span class="std std-ref">Setup CCS for EVM and Processor-SDK RTOS</span></a>
to get target configuration setup correctly.</p></li>
<li><p>Connect to the on board emulator (J1 on K2G EVM) to your PC USB</p></li>
<li><p>Plug power adaptor(12V) into the K2G EVM and power on the EVM</p></li>
<li><p>Launch the ccxml created above using “Launch Selected Configuration”
from CCS 6.1.3</p></li>
<li><p>Then “Connect to C66xx_DSP”</p></li>
<li><p>Load the audioAnalogLoopbackTest.out from
pdk_k2g_1_x_x/packages/ti/addon/cmb/test/evmK2G/analog/loopback/build/make</p></li>
<li><p>Run the program (loaded previously) by pressing F8</p></li>
<li><p>The program will run the unit test forever, taking the input from CMB
and output to the on-board line-out</p></li>
</ul>
<p class="rubric" id="omap-l137-evm-1">OMAP-L137 EVM</p>
<ul class="simple">
<li><p>Follow this link <a class="reference internal" href="index_how_to_guides.html#processor-sdk-rtos-setup-ccs-label"><span class="std std-ref">Setup CCS for EVM and Processor-SDK RTOS</span></a>
to get target configuration setup correctly.</p></li>
<li><p>Connect to the on board emulator (J201 on OMAP-L137 EVM) to your PC
USB</p></li>
<li><p>Plug power adaptor(5V) into the OMAP-L137 EVM and power on the EVM</p></li>
<li><p>Launch the ccxml created above using “Launch Selected Configuration”
from CCS 6.1.3</p></li>
<li><p>Then “Connect to C674X_0”</p></li>
<li><p>Load the audioAnalogLoopbackTest.out from
pdk_omapl137_1_x_x/packages/ti/addon/cmb/test/evmOMAPL137/analog/loopback/build/make</p></li>
<li><p>Run the program (loaded previously) by pressing F8</p></li>
<li><p>The program will run the unit test forever, taking the input from CMB
and output to the on-board line-out</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="simplelink-wifi-demo">
<h1>9.14. SimpleLink WiFi Demo<a class="headerlink" href="#simplelink-wifi-demo" title="Permalink to this headline">¶</a></h1>
<span class="target" id="demo-simplelink-wifi-demo-label"></span><div class="section" id="id68">
<h2>9.14.1. Overview<a class="headerlink" href="#id68" title="Permalink to this headline">¶</a></h2>
<p>This page describes the SimpleLink WiFi Demo provided in the
Processor-SDK for RTOS. This demo illustrates the integration of CC3120
BoosterPack and AMIC110 ICE using components in the SDK to provides a
low cost WiFi solution for application development.</p>
</div>
<div class="section" id="supported-platforms">
<h2>9.14.2. Supported platforms<a class="headerlink" href="#supported-platforms" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>iceAMIC110 ( A8 )</p></li>
</ul>
</div>
<div class="section" id="id69">
<h2>9.14.3. Requirements<a class="headerlink" href="#id69" title="Permalink to this headline">¶</a></h2>
<p>Following are required to run the application:</p>
<p>Hardware</p>
<ul class="simple">
<li><p>TI CC3120 BoosterPack</p></li>
<li><p>TI EVM (see list above)</p></li>
<li><p>Blue wires between CC3120 BP and AMIC110 ICE</p></li>
<li><p>Serial UART cable (provided in EVM kit)</p></li>
<li><p>Connection Diagram</p></li>
</ul>
<img alt="../_images/sl_wifi_demo_connection.jpg" src="../_images/sl_wifi_demo_connection.jpg" />
<ul class="simple">
<li><p>Picture of connected EVMs</p></li>
</ul>
<img alt="../_images/sl_wifi_demo_connected.jpg" src="../_images/sl_wifi_demo_connected.jpg" />
<p>Software</p>
<ul class="simple">
<li><p>Processor-SDK RTOS 5.1.0 and later</p></li>
<li><p>Code Composer Studio 8.0 and later</p></li>
</ul>
</div>
<div class="section" id="id70">
<h2>9.14.4. Components Used<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h2>
<p>RTOS Components:</p>
<ul class="simple">
<li><p>SYS/BIOS</p></li>
<li><p>XDCTools</p></li>
<li><p>Processor SDK RTOS PDK: SPI, UART, GPIO LLDs, OSAL, Board etc.</p></li>
</ul>
</div>
<div class="section" id="id71">
<h2>9.14.5. Software Design<a class="headerlink" href="#id71" title="Permalink to this headline">¶</a></h2>
<p>The demo implemented a network terminal application to illustrate
how the SimpleLink WiFi Plugin for Processor SDK RTOS can be used to provide
a low cost solution for Sitara devies (AM3/4/5). The AMIC110 ICE and CC3120
BoosterPack are connected via SPI and GPIO pins. The SPI interface will provide
The data and command channels for SimpleLink WiFi Plugin, while the GPIO pins
are providing the INT and RESET signals.</p>
<p>The following diagram shows the overview of the demo:</p>
<img alt="../_images/sl_wifi_demo_overview.jpg" src="../_images/sl_wifi_demo_overview.jpg" />
<p>The source files are organized as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>└── simplelink-wifi-demo
    ├── bin --&gt; Folder for the executables
    ├── examples --&gt; Demo source code, projectspec file and makefile
    ├── lib --&gt; Folder for SimpleLink WiFi Plugin liraray
    ├── source --&gt; Folder for SimpleLink WiFi Plugin source
</pre></div>
</div>
</div>
<div class="section" id="how-to-build-the-simplelink-wifi-plugin-demo-using-ccs">
<h2>9.14.6. How to Build the SimpleLink WiFi Plugin Demo using CCS<a class="headerlink" href="#how-to-build-the-simplelink-wifi-plugin-demo-using-ccs" title="Permalink to this headline">¶</a></h2>
<p>Please follow below step by step procedure to build the application.</p>
<ol class="arabic simple">
<li><p>Install Code Composer Studio.</p></li>
<li><p>Install Processor SDK RTOS for the respective platform needed, in a
location where CCS expects: (by default $HOME/ti or c:/ti) Refer
<a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Processor SDK RTOS Getting Started Guide</span></a>
for details.</p></li>
<li><p>Open CCS:</p></li>
<li><p>Click Project–&gt;Import CCS Projects and select network_terminal_AMIC110_ICE_RTOS_ccs
under directory :
processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;/demos/simplelink-wifi-demo/</p></li>
<li><p>Build the application . ( By right clicking on imported project and
clicking “Build project”)</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This will create executable binary under &lt;CCS_Workspace&gt;/network_terminal_AMIC110_ICE_RTOS_RTOS_ccs/Debug/network_terminal_AMIC110_ICE_RTOS_RTOS_ccs.out</p>
</div>
<img alt="../_images/sl_wifi_demo_ccs_import.jpg" src="../_images/sl_wifi_demo_ccs_import.jpg" />
</div>
<div class="section" id="how-to-build-the-simplelink-wifi-plugin-demo-using-makefile-on-windows">
<h2>9.14.7. How to Build the SimpleLink WiFi Plugin Demo using makefile on Windows<a class="headerlink" href="#how-to-build-the-simplelink-wifi-plugin-demo-using-makefile-on-windows" title="Permalink to this headline">¶</a></h2>
<p>Please follow below step by step procedure to build the application.</p>
<ol class="arabic simple">
<li><p>Install Processor SDK RTOS for the respective platform needed, in a
location where CCS expects: (by default c:/ti) Refer
<a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Processor SDK RTOS Getting Started Guide</span></a>
for details.</p></li>
<li><p>Under DOS command prompt type:</p></li>
<li><p>cd processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;/ folder</p></li>
<li><p>setupenv.bat</p></li>
<li><p>cd processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;/demos/simplelink-wifi-demo/examplesrtos/AMIC110_ICE/demos/network_terminal/tirtos/ccs</p></li>
<li><p>gmake clean</p></li>
<li><p>gmake all</p></li>
<li><p>The executable binary will be generated under
processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;/demos/simplelink-wifi-demo/examplesrtos/AMIC110_ICE/demos/network_terminal/tirtos/ccs and
The executable network_terminal.out, boot image files network_terminal.bin and app will be under
processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;/demos/simplelink-wifi-demo/bin/am335x/a8/debug</p></li>
</ol>
</div>
<div class="section" id="how-to-build-the-simplelink-wifi-plugin-demo-using-makefile-on-linux">
<h2>9.14.8. How to Build the SimpleLink WiFi Plugin Demo using makefile on Linux<a class="headerlink" href="#how-to-build-the-simplelink-wifi-plugin-demo-using-makefile-on-linux" title="Permalink to this headline">¶</a></h2>
<p>Please follow below step by step procedure to build the application.</p>
<ol class="arabic simple">
<li><p>Install Processor SDK RTOS for the respective platform needed, in a
location where CCS expects: (by default $HOME/ti) Refer
<a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Processor SDK RTOS Getting Started Guide</span></a>
for details.</p></li>
<li><p>Under Linux command prompt type:</p></li>
<li><p>cd processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;/ folder</p></li>
<li><p>source setupenv.sh</p></li>
<li><p>cd processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;/demos/simplelink-wifi-demo/examplesrtos/AMIC110_ICE/demos/network_terminal/tirtos/ccs</p></li>
<li><p>make clean</p></li>
<li><p>make all</p></li>
<li><p>The executable binary will be generated under
processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;/demos/simplelink-wifi-demo/examplesrtos/AMIC110_ICE/demos/network_terminal/tirtos/ccs</p></li>
</ol>
</div>
<div class="section" id="how-to-run-the-simplelink-wifi-plugin-demo-using-ccs">
<h2>9.14.9. How to Run the SimpleLink WiFi Plugin Demo using CCS<a class="headerlink" href="#how-to-run-the-simplelink-wifi-plugin-demo-using-ccs" title="Permalink to this headline">¶</a></h2>
<p>You will need the following:</p>
<ol class="arabic simple">
<li><p>Install Code Composer Studio to load and run the Template
Application. Refer to <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Processor SDK RTOS Getting Started
Guide</span></a> for
installing CCS.</p></li>
<li><p>AMIC110 ICE board</p></li>
<li><p>JTAG Emulator</p></li>
</ol>
<p>To load and run SimpleLink WiFi Plugin Demo:</p>
<ol class="arabic simple">
<li><p>Connect the computer to the JTAG port on the board using the JTAG
emulator.</p></li>
<li><p>Power on the EVM/board. Ensure that no boot mode is
entered (do not have SD card loaded or QSPI flashed)</p></li>
<li><p>Open up a serial terminal for UART communication (Refer to <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Processor
SDK RTOS Getting Started Guide</span></a>, setup
EVM hardware)</p></li>
<li><p>Open CCS and launch target config file for the EVM (Refer to
<a class="reference external" href="index_how_to_guides.html#setup-ccs-for-evm-and-processor-sdk-rtos">Processor SDK RTOS Setup
CCS</a> for setting up CCS)</p></li>
<li><p>Connect to the primary core to make sure on connect gels are run
A8 core for AM335x</p></li>
<li><p>Connect to core where the application is expected to run, if not the primary core.</p></li>
<li><p>Load executable by clicking(“Run –&gt; Load –&gt; Load Program.). Click
on Browse Project and select outfile under:
&lt;CCS_Workspace&gt;/network_terminal_AMIC110_ICE_RTOS_RTOS_ccs/Debug/network_terminal_AMIC110_ICE_RTOS_RTOS_ccs.out</p></li>
<li><p>Run application by clicking the Run icon. ( Or Click Run –&gt; Resume)</p></li>
</ol>
<p>Now the network terminal demo will run and print progress through the UART.</p>
<ul class="simple">
<li><p>The inital display on the UART</p></li>
</ul>
<img alt="../_images/sl_wifi_demo_uart_init.jpg" src="../_images/sl_wifi_demo_uart_init.jpg" />
<ul class="simple">
<li><p>Enter “help” at UART prompt</p></li>
</ul>
<img alt="../_images/sl_wifi_demo_uart_help.jpg" src="../_images/sl_wifi_demo_uart_help.jpg" />
<ul class="simple">
<li><p>Enter “scan -n 10” at UART prompt</p></li>
</ul>
<img alt="../_images/sl_wifi_demo_uart_scan.jpg" src="../_images/sl_wifi_demo_uart_scan.jpg" />
<ul class="simple">
<li><p>Enter ” wlanconnect -s “dir645” -t WPA/WPA2 -p “12345678” ” at UART prompt</p></li>
</ul>
<img alt="../_images/sl_wifi_demo_uart_wlanconnect.jpg" src="../_images/sl_wifi_demo_uart_wlanconnect.jpg" />
<ul class="simple">
<li><p>Enter “ping 192.168.0.1” at UART prompt</p></li>
</ul>
<img alt="../_images/sl_wifi_demo_uart_ping.jpg" src="../_images/sl_wifi_demo_uart_ping.jpg" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This demo uses the D-Link DIR-645 wirless router with DHCP server. “dir645” is its SSID. “12345678” is its
connection password. “192.168.0.1” is its default gateway. Users should adjust those parameters according
to their own wireless routers.</p>
</div>
</div>
<div class="section" id="how-to-run-the-simplelink-wifi-plugin-demo-using-uart-boot">
<h2>9.14.10. How to Run the SimpleLink WiFi Plugin Demo using UART Boot<a class="headerlink" href="#how-to-run-the-simplelink-wifi-plugin-demo-using-uart-boot" title="Permalink to this headline">¶</a></h2>
<p>To load and run SimpleLink WiFi Plugin Demo:</p>
<ol class="arabic simple">
<li><p>Connect the J3 to the USB port on a PC via the UART to USB cable.</p></li>
<li><p>Power on the EVM/board.</p></li>
<li><p>Open up a serial terminal for UART communication (Refer to <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Processor
SDK RTOS Getting Started Guide</span></a>, setup
EVM hardware)</p></li>
<li><p>Send the bootloader_boot_uart_a8host_debug.bin under
pdk_&lt;platform&gt;_&lt;version&gt;/packages/ti/starterware/binary/bootloader/bin/am335x-evm/gcc
using the XMODEM.</p></li>
</ol>
<img alt="../_images/sl_uart_boot_1st.jpg" src="../_images/sl_uart_boot_1st.jpg" />
<ol class="arabic simple">
<li><p>Upon completion,  then send the network_terminal.bin under
processor_sdk_rtos_&lt;platform&gt;_&lt;version&gt;/demos/simplelink-wifi-demo/bin/am335x/a8/debug
using the XMODEM.</p></li>
</ol>
<img alt="../_images/sl_uart_boot_2nd.jpg" src="../_images/sl_uart_boot_2nd.jpg" />
<p>Now the network terminal demo will run and print progress through the UART.</p>
<ul class="simple">
<li><p>The inital display on the UART</p></li>
</ul>
<img alt="../_images/sl_wifi_demo_uart_init.jpg" src="../_images/sl_wifi_demo_uart_init.jpg" />
<ul class="simple">
<li><p>Enter “help” at UART prompt</p></li>
</ul>
<img alt="../_images/sl_wifi_demo_uart_help.jpg" src="../_images/sl_wifi_demo_uart_help.jpg" />
<ul class="simple">
<li><p>Enter “scan -n 10” at UART prompt</p></li>
</ul>
<img alt="../_images/sl_wifi_demo_uart_scan.jpg" src="../_images/sl_wifi_demo_uart_scan.jpg" />
<ul class="simple">
<li><p>Enter ” wlanconnect -s “dir645” -t WPA/WPA2 -p “12345678” ” at UART prompt</p></li>
</ul>
<img alt="../_images/sl_wifi_demo_uart_wlanconnect.jpg" src="../_images/sl_wifi_demo_uart_wlanconnect.jpg" />
<ul class="simple">
<li><p>Enter “ping 192.168.0.1” at UART prompt</p></li>
</ul>
<img alt="../_images/sl_wifi_demo_uart_ping.jpg" src="../_images/sl_wifi_demo_uart_ping.jpg" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This demo uses the D-Link DIR-645 wirless router with DHCP server. “dir645” is its SSID. “12345678” is its
connection password. “192.168.0.1” is its default gateway. Users should adjust those parameters according
to their own wireless routers.</p>
</div>
</div>
</div>
<div class="section" id="can-eth-gatway-demo">
<h1>9.15. CAN-Eth Gatway Demo<a class="headerlink" href="#can-eth-gatway-demo" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id72">
<h2>9.15.1. Overview<a class="headerlink" href="#id72" title="Permalink to this headline">¶</a></h2>
<p>Gateway is one of the major use-cases in the modern cars. Performance
requirements for Gateway applications are ever increasing due to advanced
connected car architecture having multiple domain controllers. The CAN - Ethernet
gateway demo showcases P2P (Protocol to Protocol) translation i.e. translating data
and control information between incompatible networks like Ethernet and CAN for
communication on AM65xx device. The demo enables full duplex
routing between CAN and Ethernet (CAN to Ethernet &amp; Ethernet to CAN).
The gateway demo shows handling of high bandwidth data traffic on Cortex-R5 with
low CPU load and latency for bridging application leaving cortex A53 free
for application processing.</p>
</div>
<div class="section" id="id73">
<h2>9.15.2. Architecture Overview<a class="headerlink" href="#id73" title="Permalink to this headline">¶</a></h2>
<p>The following block diagram shows the various functional blocks &amp; the data flow
used in the gateway application. As shown in the diagram the PC Ethernet
applications are used for transmitting &amp; receiving the Ethernet frames from/to
PC, similarly for CAN message reception &amp; transmission, any compatible CAN tool
can be used.</p>
<a class="reference internal image-reference" href="../_images/can-eth-gateway.png"><img alt="can-to-eth data flow" class="align-center" src="../_images/can-eth-gateway.png" style="width: 750.0px; height: 500.0px;" /></a>
</div>
<div class="section" id="id74">
<h2>9.15.3. Software Features<a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Routing application for CAN to Eth and Eth to CAN.</p></li>
<li><p>Network APIs for creating TCP/IP applications.</p></li>
<li><p>CPU load benchmark utils.</p></li>
</ul>
</div>
<div class="section" id="id75">
<h2>9.15.4. Directory Structure<a class="headerlink" href="#id75" title="Permalink to this headline">¶</a></h2>
<p>The CAN_ETH Gateway demo is located in the Processor SDK RTOS
release under the directory path</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">gateway</span><span class="o">-</span><span class="n">demos</span><span class="o">/</span><span class="n">can</span><span class="o">-</span><span class="n">eth</span><span class="o">-</span><span class="n">gateway</span>
</pre></div>
</div>
<p>Detailed description of the directory structure is given below:</p>
<ul class="simple">
<li><p>output - directory contains prebuilt out file and PC tools executables.</p></li>
<li><p>build - directory contains makefiles and SYSBIOS configuration, linker files for build</p></li>
<li><p>pctools - directory contains Ethernet PC tools</p></li>
<li><p>src - Source files for gateway application, utils and network APIs.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Only Linux PC tools pre-built binaries are provided. For Windows, user needs
to build it locally.</p></li>
</ul>
</div>
</div>
<div class="section" id="id76">
<h2>9.15.5. Components Used<a class="headerlink" href="#id76" title="Permalink to this headline">¶</a></h2>
<p>RTOS Components:</p>
<ul class="simple">
<li><p>SYSBIOS</p></li>
<li><p>XDC</p></li>
<li><p>NDK</p></li>
</ul>
<p>Processor SDK RTOS Drivers:</p>
<ul class="simple">
<li><p>EMAC</p></li>
<li><p>NIMU</p></li>
<li><p>UART</p></li>
<li><p>Board</p></li>
<li><p>OSAL</p></li>
<li><p>CSL</p></li>
<li><p>udma</p></li>
<li><p>sciclient</p></li>
</ul>
</div>
<div class="section" id="id77">
<h2>9.15.6. Building the Demo<a class="headerlink" href="#id77" title="Permalink to this headline">¶</a></h2>
<p>The demo application is built using makefile. Also the demo is available pre-built
for Processor SDK RTOS version 5.3.0.0 or higher.</p>
<p>You must first set up your development environment. Refer to
the <a class="reference external" href="index_overview.html#building-the-sdk">Processor SDK RTOS Building</a> page for
information on setting up your build environment.</p>
<p>The following are steps to clean the demo:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">gateway</span><span class="o">-</span><span class="n">demos</span><span class="o">/</span><span class="n">can</span><span class="o">-</span><span class="n">eth</span><span class="o">-</span><span class="n">gateway</span><span class="o">/</span><span class="n">build</span>
<span class="n">make</span> <span class="n">clean</span> <span class="n">BOARD</span><span class="o">=</span><span class="n">am65xx_idk</span>
</pre></div>
</div>
<p>The following are steps to compile the demo:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">gateway</span><span class="o">-</span><span class="n">demos</span><span class="o">/</span><span class="n">can</span><span class="o">-</span><span class="n">eth</span><span class="o">-</span><span class="n">gateway</span><span class="o">/</span><span class="n">build</span>
<span class="n">make</span> <span class="n">all</span> <span class="n">BOARD</span><span class="o">=</span><span class="n">am65xx_idk</span>
</pre></div>
</div>
</div>
<div class="section" id="host-applications">
<h2>9.15.7. Host Applications<a class="headerlink" href="#host-applications" title="Permalink to this headline">¶</a></h2>
<p>The PC tools for Ethernet reception and transmission are located under pctools
directory. These tools can be built for Linux and Windows.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">gateway</span><span class="o">-</span><span class="n">demos</span><span class="o">/</span><span class="n">can</span><span class="o">-</span><span class="n">eth</span><span class="o">-</span><span class="n">gateway</span><span class="o">/</span><span class="n">pctools</span>
<span class="n">make</span> <span class="n">all</span>
</pre></div>
</div>
</div>
<div class="section" id="id78">
<h2>9.15.8. Running the Demo<a class="headerlink" href="#id78" title="Permalink to this headline">¶</a></h2>
<p>You will need the following:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 77%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>EVM’s supported</p></th>
<th class="head"><p>Bare
metal</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>AM65xx EVM/IDK</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<div class="section" id="tools">
<h3>9.15.8.1. Tools<a class="headerlink" href="#tools" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>CAN Receiver/Transmitter - PC tool to receive and transmit the CAN messages.</p></li>
<li><p>LAN Cable (preferably CAT6)</p></li>
<li><p>Gigabit switch connection - as mentioned in the known issues demo does not work
with 100Mbps mode. The gigabit connection is needed to AM65xx EVM.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>PCAN - PC CAN Emulation tool is used for testing CAN_ETH Gateway demo.</p></li>
<li><p>Refer section PCAN Tool Set up for more details.</p></li>
<li><p>For receiving and transmitting data over Ethernet, use/run “eth_rx.out” and “eth_tx.out” utilities on host PC.</p></li>
<li><p>Above utilities are available at “[SDK Install Path]/processor_sdk_rtos_[soc]_[version]/demos/gateway-demos/can-eth-gateway/pctools”.</p></li>
</ul>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="set-up">
<h3>9.15.8.2. Set up<a class="headerlink" href="#set-up" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Code Composer Studio to load and run the demo. Refer to <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Processor
SDK RTOS Getting Started Guide</span></a> for
installing CCS.</p></li>
<li><p>AM65xx_EVM board with attached LAN cable and CAN tool.</p></li>
<li><p>USB cable for JTAG and serial terminal (micro USB port)</p></li>
<li><dl>
<dt>Configure PC running Ethernet PC tools with below static IP</dt><dd><ul class="simple">
<li><p>IP Address = “192.168.1.20”</p></li>
<li><p>Subnet mask = “255.255.255.0”</p></li>
<li><p>Default Gateway = “192.168.1.1”</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<blockquote>
<div><p>You can enable DHCP for AM65xx board if PC is connected to network and static
IP configuration is not feasible. Set enableStaticIP flag to 1 in</p>
</div></blockquote>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">gateway</span><span class="o">-</span><span class="n">demos</span><span class="o">/</span><span class="n">can</span><span class="o">-</span><span class="n">eth</span><span class="o">-</span><span class="n">gateway</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">am65xx</span><span class="o">/</span><span class="n">nimuExample_r5</span><span class="p">.</span><span class="n">cfg</span>
</pre></div>
</div>
</div>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="am65x-evm-idk-board-set-up">
<h3>9.15.8.3. AM65x EVM/IDK Board Set up<a class="headerlink" href="#am65x-evm-idk-board-set-up" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Adding Termination Resistors to the MCAN Interface</p>
<blockquote>
<div><dl>
<dt>Reason for change</dt><dd><ul class="simple">
<li><p>The IDK Application board has two MCAN ports. The termination for the MCAN ports is not installed by default. If the termination is needed on the board, the following steps can be followed to add it.</p></li>
</ul>
</dd>
<dt>Items Needed</dt><dd><ul class="simple">
<li><p>Two 120 ohm resistors in 0603 package</p></li>
</ul>
</dd>
<dt>Modification</dt><dd><ul class="simple">
<li><p>Carefully remove the IDK application board by removing the four screws and gently separating the board from the connectors.</p></li>
<li><p>On the top of the board, solder a 120 ohm resistor to the footprint for R252.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/am65x_evm_idk_board_changes_for_mcan_interface1.png"><img alt="can-to-eth data flow" class="align-center" src="../_images/am65x_evm_idk_board_changes_for_mcan_interface1.png" style="width: 400.0px; height: 250.0px;" /></a>
<ul class="simple">
<li><p>On the bottom of the board, solder a 120 ohm resistor to the footprint for R130.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/am65x_evm_idk_board_changes_for_mcan_interface2.png"><img alt="can-to-eth data flow" class="align-center" src="../_images/am65x_evm_idk_board_changes_for_mcan_interface2.png" style="width: 400.0px; height: 250.0px;" /></a>
<ul class="simple">
<li><p>Reinstall the IDK Application board and return the screws.</p></li>
</ul>
</dd>
</dl>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="pcan-tool-set-up">
<h3>9.15.8.4. PCAN Tool Set up<a class="headerlink" href="#pcan-tool-set-up" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>CAN FD adapter PCAN-USB FD allows the connection of CAN FD and CAN networks to a computer via USB.</dt><dd><p>Product details: <a class="reference external" href="https://www.peak-system.com/PCAN-USB-FD.365.0.html?&amp;L=1">https://www.peak-system.com/PCAN-USB-FD.365.0.html?&amp;L=1</a></p>
</dd>
</dl>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Prerequisite (PC Setup):</dt><dd><ul class="simple">
<li><p>Download and install PCAN driver from: <a class="reference external" href="https://www.peak-system.com/quick/DrvSetup">https://www.peak-system.com/quick/DrvSetup</a></p></li>
<li><p>Download and install PCAN driver from: <a class="reference external" href="https://www.peak-system.com/quick/DrvSetup">https://www.peak-system.com/quick/DrvSetup</a></p></li>
<li><p>Download PCAN-View from: <a class="reference external" href="https://www.peak-system.com/fileadmin/media/files/pcanview.zip">https://www.peak-system.com/fileadmin/media/files/pcanview.zip</a></p></li>
<li><p>PCAN-View is a GUI based tool used to configure bit-rate of the PCAN tool. It provides a convenient was to see sent and received messages. It also provides an option to enable tracing of CAN messages along with timestamp</p></li>
<li><p>Please refer to PCAN-USB FD manual for more details</p></li>
</ul>
</dd>
</dl>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please check licensing information &amp; terms of usage of PCAN-USB product and make sure it
adheres your organizations policy before downloading the drivers.</p>
</div>
<ol class="arabic">
<li><dl>
<dt>PCAN Setup:</dt><dd><ul>
<li><p>Once driver is installed, connect PCAN to PC. It should be auto detected as ‘PCAN-USB FD’ in ‘Device Manager’. If it is not auto detected then re-install the PCAN driver</p></li>
<li><dl>
<dt>Once it is detected in Device Manager, open PCAN-View and follow below steps</dt><dd><ul>
<li><dl>
<dt>Click on ‘Connect’ from ‘CAN’ menu (as shown in below figure)</dt><dd><ul class="simple">
<li><p>Popped up window shall show connected PCAN hardware. Select that device.</p></li>
<li><dl class="simple">
<dt>Tick in the checkbox shown next to ‘Data Bit rate’</dt><dd><ul>
<li><p>This will enable Bit</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Select ‘Nominal Bit Rate’ as ‘1 MBits/s’</p></li>
<li><dl class="simple">
<dt>Select ‘Data Bit Rate’ as ‘5 MBits/s’</dt><dd><ul>
<li><p>Bit rates may vary from use-case to use-case.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Click on Ok button.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/pcan_view_device_selection.png"><img alt="can-to-eth data flow" class="align-center" src="../_images/pcan_view_device_selection.png" style="width: 250.0px; height: 250.0px;" /></a>
</dd>
</dl>
</li>
<li><dl>
<dt>Create and send message at period of 2sec</dt><dd><ul class="simple">
<li><p>Click on ‘New Message’ under ‘Transmit’ menu</p></li>
<li><p>Tick the check box present next to ‘CAN FD’</p></li>
<li><p>Tick the check box present next to ‘Bit Rate Switch’</p></li>
<li><dl class="simple">
<dt>Give below parameters /inputs:</dt><dd><ul>
<li><p>ID as hex ‘004’</p></li>
<li><p>Length as ‘64’</p></li>
<li><p>Cycle Time as ‘2000’</p></li>
<li><p>Data: as use-case needs</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<a class="reference internal image-reference" href="../_images/pcan_view_transmit_message_config.png"><img alt="can-to-eth data flow" class="align-center" src="../_images/pcan_view_transmit_message_config.png" style="width: 300.0px; height: 250.0px;" /></a>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>Creating Bit Rate Configurations:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Example for creating 5 Mbps bit rate configuration for ‘Data Bit Rate’(shown in below diagram)</dt><dd><ul>
<li><p>Click on ‘Connect’ under ‘CAN’ menu</p></li>
<li><p>Tick in the checkbox shown next to ‘Data Bit rate’</p></li>
<li><p>Click on Play button present below ‘Data Bit rate’ and then ‘Manage Bit rates’</p></li>
<li><p>Click on ‘Data’ in newly popped window</p></li>
<li><p>Select clock frequency as 80 MHz</p></li>
<li><p>Click on ‘Add’ button</p></li>
<li><p>Give caption as ‘5 MBits/s’</p></li>
<li><p>Program ‘Prescalar’, ‘tseg1’, ‘tseg2’, ‘Sync Jump Width’ as ‘1’, ‘12’, ‘3’, ‘1’ respectively.</p></li>
<li><p>Bit Rate text box shall show ‘5 Mbit/s’ after programming above values.</p></li>
<li><p>Click on ‘Ok’ and then again on ‘Ok’</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<a class="reference internal image-reference" href="../_images/pcan_view_different_bit_rate_config.png"><img alt="can-to-eth data flow" class="align-center" src="../_images/pcan_view_different_bit_rate_config.png" style="width: 400.0px; height: 250.0px;" /></a>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>CAN Bus Connections:</dt><dd><ul class="simple">
<li><p>CAN_H of all the nodes on the bus shall be connected together</p></li>
<li><p>Similarly CAN_L of all the nodes on the bus shall be connected together</p></li>
<li><p>Please refer to ‘PCAN-USB FD manual’ for more details about connections.</p></li>
</ul>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="load-and-run-the-demo">
<h3>9.15.8.5. Load and run the demo<a class="headerlink" href="#load-and-run-the-demo" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Connect the USB cable from your computer to the AM65xx_EVM’s JTAG port</p></li>
<li><p>Power on the AM65xx_EVM board. Ensure that no boot mode is entered (do
not have SD card loaded or QSPI flashed)</p></li>
<li><p>Open up a serial terminal for UART communication (Refer to <a class="reference internal" href="index_overview.html#processor-sdk-rtos-getting-started-guide-label"><span class="std std-ref">Processor
SDK RTOS Getting Started Guide</span></a>, setup
EVM hardware)</p></li>
<li><p>Open CCS and launch target config file for AM65xx_EVM (Refer to
<a class="reference external" href="index_how_to_guides.html#setup-ccs-for-evm-and-processor-sdk-rtos">Processor SDK RTOS Setup CCS</a> for setting up CCS)</p></li>
<li><p>Connect to MCU_PULSAR_Cortex_R5_0</p></li>
<li><p>Load the System firmware as specified in SCICLIENT documentation</p></li>
<li><p>Load and launch the demo executable:</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">PDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">ti</span><span class="o">/</span><span class="n">binary</span><span class="o">/</span><span class="n">gatewayapp</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">am65xx_idk</span><span class="o">/</span><span class="n">gatewayapp_mcu1_0_release</span><span class="p">.</span><span class="n">xer5f</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>The application print will be displayed on the CCS and UART console. The UART console used depends on the core in which the application is run.</p></li>
<li><p>Confirm the network connectivity of PC with board.
ping 192.168.1.4</p></li>
</ol>
<div class="section" id="can-to-eth">
<h4>9.15.8.5.1. CAN to ETH<a class="headerlink" href="#can-to-eth" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p>Connect the CAN PC tool.</p></li>
<li><p>Start the Ethernet receive application</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">eth_tx</span><span class="p">.</span><span class="n">exe</span><span class="p">[</span><span class="n">or</span> <span class="n">eth_tx</span><span class="p">.</span><span class="n">out</span><span class="p">]</span> <span class="mf">192.168.1.4</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>Start CAN message transmission from the CAN tool with below information</dt><dd><ul class="simple">
<li><p>ID as hex ‘004’</p></li>
<li><p>Length as ‘64’</p></li>
<li><p>Cycle Time as ‘2000’</p></li>
<li><p>Data can be any user specified data</p></li>
</ul>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="eth-to-can">
<h4>9.15.8.5.2. ETH to CAN<a class="headerlink" href="#eth-to-can" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p>Connect the CAN PC tool.</p></li>
<li><p>Start the Ethernet transmit application</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">eth_rx</span><span class="p">.</span><span class="n">exe</span><span class="p">[</span><span class="n">or</span> <span class="n">eth_rx</span><span class="p">.</span><span class="n">out</span><span class="p">]</span> <span class="o">--</span><span class="n">ip</span> <span class="mf">192.168.1.4</span> <span class="p">[</span><span class="o">--</span><span class="n">port</span> <span class="o">&lt;</span><span class="n">portNum</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">framerate</span> <span class="o">&lt;</span><span class="n">frames</span> <span class="n">per</span> <span class="n">seconds</span><span class="o">&gt;</span><span class="p">]</span>

 <span class="n">port</span> <span class="n">and</span> <span class="n">framerate</span> <span class="n">are</span> <span class="n">optional</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Once Ethernet transmit application starts sending data out, CAN PC tool shall receive a CAN FD message with ID hex ‘009’</p></li>
</ol>
</div>
</div>
</div>
<div class="section" id="terminal-screen-shot">
<h2>9.15.9. Terminal Screen-shot<a class="headerlink" href="#terminal-screen-shot" title="Permalink to this headline">¶</a></h2>
<p>Below is a terminal output after one simulation:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Board_init</span> <span class="n">success</span>

<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">BOARD</span> <span class="n">IP</span> <span class="n">address</span> <span class="n">I</span><span class="o">/</span><span class="n">F</span> <span class="mi">1</span><span class="o">:</span> <span class="mf">192.168.1.14</span>

<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">GATEWAY</span> <span class="n">Tasks</span><span class="p">...</span>
<span class="n">Gateway</span> <span class="nl">Tx</span><span class="p">:</span> <span class="n">Server</span> <span class="n">listening</span> <span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span> <span class="o">!!!</span>

<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">Network</span> <span class="n">Tx</span> <span class="n">socket</span> <span class="n">open</span> <span class="n">done</span><span class="p">..</span>
<span class="n">Gateway</span> <span class="nl">Tx</span><span class="p">:</span> <span class="n">Server</span> <span class="n">listening</span> <span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span> <span class="o">!!!</span>

<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">Network</span> <span class="n">Rx</span> <span class="n">socket</span> <span class="n">open</span> <span class="n">done</span><span class="p">..</span>
<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">CrossBar</span><span class="o">/</span><span class="n">Interrupt</span> <span class="n">Configuration</span> <span class="n">done</span><span class="p">.</span>
<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">MCANSS</span> <span class="n">Revision</span> <span class="nl">ID</span><span class="p">:</span>
<span class="nl">GatewayApp</span><span class="p">:</span> <span class="nl">scheme</span><span class="p">:</span><span class="mh">0x1</span>
<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">Business</span> <span class="nl">Unit</span><span class="p">:</span><span class="mh">0x2</span>
<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">Module</span> <span class="nl">ID</span><span class="p">:</span><span class="mh">0x8e0</span>
<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">RTL</span> <span class="nl">Revision</span><span class="p">:</span><span class="mh">0x5</span>
<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">Major</span> <span class="nl">Revision</span><span class="p">:</span><span class="mh">0x1</span>
<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">Custom</span> <span class="nl">Revision</span><span class="p">:</span><span class="mh">0x0</span>
<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">Minor</span> <span class="nl">Revision</span><span class="p">:</span><span class="mh">0x1</span>
<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">CAN</span><span class="o">-</span><span class="n">FD</span> <span class="n">operation</span> <span class="n">is</span> <span class="n">enabled</span> <span class="n">through</span> <span class="n">E</span><span class="o">-</span><span class="n">Fuse</span><span class="p">.</span>
<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">Endianess</span> <span class="nl">Value</span><span class="p">:</span> <span class="mh">0x87654321</span>

<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">MCAN</span> <span class="n">Transmitter</span> <span class="n">app</span> <span class="n">started</span><span class="p">..</span>

<span class="n">Received</span> <span class="mi">0</span> <span class="n">Transmitted</span> <span class="mi">0</span>
<span class="nl">LOAD</span><span class="p">:</span> <span class="nl">CPU</span><span class="p">:</span> <span class="mf">0.6</span><span class="o">%</span> <span class="nl">HWI</span><span class="p">:</span> <span class="mf">0.1</span><span class="o">%</span><span class="p">,</span> <span class="nl">SWI</span><span class="p">:</span><span class="mf">0.1</span><span class="o">%</span>
<span class="nl">LOAD</span><span class="p">:</span> <span class="nl">TSK</span><span class="p">:</span> <span class="n">Gateway</span> <span class="nl">Tx</span><span class="p">:</span> <span class="mf">0.1</span><span class="o">%</span>
<span class="nl">MISC</span><span class="p">:</span> <span class="mf">0.3</span><span class="o">%</span>

<span class="nl">GatewayApp</span><span class="p">:</span> <span class="n">CAN</span> <span class="n">stats</span> <span class="o">-</span> <span class="n">Received</span> <span class="mi">500</span> <span class="n">Transmitted</span> <span class="mi">500</span>
<span class="nl">LOAD</span><span class="p">:</span> <span class="nl">CPU</span><span class="p">:</span> <span class="mf">6.6</span><span class="o">%</span> <span class="nl">HWI</span><span class="p">:</span> <span class="mf">0.5</span><span class="o">%</span><span class="p">,</span> <span class="nl">SWI</span><span class="p">:</span><span class="mf">0.1</span><span class="o">%</span>
<span class="nl">LOAD</span><span class="p">:</span> <span class="nl">TSK</span><span class="p">:</span> <span class="n">Gateway</span> <span class="nl">Rx</span><span class="p">:</span> <span class="mf">1.6</span><span class="o">%</span>
<span class="nl">LOAD</span><span class="p">:</span> <span class="nl">TSK</span><span class="p">:</span> <span class="n">Gateway</span> <span class="nl">Tx</span><span class="p">:</span> <span class="mf">0.6</span><span class="o">%</span>
<span class="nl">MISC</span><span class="p">:</span> <span class="mf">3.8</span><span class="o">%</span>
</pre></div>
</div>
<div class="section" id="known-issues-limitations">
<h3>9.15.9.1. Known issues &amp; limitations<a class="headerlink" href="#known-issues-limitations" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Polling mode is not supported in the Gateway application.</p></li>
<li><p>Re-transmission of failed CAN message is not supported.</p></li>
<li><p>Ethernet 100Mbps is not supported. Gigabit only supported.</p></li>
</ol>
</div>
</div>
</div>
<div class="section" id="sercos-iii-softmaster">
<h1>9.16. Sercos III Softmaster<a class="headerlink" href="#sercos-iii-softmaster" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id79">
<h2>9.16.1. Overview<a class="headerlink" href="#id79" title="Permalink to this headline">¶</a></h2>
<p>Sercos III is a third-generation industrial control interface that merges a hard real-time communications protocol with Ethernet by introducing a synchronized cyclic communication over Ethernet. To achieve true hard real time characteristics, Sercos III uses a form of synchronization that depends upon a synchronization “mark” issued by the master control at exact equidistant time intervals.
As shown in the figure below, the Real-Time (RT) packets are merged with Non Real-Time (NRT) Ethernet traffic, and the real-time packets are sent in a cyclic manner which can be achieved by Time Triggered Send (TTS). The first MDT packet (MDT0) contains the synchronization “mark” issued from the master.</p>
<blockquote>
<div><ul class="simple">
<li><p>MDT (Master Data Telegram): contains information provided by the master to slaves</p></li>
<li><p>AT (Acknowledge Telegram): issued by the master but populated by the individual slave with their response data.</p></li>
</ul>
</div></blockquote>
<img alt="../_images/Sercos3_cyclicPkts.png" class="align-center" src="../_images/Sercos3_cyclicPkts.png" />
</div>
<div class="section" id="id80">
<h2>9.16.2. Architecture Overview<a class="headerlink" href="#id80" title="Permalink to this headline">¶</a></h2>
<p>Bosch Rexroth Sercos III SoftMaster software has been developed to provide an interface that is 100% compatible with previous generation of hardware-implemented Sercos III master interfaces. This enables the existing library of CoSeMa (Common Sercos Master) driver software to be used without modification. The PRU-ICSS Softmaster implements SercosIII Softmaster stack on TI Sitara Embedded Processors and enables real-time communication via PRU-ICSS EMAC firmware and LLD.</p>
<p>The following block diagram shows software architecture blocks of TI’s Sitara implementation of Sercos III Softmaster.</p>
<img alt="../_images/Softmaster_software_Arch.png" class="align-center" src="../_images/Softmaster_software_Arch.png" />
</div>
<div class="section" id="mdt-at-telegrams-tx-queue-distribution">
<h2>9.16.3. MDT/AT Telegrams - TX queue distribution<a class="headerlink" href="#mdt-at-telegrams-tx-queue-distribution" title="Permalink to this headline">¶</a></h2>
<p>MDT0 packets are mapped to the highest priority TX Queue (Queue1). MDT1 to MDT3 go to Queue 2. AT0 to AT3 packets go to Queue3 and non-real time packets to Queue4.</p>
</div>
<div class="section" id="id81">
<h2>9.16.4. Directory Structure<a class="headerlink" href="#id81" title="Permalink to this headline">¶</a></h2>
<p>Sercos III Softmaster demo is located in the Processor SDK RTOS
release under the directory path</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">sercos3</span><span class="o">-</span><span class="n">softmaster</span>
</pre></div>
</div>
<p>Detailed description of the directory structure is given below:</p>
<ul class="simple">
<li><p>sercos3-softmaster - is the main directory and contains makefile.</p></li>
<li><p>bin - directory contains output executables.</p></li>
<li><p>Module - directory contains Softmaster stack modules.</p></li>
<li><p>Module/RTTI - directory contains mayority of TI modifications to Softmaster stack.</p></li>
</ul>
</div>
<div class="section" id="id82">
<h2>9.16.5. Components Used<a class="headerlink" href="#id82" title="Permalink to this headline">¶</a></h2>
<p>RTOS Components:</p>
<ul class="simple">
<li><p>SYSBIOS</p></li>
<li><p>XDC</p></li>
<li><p>PDK</p></li>
</ul>
<p>Processor SDK RTOS Drivers:</p>
<ul class="simple">
<li><p>EMAC</p></li>
<li><p>UART</p></li>
<li><p>Board</p></li>
<li><p>OSAL</p></li>
<li><p>CSL</p></li>
</ul>
</div>
<div class="section" id="id83">
<h2>9.16.6. Building the Demo<a class="headerlink" href="#id83" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>If building in windows use gmake instead of make.</p>
</div>
</div></blockquote>
<p>The demo application is built using makefile.</p>
<p>You must first set up your development environment. Refer to
the <a class="reference external" href="index_overview.html#building-the-sdk">Processor SDK RTOS Building</a> page for
information on setting up your build environment.</p>
<p>The following are steps to clean the demo:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">sercos3</span><span class="o">-</span><span class="n">softmaster</span>
<span class="n">make</span> <span class="n">clean</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="p">[</span><span class="n">SDK</span> <span class="n">Install</span> <span class="n">Path</span><span class="p">]</span><span class="o">/</span><span class="n">processor_sdk_rtos_</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="n">_</span><span class="p">[</span><span class="n">version</span><span class="p">]</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">sercos3</span><span class="o">-</span><span class="n">softmaster</span>
<span class="n">make</span> <span class="n">all</span>
</pre></div>
</div>
</div>
<div class="section" id="enabling-time-triggered-send-tts">
<h2>9.16.7. Enabling Time Triggered Send (TTS)<a class="headerlink" href="#enabling-time-triggered-send-tts" title="Permalink to this headline">¶</a></h2>
<p>The EMAC Time Triggered Send (TTS) is used to expand classical Ethernet to meet deterministic, time-critical or safety-relevant conditions. TTS reduces helps to reduce transmission jitter from 10us range to 40ns. Refer to <a class="reference external" href="http://processors.wiki.ti.com/index.php/ICSS_EMAC_LLD_developers_guide#Time_Triggered_Send">http://processors.wiki.ti.com/index.php/ICSS_EMAC_LLD_developers_guide#Time_Triggered_Send</a> for more details.</p>
<ul class="simple">
<li><p>In RTTI_GLOB.h define RTTI_PRU_TTS_NIC_TIMED macro.</p></li>
<li><p>In RTTI_S3SM_USER.h for TTS define RTOS_USE_NIC_TIMED_TX and commented out RTOS_TIMING_REL_NANOSLEEP.</p></li>
<li><p>In SICE_USER.h define SICE_USE_NIC_TIMED_TX.</p></li>
</ul>
</div>
<div class="section" id="enabling-redundancy">
<h2>9.16.8. Enabling Redundancy<a class="headerlink" href="#enabling-redundancy" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Redundancy only works if TTS is enabled.</p>
</div>
</div></blockquote>
<ul class="simple">
<li><p>In RTTI_GLOB.h define or undefined RTTI_REDUNDANCY macro.</p></li>
<li><p>In SICE_USER.h define SICE_REDUNDANCY macro.</p></li>
</ul>
</div>
<div class="section" id="id84">
<h2>9.16.9. Running the Demo<a class="headerlink" href="#id84" title="Permalink to this headline">¶</a></h2>
<p>You will need the following:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>EVM’s supported</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>AM335x ICEv2</p></td>
</tr>
</tbody>
</table>
<div class="section" id="additional-hardware">
<h3>9.16.9.1. Additional Hardware<a class="headerlink" href="#additional-hardware" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>A Sercos III slave for connecting/testing PRU-ICSS Sercos III Softmaster.</p></li>
<li><p>Ethernet LAN Cable.</p></li>
<li><p>USB to micro USB cable for JTAG and serial terminal.</p></li>
</ol>
</div>
<div class="section" id="sd-card-creation">
<h3>9.16.9.2. SD Card Creation<a class="headerlink" href="#sd-card-creation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Windows instructions: <a class="reference external" href="http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_overview.html#windows-sd-card-creation-guide">http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_overview.html#windows-sd-card-creation-guide</a>.</p></li>
<li><p>Linux instrunctions: <a class="reference external" href="http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_overview.html#tools-create-sd-card-linux-label">http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_overview.html#tools-create-sd-card-linux-label</a>.</p></li>
<li><p>Copy binary /bin/am335x/a8/debug into SD card as “app”</p></li>
<li><p>Copy SD card SBL (MLO) into SD card. Prebuilt MLO location: [SDK Install Path]/processor_sdk_rtos_[soc]_[version]prebuilt-sdcardsevmAM335xsd_card_files</p></li>
</ul>
</div>
<div class="section" id="id85">
<h3>9.16.9.3. Set up<a class="headerlink" href="#id85" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Connect AM335x ICEv2 Eth0 to Sercos III slave with a LAN cable.</p></li>
<li><p>Connect USB cable between a Host PC, and AM335x’s ICEv2 micro USB port.</p></li>
<li><dl class="simple">
<dt>Configure and run teraterm.</dt><dd><ul class="simple">
<li><p>Speed : 115200</p></li>
<li><p>Data : 8</p></li>
<li><p>Parity / Flow control : none</p></li>
<li><p>Stop bits : 1 bit</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>After SercosIII Softmaster initialize, Enter “m” for menu (optional step).</p></li>
<li><p>Then enter “f”, to Go to CP4 with automatic slave configuration.</p></li>
<li><p>After CP4 is reached, enable output with “y”.</p></li>
</ol>
</div>
<div class="section" id="supported-features">
<h3>9.16.9.4. Supported features<a class="headerlink" href="#supported-features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Standard timing.</p></li>
<li><p>NIC timing via Time Triggered Send.</p></li>
<li><p>Redundancy.</p></li>
<li><p>Minimum cycle time 1ms.</p></li>
</ul>
</div>
<div class="section" id="unsupported-features">
<h3>9.16.9.5. Unsupported features<a class="headerlink" href="#unsupported-features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Different cycle time for different Communication Phase (CP).</p></li>
<li><p>Hot-plugging (not tested).</p></li>
<li><p>NRT communication (no tested).</p></li>
<li><p>Communication method 2.</p></li>
</ul>
</div>
<div class="section" id="fixed-issues">
<h3>9.16.9.6. Fixed issues<a class="headerlink" href="#fixed-issues" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>PRU-ICSS EMAC TX queuing performance issue. PRSDK-4965.</p></li>
</ol>
</div>
<div class="section" id="id86">
<h3>9.16.9.7. Known issues &amp; limitations<a class="headerlink" href="#id86" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>PRU-ICSS EMAC + TTS : Corrupted Rx packet at host from Firmware. PRSDK-4548.</p></li>
<li><p>Redundancy can be stablished if system starts as line topology and in CP4, second port is connected in ring topology, but sometimes it fails if systems starts in ring topology.</p></li>
</ol>
</div>
</div>
</div>
<div class="section" id="interrupt-latency-benchmark">
<h1>9.17. Interrupt Latency Benchmark<a class="headerlink" href="#interrupt-latency-benchmark" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id87">
<h2>9.17.1. Introduction<a class="headerlink" href="#id87" title="Permalink to this headline">¶</a></h2>
<p>This page describes the interrupt latency benchmark provided in the
Processor-SDK for RTOS. This benchmark gives several options for
different types of load configurations.</p>
<p>This benchmark runs on:</p>
<ul class="simple">
<li><p>AM572x (A15)</p></li>
<li><p>AM65xx (A53)</p></li>
</ul>
<p>The sections below provide details of the application as well as build
and run instructions.</p>
</div>
<div class="section" id="id88">
<h2>9.17.2. Requirements<a class="headerlink" href="#id88" title="Permalink to this headline">¶</a></h2>
<p>The following materials are required to run this demonstration:</p>
<p>Hardware</p>
<ul class="simple">
<li><p>TI EVM (see list above)</p></li>
<li><p>Micro USB cable (provided in EVM kit)</p></li>
</ul>
<p>Software</p>
<ul class="simple">
<li><p>Processor-SDK RTOS</p></li>
<li><p>Code Composer Studio</p></li>
</ul>
</div>
<div class="section" id="id89">
<h2>9.17.3. Software Design<a class="headerlink" href="#id89" title="Permalink to this headline">¶</a></h2>
<p>The purpose of this benchmark is to measure the worst case interrupt
latency under load. This load is achieved by simultaneously running
a modified version of the Dhrystone benchmark.</p>
<div class="section" id="dhrystone">
<h3>9.17.3.1. Dhrystone<a class="headerlink" href="#dhrystone" title="Permalink to this headline">¶</a></h3>
<p>The Dhrystone code is modified to run continuously. Instead of testing
the host system for DMIPS, Dhrystone threads are created repeatedly
until the benchmark completes. Essentially, once a Dhrystone thread
finishes, it is created again. Additionally, the user can specify the
number of Dhrystone threads to be created.</p>
</div>
<div class="section" id="id90">
<h3>9.17.3.2. Interrupt Latency Benchmark<a class="headerlink" href="#id90" title="Permalink to this headline">¶</a></h3>
<p>Several design choices were made when creating the interrupt latency
benchmark.</p>
<ul class="simple">
<li><dl class="simple">
<dt>The benchmark task is set to core 0</dt><dd><ul>
<li><p>Core 0 is the A15_0/A53_0 core,
and is the primary core for the benchmark. The benchmark is forced to
operate only on this core, no matter the load. This is achieved by setting
the affinity of the task parameter to 0</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The benchmark task needs to have a higher priority than the Dhrystone threads</dt><dd><ul>
<li><p>If the Dhrystone threads have a priority level that is greater
than or equal to the benchmark task priority, then the scheduler will schedule
the two to execute one after another. Thus, the benchmark task will not run
while the Dhrystone thread is running, but the timer will continue to fire.
As a result, the benchmark task is stalled and returns invalid data when it
resumes</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Results are printed to the UART</dt><dd><ul>
<li><p>A UART-based menu has been implemented on the main UART</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="id91">
<h2>9.17.4. How to Build the Demo<a class="headerlink" href="#id91" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id92">
<h3>9.17.4.1. Processor-SDK RTOS<a class="headerlink" href="#id92" title="Permalink to this headline">¶</a></h3>
<p>To build the project, navigate to the benchmark’s directory and
run “gmake clean” and then “gmake all” on windows, or “make
clean” and “make all” on Linux.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">PROC_SDK_INSTALL_PATH</span><span class="o">&gt;/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">interrupt_latency</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id93">
<h2>9.17.5. How to Run the Demo<a class="headerlink" href="#id93" title="Permalink to this headline">¶</a></h2>
<p>After building the benchmark, locate the binary under the relevant
device directory in the interrupt latency benchmark’s bin/ directory.
Additionally, power on the board, connect the micro-USB cable to the
UART port, and begin a UART console.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">PROC_SDK_INSTALL_PATH</span><span class="o">&gt;/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">interrupt_latency</span><span class="o">/</span><span class="n">bin</span><span class="o">/&lt;</span><span class="n">soc</span><span class="o">&gt;/</span>
</pre></div>
</div>
<div class="section" id="ccs">
<h3>9.17.5.1. CCS<a class="headerlink" href="#ccs" title="Permalink to this headline">¶</a></h3>
<p>To run the benchmark on AM572xx using CCS, use the following steps.</p>
<ol class="arabic simple">
<li><p>Using CCS, launch the target configuration for the EVM CCS-Target
Configurations (<a class="reference external" href="http://software-dl.ti.com/ccs/esd/documents/ccs_custom_target_config.html">http://software-dl.ti.com/ccs/esd/documents/ccs_custom_target_config.html</a>)</p></li>
<li><p>In the CCS debug view, create a sync group (<a class="reference external" href="http://software-dl.ti.com/ccs/esd/documents/ccs_smp-debug.html">http://software-dl.ti.com/ccs/esd/documents/ccs_smp-debug.html</a>)
with the A15 cores</p></li>
<li><p>For each core, connect to it and load the binary. The A15_0
core should halt at main while the SMP linked cores will begin
auto-running upon load</p></li>
<li><p>Once all cores have been loaded, run them all</p></li>
<li><p>The output will be sent to the UART console in real time</p></li>
<li><p>You must manually halt the cores to end the benchmark</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>If running in non-SMP mode, do not create a sync group. Only
load and run the binary on the A15_0 core</p></li>
</ul>
</div>
<p>To run the benchmark on AM65x using CCS, use the following steps.</p>
<ol class="arabic simple">
<li><p>If this is the first time running the benchmark, refer to the
following link to setup CCS for AM65x (<a class="reference external" href="http://software-dl.ti.com/processor-sdk-linux/esd/docs/latest/linux/How_to_Guides_Hardware_Setup_with_CCS.html#advanced-am65x-debug-setup-with-dmsc-firmware-load">http://software-dl.ti.com/processor-sdk-linux/esd/docs/latest/linux/How_to_Guides_Hardware_Setup_with_CCS.html#advanced-am65x-debug-setup-with-dmsc-firmware-load</a>)</p></li>
<li><p>Once setup, click the drop down arrow next to the debug button
and select Debug Configurations</p></li>
<li><p>Select your corresponding AM65x .ccxml file and click Debug</p></li>
<li><p>In the CCS debug view, disconnect the R5_0 core</p></li>
<li><p>Create a sync group (<a class="reference external" href="http://software-dl.ti.com/ccs/esd/documents/ccs_smp-debug.html">http://software-dl.ti.com/ccs/esd/documents/ccs_smp-debug.html</a>)
with the A53 cores and connect to them all</p></li>
<li><p>Load the binary to all of the cores. The A53_0 core
should halt at main while the SMP linked cores will begin
auto-running upon load</p></li>
<li><p>Once all cores have been loaded, run them all</p></li>
<li><p>The output will be sent to the UART console in real time</p></li>
<li><p>You must manually halt the cores to end the benchmark</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>If running in non-SMP mode, do not create a sync group.
Only load and run the binary on the A53_0 core</p></li>
</ul>
</div>
</div>
<div class="section" id="secondary-bootloader-sbl">
<h3>9.17.5.2. Secondary Bootloader (SBL)<a class="headerlink" href="#secondary-bootloader-sbl" title="Permalink to this headline">¶</a></h3>
<p>To run the benchmark on a micro-SD card, follow the
corresponding steps for AM57x (<a class="reference external" href="http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_Foundational_Components.html#am57x">http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_Foundational_Components.html#am57x</a>)
and AM65x (<a class="reference external" href="http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_Foundational_Components.html#am65x">http://software-dl.ti.com/processor-sdk-rtos/esd/docs/latest/rtos/index_Foundational_Components.html#am65x</a>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The binary is the same format as a .out file</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="known-issues-and-limitations">
<h2>9.17.6. Known Issues and Limitations<a class="headerlink" href="#known-issues-and-limitations" title="Permalink to this headline">¶</a></h2>
<p>When running the benchmark, keep in mind the following
issues which are still being fixed.</p>
<ol class="arabic simple">
<li><p>SMP mode for AM65x is not working</p></li>
<li><p>Loading through SBL on AM65x has not been verified</p></li>
<li><p>The cause for several outliers in the data is being
investigated</p></li>
</ol>
</div>
<div class="section" id="results">
<h2>9.17.7. Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>AM572x</p></th>
<th class="head"><p>SMP Disabled
Dhrystone Disabled</p></th>
<th class="head"><p>SMP Disabled
Dhrystone Enabled
One Dhry Thread</p></th>
<th class="head"><p>SMP Disabled
Dhrystone Enabled
Two Dhry Threads</p></th>
<th class="head"><p>SMP Enabled
Dhrystone Disabled</p></th>
<th class="head"><p>SMP Enabled
Dhrystone Enabled
One Dhry Thread</p></th>
<th class="head"><p>SMP Enabled
Dhrystone Enabled
Two Dhry Threads</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>HW Interrupt Latency</strong></p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><strong>Average Max</strong></p></td>
<td><p>0.602 us</p></td>
<td><p>0.576 us</p></td>
<td><p>0.579 us</p></td>
<td><p>1.159 us</p></td>
<td><p>1.150 us</p></td>
<td><p>1.063 us</p></td>
</tr>
<tr class="row-even"><td><p><strong>Average Min</strong></p></td>
<td><p>0.572 us</p></td>
<td><p>0.572 us</p></td>
<td><p>0.572 us</p></td>
<td><p>1.121 us</p></td>
<td><p>1.102 us</p></td>
<td><p>1.040 us</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Absolute Max</strong></p></td>
<td><p>1.510 us</p></td>
<td><p>1.354 us</p></td>
<td><p>1.354 us</p></td>
<td><p>2.916 us</p></td>
<td><p>2.916 us</p></td>
<td><p>3.385 us</p></td>
</tr>
<tr class="row-even"><td><p><strong>Absolute Min</strong></p></td>
<td><p>0.572 us</p></td>
<td><p>0.572 us</p></td>
<td><p>0.572 us</p></td>
<td><p>1.041 us</p></td>
<td><p>0.885 us</p></td>
<td><p>0.885 us</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Semaphore Wake Latency</strong></p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><strong>Average Max</strong></p></td>
<td><p>1.281 us</p></td>
<td><p>1.329 us</p></td>
<td><p>1.281 us</p></td>
<td><p>2.645 us</p></td>
<td><p>2.665 us</p></td>
<td><p>2.812 us</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Average Min</strong></p></td>
<td><p>1.249 us</p></td>
<td><p>1.250 us</p></td>
<td><p>1.250 us</p></td>
<td><p>2.581 us</p></td>
<td><p>2.551 us</p></td>
<td><p>2.657 us</p></td>
</tr>
<tr class="row-even"><td><p><strong>Absolute Max</strong></p></td>
<td><p>2.968 us</p></td>
<td><p>2.812 us</p></td>
<td><p>2.812 us</p></td>
<td><p>5.625 us</p></td>
<td><p>5.468 us</p></td>
<td><p>7.500 us</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Absolute Min</strong></p></td>
<td><p>1.093 us</p></td>
<td><p>1.250 us</p></td>
<td><p>1.250 us</p></td>
<td><p>2.343 us</p></td>
<td><p>2.343 us</p></td>
<td><p>2.343 us</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="How_to_Guides.html" class="btn btn-neutral float-right" title="10. How to Guides" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Examples_and_Demonstrations.html" class="btn btn-neutral" title="9. Examples and Demonstrations" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2019</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'06_01_00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>