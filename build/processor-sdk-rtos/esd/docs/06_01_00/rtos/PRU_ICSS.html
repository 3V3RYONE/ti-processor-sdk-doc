

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7. PRU-ICSS Firmware &mdash; Processor SDK RTOS Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Processor SDK RTOS Documentation" href="../index.html"/>
        <link rel="next" title="7.1. Dual EMAC and Switch" href="index_pru_icss_fw.html"/>
        <link rel="prev" title="6.1. CSL" href="index_device_drv.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Processor SDK RTOS
          

          
          </a>

          
            
            
              <div class="version">
                06_01_00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Release_Specific.html">2. Release Specific</a></li>
<li class="toctree-l1"><a class="reference internal" href="Board_EVM_Abstration.html">3. Board/EVM Abstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Foundational_Components.html">4. Foundational Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="DSP_Software.html">5. DSP Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="Device_Drivers.html">6. Device Drivers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">7. PRU-ICSS Firmware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html">7.1. Dual EMAC and Switch</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#icss-g-dual-emac">7.2. ICSS-G Dual EMAC</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#pru-icss-sorte">7.3. PRU-ICSS SORTE</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#pru-icss-i2c">7.4. PRU-ICSS I2C</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#pru-icss-iolink">7.5. PRU-ICSS IOLINK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pru-icss-espi">7.6. PRU-ICSS ESPI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">7.6.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#firmware-organization">7.6.2. Firmware Organization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#firmware-build-instruction">7.6.3. Firmware Build Instruction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#build-instruction-from-processor-sdk-release-package">7.6.3.1. Build instruction from Processor SDK Release package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#supported-evms">7.6.4. Supported EVMs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#espi-applications">7.6.5. eSPI Applications</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pru-icss-uart">7.7. PRU-ICSS UART</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">7.7.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#firmware-features">7.7.2. FIRMWARE FEATURES</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">7.7.3. Firmware Organization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#firmware-build-instructions">7.7.4. Firmware Build Instructions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#build-instructions-from-processor-sdk-release-package">7.7.4.1. Build instructions from Processor SDK Release package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id3">7.7.5. Supported EVMs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uart-firmware-example-test">7.7.6. UART Firmware Example &amp; Test</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Compilers.html">8. Compilers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Examples_and_Demonstrations.html">9. Examples and Demonstrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="How_to_Guides.html">10. How to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">11. Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Documentation_Tarball.html">12. Documentation Tarball</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Processor SDK RTOS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>7. PRU-ICSS Firmware</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pru-icss-firmware">
<h1>7. PRU-ICSS Firmware<a class="headerlink" href="#pru-icss-firmware" title="Permalink to this headline">Â¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="index_pru_icss_fw.html">7.1. Dual EMAC and Switch</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#introduction">7.1.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#dual-emac">7.1.2. DUAL_EMAC</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#switch">7.1.3. SWITCH</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#code-organization">7.1.4. Code Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#firmware-build-instruction">7.1.5. Firmware Build Instruction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_pru_icss_fw.html#build-instruction-from-processor-sdk-release-package">7.1.5.1. Build instruction from Processor SDK Release package</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_pru_icss_fw.html#build-instruction-from-git">7.1.5.2. Build instruction from GIT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#supported-evms">7.1.6. Supported EVMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#running-icss-emac-firmwares-example">7.1.7. Running ICSS-EMAC FIRMWARES Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index_pru_icss_fw.html#icss-g-dual-emac">7.2. ICSS-G Dual EMAC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#id1">7.2.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#id2">7.2.2. DUAL_EMAC</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#firmware-code-location-and-build-instruction">7.2.3. Firmware Code Location and Build Instruction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index_pru_icss_fw.html#pru-icss-sorte">7.3. PRU-ICSS SORTE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#id3">7.3.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#protocol-overview">7.3.2. Protocol Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#id4">7.3.3. Code Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#building-the-examples">7.3.4. Building the Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_pru_icss_fw.html#id5">7.3.4.1. Pre-requisites to Building</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_pru_icss_fw.html#compiling-the-pruss-sorte-firmware">7.3.4.2. Compiling the PRUSS SORTE Firmware</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_pru_icss_fw.html#compiling-the-pruss-sorte-application">7.3.4.3. Compiling the PRUSS SORTE Application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#id6">7.3.5. Supported EVMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#running-the-pruss-sorte-example">7.3.6. Running the PRUSS SORTE Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#additional-reference">7.3.7. Additional Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index_pru_icss_fw.html#pru-icss-i2c">7.4. PRU-ICSS I2C</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#id7">7.4.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#firmware-features">7.4.2. FIRMWARE FEATURES</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#firmware-organization">7.4.3. Firmware Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#id8">7.4.4. Firmware Build Instruction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_pru_icss_fw.html#id9">7.4.4.1. Build instruction from Processor SDK Release package</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_pru_icss_fw.html#build-instruction-for-git">7.4.4.2. Build instruction for GIT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#id11">7.4.5. Supported EVMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#i2c-firmware-example">7.4.6. I2C FIRMWARE Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index_pru_icss_fw.html#pru-icss-iolink">7.5. PRU-ICSS IOLINK</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#id13">7.5.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#id14">7.5.2. FIRMWARE FEATURES</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#id15">7.5.3. Firmware Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#id16">7.5.4. Firmware Build Instruction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index_pru_icss_fw.html#id17">7.5.4.1. Build instruction from Processor SDK Release package</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_pru_icss_fw.html#id19">7.5.4.2. Build instruction for GIT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_pru_icss_fw.html#id20">7.5.5. Supported EVMs</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="pru-icss-espi">
<h2>7.6. PRU-ICSS ESPI<a class="headerlink" href="#pru-icss-espi" title="Permalink to this headline">Â¶</a></h2>
<span class="target" id="pru-icss-espi-firmware-label"></span><div class="section" id="introduction">
<h3>7.6.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">Â¶</a></h3>
<div class="line-block">
<div class="line">PRU-ICSS eSPI serves as an example for firmware-based eSPI peripheral
support. The Processor SDK package includes full source code for eSPI FW.</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="firmware-organization">
<h3>7.6.2. Firmware Organization<a class="headerlink" href="#firmware-organization" title="Permalink to this headline">Â¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>FW Item</strong></p></th>
<th class="head"><p><strong>Directory</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Source code</p></td>
<td><p>&lt;PDK&gt;/packages/ti/drv/spi/firmware/icss_espi/src/</p></td>
</tr>
<tr class="row-odd"><td><p>Design Guide</p></td>
<td><p>&lt;PDK&gt;/packages/ti/drv/spi/docs/</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="firmware-build-instruction">
<h3>7.6.3. Firmware Build Instruction<a class="headerlink" href="#firmware-build-instruction" title="Permalink to this headline">Â¶</a></h3>
<div class="section" id="build-instruction-from-processor-sdk-release-package">
<h4>7.6.3.1. Build instruction from Processor SDK Release package<a class="headerlink" href="#build-instruction-from-processor-sdk-release-package" title="Permalink to this headline">Â¶</a></h4>
<p class="rubric" id="espi-pre-requisites-to-building">Pre-requisites to Building</p>
<p>Refer to the Processor SDK RTOS Building page for information on setting up the build environment.</p>
<p class="rubric" id="espi-compiling-driver-firmware">Compiling Driver/Firmware</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">spi</span></code></p></li>
</ol>
<p class="rubric" id="espi-run-app">Running CCS Application</p>
<p>CCS applications will be build and run just like any other project with one exception. Before loading the binary, from the menu-bar run <code class="docutils literal notranslate"><span class="pre">Scripts</span> <span class="pre">&gt;</span> <span class="pre">PRU_ICSS</span> <span class="pre">&gt;</span> <span class="pre">PRU_ICSS_Init</span></code>.</p>
</div>
</div>
<div class="section" id="supported-evms">
<h3>7.6.4. Supported EVMs<a class="headerlink" href="#supported-evms" title="Permalink to this headline">Â¶</a></h3>
<p>Supported EVMs and pin configurations for these EVMs are listed below. See the design document in <code class="docutils literal notranslate"><span class="pre">&lt;PDK&gt;/packages/ti/drv/spi/docs/</span></code> for more information.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 40%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>EVM Name</p></th>
<th class="head"><p>PRU-ICSS Instances</p></th>
<th class="head"><p>PRU-ICSS Revision</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bbbAM335x</p></td>
<td><p>1</p></td>
<td><p>REV1</p></td>
</tr>
<tr class="row-odd"><td><p>idkAM437x</p></td>
<td><p>2</p></td>
<td><p>REV1</p></td>
</tr>
</tbody>
</table>
<p class="rubric" id="espi-bbbam335x">bbbAM335x</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 11%" />
<col style="width: 21%" />
<col style="width: 32%" />
<col style="width: 12%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Core</p></th>
<th class="head"><p>PRU</p></th>
<th class="head"><p>Functional Pin</p></th>
<th class="head"><p>GPIO Pins</p></th>
<th class="head"><p>EVM Port</p></th>
<th class="head"><p>EVM Pin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="12"><p>ICSS1</p></td>
<td rowspan="12"><p>PRU1</p></td>
<td rowspan="12"><blockquote>
<div><p>OUT[0]</p>
</div></blockquote>
<blockquote>
<div><p>OUT[1]</p>
</div></blockquote>
<blockquote>
<div><p>OUT[2]</p>
</div></blockquote>
<blockquote>
<div><p>OUT[3]</p>
</div></blockquote>
<blockquote>
<div><p>Alert</p>
</div></blockquote>
<blockquote>
<div><p>EN</p>
</div></blockquote>
<blockquote>
<div><p>IN[0]</p>
</div></blockquote>
<blockquote>
<div><p>IN[1]</p>
</div></blockquote>
<blockquote>
<div><p>IN[2]</p>
</div></blockquote>
<blockquote>
<div><p>IN[3]</p>
</div></blockquote>
<blockquote>
<div><p>SCL</p>
</div></blockquote>
<blockquote>
<div><p>CS</p>
</div></blockquote>
</td>
<td><p>pr1_pru0_pru_r30_4</p></td>
<td><p>J3</p></td>
<td><p>41</p></td>
</tr>
<tr class="row-odd"><td><p>pr1_pru0_pru_r30_5</p></td>
<td><p>J3</p></td>
<td><p>42</p></td>
</tr>
<tr class="row-even"><td><p>pr1_pru0_pru_r30_6</p></td>
<td><p>J3</p></td>
<td><p>39</p></td>
</tr>
<tr class="row-odd"><td><p>pr1_pru0_pru_r30_7</p></td>
<td><p>J3</p></td>
<td><p>40</p></td>
</tr>
<tr class="row-even"><td><p>pr1_pru0_pru_r30_9</p></td>
<td><p>J3</p></td>
<td><p>29</p></td>
</tr>
<tr class="row-odd"><td><p>pr1_pru0_pru_r30_10</p></td>
<td><p>J3</p></td>
<td><p>28</p></td>
</tr>
<tr class="row-even"><td><p>pr1_pru0_pru_r30_0</p></td>
<td><p>J3</p></td>
<td><p>45</p></td>
</tr>
<tr class="row-odd"><td><p>pr1_pru0_pru_r30_1</p></td>
<td><p>J3</p></td>
<td><p>46</p></td>
</tr>
<tr class="row-even"><td><p>pr1_pru0_pru_r30_2</p></td>
<td><p>J3</p></td>
<td><p>43</p></td>
</tr>
<tr class="row-odd"><td><p>pr1_pru0_pru_r30_3</p></td>
<td><p>J3</p></td>
<td><p>44</p></td>
</tr>
<tr class="row-even"><td><p>pr1_pru0_pru_r30_8</p></td>
<td><p>J3</p></td>
<td><p>27</p></td>
</tr>
<tr class="row-odd"><td><p>pr1_pru0_pru_r30_11</p></td>
<td><p>J3</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-even"><td><p>A8</p></td>
<td><p>n/a</p></td>
<td><p>Reset</p></td>
<td><p>GPIO_3_19</p></td>
<td><p>J9</p></td>
<td><p>26</p></td>
</tr>
</tbody>
</table>
<p class="rubric" id="espi-idkam437x">idkAM437x</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 11%" />
<col style="width: 21%" />
<col style="width: 32%" />
<col style="width: 12%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Core</p></th>
<th class="head"><p>PRU</p></th>
<th class="head"><p>Functional Pin</p></th>
<th class="head"><p>GPIO Pins</p></th>
<th class="head"><p>EVM Port</p></th>
<th class="head"><p>EVM Pin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="6"><p>ICSS1</p></td>
<td rowspan="6"><p>PRU0</p></td>
<td rowspan="6"><blockquote>
<div><p>OUT[0]</p>
</div></blockquote>
<blockquote>
<div><p>Alert</p>
</div></blockquote>
<blockquote>
<div><p>EN</p>
</div></blockquote>
<blockquote>
<div><p>IN[0]</p>
</div></blockquote>
<blockquote>
<div><p>SCL</p>
</div></blockquote>
<blockquote>
<div><p>CS</p>
</div></blockquote>
</td>
<td><p>pr1_pru0_pru_r30_6</p></td>
<td><p>P16</p></td>
<td><p>49</p></td>
</tr>
<tr class="row-odd"><td><p>pr1_pru0_pru_r30_11</p></td>
<td><p>P16</p></td>
<td><p>48</p></td>
</tr>
<tr class="row-even"><td><p>pr1_pru0_pru_r30_8</p></td>
<td><p>P16</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>pr1_pru0_pru_r30_16</p></td>
<td><p>P16</p></td>
<td><p>42</p></td>
</tr>
<tr class="row-even"><td><p>pr1_pru0_pru_r30_10</p></td>
<td><p>P16</p></td>
<td><p>46</p></td>
</tr>
<tr class="row-odd"><td><p>pr1_pru0_pru_r30_9</p></td>
<td><p>P16</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>A9</p></td>
<td><p>n/a</p></td>
<td><p>Reset</p></td>
<td><p>GPIO_5_9</p></td>
<td><p>P16</p></td>
<td><p>32</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="espi-applications">
<h3>7.6.5. eSPI Applications<a class="headerlink" href="#espi-applications" title="Permalink to this headline">Â¶</a></h3>
<p>We have included a simple example test application which handles PUT_IORD_SHORT, PUT_IOWR_SHORT, PUT_MEMRD32_SHORT, and PUT_MEMWR32_SHORT packets with expected address/data values. This can be used as a starting point to build your own applications, along with the following:
- eSPI uses the MCSPI API</p>
<blockquote>
<div><ul class="simple">
<li><p>Open as MCSPI instance 2</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>HW interrupts must be enabled</dt><dd><ul>
<li><p>i.e. HwiP_enableInterrupt(espi_cfg.intNum)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>MCSPI_transfer() is blocking and takes a SPI_Transaction parameter which is used as follows:</dt><dd><ul>
<li><p>RX Transfer:
- transaction.rxBuf = &lt;some pre-allocated buffer&gt;
- transaction.txBuf = Null
- transaction.count = max packet size</p></li>
<li><p>TX Transfer:
- transaction.rxBuf = Null
- transaction.txBuf = &lt;some pre-allocated buffer&gt;
- transaction.count = &lt;size of packet&gt;</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>The application must parse the full eSPI packet, and must respond with the full proper eSPI packet (the RSP code and CRC will be taken care of by the firmware)</p></li>
</ul>
<p class="rubric" id="espi-example-application">example-application</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Refer to eSPI FW Example for details */</span>

<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>

<span class="p">...</span>

<span class="cm">/* Initialize the ESPI fw configuration */</span>
<span class="n">ESPI_socInitFwCfg</span><span class="p">();</span>

<span class="cm">/* Get the default ESPI init configurations */</span>
<span class="n">ESPI_socGetFwCfg</span><span class="p">(</span><span class="n">ESPI_INSTANCE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">espi_cfg</span><span class="p">);</span>

<span class="cm">/* Modify the default eSPI configurations if necessary */</span>

<span class="cm">/* Set the default ESPI init configurations */</span>
  <span class="n">ESPI_socSetFwCfg</span><span class="p">(</span><span class="n">ESPI_INSTANCE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">espi_cfg</span><span class="p">);</span>

<span class="cm">/* Set GPIO pin configurations */</span>
<span class="n">GPIO_setConfig</span><span class="p">(</span><span class="n">ESPI_GPIO_PIN_RESET</span><span class="p">,</span> <span class="n">GPIO_DEVICE_CONFIG</span><span class="p">(</span><span class="n">espi_cfg</span><span class="p">.</span><span class="n">resetPin</span><span class="p">.</span><span class="n">port</span><span class="p">,</span>
                                                <span class="n">espi_cfg</span><span class="p">.</span><span class="n">resetPin</span><span class="p">.</span><span class="n">pinNum</span><span class="p">)</span> <span class="o">|</span>
             <span class="n">GPIO_CFG_IN_INT_RISING</span> <span class="o">|</span> <span class="n">GPIO_CFG_INPUT</span><span class="p">);</span>

<span class="cm">/* Initialize GPIO */</span>
<span class="n">GPIO_init</span><span class="p">();</span>

<span class="cm">/* Initialize the MCSPI paramters */</span>
<span class="n">MCSPI_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mcspiParams</span><span class="p">);</span>

<span class="cm">/* Init SPI driver */</span>
<span class="n">MCSPI_init</span><span class="p">();</span>

<span class="cm">/* Enable interrupts (necessary for  */</span>
<span class="n">HwiP_enableInterrupt</span><span class="p">(</span><span class="n">espi_cfg</span><span class="p">.</span><span class="n">intNum</span><span class="p">);</span>

<span class="cm">/* Grab ESPI handle from SoC config list */</span>
<span class="n">fwHandle</span> <span class="o">=</span> <span class="p">(</span><span class="n">MCSPI_Handle</span><span class="p">)</span><span class="n">MCSPI_open</span><span class="p">(</span><span class="n">ESPI_INSTANCE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mcspiParams</span><span class="p">);</span>

<span class="p">...</span>

<span class="cm">/* Read ESPI Packet */</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">txBuf</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="cm">/* indicates we want RX */</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">rxBuf</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span> <span class="n">rxBuf</span><span class="p">;</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">ESPI_PACKET_MAX_SIZE</span><span class="p">;</span>
<span class="n">retVal</span> <span class="o">=</span> <span class="n">MCSPI_transfer</span><span class="p">(</span><span class="n">fwHandle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">transaction</span><span class="p">);</span>  <span class="cm">/* blocking */</span>

<span class="p">...</span>

<span class="cm">/* Prepare TX response */</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">txBuf</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span> <span class="n">txBuf</span><span class="p">;</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">rxBuf</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="cm">/* indicates we want TX */</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">ESPI_PACKET_MAX_SIZE</span><span class="p">;</span>

<span class="p">...</span>

<span class="cm">/* Put response in TX queue */</span>
<span class="n">retVal</span> <span class="o">=</span> <span class="n">MCSPI_transfer</span><span class="p">(</span><span class="n">fwHandle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">transaction</span><span class="p">);</span>

<span class="p">...</span>
</pre></div>
</div>
<p class="rubric" id="examples-list">Examples List</p>
<p>Refer to the Release Notes for details concerning eSPI support across different EVMs.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 32%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ESPI_FwExample</p></td>
<td><p>Driver Firmware
example application
for ESPI FW instances</p></td>
<td><p>A short write to 0xDEAD
or 0x0D0E0A0D will not
print or return anything.
A short read from 0xDEAD
or 0x0D0E0A0D will return
the command opcode + the
byte-number of the
response. A read from any
other address will return
the opcode minus the
byte-number of the
response.</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="firmware-design-guide">Firmware Design Guide</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Document</strong></p></th>
<th class="head"><p><strong>Location</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>eSPI FIRMWARE Design Guide</p></td>
<td><p>&lt;PDK&gt;/packages/ti/drv/spi/docs/ESPI_FW_DESIGN_GUIDE.doc</p></td>
</tr>
</tbody>
</table>
<p><strong>NOTE: For normal use of eSPI FW, there is no need to refer to the design guide.
This document can be cosulted in case of interest in details of internal firmware
operation, or a desire to modify the firmware.</strong></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="pru-icss-uart">
<h2>7.7. PRU-ICSS UART<a class="headerlink" href="#pru-icss-uart" title="Permalink to this headline">Â¶</a></h2>
<span class="target" id="pru-icss-uart-firmware-label"></span><div class="section" id="id1">
<h3>7.7.1. Introduction<a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h3>
<div class="line-block">
<div class="line">PRU-ICSS UART serves as an example for PRU firmware-based UART peripheral
support. The UART firmware (UART FW) allows additional UART instances for SOCs
beyond those supported by SOC hardware. The Processor SDK package includes
full source code for UART FW.</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="firmware-features">
<h3>7.7.2. FIRMWARE FEATURES<a class="headerlink" href="#firmware-features" title="Permalink to this headline">Â¶</a></h3>
<p>The following UART specifications are supported by the PRU UART firmware:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Up to 3 UARTs are supported per PRU with the following configuration options</dt><dd><ul>
<li><p>Baud rate: common baud rates up to 115200</p></li>
<li><p>Bits per transfer: 5-9 bit characters</p></li>
<li><p>Number of stop bits: 1, 1.5, 2</p></li>
<li><p>Parity: even, odd, none</p></li>
<li><p>Flow control: HW, none (SW flow control currently unsupported)</p></li>
<li><p>Full-duplex communication</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Each UART can simultaneously support different configurations</dt><dd><ul>
<li><p>UART0 can have a different baud rate, number of stop bits, etc. when
compared to UART1 or UART2 in the same PRU</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The firmware is self-contained in a single PRU</dt><dd><ul>
<li><p>The firmware does not use shared resources within an ICSS including IEP Timer and Scratchpad</p></li>
<li><p>In case 3 or less UART instances are required, only one PRU core is required for the UART firmware</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>The table below shows a comparison of the features supported by the UART
firmware with those available on hardware IP.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 34%" />
<col style="width: 35%" />
<col style="width: 31%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>UART Supported Feature</strong></p></td>
<td><p><strong>Hardware IP</strong></p></td>
<td><p><strong>Software IP (Firmware)</strong></p></td>
</tr>
<tr class="row-even"><td><p>Number of hardware instances</p></td>
<td><p>SoC dependent</p></td>
<td><p>3 (per PRU)</p></td>
</tr>
<tr class="row-odd"><td><p>Baud rates</p></td>
<td><p>SoC dependent (up to 12 Mbps)</p></td>
<td><p>All common baud rates
between 300-115200</p></td>
</tr>
<tr class="row-even"><td><p>Bits per character</p></td>
<td><p>5-8 bits</p></td>
<td><p>5-9 bits</p></td>
</tr>
<tr class="row-odd"><td><p>Number of stop bits</p></td>
<td><p>1, 1.5, 2</p></td>
<td><p>1, 1.5, 2</p></td>
</tr>
<tr class="row-even"><td><p>Parity types</p></td>
<td><p>Even, Odd, Mark, Space, none</p></td>
<td><p>Even, Odd, none</p></td>
</tr>
<tr class="row-odd"><td><p>Flow control types</p></td>
<td><p>HW, SW, none</p></td>
<td><p>HW, none</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id2">
<h3>7.7.3. Firmware Organization<a class="headerlink" href="#id2" title="Permalink to this headline">Â¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>FW Item</strong></p></td>
<td><p><strong>Directory</strong></p></td>
</tr>
<tr class="row-even"><td><p>Source code</p></td>
<td><p>&lt;PDK&gt;/packages/ti/drv/uart/firmware/icss_i2c/src</p></td>
</tr>
<tr class="row-odd"><td><p>Design Guide</p></td>
<td><p>&lt;PDK&gt;/packages/ti/drv/uart/docs</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="firmware-build-instructions">
<h3>7.7.4. Firmware Build Instructions<a class="headerlink" href="#firmware-build-instructions" title="Permalink to this headline">Â¶</a></h3>
<div class="section" id="build-instructions-from-processor-sdk-release-package">
<h4>7.7.4.1. Build instructions from Processor SDK Release package<a class="headerlink" href="#build-instructions-from-processor-sdk-release-package" title="Permalink to this headline">Â¶</a></h4>
<p class="rubric" id="uart-pre-requisites-to-building">Pre-requisites to Building</p>
<p>Refer to the Processor SDK RTOS Building page for information on setting up the build environment.</p>
<p class="rubric" id="uart-compiling-firmware">Compiling UART Firmware</p>
<ul class="simple">
<li><p>cd &lt;PDK&gt;/packages/ti/drv/uart</p></li>
<li><p>make firm</p></li>
</ul>
<p class="rubric" id="uart-compiling-driver">Compiling UART LLD</p>
<ul class="simple">
<li><p>cd &lt;PDK&gt;/packages/ti/drv/uart</p></li>
<li><p>make lib</p></li>
</ul>
<p class="rubric" id="uart-compiling-driver-firmware">Compiling UART Driver &amp; Firmware</p>
<ul class="simple">
<li><p>cd &lt;PDK&gt;/packages/</p></li>
<li><p>make uart</p></li>
</ul>
<p>Firmware binaries at the end of the firmware build will be located at:</p>
<ul class="simple">
<li><p>&lt;PDK&gt;/packages/ti/drv/uart/firmware/&lt;FIRMWARE_TYPE&gt;/bin/&lt;SOC&gt;/&lt;HOST_CORE&gt;/&lt;REVISION&gt;</p></li>
<li><p>&lt;FIRMWARE_TYPE&gt; indicates the firmware type i.e. icss_uart</p></li>
<li><p>&lt;SOC&gt; indicates the SOC type, e.g. am335x</p></li>
<li><p>&lt;HOST_CORE&gt; indicates the Host core type on which the built binary
can be loaded, e.g. a8host</p></li>
<li><p>&lt;REVISION&gt; indicates the revision of the firmware binary based on
core (there are 2 revision of PRU-ICSS core), e.g. REV1.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>7.7.5. Supported EVMs<a class="headerlink" href="#id3" title="Permalink to this headline">Â¶</a></h3>
<p>Supported EVMs and pin configurations for these EVMs are listed below. See the design document in <code class="docutils literal notranslate"><span class="pre">&lt;PDK&gt;/packages/ti/drv/uart/docs/</span></code> for more information.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 40%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>EVM Name</p></th>
<th class="head"><p>PRU-ICSS Instances</p></th>
<th class="head"><p>PRU-ICSS Revision</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bbbAM335x</p></td>
<td><p>6</p></td>
<td><p>REV1</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="bbbam335x">bbbAM335x</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 12%" />
<col style="width: 9%" />
<col style="width: 13%" />
<col style="width: 18%" />
<col style="width: 28%" />
<col style="width: 11%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ICSS</p></th>
<th class="head"><p>PRU</p></th>
<th class="head"><p>Instance</p></th>
<th class="head"><p>Functional Pin</p></th>
<th class="head"><p>PRU GPIO Pins</p></th>
<th class="head"><p>EVM Port</p></th>
<th class="head"><p>EVM Pin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="4"><p>ICSS1</p></td>
<td rowspan="4"><p>PRU0</p></td>
<td rowspan="4"><p>UART0</p></td>
<td><p>TX</p></td>
<td><p>pr1_pru0_pru_r30_0</p></td>
<td><p>P9</p></td>
<td><p>31</p></td>
</tr>
<tr class="row-odd"><td><p>RX</p></td>
<td><p>pr1_pru0_pru_r31_1</p></td>
<td><p>P9</p></td>
<td><p>29</p></td>
</tr>
<tr class="row-even"><td><p>CTS</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>RTS</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>ICSS1</p></td>
<td rowspan="4"><p>PRU0</p></td>
<td rowspan="4"><p>UART1</p></td>
<td><p>TX</p></td>
<td><p>pr1_pru0_pru_r30_2</p></td>
<td><p>P9</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-odd"><td><p>RX</p></td>
<td><p>pr1_pru0_pru_r31_3</p></td>
<td><p>P9</p></td>
<td><p>28</p></td>
</tr>
<tr class="row-even"><td><p>CTS</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>RTS</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>ICSS1</p></td>
<td rowspan="4"><p>PRU0</p></td>
<td rowspan="4"><p>UART2</p></td>
<td><p>TX</p></td>
<td><p>pr1_pru0_pru_r30_5</p></td>
<td><p>P9</p></td>
<td><p>27</p></td>
</tr>
<tr class="row-odd"><td><p>RX</p></td>
<td><p>pr1_pru0_pru_r31_7</p></td>
<td><p>P9</p></td>
<td><p>25</p></td>
</tr>
<tr class="row-even"><td><p>CTS</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>RTS</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>ICSS1</p></td>
<td rowspan="4"><p>PRU1</p></td>
<td rowspan="4"><p>UART0</p></td>
<td><p>TX</p></td>
<td><p>pr1_pru0_pru_r30_0</p></td>
<td><p>P8</p></td>
<td><p>45</p></td>
</tr>
<tr class="row-odd"><td><p>RX</p></td>
<td><p>pr1_pru0_pru_r31_1</p></td>
<td><p>P8</p></td>
<td><p>46</p></td>
</tr>
<tr class="row-even"><td><p>CTS</p></td>
<td><p>pr1_pru1_pru_r31_2</p></td>
<td><p>P8</p></td>
<td><p>43</p></td>
</tr>
<tr class="row-odd"><td><p>RTS</p></td>
<td><p>pr1_pru1_pru_r30_3</p></td>
<td><p>P8</p></td>
<td><p>44</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>ICSS1</p></td>
<td rowspan="4"><p>PRU1</p></td>
<td rowspan="4"><p>UART1</p></td>
<td><p>TX</p></td>
<td><p>pr1_pru0_pru_r30_4</p></td>
<td><p>P8</p></td>
<td><p>41</p></td>
</tr>
<tr class="row-odd"><td><p>RX</p></td>
<td><p>pr1_pru0_pru_r31_5</p></td>
<td><p>P8</p></td>
<td><p>42</p></td>
</tr>
<tr class="row-even"><td><p>CTS</p></td>
<td><p>pr1_pru1_pru_r31_6</p></td>
<td><p>P8</p></td>
<td><p>39</p></td>
</tr>
<tr class="row-odd"><td><p>RTS</p></td>
<td><p>pr1_pru1_pru_r30_7</p></td>
<td><p>P8</p></td>
<td><p>40</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>ICSS1</p></td>
<td rowspan="4"><p>PRU1</p></td>
<td rowspan="4"><p>UART2</p></td>
<td><p>TX</p></td>
<td><p>pr1_pru0_pru_r30_8</p></td>
<td><p>P8</p></td>
<td><p>27</p></td>
</tr>
<tr class="row-odd"><td><p>RX</p></td>
<td><p>pr1_pru0_pru_r31_9</p></td>
<td><p>P8</p></td>
<td><p>29</p></td>
</tr>
<tr class="row-even"><td><p>CTS</p></td>
<td><p>pr1_pru1_pru_r31_10</p></td>
<td><p>P8</p></td>
<td><p>28</p></td>
</tr>
<tr class="row-odd"><td><p>RTS</p></td>
<td><p>pr1_pru1_pru_r30_11</p></td>
<td><p>P8</p></td>
<td><p>30</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="uart-firmware-example-test">
<h3>7.7.6. UART Firmware Example &amp; Test<a class="headerlink" href="#uart-firmware-example-test" title="Permalink to this headline">Â¶</a></h3>
<p>Example are test applications are available in the package for reference purpose
and starting point.</p>
<p>The example application uses the UART stdio API to repeatedly read characters
transmitted from a PC UART. The acquired characters are then written (echoed)
back to the PC UART.</p>
<p>The test applications are more complex than the example application, and
perform many more types of UART transfers than the example application. The
test applications performs transfers using UART software IP (implemented
in PRU firmware) and hardware IPs with different combinations of UART
settings. Both the UART and UART stdio APIs are exercised (note the UART
software and hardware IPs use the same UART-LLD API). The test applications
are further described in the Firmware Design Guide.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Sample code for UART write &amp; read:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Refer to UART FW example &amp; tests for details */</span>
<span class="p">...</span>

<span class="cm">/* Initialize the UART FW configuration */</span>
<span class="n">UART_socInitFwCfg</span><span class="p">();</span>

<span class="n">Board_init</span><span class="p">(</span><span class="n">boardCfg</span><span class="p">);</span>
<span class="p">...</span>

<span class="n">UART_init</span><span class="p">();</span>

<span class="cm">/* Get the default UART init configuration */</span>
<span class="n">UART_socGetFwCfg</span><span class="p">(</span><span class="n">uartInst</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart_cfg</span><span class="p">);</span>
<span class="cm">/* Modify the default UART configurations if necessary */</span>
<span class="cm">/* Set the default UART init configurations */</span>
<span class="n">UART_socSetFwCfg</span><span class="p">(</span><span class="n">uartInst</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart_cfg</span><span class="p">);</span>
<span class="p">...</span>

<span class="n">UART_Params_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">uartParams</span><span class="p">);</span>
<span class="n">uartParams</span><span class="p">.</span><span class="n">readCallback</span> <span class="o">=</span> <span class="n">UART_callback</span><span class="p">;</span>
<span class="n">uartParams</span><span class="p">.</span><span class="n">readMode</span> <span class="o">=</span> <span class="n">UART_MODE_CALLBACK</span><span class="p">;</span>
<span class="n">uartParams</span><span class="p">.</span><span class="n">writeCallback</span> <span class="o">=</span> <span class="n">UART_callback</span><span class="p">;</span>
<span class="n">uartParams</span><span class="p">.</span><span class="n">writeMode</span> <span class="o">=</span> <span class="n">UART_MODE_CALLBACK</span><span class="p">;</span>
<span class="n">uartParams</span><span class="p">.</span><span class="n">parityType</span> <span class="o">=</span> <span class="n">UART_PAR_NONE</span><span class="p">;</span>
<span class="n">handle</span> <span class="o">=</span> <span class="n">UART_open</span><span class="p">(</span><span class="n">uartInst</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uartParams</span><span class="p">);</span>
<span class="p">...</span>

<span class="cm">/* Initiate UART write */</span>
<span class="n">UART_transactionInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wrCbTransaction</span><span class="p">);</span>
<span class="n">wrCbTransaction</span><span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">wrBuff</span><span class="p">;</span>
<span class="n">wrCbTransaction</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">wrBuffer</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">UART_write2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wrCbTransaction</span><span class="p">)</span> <span class="o">==</span> <span class="n">UART_ERROR</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* UART write failed */</span>
<span class="p">}</span>
<span class="p">...</span>

<span class="cm">/* Initiate UART read */</span>
<span class="n">UART_transactionInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rdCbTransaction</span><span class="p">);</span>
<span class="n">rdCbTransaction</span><span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">rdBuff</span><span class="p">;</span>
<span class="n">rdCbTransaction</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">rdBuffer</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">UART_read2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">callbackTransaction</span><span class="p">)</span> <span class="o">==</span> <span class="n">UART_ERROR</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* UART read failed */</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="examples-tests-list">List of Examples &amp; Tests</p>
<p>Refer to the Release Notes for details concerning UART support across different EVMs.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 35%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>UART_FwExample</p></td>
<td><p>Example application
for PRU UART FW driver</p></td>
<td><p>Status messages will
be displayed on
console based based
on pass/fail criteria:</p>
<p><strong>Pass criteria:</strong></p>
<p>All Passed</p>
</td>
</tr>
<tr class="row-odd"><td><p>UART_FwTest</p></td>
<td><p>Simple test application
for PRU UART FW driver</p></td>
<td><p>Status messages will
be displayed on
console based on
pass/fail criteria:</p>
<p><strong>Pass criteria:</strong></p>
<p>All tests have
passed.</p>
</td>
</tr>
<tr class="row-even"><td><p>UART_FwTestExtLb</p></td>
<td><p>More complex test
test application
for PRU UART FW driver,
superset of UART_FwTest</p></td>
<td><p>Status messages will
be displayed on
console based on
pass/fail criteria:</p>
<p><strong>Pass criteria:</strong></p>
<p>All tests have
passed.</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="id4">Firmware Design Guide</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Document</strong></p></td>
<td><p><strong>Location</strong></p></td>
</tr>
<tr class="row-even"><td><p>UART Firmware Design Guide</p></td>
<td><p>&lt;PDK&gt;/packages/ti/drv/uart/docs/UART_FW_DESIGN_GUIDE.pdf</p></td>
</tr>
</tbody>
</table>
<p><strong>NOTE: Design document includes details for internal firmware implementation and
can be used in case of modification required for firmware.</strong></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="index_pru_icss_fw.html" class="btn btn-neutral float-right" title="7.1. Dual EMAC and Switch" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index_device_drv.html" class="btn btn-neutral" title="6.1. CSL" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2019</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'06_01_00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>